<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/hedgehog.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/hedgehog.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tongsiying.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","b2t":true,"scrollpercent":true,"padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="第42篇：Django基础">
<meta property="og:url" content="https://tongsiying.github.io/2022/02/07/python/python_%E5%9F%BA%E7%A1%80%E7%AF%87/%E7%AC%AC42%E7%AF%87%EF%BC%9ADjango%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="tongsiying">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
<meta property="og:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
<meta property="og:image" content="https://tongsiying.github.io/2022/02/07/python/python_%E5%9F%BA%E7%A1%80%E7%AF%87/%E7%AC%AC42%E7%AF%87%EF%BC%9ADjango%E5%9F%BA%E7%A1%80/1476293-20190227192412223-521332498.png">
<meta property="og:image" content="https://tongsiying.github.io/2022/02/07/python/python_%E5%9F%BA%E7%A1%80%E7%AF%87/%E7%AC%AC42%E7%AF%87%EF%BC%9ADjango%E5%9F%BA%E7%A1%80/1476293-20190227192334717-152742654.png">
<meta property="og:image" content="https://tongsiying.github.io/2022/02/07/python/python_%E5%9F%BA%E7%A1%80%E7%AF%87/%E7%AC%AC42%E7%AF%87%EF%BC%9ADjango%E5%9F%BA%E7%A1%80/1476293-20190227192347134-372083611.png">
<meta property="og:image" content="https://tongsiying.github.io/2022/02/07/python/python_%E5%9F%BA%E7%A1%80%E7%AF%87/%E7%AC%AC42%E7%AF%87%EF%BC%9ADjango%E5%9F%BA%E7%A1%80/1476293-20190227192310446-2081010981.png">
<meta property="og:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
<meta property="og:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
<meta property="og:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
<meta property="og:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
<meta property="og:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
<meta property="og:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
<meta property="og:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
<meta property="og:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
<meta property="og:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
<meta property="og:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
<meta property="og:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
<meta property="og:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
<meta property="article:published_time" content="2022-02-07T14:22:21.972Z">
<meta property="article:modified_time" content="2022-02-07T14:37:28.273Z">
<meta property="article:author" content="tongsiying">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">

<link rel="canonical" href="https://tongsiying.github.io/2022/02/07/python/python_%E5%9F%BA%E7%A1%80%E7%AF%87/%E7%AC%AC42%E7%AF%87%EF%BC%9ADjango%E5%9F%BA%E7%A1%80/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>第42篇：Django基础 | tongsiying</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
<!-- 加入APlayer音乐播放器 -->
<link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>
  <div class="container use-motion">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">tongsiying</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">阅读|运动|自律</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/catalog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-目录">

    <a href="/catalog/" rel="section"><i class="fa fa fa-th fa-fw"></i>目录</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-读书清单">

    <a href="/read" rel="section"><i class="fa fa-book fa-fw"></i>读书清单</a>

  </li>
        <li class="menu-item menu-item-读书笔记">

    <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="section"><i class="fa fa-book fa-fw"></i>读书笔记</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tongsiying.github.io/2022/02/07/python/python_%E5%9F%BA%E7%A1%80%E7%AF%87/%E7%AC%AC42%E7%AF%87%EF%BC%9ADjango%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/gutianle.gif">
      <meta itemprop="name" content="tongsiying">
      <meta itemprop="description" content="问渠那得清如许？为有源头活水来。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tongsiying">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          第42篇：Django基础
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-02-07 22:22:21 / 修改时间：22:37:28" itemprop="dateCreated datePublished" datetime="2022-02-07T22:22:21+08:00">2022-02-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>32k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>29 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p class="description"></p>
<a id="more"></a> 

<h1 id="一、常用命令"><a href="#一、常用命令" class="headerlink" title="一、常用命令"></a>一、常用命令</h1><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> django-admin startproject mysite</span><br><span class="line"><span class="number">2.</span> python manage.py startapp blog  建立一个app应用</span><br><span class="line"><span class="number">3.</span> mysite.settings 中INSTALLED_APPS[]中添加blog</span><br><span class="line"><span class="symbol">4 </span>.python manage.py runserver <span class="number">8080</span> 开启服务器</span><br><span class="line"><span class="number">5.</span> python manage.py <span class="keyword">shell</span> 进入当前django环境</span><br><span class="line"><span class="symbol">6 </span>python manage.py makemigrations</span><br><span class="line"><span class="number">7.</span>python manage.py migrate</span><br></pre></td></tr></table></figure>



<h1 id="二、配置文件"><a href="#二、配置文件" class="headerlink" title="二、配置文件"></a>二、配置文件</h1><h2 id="1-配置"><a href="#1-配置" class="headerlink" title="1.  配置"></a>1.  配置</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">模板文件路径： <span class="string">'DIRS'</span>: [os.path.join(BASE_DIR,<span class="string">'templates'</span>)],</span><br><span class="line">    静态文件路径： STATIC_URL = <span class="string">'/static/'</span>  #别名</span><br><span class="line">                   STATICFILES_DIRS = (</span><br><span class="line">                             os.path.join(BASE_DIR,<span class="string">'blog'</span>,<span class="string">'static'</span>),</span><br><span class="line">                             )</span><br><span class="line">    输出台打印ORM执行的sql语句</span><br><span class="line">               <span class="built_in"> LOGGING </span>= &#123;</span><br><span class="line">                    <span class="string">'version'</span>: 1,</span><br><span class="line">                    <span class="string">'disable_existing_loggers'</span>: <span class="literal">False</span>,</span><br><span class="line">                    <span class="string">'handlers'</span>: &#123;</span><br><span class="line">                        <span class="string">'console'</span>:&#123;</span><br><span class="line">                            <span class="string">'level'</span>:<span class="string">'DEBUG'</span>,</span><br><span class="line">                            <span class="string">'class'</span>:<span class="string">'logging.StreamHandler'</span>,</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">'loggers'</span>: &#123;</span><br><span class="line">                        <span class="string">'django.db.backends'</span>: &#123;</span><br><span class="line">                            <span class="string">'handlers'</span>: [<span class="string">'console'</span>],</span><br><span class="line">                            <span class="string">'propagate'</span>: <span class="literal">True</span>,</span><br><span class="line">                            <span class="string">'level'</span>:<span class="string">'DEBUG'</span>,</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">    配置数据库: 1.sqlite</span><br><span class="line">                    <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.sqlite3'</span>,</span><br><span class="line">                    <span class="string">'NAME'</span>: os.path.join(BASE_DIR, <span class="string">'db.sqlite3'</span>),</span><br><span class="line">                2.mysql</span><br><span class="line">                    <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">                    <span class="string">'NAME'</span>: <span class="string">'sxmu'</span>,</span><br><span class="line">                    <span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">                    <span class="string">'PASSWORD'</span>: <span class="string">'0000'</span>,</span><br><span class="line">                    <span class="string">'HOST'</span>: <span class="string">'localhost'</span>,</span><br><span class="line">                    <span class="string">'PORT'</span>: <span class="string">'3306'</span>,</span><br><span class="line">    数据库连接MySql(使用ORM必须配置)</span><br><span class="line">    在项目的__init__.py中配置：import pymysql</span><br><span class="line"> </span><br><span class="line">                               pymysql.install_as_MySQLdb()</span><br><span class="line">         </span><br><span class="line">    LANGUAGE_CODE = <span class="string">'zh-hans'</span>  #<span class="string">'en-us'</span></span><br><span class="line"> </span><br><span class="line">    TIME_ZONE = <span class="string">'Asia/Shanghai'</span></span><br><span class="line">    注：import pytz</span><br><span class="line">        pytz.common_timezones_set  #获取所有时区</span><br><span class="line">        pytz.country_timezones(<span class="string">'cn'</span>)  #获取中国时区</span><br><span class="line">        重新加载css/js文件，删除浏览器缓存</span><br></pre></td></tr></table></figure>



<h2 id="2-读取配置文件"><a href="#2-读取配置文件" class="headerlink" title="2. 读取配置文件"></a>2. 读取配置文件</h2><p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> django中读取settings文件源码</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Settings</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, settings_module)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="comment"># update this dict from global settings (but only for ALL_CAPS settings)</span></span><br><span class="line">        <span class="keyword">for</span> setting <span class="keyword">in</span> dir(global_settings)<span class="symbol">:</span></span><br><span class="line">            <span class="keyword">if</span> setting.isupper()<span class="symbol">:</span></span><br><span class="line">                setattr(<span class="keyword">self</span>, setting, getattr(global_settings, setting))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># store the settings module in case someone later cares</span></span><br><span class="line">        <span class="keyword">self</span>.SETTINGS_MODULE = settings_module</span><br><span class="line"></span><br><span class="line">        mod = importlib.import_module(<span class="keyword">self</span>.SETTINGS_MODULE)</span><br><span class="line"></span><br><span class="line">        tuple_settings = (</span><br><span class="line">            <span class="string">"INSTALLED_APPS"</span>,</span><br><span class="line">            <span class="string">"TEMPLATE_DIRS"</span>,</span><br><span class="line">            <span class="string">"LOCALE_PATHS"</span>,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">self</span>._explicit_settings = set()</span><br><span class="line">        <span class="keyword">for</span> setting <span class="keyword">in</span> dir(mod)<span class="symbol">:</span></span><br><span class="line">            <span class="keyword">if</span> setting.isupper()<span class="symbol">:</span></span><br><span class="line">                setting_value = getattr(mod, setting)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (setting <span class="keyword">in</span> tuple_settings <span class="keyword">and</span></span><br><span class="line">                        <span class="keyword">not</span> isinstance(setting_value, (list, tuple)))<span class="symbol">:</span></span><br><span class="line">                    raise ImproperlyConfigured(<span class="string">"The %s setting must be a list or a tuple. "</span> % setting)</span><br><span class="line">                setattr(<span class="keyword">self</span>, setting, setting_value)</span><br><span class="line">                <span class="keyword">self</span>._explicit_settings.add(setting)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">self</span>.<span class="symbol">SECRET_KEY:</span></span><br><span class="line">            raise ImproperlyConfigured(<span class="string">"The SECRET_KEY setting must not be empty."</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.is_overridden(<span class="string">'DEFAULT_CONTENT_TYPE'</span>)<span class="symbol">:</span></span><br><span class="line">            warnings.warn(<span class="string">'The DEFAULT_CONTENT_TYPE setting is deprecated.'</span>, RemovedInDjango30Warning)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> hasattr(time, <span class="string">'tzset'</span>) <span class="keyword">and</span> <span class="keyword">self</span>.<span class="symbol">TIME_ZONE:</span></span><br><span class="line">            <span class="comment"># When we can, attempt to validate the timezone. If we can't find</span></span><br><span class="line">            <span class="comment"># this file, no check happens and it's harmless.</span></span><br><span class="line">            zoneinfo_root = <span class="string">'/usr/share/zoneinfo'</span></span><br><span class="line">            <span class="keyword">if</span> (os.path.exists(zoneinfo_root) <span class="keyword">and</span> <span class="keyword">not</span></span><br><span class="line">                    os.path.exists(os.path.join(zoneinfo_root, *(<span class="keyword">self</span>.TIME_ZONE.split(<span class="string">'/'</span>)))))<span class="symbol">:</span></span><br><span class="line">                raise ValueError(<span class="string">"Incorrect timezone setting: %s"</span> % <span class="keyword">self</span>.TIME_ZONE)</span><br><span class="line">            <span class="comment"># Move the time zone info into os.environ. See ticket #2315 for why</span></span><br><span class="line">            <span class="comment"># we don't do this unconditionally (breaks Windows).</span></span><br><span class="line">            os.environ[<span class="string">'TZ'</span>] = <span class="keyword">self</span>.TIME_ZONE</span><br><span class="line">            time.tzset()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_overridden</span><span class="params">(<span class="keyword">self</span>, setting)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> setting <span class="keyword">in</span> <span class="keyword">self</span>._explicit_settings</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;%(cls)s "%(settings_module)s"&gt;'</span> % &#123;</span><br><span class="line">            <span class="string">'cls'</span>: <span class="keyword">self</span>.__class_<span class="number">_</span>.__name_<span class="number">_</span>,</span><br><span class="line">            <span class="string">'settings_module'</span>: <span class="keyword">self</span>.SETTINGS_MODULE,</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-补充："><a href="#3-补充：" class="headerlink" title="3. 补充："></a>3. 补充：</h2><p><strong>根据字符串的形式，自动导入模块并使用反射找到模块中的类，执行指定的方法</strong></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">步骤：</span><br><span class="line">    <span class="number">1.</span> rsplit(<span class="string">'.'</span>,maxsplit=<span class="number">1</span>) 分割字符串为模块和类</span><br><span class="line">    <span class="number">2.</span> importlib导入模块</span><br><span class="line">    <span class="number">3.</span> 用反射获取模块中指定的类</span><br><span class="line">    <span class="number">4.</span> 将该类实例化成对象</span><br><span class="line">    <span class="number">5.</span> 执行对象指定的方法</span><br></pre></td></tr></table></figure>

<p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> run.py</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">import</span> importlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串路径</span></span><br><span class="line"><span class="attr">path</span> = <span class="string">"auth.crsf.CORS"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分割字符串</span></span><br><span class="line">module_path,<span class="attr">class_name</span> = path.rsplit('.',<span class="attr">maxsplit=1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据字符串的形式导入模块</span></span><br><span class="line"><span class="attr">m</span> = importlib.import_module(module_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取模块中指定的类</span></span><br><span class="line"><span class="attr">cls</span> = getattr(m,class_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类实例化</span></span><br><span class="line"><span class="attr">obj</span> = cls()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行对象指定的方法</span></span><br><span class="line">obj.process_request()</span><br></pre></td></tr></table></figure>



<h2 id="4-django入口"><a href="#4-django入口" class="headerlink" title="4. django入口"></a>4. django入口</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.wsgi <span class="keyword">import</span> WSGIHandler</span><br></pre></td></tr></table></figure>



<h1 id="三、urls：路由分发"><a href="#三、urls：路由分发" class="headerlink" title="三、urls：路由分发"></a>三、urls：路由分发</h1><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">URL配置(URLconf)就像Django 所支撑网站的目录。它的本质是URL模式以及要为该URL模式调用的视图函数之间的映射表；你就是以这种方式告诉Django，对于这个URL调用这段代码，</span><br><span class="line">对于那个URL调用那段代码。</span><br><span class="line">    urlpatterns = [</span><br><span class="line">        url(regex, <span class="keyword">view</span>, kwargs=<span class="keyword">None</span>, <span class="type">name</span>=<span class="keyword">None</span>)</span><br><span class="line">        path(route, <span class="keyword">view</span>, kwargs=<span class="keyword">None</span>, <span class="type">name</span>=<span class="keyword">None</span>),</span><br><span class="line">        re_path(regex, <span class="keyword">view</span>, kwargs=<span class="keyword">None</span>, <span class="type">name</span>=<span class="keyword">None</span>)</span><br><span class="line">    ]</span><br><span class="line">     </span><br><span class="line">    参数说明：</span><br><span class="line">        roote: url路径</span><br><span class="line">        regex: 一个正则表达式字符串</span><br><span class="line">        <span class="keyword">view</span>: 一个可调用对象，通常为一个视图函数或一个指定视图函数路径的字符串</span><br><span class="line">            这里的<span class="keyword">view</span>可以是<span class="keyword">include</span>(arg, namespace=<span class="keyword">None</span>)  命名空间，用于不同app别名相同时的路径分流，注意：当配置namespace时，app的urls.py中也要配置app_name</span><br><span class="line">        kwargs: 可选的要传递给视图函数的默认参数（字典形式）</span><br><span class="line">        <span class="type">name</span>: url的别名，一个可选的<span class="type">name</span>参数， 用于反向解析</span><br></pre></td></tr></table></figure>

<h2 id="1-例子"><a href="#1-例子" class="headerlink" title="1. 例子"></a>1. <strong>例子</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>项目.urls.py</span><br><span class="line">    <span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line">    <span class="keyword">from</span> django.urls <span class="keyword">import</span> path,include</span><br><span class="line">    <span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line">     </span><br><span class="line">    urlpatterns = [</span><br><span class="line">        path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">        path(<span class="string">'app01/'</span>,include(<span class="string">'app01.urls'</span>,namespace=<span class="string">'app01'</span>)),   <span class="comment"># namespace: 命名空间，1. 起到路径分流的作用 2. 别名重复时反向解析的问题</span></span><br><span class="line">        path(<span class="string">'login/'</span>,views.login,name=<span class="string">'login'</span>),    <span class="comment"># name: 给url起别名，用于反向解析</span></span><br><span class="line">        path(<span class="string">''</span>,views.index),</span><br><span class="line">        path(<span class="string">'index/'</span>,views.index1,name=<span class="string">'index'</span>),</span><br><span class="line">        path(<span class="string">'logout/'</span>, views.logout,name=<span class="string">'logout'</span>),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>app.urls.py</span><br><span class="line">    <span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line">    <span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"> </span><br><span class="line">    app_name = <span class="string">'app01'</span></span><br><span class="line"> </span><br><span class="line">    urlpatterns = [</span><br><span class="line">        url(<span class="string">r'^article/(?P&lt;year&gt;\d&#123;4&#125;)/(?P&lt;month&gt;\d&#123;2&#125;)/(?P&lt;day&gt;\d+)$'</span>, views.article_year_month, name=<span class="string">'article'</span>),</span><br><span class="line">        url(<span class="string">r'addbook'</span>, views.addbook, name=<span class="string">'addbook'</span>),</span><br><span class="line">        url(<span class="string">r'update'</span>, views.update, name=<span class="string">'update'</span>),</span><br><span class="line">        url(<span class="string">r'delete'</span>, views.delete, name=<span class="string">'delete'</span>),</span><br><span class="line">        url(<span class="string">r'select'</span>, views.select, name=<span class="string">'select'</span>),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>



<h2 id="2-django2-0版的path"><a href="#2-django2-0版的path" class="headerlink" title="2. django2.0版的path"></a>2. django2.0版的path</h2><p>使用尖括号(&lt;&gt;)从url中捕获值。<br>捕获值中可以包含一个转化器类型（converter type），比如使用 捕获一个整数变量。若果没有转化器，将匹配任何字符串，当然也包括了 / 字符。<br>  <img src="/2022/02/07/python/python_%E5%9F%BA%E7%A1%80%E7%AF%87/%E7%AC%AC42%E7%AF%87%EF%BC%9ADjango%E5%9F%BA%E7%A1%80/1476293-20190227192412223-521332498.png" alt="img"></p>
<p>  <a href="int:year" rel="external nofollow noreferrer">int:year</a>这种写法直接会对取值进行转换，转换成数值类型（这个int跟python内置的int方法不一样，这是django</p>
<p>  带的转换方法），而且指明了接收参数的名称为year，所以视图函数写法如下。</p>
<p><img src="/2022/02/07/python/python_%E5%9F%BA%E7%A1%80%E7%AF%87/%E7%AC%AC42%E7%AF%87%EF%BC%9ADjango%E5%9F%BA%E7%A1%80/1476293-20190227192334717-152742654.png" alt="img"></p>
<p> <img src="/2022/02/07/python/python_%E5%9F%BA%E7%A1%80%E7%AF%87/%E7%AC%AC42%E7%AF%87%EF%BC%9ADjango%E5%9F%BA%E7%A1%80/1476293-20190227192347134-372083611.png" alt="img"></p>
<p>  除了int转换器，还有其他的，如下</p>
<p> <img src="/2022/02/07/python/python_%E5%9F%BA%E7%A1%80%E7%AF%87/%E7%AC%AC42%E7%AF%87%EF%BC%9ADjango%E5%9F%BA%E7%A1%80/1476293-20190227192310446-2081010981.png" alt="img"></p>
<h1 id="四、视图函数（views）"><a href="#四、视图函数（views）" class="headerlink" title="四、视图函数（views）"></a>四、视图函数（views）</h1><p>http请求中产生两个核心对象：</p>
<p>http请求：HttpRequest对象</p>
<p>http响应：HttpResponse对象</p>
<p>所在位置：django.http</p>
<p>之前我们用到的参数request就是HttpRequest 检测方法：isinstance(request,HttpRequest)</p>
<h2 id="1-HttpRequest对象的属性和方法："><a href="#1-HttpRequest对象的属性和方法：" class="headerlink" title="1. HttpRequest对象的属性和方法："></a>1. HttpRequest对象的属性和方法：</h2><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"># path：       请求页面的全路径，不包括域名</span><br><span class="line">       #</span><br><span class="line">       # method：     请求中使用的HTTP方法的字符串表示。全大写表示。例如</span><br><span class="line">       #</span><br><span class="line">       #                    <span class="keyword">if</span>  req.method==<span class="string">"GET"</span>:</span><br><span class="line">       #</span><br><span class="line">       #                              do_something()</span><br><span class="line">       #</span><br><span class="line">       #                    elseif req.method==<span class="string">"POST"</span>:</span><br><span class="line">       #</span><br><span class="line">       #                              do_something_else()</span><br><span class="line">       #</span><br><span class="line">       # GET:         包含所有HTTP GET参数的类字典对象</span><br><span class="line">       #</span><br><span class="line">       # POST：       包含所有HTTP POST参数的类字典对象</span><br><span class="line">       #</span><br><span class="line">       #              服务器收到空的POST请求的情况也是可能发生的，也就是说，表单form通过</span><br><span class="line">       #              HTTP POST方法提交请求，但是表单中可能没有数据，因此不能使用</span><br><span class="line">       #              <span class="keyword">if</span> req.POST来判断是否使用了HTTP POST 方法；应该使用  <span class="keyword">if</span> req.method==<span class="string">"POST"</span></span><br><span class="line">       #</span><br><span class="line">       #</span><br><span class="line">       #</span><br><span class="line">       # COOKIES:     包含所有cookies的标准Python字典对象；keys和values都是字符串。</span><br><span class="line">       #</span><br><span class="line">       # FILES：      包含所有上传文件的类字典对象；FILES中的每一个Key都是&lt;input type=<span class="string">"file"</span> name=<span class="string">""</span> /&gt;标签中                     name属性的值，FILES中的每一个value同时也是一个标准的python字典对象，包含下面三个Keys：</span><br><span class="line">       #</span><br><span class="line">       #             filename：      上传文件名，用字符串表示</span><br><span class="line">       #             content_type:   上传文件的Content Type</span><br><span class="line">       #             content：       上传文件的原始内容</span><br><span class="line">       #</span><br><span class="line">       #</span><br><span class="line">       # user：       是一个django.contrib.auth.models.User对象，代表当前登陆的用户。如果访问用户当前</span><br><span class="line">       #              没有登陆，user将被初始化为django.contrib.auth.models.AnonymousUser的实例。你</span><br><span class="line">       #              可以通过user的is_authenticated()方法来辨别用户是否登陆：</span><br><span class="line">       #              <span class="keyword">if</span> req.user.is_authenticated();只有激活Django中的AuthenticationMiddleware</span><br><span class="line">       #              时该属性才可用</span><br><span class="line">       #</span><br><span class="line">       # session：    唯一可读写的属性，代表当前会话的字典对象；自己有激活Django中的session支持时该属性才可用。</span><br><span class="line"> </span><br><span class="line">       #方法</span><br><span class="line">       get_full_path(),   比如：http:<span class="comment">//127.0.0.1:8000/index33/?name=123 ,req.get_full_path()得到的结果就是/index33/?name=123</span></span><br><span class="line">       req.path:/index33</span><br><span class="line">        </span><br><span class="line">   注意一个常用方法：request.POST.getlist(<span class="string">'hooby'</span>),取多个值，常用于取多选框中的值</span><br></pre></td></tr></table></figure>



<h2 id="2-HttpResponse对象："><a href="#2-HttpResponse对象：" class="headerlink" title="2. HttpResponse对象："></a>2. HttpResponse对象：</h2><p>对于HttpRequest对象来说，是由django自动创建的，但是，HttpResponse对象就必须我们自己创建。每个view请求处理方法必须返回一个HttpResponse对象。</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">HttpResponse类在django.<span class="keyword">http</span>.HttpResponse</span><br><span class="line"> </span><br><span class="line">      在HttpResponse对象上扩展的常用方法：</span><br><span class="line">        返回内容： HttpResponse('内容')</span><br><span class="line">         </span><br><span class="line">        页面渲染： render(request,'模板路径',&#123;&#125;)（推荐）                </span><br><span class="line">                   render_to_response(’模板路径',&#123;&#125;),</span><br><span class="line">        页面跳转： redirect(<span class="string">"路径"</span>)</span><br><span class="line">         </span><br><span class="line">        locals()：    可以直接将函数中所有的变量传给模板</span><br><span class="line">        context=&#123;&#125;    将字典对象传递给模板</span><br><span class="line">         </span><br><span class="line">      注：本质--f = <span class="keyword">open</span>('templates/index.html','r')</span><br><span class="line">                data = f.<span class="keyword">read</span>()</span><br><span class="line">                f.<span class="keyword">close</span>()</span><br><span class="line">                <span class="keyword">return</span> HttpResponse(data)</span><br><span class="line">                ===================================</span><br><span class="line"><span class="comment">                #打开index.html读取数据，含有特殊标记</span></span><br><span class="line"><span class="comment">                #替换渲染 ==&gt;新字符串</span></span><br><span class="line"><span class="comment">                #返回给用户</span></span><br><span class="line">                <span class="keyword">return</span> render(request,'index.html,&#123;'k1':'k2')</span><br></pre></td></tr></table></figure>



<h1 id="五、models"><a href="#五、models" class="headerlink" title="五、models"></a>五、models</h1><p>model(数据库模型) —&gt; ORM(object relation mapping)对象关系映射<br>一些重要概念：</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.类 -&gt; 数据库表 <span class="keyword">class</span> Student():</span><br><span class="line"><span class="number">2</span>.类属性 -&gt; 数据库表的一列 username = models.CharFiled(...)</span><br><span class="line"><span class="number">3</span>.类的对象 -&gt; 数据库表的一行记录 student = Student()</span><br><span class="line"><span class="number">4</span>.一对多 ==&gt; PK字段代指关联表中的一行数据（类的对象）</span><br><span class="line"><span class="number">5</span>.多对多 ==&gt; M<span class="number">2M</span>字段，自动生成第三张表，依赖关联表对第三张表间接操作。</span><br><span class="line"><span class="number">6</span>.数据库获取数据</span><br><span class="line">--[obj,obj,obj...] .all,.filter</span><br><span class="line">--[&#123;&#125;,&#123;&#125;,&#123;&#125;...] .values</span><br><span class="line">--[(),(),()...] .values<span class="number">_</span>list</span><br><span class="line">--[obj(<span class="keyword">value</span><span class="number">1</span>, <span class="keyword">value</span><span class="number">2</span>), obj(<span class="keyword">value</span><span class="number">1</span>,<span class="keyword">value</span><span class="number">2</span>)], only(<span class="keyword">value</span><span class="number">1</span>, <span class="keyword">value</span><span class="number">2</span>) / defer(<span class="keyword">value</span><span class="number">3</span>,..)</span><br></pre></td></tr></table></figure>

<h2 id="1-创建类"><a href="#1-创建类" class="headerlink" title="1.创建类"></a><strong>1.创建类</strong></h2><p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> 模型常用字段类型　</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">&lt;1&gt;</span> CharField</span><br><span class="line">                    <span class="comment">#字符串字段, 用于较短的字符串.</span></span><br><span class="line">                    <span class="comment">#CharField 要求必须有一个参数 max_length, 用于从数据库层和Django校验层限制该字段所允许的最大字符数.</span></span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;2&gt;</span> IntegerField   4个字节  0-4294967296</span><br><span class="line">                       <span class="comment">#用于保存一个整数.</span></span><br><span class="line">                    SmallIntegerField   2个字节 0-65535</span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;3&gt;</span> FloatField</span><br><span class="line">                        <span class="comment"># 一个浮点数. 必须 提供两个参数:</span></span><br><span class="line">                        <span class="comment">#</span></span><br><span class="line">                        <span class="comment"># 参数    描述</span></span><br><span class="line">                        <span class="comment"># max_digits    总位数(不包括小数点和符号)</span></span><br><span class="line">                        <span class="comment"># decimal_places    小数位数</span></span><br><span class="line">                                <span class="comment"># 举例来说, 要保存最大值为 999 (小数点后保存2位),你要这样定义字段:</span></span><br><span class="line">                                <span class="comment">#</span></span><br><span class="line">                                <span class="comment"># models.FloatField(..., max_digits=5, decimal_places=2)</span></span><br><span class="line">                                <span class="comment"># 要保存最大值一百万(小数点后保存10位)的话,你要这样定义:</span></span><br><span class="line">                                <span class="comment">#</span></span><br><span class="line">                                <span class="comment"># models.FloatField(..., max_digits=19, decimal_places=10)</span></span><br><span class="line">                                <span class="comment"># admin 用一个文本框(&lt;input type="text"&gt;)表示该字段保存的数据.</span></span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;4&gt;</span> AutoField</span><br><span class="line">                        <span class="comment"># 一个 IntegerField, 添加记录时它会自动增长. 你通常不需要直接使用这个字段; </span></span><br><span class="line">                        <span class="comment"># 自定义一个主键：my_id=models.AutoField(primary_key=True)</span></span><br><span class="line">                        <span class="comment"># 如果你不指定主键的话,系统会自动添加一个主键字段到你的 model.</span></span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;5&gt;</span> BooleanField</span><br><span class="line">                        <span class="comment"># A true/false field. admin 用 checkbox 来表示此类字段.</span></span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;6&gt;</span> TextField</span><br><span class="line">                        <span class="comment"># 一个容量很大的文本字段.</span></span><br><span class="line">                        <span class="comment"># admin 用一个 &lt;textarea&gt; (文本区域)表示该字段数据.(一个多行编辑框).</span></span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;7&gt;</span> EmailField</span><br><span class="line">                        <span class="comment"># 一个带有检查Email合法性的 CharField,不接受 maxlength 参数.</span></span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;8&gt;</span> DateField</span><br><span class="line">                        <span class="comment"># 一个日期字段. 共有下列额外的可选参数:</span></span><br><span class="line">                        <span class="comment"># Argument    描述</span></span><br><span class="line">                        <span class="comment"># auto_now    当对象被保存时,自动将该字段的值设置为当前时间.通常用于表示 "last-modified" 时间戳.</span></span><br><span class="line">                        <span class="comment"># auto_now_add    当对象首次被创建时,自动将该字段的值设置为当前时间.通常用于表示对象创建时间.</span></span><br><span class="line">                        <span class="comment">#（仅仅在admin中有意义...)</span></span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;9&gt;</span> DateTimeField</span><br><span class="line">                        <span class="comment">#  一个日期时间字段. 类似 DateField 支持同样的附加选项.</span></span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;10&gt;</span> ImageField</span><br><span class="line">                        <span class="comment"># 类似 FileField, 不过要校验上传对象是否是一个合法图片.#它有两个可选参数:height_field和width_field,</span></span><br><span class="line">                        <span class="comment"># 如果提供这两个参数,则图片将按提供的高度和宽度规格保存.     </span></span><br><span class="line">                <span class="variable">&lt;11&gt;</span> FileField</span><br><span class="line">                     <span class="comment"># 一个文件上传字段.</span></span><br><span class="line">                     <span class="comment">#要求一个必须有的参数: upload_to, 一个用于保存上载文件的本地文件系统路径. 这个路径必须包含 strftime #formatting, </span></span><br><span class="line">                     <span class="comment">#该格式将被上载文件的 date/time </span></span><br><span class="line">                     <span class="comment">#替换(so that uploaded files don't fill up the given directory).</span></span><br><span class="line">                     <span class="comment"># admin 用一个&lt;input type="file"&gt;部件表示该字段保存的数据(一个文件上传部件) .</span></span><br><span class="line"></span><br><span class="line">                     <span class="comment">#注意：在一个 model 中使用 FileField 或 ImageField 需要以下步骤:</span></span><br><span class="line">                            <span class="comment">#（1）在你的 settings 文件中, 定义一个完整路径给 MEDIA_ROOT 以便让 Django在此处保存上传文件. </span></span><br><span class="line">                            <span class="comment"># (出于性能考虑,这些文件并不保存到数据库.) 定义MEDIA_URL 作为该目录的公共 URL. 要确保该目录对 </span></span><br><span class="line">                            <span class="comment">#  WEB服务器用户帐号是可写的.</span></span><br><span class="line">                            <span class="comment">#（2） 在你的 model 中添加 FileField 或 ImageField, 并确保定义了 upload_to 选项,以告诉 Django</span></span><br><span class="line">                            <span class="comment"># 使用 MEDIA_ROOT 的哪个子目录保存上传文件.你的数据库中要保存的只是文件的路径(相对于 MEDIA_ROOT). </span></span><br><span class="line">                            <span class="comment"># 出于习惯你一定很想使用 Django 提供的 get_&lt;#fieldname&gt;_url 函数.举例来说,如果你的 ImageField </span></span><br><span class="line">                            <span class="comment"># 叫作 mug_shot, 你就可以在模板中以 &#123;&#123; object.#get_mug_shot_url &#125;&#125; 这样的方式得到图像的绝对路径.</span></span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;12&gt;</span> URLField</span><br><span class="line">                      <span class="comment"># 用于保存 URL. 若 verify_exists 参数为 True (默认), 给定的 URL 会预先检查是否存在( 即URL是否被有效装入且</span></span><br><span class="line">                      <span class="comment"># 没有返回404响应).</span></span><br><span class="line">                      <span class="comment"># admin 用一个 &lt;input type="text"&gt; 文本框表示该字段保存的数据(一个单行编辑框)</span></span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;13&gt;</span> NullBooleanField</span><br><span class="line">                       <span class="comment"># 类似 BooleanField, 不过允许 NULL 作为其中一个选项. 推荐使用这个字段而不要用 BooleanField 加 null=True 选项</span></span><br><span class="line">                       <span class="comment"># admin 用一个选择框 &lt;select&gt; (三个可选择的值: "Unknown", "Yes" 和 "No" ) 来表示这种字段数据.</span></span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;14&gt;</span> SlugField</span><br><span class="line">                       <span class="comment"># "Slug" 是一个报纸术语. slug 是某个东西的小小标记(短签), 只包含字母,数字,下划线和连字符.#它们通常用于URLs</span></span><br><span class="line">                       <span class="comment"># 若你使用 Django 开发版本,你可以指定 maxlength. 若 maxlength 未指定, Django 会使用默认长度: 50.  #在</span></span><br><span class="line">                       <span class="comment"># 以前的 Django 版本,没有任何办法改变50 这个长度.</span></span><br><span class="line">                       <span class="comment"># 这暗示了 db_index=True.</span></span><br><span class="line">                       <span class="comment"># 它接受一个额外的参数: prepopulate_from, which is a list of fields from which to auto-#populate </span></span><br><span class="line">                       <span class="comment"># the slug, via JavaScript,in the object's admin form: models.SlugField</span></span><br><span class="line">                       <span class="comment"># (prepopulate_from=("pre_name", "name"))prepopulate_from 不接受 DateTimeFields.</span></span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;13&gt;</span> XMLField</span><br><span class="line">                        <span class="comment">#一个校验值是否为合法XML的 TextField,必须提供参数: schema_path, 它是一个用来校验文本的 RelaxNG schema #的文件系统路径.</span></span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;14&gt;</span> FilePathField</span><br><span class="line">                        <span class="comment"># 可选项目为某个特定目录下的文件名. 支持三个特殊的参数, 其中第一个是必须提供的.</span></span><br><span class="line">                        <span class="comment"># 参数    描述</span></span><br><span class="line">                        <span class="comment"># path    必需参数. 一个目录的绝对文件系统路径. FilePathField 据此得到可选项目. </span></span><br><span class="line">                        <span class="comment"># Example: "/home/images".</span></span><br><span class="line">                        <span class="comment"># match    可选参数. 一个正则表达式, 作为一个字符串, FilePathField 将使用它过滤文件名.  </span></span><br><span class="line">                        <span class="comment"># 注意这个正则表达式只会应用到 base filename 而不是</span></span><br><span class="line">                        <span class="comment"># 路径全名. Example: "foo.*\.txt^", 将匹配文件 foo23.txt 却不匹配 bar.txt 或 foo23.gif.</span></span><br><span class="line">                        <span class="comment"># recursive可选参数.要么 True 要么 False. 默认值是 False. 是否包括 path 下面的全部子目录.</span></span><br><span class="line">                        <span class="comment"># 这三个参数可以同时使用.</span></span><br><span class="line">                        <span class="comment"># match 仅应用于 base filename, 而不是路径全名. 那么,这个例子:</span></span><br><span class="line">                        <span class="comment"># FilePathField(path="/home/images", match="foo.*", recursive=True)</span></span><br><span class="line">                        <span class="comment"># ...会匹配 /home/images/foo.gif 而不匹配 /home/images/foo/bar.gif</span></span><br><span class="line"></span><br><span class="line">                <span class="variable">&lt;15&gt;</span> IPAddressField</span><br><span class="line">                        <span class="comment"># 一个字符串形式的 IP 地址, (i.e. "24.124.1.30").</span></span><br><span class="line">                <span class="variable">&lt;16&gt;</span>CommaSeparatedIntegerField</span><br><span class="line">                        <span class="comment"># 用于存放逗号分隔的整数值. 类似 CharField, 必须要有maxlength参数.</span></span><br><span class="line"></span><br><span class="line">模型常用字段类型</span><br></pre></td></tr></table></figure>

<p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> filed重要参数</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Field重要参数</span><br><span class="line">                &lt;1&gt; <span class="literal">null</span> ： 数据库中字段是否可以为空</span><br><span class="line">                &lt;2&gt; default：设定缺省值</span><br><span class="line">                &lt;3&gt; primary_key：加速查找，数据唯一，且不为空。</span><br><span class="line">                                设置主键，如果没有设置django创建表时会自动加上：</span><br><span class="line">                    id = meta.AutoField(<span class="string">'ID'</span>, <span class="attribute">primary_key</span>=<span class="literal">True</span>)</span><br><span class="line">                    <span class="attribute">primary_key</span>=<span class="literal">True</span> implies <span class="attribute">blank</span>=<span class="literal">False</span>, <span class="attribute">null</span>=<span class="literal">False</span> <span class="keyword">and</span> <span class="attribute">unique</span>=<span class="literal">True</span>. Only one</span><br><span class="line">                    primary key is allowed on an object.</span><br><span class="line">                &lt;4&gt; unique：加速查找，数据唯一</span><br><span class="line">                    unique_for_date     数据库中字段【日期】部分是否可以建立唯一索引</span><br><span class="line">                    unique_for_month    数据库中字段【月】部分是否可以建立唯一索引</span><br><span class="line">                    unique_for_year     数据库中字段【年】部分是否可以建立唯一索引</span><br><span class="line">                &lt;5&gt; db_column:自定义数据库中存储列名，</span><br><span class="line">                    db_index：加速查找（创建一个二叉树存储的表）二叉树查找速度快 时间复杂度 O(log2(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &lt;6&gt; verbose_name　　Admin中字段的显示名称</span><br><span class="line">                &lt;7&gt; blank： django的 Admin 中添加数据时是否可允许空值</span><br><span class="line">                &lt;8&gt; editable：如果为假，admin模式下将不能改写。缺省为真</span><br><span class="line">                &lt;9&gt;choices：一个用来选择值的2维元组。第一个值是实际存储的值，第二个用来方便进行选择。</span><br><span class="line">                            如SEX_CHOICES= (( ‘F’,<span class="string">'Female’),(‘M’,'</span>Male’),)</span><br><span class="line">                            gender = models.CharField(<span class="attribute">max_length</span>=2,choices = SEX_CHOICES)</span><br><span class="line">                (10)help_text           Admin中该字段的提示信息</span><br><span class="line"></span><br><span class="line">                </span><br><span class="line">                &lt;11&gt; validator_list：有效性检查。非有效产生 django.core.validators.ValidationError 错误</span><br><span class="line">                (12)error_messages      自定义错误信息（字典类型），从而定制想要显示的错误信息；</span><br><span class="line">                                    字典健：<span class="literal">null</span>, blank, invalid, invalid_choice, unique, <span class="keyword">and</span> unique_for_date</span><br><span class="line">                                    如：&#123;<span class="string">'null'</span>: <span class="string">"不能为空."</span>, <span class="string">'invalid'</span>: <span class="string">'格式错误'</span>&#125;</span><br><span class="line">                (13)validators          自定义错误验证（列表类型），从而定制想要的验证规则</span><br><span class="line">                                    <span class="keyword">from</span> django.core.validators import RegexValidator</span><br><span class="line">                                    <span class="keyword">from</span> django.core.validators import EmailValidator,URLValidator,DecimalValidator,\</span><br><span class="line">                                    MaxLengthValidator,MinLengthValidator,MaxValueValidator,MinValueValidator</span><br><span class="line">                                    如：</span><br><span class="line">                                        test = models.CharField(</span><br><span class="line">                                            <span class="attribute">max_length</span>=32,</span><br><span class="line">                                            error_messages=&#123;</span><br><span class="line">                                                <span class="string">'c1'</span>: <span class="string">'优先错信息1'</span>,</span><br><span class="line">                                                <span class="string">'c2'</span>: <span class="string">'优先错信息2'</span>,</span><br><span class="line">                                                <span class="string">'c3'</span>: <span class="string">'优先错信息3'</span>,</span><br><span class="line">                                            &#125;,</span><br><span class="line">                                            validators=[</span><br><span class="line">                                                RegexValidator(<span class="attribute">regex</span>=<span class="string">'root_\d+'</span>, <span class="attribute">message</span>=<span class="string">'错误了'</span>, <span class="attribute">code</span>=<span class="string">'c1'</span>),</span><br><span class="line">                                                RegexValidator(<span class="attribute">regex</span>=<span class="string">'root_112233\d+'</span>, <span class="attribute">message</span>=<span class="string">'又错误了'</span>, <span class="attribute">code</span>=<span class="string">'c2'</span>),</span><br><span class="line">                                                EmailValidator(<span class="attribute">message</span>=<span class="string">'又错误了'</span>, <span class="attribute">code</span>=<span class="string">'c3'</span>), ]</span><br><span class="line">                            )</span><br><span class="line"></span><br><span class="line">filed重要参数</span><br></pre></td></tr></table></figure>

<p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> 多表关系及参数</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">ForeignKey(ForeignObject) # ForeignObject(RelatedField)</span><br><span class="line">                    <span class="keyword">to</span>,                         # 要进行关联的表名</span><br><span class="line">                    <span class="attribute">to_field</span>=None,              # 要关联的表中的字段名称</span><br><span class="line">                    <span class="attribute">on_delete</span>=None,             # 当删除关联表中的数据时，当前表与其关联的行的行为</span><br><span class="line">                                                    - models.CASCADE，删除关联数据，与之关联也删除</span><br><span class="line">                                                    - models.DO_NOTHING，删除关联数据，引发错误IntegrityError</span><br><span class="line">                                                    - models.PROTECT，删除关联数据，引发错误ProtectedError</span><br><span class="line">                                                    - models.SET_NULL，删除关联数据，与之关联的值设置为<span class="literal">null</span>（前提FK字段需要设置为可空）</span><br><span class="line">                                                    - models.SET_DEFAULT，删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）</span><br><span class="line">                                                    - models.SET，删除关联数据，</span><br><span class="line">                                                                  a. 与之关联的值设置为指定值，设置：models.<span class="builtin-name">SET</span>(值)</span><br><span class="line">                                                                  b. 与之关联的值设置为可执行对象的返回值，设置：models.<span class="builtin-name">SET</span>(可执行对象)</span><br><span class="line"></span><br><span class="line">                                                                    def func():</span><br><span class="line">                                                                        return 10</span><br><span class="line"></span><br><span class="line">                                                                    class MyModel(models.Model):</span><br><span class="line">                                                                       <span class="built_in"> user </span>= models.ForeignKey(</span><br><span class="line">                                                                            <span class="attribute">to</span>=<span class="string">"User"</span>,</span><br><span class="line">                                                                            <span class="attribute">to_field</span>=<span class="string">"id"</span></span><br><span class="line">                                                                            <span class="attribute">on_delete</span>=models.SET(func),)</span><br><span class="line">                    <span class="attribute">related_name</span>=None,          # 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span><br><span class="line">                    <span class="attribute">related_query_name</span>=None,    # 反向操作时，使用的连接前缀，用于替换【表名】     如：            </span><br><span class="line">                                                  models.UserGroup.objects.filter(表名__字段名=1).values(<span class="string">'表名__字段名'</span>)</span><br><span class="line">                    <span class="attribute">limit_choices_to</span>=None,      # 在Admin或ModelForm中显示关联数据时，提供的条件：</span><br><span class="line">                                                # 如：</span><br><span class="line">                                                        - limit_choices_to=&#123;<span class="string">'nid__gt'</span>: 5&#125;</span><br><span class="line">                                                        - <span class="attribute">limit_choices_to</span>=lambda : &#123;<span class="string">'nid__gt'</span>: 5&#125;</span><br><span class="line"></span><br><span class="line">                                                        <span class="keyword">from</span> django.db.models import Q</span><br><span class="line">                                                        - <span class="attribute">limit_choices_to</span>=Q(nid__gt=10)</span><br><span class="line">                                                        - <span class="attribute">limit_choices_to</span>=Q(nid=8) | Q(<span class="attribute">nid__gt</span>=10)</span><br><span class="line">                                                        - <span class="attribute">limit_choices_to</span>=lambda : Q(Q(<span class="attribute">nid</span>=8) | Q(<span class="attribute">nid__gt</span>=10)) &amp; Q(<span class="attribute">caption</span>=<span class="string">'root'</span>)</span><br><span class="line">                    <span class="attribute">db_constraint</span>=<span class="literal">True</span>          # 是否在数据库中创建外键约束</span><br><span class="line">                    <span class="attribute">parent_link</span>=<span class="literal">False</span>           # 在Admin中是否显示关联数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            OneToOneField(ForeignKey)</span><br><span class="line">                <span class="keyword">to</span>,                         # 要进行关联的表名</span><br><span class="line">                <span class="attribute">to_field</span>=None               # 要关联的表中的字段名称</span><br><span class="line">                <span class="attribute">on_delete</span>=None,             # 当删除关联表中的数据时，当前表与其关联的行的行为</span><br><span class="line"></span><br><span class="line">                                            ###### 对于一对一 ######</span><br><span class="line">                                            # 1. 一对一其实就是 一对多 + 唯一索引</span><br><span class="line">                                            # 2.当两个类之间有继承关系时，默认会创建一个一对一字段</span><br><span class="line">                                            # 如下会在A表中额外增加一个c_ptr_id列且唯一：</span><br><span class="line">                                                    class C(models.Model):</span><br><span class="line">                                                        nid = models.AutoField(<span class="attribute">primary_key</span>=<span class="literal">True</span>)</span><br><span class="line">                                                        part = models.CharField(<span class="attribute">max_length</span>=12)</span><br><span class="line"></span><br><span class="line">                                                    class A(C):</span><br><span class="line">                                                        id = models.AutoField(<span class="attribute">primary_key</span>=<span class="literal">True</span>)</span><br><span class="line">                                                        code = models.CharField(<span class="attribute">max_length</span>=1)</span><br><span class="line"></span><br><span class="line">            ManyToManyField(RelatedField)</span><br><span class="line">                <span class="keyword">to</span>,                         # 要进行关联的表名</span><br><span class="line">                <span class="attribute">related_name</span>=None,          # 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span><br><span class="line">                <span class="attribute">related_query_name</span>=None,    # 反向操作时，使用的连接前缀，用于替换【表名】     如： models.UserGroup.objects.filter(表名__字段名=1).values(<span class="string">'表名__字段名'</span>)</span><br><span class="line">                <span class="attribute">limit_choices_to</span>=None,      # 在Admin或ModelForm中显示关联数据时，提供的条件：</span><br><span class="line">                                            # 如：</span><br><span class="line">                                                    - limit_choices_to=&#123;<span class="string">'nid__gt'</span>: 5&#125;</span><br><span class="line">                                                    - <span class="attribute">limit_choices_to</span>=lambda : &#123;<span class="string">'nid__gt'</span>: 5&#125;</span><br><span class="line"></span><br><span class="line">                                                    <span class="keyword">from</span> django.db.models import Q</span><br><span class="line">                                                    - <span class="attribute">limit_choices_to</span>=Q(nid__gt=10)</span><br><span class="line">                                                    - <span class="attribute">limit_choices_to</span>=Q(nid=8) | Q(<span class="attribute">nid__gt</span>=10)</span><br><span class="line">                                                    - <span class="attribute">limit_choices_to</span>=lambda : Q(Q(<span class="attribute">nid</span>=8) | Q(<span class="attribute">nid__gt</span>=10)) &amp; Q(<span class="attribute">caption</span>=<span class="string">'root'</span>)</span><br><span class="line">                <span class="attribute">symmetrical</span>=None,           # 仅用于多对多自关联时，symmetrical用于指定内部是否创建反向操作的字段</span><br><span class="line">                                            # 做如下操作时，不同的symmetrical会有不同的可选字段</span><br><span class="line">                                                models.BB.objects.filter(<span class="built_in">..</span>.)</span><br><span class="line"></span><br><span class="line">                                                # 可选字段有：code, id, m1</span><br><span class="line">                                                    class BB(models.Model):</span><br><span class="line"></span><br><span class="line">                                                    code = models.CharField(<span class="attribute">max_length</span>=12)</span><br><span class="line">                                                    m1 = models.ManyToManyField(<span class="string">'self'</span>,<span class="attribute">symmetrical</span>=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">                                                # 可选字段有: bb, code, id, m1</span><br><span class="line">                                                    class BB(models.Model):</span><br><span class="line"></span><br><span class="line">                                                    code = models.CharField(<span class="attribute">max_length</span>=12)</span><br><span class="line">                                                    m1 = models.ManyToManyField(<span class="string">'self'</span>,<span class="attribute">symmetrical</span>=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">                <span class="attribute">through</span>=None,               # 自定义第三张表时，使用字段用于指定关系表</span><br><span class="line">                <span class="attribute">through_fields</span>=None,        # 自定义第三张表时，使用字段用于指定关系表中那些字段做多对多关系表</span><br><span class="line">                                                <span class="keyword">from</span> django.db import models</span><br><span class="line"></span><br><span class="line">                                                class Person(models.Model):</span><br><span class="line">                                                    name = models.CharField(<span class="attribute">max_length</span>=50)</span><br><span class="line"></span><br><span class="line">                                                class Group(models.Model):</span><br><span class="line">                                                    name = models.CharField(<span class="attribute">max_length</span>=128)</span><br><span class="line">                                                    members = models.ManyToManyField(</span><br><span class="line">                                                        Person,</span><br><span class="line">                                                        <span class="attribute">through</span>=<span class="string">'Membership'</span>,</span><br><span class="line">                                                        through_fields=(<span class="string">'group'</span>, <span class="string">'person'</span>),</span><br><span class="line">                                                    )</span><br><span class="line"></span><br><span class="line">                                                class Membership(models.Model):</span><br><span class="line">                                                   <span class="built_in"> group </span>= models.ForeignKey(Group, <span class="attribute">on_delete</span>=models.CASCADE)</span><br><span class="line">                                                    person = models.ForeignKey(Person, <span class="attribute">on_delete</span>=models.CASCADE)</span><br><span class="line">                                                    inviter = models.ForeignKey(</span><br><span class="line">                                                        Person,</span><br><span class="line">                                                        <span class="attribute">on_delete</span>=models.CASCADE,</span><br><span class="line">                                                        <span class="attribute">related_name</span>=<span class="string">"membership_invites"</span>,</span><br><span class="line">                                                    )</span><br><span class="line">                                                    invite_reason = models.CharField(<span class="attribute">max_length</span>=64)</span><br><span class="line">                <span class="attribute">db_constraint</span>=<span class="literal">True</span>,         # 是否在数据库中创建外键约束</span><br><span class="line">                <span class="attribute">db_table</span>=None,              # 默认创建第三张表时，数据库中表的名称</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">多表关系及参数</span><br></pre></td></tr></table></figure>

<p>　　<strong>2.操作类</strong></p>
<p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> 书籍管理表</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="constructor">Book(<span class="params">models</span>.Model)</span>:</span><br><span class="line">                name = models.<span class="constructor">CharField(<span class="params">max_length</span>=20,<span class="params">verbose_name</span>='姓名')</span></span><br><span class="line">                price = models.<span class="constructor">IntegerField('价格')</span></span><br><span class="line">                pub_date = models.<span class="constructor">DateField('出版日期')</span></span><br><span class="line">                publish = models.<span class="constructor">ForeignKey('Publish',<span class="params">on_delete</span>='CASCADE',<span class="params">verbose_name</span>='出版商')</span></span><br><span class="line">                authors = models.<span class="constructor">ManyToManyField('Author',<span class="params">verbose_name</span>='作者')</span></span><br><span class="line"></span><br><span class="line">                def <span class="constructor">__str__(<span class="params">self</span>)</span>:</span><br><span class="line">                    return self.name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">class</span> <span class="constructor">Publish(<span class="params">models</span>.Model)</span>:</span><br><span class="line">                name = models.<span class="constructor">CharField(<span class="params">max_length</span>=32)</span></span><br><span class="line">                city = models.<span class="constructor">CharField(<span class="params">max_length</span>=32)</span></span><br><span class="line"></span><br><span class="line">                def <span class="constructor">__str__(<span class="params">self</span>)</span>:</span><br><span class="line">                    return self.name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">class</span> <span class="constructor">Author(<span class="params">models</span>.Model)</span>:</span><br><span class="line">                name = models.<span class="constructor">CharField(<span class="params">max_length</span>=32)</span></span><br><span class="line">                age = models.<span class="constructor">IntegerField(<span class="params">default</span>=20)</span></span><br><span class="line"></span><br><span class="line">                def <span class="constructor">__str__(<span class="params">self</span>)</span>:</span><br><span class="line">                    return self.name</span><br><span class="line"></span><br><span class="line">书籍管理表</span><br></pre></td></tr></table></figure>

<p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> 学生管理表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Classes</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">                <span class="string">"""</span></span><br><span class="line"><span class="string">                班级表</span></span><br><span class="line"><span class="string">                """</span></span><br><span class="line">                title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">                teachers = models.ManyToManyField(<span class="string">'Teachers'</span>)</span><br><span class="line">                schools = models.ForeignKey(Schools)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="class"><span class="keyword">class</span> <span class="title">Teachers</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">                <span class="string">"""</span></span><br><span class="line"><span class="string">                老师表</span></span><br><span class="line"><span class="string">                """</span></span><br><span class="line">                name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="class"><span class="keyword">class</span> <span class="title">Students</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">                <span class="string">"""</span></span><br><span class="line"><span class="string">                学生表</span></span><br><span class="line"><span class="string">                """</span></span><br><span class="line">                username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">                age = models.IntegerField()</span><br><span class="line">                gender = models.BooleanField()</span><br><span class="line">                cs = models.ForeignKey(Classes,on_delete=<span class="string">'CASCADE'</span>)  <span class="comment">#cs是classes表的一个对象</span></span><br><span class="line"></span><br><span class="line">学生管理表</span><br></pre></td></tr></table></figure>

<p> b = Book() 实例化一个类，代表创建一条记录</p>
<p>表与表之间的关系：<br>一对一：在一对多的基础上给外键加一个唯一约束<br>一对多：比如员工与部门，通过外键连接<br>多对多：书籍信息表与作者表，再加一个书籍与作者关系表，分别建立书籍与作者的外键关联</p>
<p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> 表记录的增删改查</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">表记录的添加</span><br><span class="line">            <span class="number">1.</span><span class="constructor">Book()</span></span><br><span class="line">            b = <span class="constructor">Book(<span class="params">name</span>='<span class="params">python</span>基础',<span class="params">price</span>=99,<span class="params">author</span>='<span class="params">fei</span>',<span class="params">pub_date</span>='2017-12-12')</span></span><br><span class="line">            b.save<span class="literal">()</span></span><br><span class="line">            <span class="number">2.</span><span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.create(name='python核心', price=<span class="number">199</span>, author='oldboy', pub_date='<span class="number">2017</span>-<span class="number">12</span>-<span class="number">12</span>')</span><br><span class="line">              <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.create(**dic)</span><br><span class="line">        表记录的更改</span><br><span class="line">            <span class="number">1.</span> <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.filter(author='fei').update(price=<span class="number">999</span>)</span><br><span class="line">            <span class="number">2.</span>  b = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.get(author='oldboy')</span><br><span class="line">                b.price = <span class="number">120</span></span><br><span class="line">                b.save<span class="literal">()</span></span><br><span class="line">        表记录的删除</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.filter(author='oldboy').delete<span class="literal">()</span></span><br><span class="line">            </span><br><span class="line">        表记录的查询(重点)</span><br><span class="line">            book_list = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.all<span class="literal">()</span>     <span class="literal">[<span class="identifier">obj1</span>(),<span class="identifier">obj2</span>(),<span class="identifier">obj3</span>(),<span class="identifier">obj4</span>(),<span class="operator">...</span>]</span>--取每一个对象可以用for循环</span><br><span class="line">            print(book_list<span class="literal">[<span class="number">0</span>]</span>)</span><br><span class="line">            </span><br><span class="line">            book_list = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.all<span class="literal">()</span><span class="literal">[:<span class="number">2</span>]</span></span><br><span class="line">            book_list = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.all<span class="literal">()</span><span class="literal">[::<span class="number">2</span>]</span></span><br><span class="line">            book_list = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.all<span class="literal">()</span><span class="literal">[::-<span class="number">1</span>]</span></span><br><span class="line">            </span><br><span class="line">            first,last,get取到的是一个实例对象，不是querySet对象</span><br><span class="line">            book_list = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.first<span class="literal">()</span></span><br><span class="line">            book_list = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.last<span class="literal">()</span></span><br><span class="line">            book_list = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.get(id=<span class="number">2</span>) #只能取出一条记录的时候才不报错</span><br><span class="line">            </span><br><span class="line">            name = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.filter(author='fei').values('name<span class="character">','</span>price')</span><br><span class="line">            name = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.filter(author='fei').values<span class="constructor">_list('<span class="params">name</span>','<span class="params">price</span>')</span></span><br><span class="line">            </span><br><span class="line">            book_list = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.exclude(author='fei')</span><br><span class="line">            </span><br><span class="line">            book_list = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.all<span class="literal">()</span>.values('name').distinct<span class="literal">()</span></span><br><span class="line">            num = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.all<span class="literal">()</span>.values('name').distinct<span class="literal">()</span>.count<span class="literal">()</span></span><br><span class="line">            </span><br><span class="line">            模糊匹配 双下划线__</span><br><span class="line">            book_list = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.filter(price__gt=<span class="number">50</span>).values('name<span class="character">','</span>price')</span><br><span class="line">            book_list = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.filter(price__lt=<span class="number">50</span>).values('name<span class="character">','</span>price')</span><br><span class="line">            book_list = <span class="module-access"><span class="module"><span class="identifier">Book</span>.</span></span>objects.filter(name__icontains=<span class="character">'p'</span>).values('name<span class="character">','</span>price') # icontains大小写不敏感</span><br><span class="line">            models.<span class="module-access"><span class="module"><span class="identifier">Tb1</span>.</span></span>objects.filter(id__range=<span class="literal">[<span class="number">1</span>, <span class="number">2</span>]</span>)   # 范围bettwen <span class="keyword">and</span></span><br><span class="line">            models.<span class="module-access"><span class="module"><span class="identifier">Tb1</span>.</span></span>objects.filter(id__in=<span class="literal">[<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>]</span>)   # 获取id等于<span class="number">11</span>、<span class="number">22</span>、<span class="number">33</span>的数据</span><br><span class="line">            models.<span class="module-access"><span class="module"><span class="identifier">Tb1</span>.</span></span>objects.exclude(id__in=<span class="literal">[<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>]</span>)  # not <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">            startswith，istartswith, endswith, iendswith,</span><br><span class="line">            注：id_range = <span class="literal">[]</span>,id_in = <span class="literal">[]</span></span><br><span class="line"></span><br><span class="line">表记录的增删改查</span><br></pre></td></tr></table></figure>

<p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> 多表查询（一对多)</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">多表操作(一对多)</span><br><span class="line">            创建表关联：publish = models.ForeignKey(<span class="string">'Publish'</span>,<span class="attribute">on_delete</span>=<span class="string">'CASCADE'</span>,verbose_name='出版商')  #默认在Book表中添加一个publish_id字段</span><br><span class="line">            添加记录：</span><br><span class="line">               1.#<span class="attribute">publish_id</span>=2</span><br><span class="line">                Book.objects.create(<span class="attribute">name</span>=<span class="string">'linux运维'</span>, <span class="attribute">price</span>=77, <span class="attribute">pub_date</span>=<span class="string">'2017-12-12'</span>,publish_id=2)</span><br><span class="line">               2.publish_obj = Publish.objects.filter(<span class="attribute">name</span>=<span class="string">'人民出版社'</span>)[0]</span><br><span class="line">                Book.objects.create(<span class="attribute">name</span>=<span class="string">'linux运维'</span>, <span class="attribute">price</span>=77, <span class="attribute">pub_date</span>=<span class="string">'2017-12-12'</span>,publish=publish_obj)</span><br><span class="line">           </span><br><span class="line">            查询记录(通过对象):正向：通过fk字段关联另一张表 </span><br><span class="line">                               反向：若不存在fk字段，通过小写类名_set(默认)关联另一张表==&gt;可设置<span class="attribute">related_name</span>=<span class="string">'cls'</span>，修改关联表名称</span><br><span class="line">                正向查询：book_obj = Book.objects.<span class="builtin-name">get</span>(<span class="attribute">name</span>=<span class="string">'python'</span>)</span><br><span class="line">                          pub_obj = book_obj.publish ==&gt;书籍对象对应的出版社对象</span><br><span class="line">                          pub_obj.city，pub_obj.name</span><br><span class="line">                反向查询：publish_obj = Publish.objects.<span class="builtin-name">get</span>(<span class="attribute">name</span>=<span class="string">'人民出版社'</span>)</span><br><span class="line">                          book_obj = publish_obj.book_set.all()) ==&gt;出版社对象对应的所有书籍对象的querySet集合</span><br><span class="line">                          book_obj = publish_obj.book_set.values(<span class="string">'name'</span>,<span class="string">'price'</span>))</span><br><span class="line">                    </span><br><span class="line">            查询记录(filter,values,双下划线__)</span><br><span class="line">                正向查询：book_obj = Book.objects.filter(<span class="attribute">publish__name</span>=<span class="string">'人民出版社'</span>).values('name','price')</span><br><span class="line">                反向查询： 1.python这本书出版社的名字</span><br><span class="line">                             pub_name = Publish.objects.filter(<span class="attribute">book__name</span>=<span class="string">'python'</span>).values('name')</span><br><span class="line">                             pub_name = Book.objects.filter(<span class="attribute">name</span>=<span class="string">'python'</span>).values('publish__name')</span><br><span class="line">                           </span><br><span class="line">                           2.查询北京出版的所有书籍名称</span><br><span class="line">                             book__name = Book.objects.filter(<span class="attribute">publish__city</span>=<span class="string">'北京'</span>).values('name')</span><br><span class="line">                             book__name = Publish.objects.filter(<span class="attribute">city</span>=<span class="string">'北京'</span>).values('book__name')</span><br><span class="line">                           </span><br><span class="line">                           3.查询在2017-2018之间出版过书籍的出版社                       </span><br><span class="line">                             publish__name = Book.objects.filter(<span class="attribute">pub_date__lt</span>=<span class="string">'2018-01-01'</span>,pub_date__gt='2017-01-01').values('publish__name')</span><br><span class="line">            例：students_list = Students.objects.all()</span><br><span class="line">                <span class="keyword">for</span> item <span class="keyword">in</span> students_list:</span><br><span class="line">                    <span class="builtin-name">print</span>(item.id)</span><br><span class="line">                    <span class="builtin-name">print</span>(item.username)</span><br><span class="line">                    <span class="builtin-name">print</span>(item.age)</span><br><span class="line">                    <span class="builtin-name">print</span>(item.gender)</span><br><span class="line">                    <span class="builtin-name">print</span>(item.cs_id)</span><br><span class="line">                    <span class="builtin-name">print</span>(item.cs.id)</span><br><span class="line">                    <span class="builtin-name">print</span>(item.cs.name)</span><br><span class="line">                    </span><br><span class="line">               student_obj = Students.objects.filter(<span class="attribute">cs__title</span>=<span class="string">'一班'</span>)  #[student1,student2,<span class="built_in">..</span>.]</span><br><span class="line">               student_obj.values(<span class="string">'username'</span>)</span><br><span class="line">                    注：取属性跨表可以用.，但filter跨表必須用__</span><br><span class="line">            补充：-查询所有学生姓名和所在班级名称,QuerySet</span><br><span class="line">                stu_list = Student.objects.all()</span><br><span class="line">                <span class="keyword">for</span> row <span class="keyword">in</span> stu_list:</span><br><span class="line">                    row.username,row.age,row.gender,row.cs_id,row.cs.title</span><br><span class="line">                select * <span class="keyword">from</span> Student</span><br><span class="line">                [obj,obj,obj,obj]</span><br><span class="line">                </span><br><span class="line">                stu_list = Student.objects.all().values(<span class="string">'id'</span>,<span class="string">'username'</span>)</span><br><span class="line">                select id,username <span class="keyword">from</span> Student</span><br><span class="line">                [&#123;<span class="string">'id'</span>:1,<span class="string">'username'</span>:<span class="string">'xx'</span>&#125;,&#123;<span class="string">'id'</span>:2,username:<span class="string">''</span>]</span><br><span class="line">                </span><br><span class="line">                stu_list = Student.objects.all().values_list(<span class="string">'id'</span>,<span class="string">'username'</span>)</span><br><span class="line">                [(1,<span class="string">'root'</span>),(2,<span class="string">'alex'</span>)]</span><br><span class="line">                </span><br><span class="line">                stu_list = Student.objects.all().values(<span class="string">'username'</span>,<span class="string">'cs__name'</span>)</span><br><span class="line">                <span class="keyword">for</span> row <span class="keyword">in</span> stu_list:</span><br><span class="line">                    <span class="builtin-name">print</span>(row[<span class="string">'username'</span>],row[<span class="string">'cs__name'</span>])</span><br><span class="line">                    </span><br><span class="line">             -找到所有学生所在班级以及校区名称</span><br><span class="line">                Student.objects.all().values(<span class="string">'username'</span>,<span class="string">'cs__name'</span>,<span class="string">'cs__schools__name'</span>)</span><br><span class="line">                    </span><br><span class="line">             -找到三班的所有学生</span><br><span class="line">                正向：Student.objects.filter(<span class="attribute">cs__name</span>=<span class="string">'三班'</span>)</span><br><span class="line">                </span><br><span class="line">                反向：obj = Classes.objects.filter(<span class="attribute">title</span>=<span class="string">'三班'</span>).first()    #obj = Classes.objects.<span class="builtin-name">get</span>(<span class="attribute">title</span>=<span class="string">'三班'</span>)</span><br><span class="line">                      obj.student_set.all()</span><br><span class="line">                      </span><br><span class="line">            自关联：评论表</span><br><span class="line">                    pid content article_id user_id reply_id</span><br><span class="line">                    0   好      1          1       <span class="literal">null</span></span><br><span class="line">                    1   hjsa    1          2       <span class="literal">null</span></span><br><span class="line">                    2   ds      1          3       0</span><br><span class="line">                    3   dsd     1          4       2</span><br><span class="line">                    </span><br><span class="line"></span><br><span class="line">多表查询（一对多）</span><br></pre></td></tr></table></figure>

<p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> 多表查询（多对多)</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">多表查询(多对多)：<span class="number">1</span>.自动 <span class="number">2</span>.手动 <span class="number">3</span>.手动+自动</span><br><span class="line">            方式一：创建多对多的关系：authors = models.ManyToManyField(<span class="keyword">to</span>=<span class="string">'Author'</span>)#推荐</span><br><span class="line">                                      authors = models.ManyToManyField(<span class="keyword">to</span>=<span class="string">'Author'</span>,through=<span class="string">'BookToAuthor'</span>,through_fields=[<span class="string">'Book'</span>,<span class="string">'Author'</span>])</span><br><span class="line">                                      #使用ManyToManyField只能在第三张表中创建三列数据</span><br><span class="line">                </span><br><span class="line">                书籍对象它的所有关联作者：obj = book_obj.authors.<span class="keyword">all</span>()</span><br><span class="line">                        绑定多对多的关系：obj.<span class="built_in">add</span>(*querySet)</span><br><span class="line">                                          obj.<span class="built_in">remove</span>(author_obj)</span><br><span class="line">                                          </span><br><span class="line">                查询id为<span class="number">1</span>的书籍的所有作者   </span><br><span class="line">                book_obj = Book.objects.<span class="built_in">get</span>(id=<span class="number">3</span>)</span><br><span class="line">                <span class="keyword">print</span>(book_obj.authors.<span class="keyword">all</span>())</span><br><span class="line">                </span><br><span class="line">                查询作者id为<span class="number">3</span>的所有书籍的名称</span><br><span class="line">                author_obj = Author.objects.<span class="built_in">get</span>(id=<span class="number">3</span>)</span><br><span class="line">                <span class="keyword">print</span>(author_obj.book_set.<span class="built_in">values</span>(<span class="string">'name'</span>))</span><br><span class="line">                </span><br><span class="line">                给第<span class="number">4</span>本书加上几个作者</span><br><span class="line">                book_obj1 = Book.objects.<span class="built_in">get</span>(id=<span class="number">4</span>)</span><br><span class="line">                author_objs = Author.objects.<span class="keyword">all</span>()</span><br><span class="line">                # book_obj1.authors.<span class="built_in">add</span>(*author_objs) #参数为集合加一个*，字典加**</span><br><span class="line">                </span><br><span class="line">                给第<span class="number">4</span>本书移除某些作者</span><br><span class="line">                # book_obj1.authors.<span class="built_in">remove</span>(<span class="number">1</span>) #通过id</span><br><span class="line">                book_obj1.authors.<span class="built_in">remove</span>(author_objs) #通过作者对象</span><br><span class="line">                </span><br><span class="line">                查询alex写过的书籍名称和价格</span><br><span class="line">                book_obj2 = Book.objects.<span class="built_in">filter</span>(authors__name=<span class="string">'alex'</span>).<span class="built_in">values</span>(<span class="string">'name'</span>,<span class="string">'price'</span>)</span><br><span class="line">                </span><br><span class="line">                注：外键是沟通多张表的桥梁</span><br><span class="line">                    cls_obj = Classes.objects.<span class="built_in">get</span>(id=<span class="number">1</span>)</span><br><span class="line">                    #增加</span><br><span class="line">                    cls_obj.teachers.<span class="built_in">add</span>(<span class="number">1</span>)</span><br><span class="line">                    cls_obj.teachers.<span class="built_in">add</span>([<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">                    #删除</span><br><span class="line">                    cls_obj.teachers.<span class="built_in">remove</span>([<span class="number">1</span>,<span class="number">3</span>])</span><br><span class="line">                    #清空</span><br><span class="line">                    cls_obj.teachers.clear()</span><br><span class="line">                    #重置</span><br><span class="line">                    cls_obj.teachers.<span class="keyword">set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">                    #查询属性</span><br><span class="line">                    teachers_obj = cls_obj.teachers.<span class="keyword">all</span>()        #[teacher1(id,name),teacher2(id,name),...]</span><br><span class="line">                    cls_obj.teachers.<span class="keyword">all</span>().<span class="built_in">values</span>(<span class="string">'name'</span>) </span><br><span class="line">             </span><br><span class="line">            方式二：创建第三张表，关联Book表和Author表</span><br><span class="line">            </span><br><span class="line">            class BookToAuthor(models.Model):</span><br><span class="line">                book = models.ForeignKey(<span class="string">'Book'</span>,on_delete=<span class="string">'CASCADE'</span>)</span><br><span class="line">                author = models.ForeignKey(<span class="string">'Author'</span>,on_delete=<span class="string">'CASCADE'</span>)</span><br><span class="line">                ctime = models.DateField()</span><br><span class="line">                </span><br><span class="line">                #ManyToManyField字段默认生成联合唯一</span><br><span class="line">                class Met<span class="variable">a:</span></span><br><span class="line">                    unique_together = [(<span class="string">'book'</span>,<span class="string">'author'</span>],]</span><br><span class="line">                </span><br><span class="line">            Book_to_Author.objects.create(book_id=<span class="number">2</span>,author_id=<span class="number">3</span>)</span><br><span class="line">            </span><br><span class="line">            自关联：用处--好友、互粉、关注等</span><br><span class="line">                    class UserInfo(models.Model):</span><br><span class="line">                        username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">                        email = models.EmailField(max_length=<span class="number">32</span>)</span><br><span class="line">                        friends = models.ManyToManyField(<span class="keyword">to</span>=<span class="string">'UserInfo'</span>,related_name=<span class="string">'f'</span>) #ForeignKey,ManyToManyField字段如涉及反向操作，建议加上related_name字段</span><br><span class="line">                        </span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        <span class="keyword">return</span> self.username</span><br><span class="line">            补充：</span><br><span class="line">                    <span class="keyword">for</span> obj in classes_lis<span class="variable">t:</span></span><br><span class="line">                        <span class="keyword">print</span>(obj.id,obj.title)</span><br><span class="line">                        <span class="keyword">for</span> teacher in obj.teachers.<span class="keyword">all</span>():</span><br><span class="line">                            <span class="keyword">print</span>(teacher.name)</span><br><span class="line">                            </span><br><span class="line">                    teacher_obj = Teachers.objects.<span class="built_in">filter</span>(id=<span class="number">2</span>).<span class="keyword">first</span>()</span><br><span class="line">                    teacher_obj.classes_set.<span class="built_in">add</span>(<span class="number">2</span>)</span><br><span class="line">                    </span><br><span class="line">                    cls = Classes.objects.<span class="built_in">filter</span>(id=<span class="number">2</span>).<span class="keyword">first</span>()</span><br><span class="line">                    cls.teachers.<span class="keyword">set</span>([<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line">                    </span><br><span class="line">                    class_list = Classes.objects.<span class="keyword">all</span>().<span class="built_in">values</span>(<span class="string">'id'</span>,<span class="string">'title'</span>,<span class="string">'teachers'</span>,<span class="string">'teachers__name'</span>)</span><br><span class="line">                    <span class="keyword">print</span>(class_list)</span><br><span class="line"></span><br><span class="line">                    # t_list = Teachers.objects.<span class="keyword">all</span>().<span class="built_in">values</span>(<span class="string">'name'</span>,<span class="string">'cls__title'</span>)  #related_name = <span class="string">'cls'</span></span><br><span class="line">                    t_list = Teachers.objects.<span class="keyword">all</span>().<span class="built_in">values</span>(<span class="string">'name'</span>,<span class="string">'classes__title'</span>)</span><br><span class="line">                    <span class="keyword">print</span>(t_list)</span><br><span class="line">                    </span><br><span class="line">                    找出当前班级任课老师的id列表</span><br><span class="line">                    teachers_obj = Classes.objects.<span class="built_in">filter</span>(id=nid).values_list(<span class="string">'teachers'</span>)</span><br><span class="line">                    id_list = <span class="keyword">list</span>(zip(*teachers_obj))[<span class="number">0</span>]</span><br><span class="line">                    </span><br><span class="line">                    teachers_obj = Classes.objects.<span class="built_in">filter</span>(id=nid).<span class="built_in">values</span>(<span class="string">'teachers'</span>)</span><br><span class="line">                    id_list = <span class="keyword">list</span>(zip(*teacher_obj))[<span class="number">1</span>]</span><br><span class="line">                    </span><br><span class="line">                    模板语言里执行方法不需要加（）</span><br><span class="line">                    例：在模板里展示当前班级的所有老师</span><br><span class="line">                        &#123;% <span class="keyword">for</span> row in classes_list  %&#125;</span><br><span class="line">                            <span class="symbol">&lt;td&gt;</span></span><br><span class="line">                                 &#123;% <span class="keyword">for</span> item in row.teachers.<span class="keyword">all</span> %&#125;</span><br><span class="line">                                    <span class="symbol">&lt;span&gt;</span>&#123;&#123; item.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">                                 &#123;% <span class="keyword">endfor</span> %&#125;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                        &#123;% <span class="keyword">endfor</span> %&#125;</span><br><span class="line">                        </span><br><span class="line">                    注：zip函数： v = [(<span class="number">1</span>,<span class="string">'sa'</span>),(<span class="number">2</span>,<span class="string">'sas'</span>)]</span><br><span class="line">                                  <span class="keyword">list</span>(zip(*v))[<span class="number">0</span>]</span><br><span class="line">                                  <span class="keyword">ou</span><span class="variable">t:</span>&lt;&lt;(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">                    </span><br><span class="line">                </span><br><span class="line"></span><br><span class="line">多表查询（多对多）</span><br></pre></td></tr></table></figure>

<p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> 聚合函数和分组函数</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">聚合函数和分组查询</span><br><span class="line">       <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Avg,Min,Sum,Max,Count</span><br><span class="line">       聚合查询：</span><br><span class="line">               查询所有书籍的平均价格</span><br><span class="line">               book_avg = Book.objects.<span class="keyword">all</span>().<span class="keyword">aggregate</span>(Avg(<span class="string">'price'</span>))</span><br><span class="line">               </span><br><span class="line">               查询所有书籍的总价格</span><br><span class="line">               book_sum = Book.objects.<span class="keyword">all</span>().<span class="keyword">aggregate</span>(Sum(<span class="string">'price'</span>))</span><br><span class="line">               </span><br><span class="line">               查询alex出版书的总价格</span><br><span class="line">               alex_sum = Book.objects.<span class="keyword">filter</span>(authors__name=<span class="string">'alex'</span>).<span class="keyword">aggregate</span>(alex_money=Sum(<span class="string">'price'</span>))</span><br><span class="line">               </span><br><span class="line">               查询alex出版书的数量</span><br><span class="line">               alex_count = Book.objects.<span class="keyword">filter</span>(authors__name=<span class="string">'alex'</span>).<span class="keyword">aggregate</span>(Count(<span class="string">'id'</span>))</span><br><span class="line">       </span><br><span class="line">       分组查询：</span><br><span class="line">                </span><br><span class="line">                每个作者书的总价格</span><br><span class="line">                ret7 = Book.objects.<span class="keyword">values</span>(<span class="string">'authors__name'</span>).annotate(Sum(<span class="string">'price'</span>))</span><br><span class="line">                </span><br><span class="line">                每个出版社最便宜的书</span><br><span class="line">                ret8 = Publish.objects.<span class="keyword">values</span>(<span class="string">'name'</span>).annotate(Min(<span class="string">'book__price'</span>))</span><br><span class="line">                </span><br><span class="line">        F 和 Q函数</span><br><span class="line">                 Book.objects.<span class="keyword">all</span>().<span class="keyword">update</span>(price=F(<span class="string">'price'</span>)+<span class="number">10</span>)</span><br><span class="line">                 ret = Book.objects.<span class="keyword">filter</span>(Q(price=<span class="number">97</span>)|Q(<span class="type">name</span>=<span class="string">'Go'</span>))</span><br><span class="line">                 ret1 = Book.objects.<span class="keyword">filter</span>(~Q(<span class="type">name</span>=<span class="string">'Go'</span>))</span><br><span class="line">                 ret2 = Book.objects.<span class="keyword">filter</span>(Q(name__contains=<span class="string">'G'</span>))</span><br><span class="line">                 ret3 = Book.objects.<span class="keyword">filter</span>(Q(<span class="type">name</span>=<span class="string">'Go'</span>),price=<span class="string">'97'</span>)</span><br><span class="line">        <span class="keyword">cache</span>机制：当你遍历queryset时，所有匹配的记录会从数据库获取，然后转换成Django的model。这被称为执行</span><br><span class="line">                 （evaluation）.这些model会保存在queryset内置的<span class="keyword">cache</span>中，这样如果你再次遍历这个queryset，</span><br><span class="line">                  你不需要重复运行通用的查询。</span><br><span class="line">                  </span><br><span class="line">                 ret4 = Book.objects.filter(price=<span class="number">97</span>)</span><br><span class="line">                 <span class="keyword">for</span> i <span class="keyword">in</span> ret4:</span><br><span class="line">                     print(i)</span><br><span class="line"></span><br><span class="line">                 <span class="keyword">for</span> i <span class="keyword">in</span> ret4:</span><br><span class="line">                     print(i)</span><br><span class="line">                     </span><br><span class="line">                 ret4赋值的时候只会赋值一条<span class="keyword">sql</span>语句，放入缓存，不会去执行，只有当使用的时候才会去执行<span class="keyword">sql</span>语句，且多次使用<span class="keyword">sql</span>语句只执行一次</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">exists</span>: 简单的使用<span class="keyword">if</span>语句进行判断也会完全执行整个queryset并且把数据放入<span class="keyword">cache</span>，虽然你并不需要这些数据！为了避免这个，可以用exists()方法来检查是否有数据：</span><br><span class="line">                 if ret4.exists():</span><br><span class="line">                     print('ok')</span><br><span class="line">         </span><br><span class="line">         迭代器：减少缓存。当查询的数据很大时，<span class="keyword">cache</span>会有很大压力，迭代器可以使数据用多少取多少</span><br><span class="line">                ret4 = Book.objects.filter(price=<span class="number">97</span>)</span><br><span class="line">                ret4 = ret4.iterator()</span><br><span class="line">                print(ret4)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> ret4:</span><br><span class="line">                    print(i)</span><br><span class="line">                #这个<span class="keyword">for</span>循环不输出结果</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> ret4:</span><br><span class="line">                    print(i)</span><br><span class="line">                    </span><br><span class="line"></span><br><span class="line">聚合函数和分组函数</span><br></pre></td></tr></table></figure>

<p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> 补充：查询相关API</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">补充：<span class="comment"># 查询相关API：</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">#  &lt;1&gt;filter(**kwargs):      它包含了与所给筛选条件相匹配的对象</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">#  &lt;2&gt;all():                 查询所有结果</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">#  &lt;3&gt;get(**kwargs):         返回与所给筛选条件相匹配的对象，返回结果有且只有一个，如果符合筛选条件的对象超过一个或者没有都会抛出错误。</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">#-----------下面的方法都是对查询的结果再进行处理:比如 objects.filter.values()--------</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">#  &lt;4&gt;values(*field):        返回一个ValueQuerySet——一个特殊的QuerySet，运行后得到的并不是一系列 model的实例化对象，而是一个可迭代的字典序列</span></span><br><span class="line">                                                     </span><br><span class="line">                <span class="comment">#  &lt;5&gt;exclude(**kwargs):     它包含了与所给筛选条件不匹配的对象</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">#  &lt;6&gt;order_by(*field):      对查询结果排序</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">#  &lt;7&gt;reverse():             对查询结果反向排序</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">#  &lt;8&gt;distinct():            从返回结果中剔除重复纪录</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">#  &lt;9&gt;values_list(*field):   它与values()非常相似，它返回的是一个元组序列，values返回的是一个字典序列</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">#  &lt;10&gt;count():              返回数据库中匹配查询(QuerySet)的对象数量。</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># &lt;11&gt;first():               返回第一条记录</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># &lt;12&gt;last():                返回最后一条记录</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">#  &lt;13&gt;exists():             如果QuerySet包含数据，就返回True，否则返回False。</span></span><br><span class="line">                </span><br><span class="line">         <span class="comment">#扩展查询,有时候DJANGO的查询API不能方便的设置查询条件，提供了另外的扩展查询方法extra:</span></span><br><span class="line">            <span class="comment">#extra(select=None, where=None, params=None, tables=None,order_by=None, select_params=None</span></span><br><span class="line"></span><br><span class="line">            (1)  Entry.objects.extra(<span class="keyword">select</span>=&#123;<span class="string">'is_recent'</span>: <span class="string">"pub_date &gt; '2006-01-01'"</span>&#125;)</span><br><span class="line">            (<span class="number">2</span>)  Blog.objects.extra(</span><br><span class="line">                    <span class="keyword">select</span>=SortedDict([(<span class="string">'a'</span>, <span class="string">'%s'</span>), (<span class="string">'b'</span>, <span class="string">'%s'</span>)]),</span><br><span class="line">                    select_params=(<span class="string">'one'</span>, <span class="string">'two'</span>))</span><br><span class="line"></span><br><span class="line">            (<span class="number">3</span>)  q = Entry.objects.extra(<span class="keyword">select</span>=&#123;<span class="string">'is_recent'</span>: <span class="string">"pub_date &gt; '2006-01-01'"</span>&#125;)</span><br><span class="line">                 q = q.extra(order_by = [<span class="string">'-is_recent'</span>])</span><br><span class="line"></span><br><span class="line">            (<span class="number">4</span>)  Entry.objects.extra(<span class="keyword">where</span>=[<span class="string">'headline=%s'</span>], params=[<span class="string">'Lennon'</span>])  </span><br><span class="line">            </span><br><span class="line">       高级操作：<span class="keyword">all</span>,filter,<span class="keyword">exclude</span>,annotate,<span class="keyword">distinct</span>,order_by, extra,<span class="keyword">reverse</span>，<span class="keyword">only</span>,defer,<span class="keyword">using</span>,<span class="keyword">row</span>等等</span><br><span class="line"></span><br><span class="line">                 select_related(<span class="keyword">self</span>, *<span class="keyword">fields</span>)</span><br><span class="line">                     性能相关：表之间进行<span class="keyword">join</span>连表操作，一次性获取关联的数据。</span><br><span class="line">                     model.tb.objects.all().select_related()</span><br><span class="line">                     model.tb.objects.all().select_related(<span class="string">'外键字段'</span>)</span><br><span class="line">                     model.tb.objects.all().select_related(<span class="string">'外键字段__外键字段'</span>)</span><br><span class="line">                     </span><br><span class="line">                 prefetch_related(<span class="keyword">self</span>, *lookups)</span><br><span class="line">                     性能相关：多表连表操作时速度会慢，使用其执行多次<span class="keyword">SQL</span>查询在Python代码中实现连表操作。</span><br><span class="line">                     models.UserInfo.objects.prefetch_related(<span class="string">'外键字段'</span>)</span><br><span class="line">                    <span class="comment"># 获取所有用户表</span></span><br><span class="line">                    <span class="comment"># 计算获取搭配所有用户类型ID(1,2,...)</span></span><br><span class="line">                    <span class="comment"># 获取用户类型表where id in (用户表中的查到的所有用户ID[1,2,...)</span></span><br><span class="line">                    <span class="keyword">select</span> * <span class="keyword">from</span> UserInfo <span class="keyword">where</span> <span class="keyword">id</span> &lt;<span class="number">20</span></span><br><span class="line">                    <span class="keyword">select</span> * <span class="keyword">from</span> UserType <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> [<span class="number">1</span>,<span class="number">2</span>,...]</span><br><span class="line">                            </span><br><span class="line">                 defer(<span class="keyword">self</span>, *<span class="keyword">fields</span>):</span><br><span class="line">                    models.UserInfo.objects.defer(<span class="string">'username'</span>,<span class="string">'id'</span>)</span><br><span class="line">                    或</span><br><span class="line">                    models.UserInfo.objects.filter(...).defer(<span class="string">'username'</span>,<span class="string">'id'</span>)</span><br><span class="line">                    <span class="comment">#映射中排除某列数据</span></span><br><span class="line"></span><br><span class="line">                 <span class="keyword">only</span>(<span class="keyword">self</span>, *<span class="keyword">fields</span>):</span><br><span class="line">                    <span class="comment">#仅取某个表中的数据</span></span><br><span class="line">                     models.UserInfo.objects.only(<span class="string">'username'</span>,<span class="string">'id'</span>)</span><br><span class="line">                     或</span><br><span class="line">                     models.UserInfo.objects.filter(...).only(<span class="string">'username'</span>,<span class="string">'id'</span>)</span><br><span class="line">                     </span><br><span class="line">                 <span class="keyword">using</span>(<span class="keyword">self</span>, <span class="keyword">alias</span>):</span><br><span class="line">                    指定使用的数据库，参数为别名（setting中的设置）</span><br><span class="line">                    </span><br><span class="line">       自己写<span class="keyword">sql</span>语句</span><br><span class="line">            <span class="keyword">from</span> django.db <span class="keyword">import</span> <span class="keyword">connection</span>,connections</span><br><span class="line">            <span class="keyword">cursor</span> = connection.cursor()  <span class="comment">#connections['default'].cursor()</span></span><br><span class="line">            cursor.execute(“”“<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> auth_user <span class="keyword">where</span> <span class="keyword">id</span> = %s<span class="string">""",[1])</span></span><br><span class="line"><span class="string">            row = cursor.fetchone()</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            models.UserInfo.objects.raw('select id,name from userinfo')</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Entry.objects.extra(select=('new_id':'select col from sometable where othercol &gt; %s'),select_params=(1,))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">补充：查询相关API</span></span><br></pre></td></tr></table></figure>

<p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> 总结 </p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">总结：1.索引</span><br><span class="line">             2.一对多：on_delete</span><br><span class="line">             3.一对一和一对多什么关系？unique=True  <span class="comment">#一对一其实就是 一对多 + 唯一索引</span></span><br><span class="line">             4.多对多</span><br><span class="line">                    a.自动创建 b.手动创建 c.自动+手动</span><br><span class="line">                    -<span class="comment">#自关联：互粉、好友#</span></span><br><span class="line">             PS：related_name</span><br><span class="line">             </span><br><span class="line">       必须要记住的：</span><br><span class="line">          创建数据库：related_name</span><br><span class="line">                      related_query_name</span><br><span class="line">                      <span class="comment">#表和表之间可以关联</span></span><br><span class="line">                          多对多自关联 --&gt;互粉</span><br><span class="line">                          一对多自关联 --&gt;评论楼</span><br><span class="line">                      </span><br><span class="line">          操作数据库 <span class="string">.all</span></span><br><span class="line">                     <span class="string">.values</span></span><br><span class="line">                     <span class="string">.values_list</span></span><br><span class="line">                     <span class="string">.filter</span></span><br><span class="line">                     <span class="string">.delete</span></span><br><span class="line">                     <span class="string">.update</span></span><br><span class="line">                     <span class="string">.create</span></span><br><span class="line">                     m.add</span><br><span class="line">                     m.<span class="keyword">set</span></span><br><span class="line">                     m.<span class="keyword">clear</span></span><br><span class="line">                     m.remove</span><br><span class="line">                     <span class="string">.only</span></span><br><span class="line">                     <span class="string">.defer</span></span><br><span class="line">                     <span class="string">.extra</span></span><br><span class="line">                     <span class="string">.raw</span></span><br><span class="line">                     原生sql</span><br><span class="line">                     select_related</span><br><span class="line">                     prefetch_related</span><br><span class="line">                     </span><br><span class="line"></span><br><span class="line">总结</span><br></pre></td></tr></table></figure>

<p>更多请关注：<a href="https://www.cnblogs.com/zhangyafei/p/10350281.html" target="_blank" rel="noopener external nofollow noreferrer">https://www.cnblogs.com/zhangyafei/p/10350281.html</a></p>
<h1 id="六、admin：后台管理工具"><a href="#六、admin：后台管理工具" class="headerlink" title="六、admin：后台管理工具"></a>六、admin：后台管理工具</h1><p>后台管理的特点</p>
<ul>
<li>权限管理</li>
<li>少前端样式</li>
<li>快速开发</li>
</ul>
<p>创建超级用户</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">python</span> <span class="selector-tag">manage</span><span class="selector-class">.py</span> <span class="selector-tag">createsuperuser</span></span><br><span class="line">    <span class="selector-tag">username</span><span class="selector-pseudo">:root</span></span><br><span class="line">    <span class="selector-tag">email</span><span class="selector-pseudo">:root</span><span class="keyword">@qq</span>.com</span><br><span class="line">    <span class="attribute">password:</span> xxxxxxx</span><br><span class="line">    <span class="attribute">password:</span> xxxxxxx</span><br></pre></td></tr></table></figure>

<p>admin注册</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># admin.py中自定制</span></span><br><span class="line">    <span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line">    <span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">        list_display = [<span class="string">'id'</span>,<span class="string">'name'</span>,<span class="string">'price'</span>,<span class="string">'pub_date'</span>] <span class="comment">#每个表首页显示每一条记录的字段</span></span><br><span class="line">        list_editable = [<span class="string">'name'</span>,<span class="string">'price'</span>]  <span class="comment">#那些字段可编辑</span></span><br><span class="line">        filter_horizontal = [<span class="string">'authors'</span>] <span class="comment">#详细页水平过滤字段 主要针对多对多字段</span></span><br><span class="line">        <span class="comment"># filter_vertical =[]  #垂直过滤</span></span><br><span class="line">        list_per_page = <span class="number">3</span>       <span class="comment">#分页，每页显示多少条记录</span></span><br><span class="line">        search_fields = [<span class="string">'name'</span>,<span class="string">'authors__name'</span>,<span class="string">'publish__name'</span>]    <span class="comment">#检索框</span></span><br><span class="line">        list_filter = (<span class="string">'pub_date'</span>,<span class="string">'publish'</span>,<span class="string">'authors'</span>)      <span class="comment">#表首页过滤字段</span></span><br><span class="line">        ordering = [<span class="string">'price'</span>,<span class="string">'id'</span>] <span class="comment">#按照某字段排序</span></span><br><span class="line">        fieldsets = [</span><br><span class="line">            (<span class="literal">None</span>, &#123;<span class="string">'fields'</span>: [<span class="string">'name'</span>]&#125;),  <span class="comment">#显示字段</span></span><br><span class="line">            (<span class="string">'price information'</span>, &#123;<span class="string">'fields'</span>: [<span class="string">'price'</span>, <span class="string">"publish"</span>], <span class="string">'classes'</span>: [<span class="string">'collapse'</span>]&#125;), <span class="comment"># 隐藏字段，隐藏样式</span></span><br><span class="line">    ]</span><br><span class="line">     </span><br><span class="line"><span class="comment"># 自定制显示字段名称：</span></span><br><span class="line">    models.py</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">        name = models.CharField(max_length=<span class="number">20</span>,verbose_name=<span class="string">'姓名'</span>)</span><br><span class="line">        price = models.IntegerField(<span class="string">'价格'</span>)</span><br><span class="line">        pub_date = models.DateField(<span class="string">'出版日期'</span>)</span><br><span class="line">        publish = models.ForeignKey(<span class="string">'Publish'</span>,on_delete=<span class="string">'CASCADE'</span>,verbose_name=<span class="string">'出版商'</span>)</span><br><span class="line">        authors = models.ManyToManyField(<span class="string">'Author'</span>,verbose_name=<span class="string">'作者'</span>)</span><br><span class="line"> </span><br><span class="line">    admin.site.register(models.Author)</span><br><span class="line">    admin.site.register(models.Book,BookAdmin)</span><br><span class="line">    admin.site.register(models.Publish)</span><br><span class="line">     </span><br><span class="line">    注：settings中设置：LANGUAGE_CODE = <span class="string">'zh-hans'</span> <span class="comment">#中文   #'en-us'</span></span><br></pre></td></tr></table></figure>

<p>　<strong>补充：对django内置auth表自定义扩展</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db import models</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models import AbstractUser</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">class UserProfile(AbstractUser):</span><br><span class="line">    <span class="string">""</span><span class="string">" 用户信息表 "</span><span class="string">""</span></span><br><span class="line">    nickname = models.CharField(<span class="attribute">max_length</span>=50, <span class="attribute">verbose_name</span>=<span class="string">'昵称'</span>, <span class="attribute">default</span>=<span class="string">''</span>)</span><br><span class="line">    birthday = models.DateField(<span class="attribute">verbose_name</span>=<span class="string">'生日'</span>, <span class="attribute">null</span>=<span class="literal">True</span>, <span class="attribute">blank</span>=<span class="literal">True</span>)</span><br><span class="line">    gender = models.CharField(choices=((<span class="string">'male'</span>, <span class="string">'男'</span>),(<span class="string">'female'</span>, <span class="string">'女'</span>)), <span class="attribute">max_length</span>=5,  <span class="attribute">default</span>=<span class="string">'female'</span>)</span><br><span class="line">   <span class="built_in"> address </span>= models.CharField(<span class="attribute">max_length</span>=100, <span class="attribute">default</span>=<span class="string">''</span>)</span><br><span class="line">    mobile = models.CharField(<span class="attribute">max_length</span>=11, <span class="attribute">null</span>=<span class="literal">True</span>, <span class="attribute">blank</span>=<span class="literal">True</span>)</span><br><span class="line">    image = models.ImageField(<span class="attribute">upload_to</span>=<span class="string">'image/%Y/%m'</span>, <span class="attribute">default</span>=<span class="string">'image/default.png'</span>, <span class="attribute">max_length</span>=100)</span><br><span class="line"> </span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name = <span class="string">'用户信息'</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"> </span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.username</span><br></pre></td></tr></table></figure>

<p>settings配置</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">AUTH_USER_MODEL</span> = <span class="string">'users.UserProfile'</span></span><br></pre></td></tr></table></figure>

<p>　</p>
<h1 id="七、后台管理工具之xadmin"><a href="#七、后台管理工具之xadmin" class="headerlink" title="七、后台管理工具之xadmin"></a>七、后台管理工具之xadmin</h1><p>　　1. 下载安装xadmin</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">下载源码： https:<span class="regexp">//gi</span>thub.com<span class="regexp">/sshwsfc/</span>xadmin</span><br></pre></td></tr></table></figure>

<p>　　然后把下载的文件夹中的xadmin移到项目根目录</p>
<p>　　2. 安装依赖包</p>
<p>requirements.txt</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">xlwt</span>==<span class="number">1.3</span>.<span class="number">0</span></span><br><span class="line"><span class="attr">six</span>==<span class="number">1.12</span>.<span class="number">0</span></span><br><span class="line"><span class="attr">Django</span>==<span class="number">2.1</span>.<span class="number">7</span></span><br><span class="line"><span class="attr">httplib2</span>==<span class="number">0.12</span>.<span class="number">1</span></span><br><span class="line"><span class="attr">future</span>==<span class="number">0.17</span>.<span class="number">1</span></span><br><span class="line"><span class="attr">django_crispy_forms</span>==<span class="number">1.7</span>.<span class="number">2</span></span><br><span class="line"><span class="attr">django_formtools</span>==<span class="number">2.1</span></span><br><span class="line"><span class="attr">django_reversion</span>==<span class="number">3.0</span>.<span class="number">3</span></span><br><span class="line"><span class="attr">xlsxwriter</span>==<span class="number">1.1</span>.<span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>　安装　</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install</span> -r requirements.txt</span><br></pre></td></tr></table></figure>

<p>　　3. settings配置</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">INSTALLED_APPS</span> = [</span><br><span class="line">    <span class="symbol">'django</span>.contrib.admin',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.auth',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.contenttypes',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.sessions',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.messages',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.staticfiles',</span><br><span class="line">    <span class="symbol">'xadmin'</span>,    # 新增</span><br><span class="line">    <span class="symbol">'crispy_forms'</span>,   # 新增</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>　　4. urls配置</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from django.urls <span class="keyword">import</span> <span class="built_in">path</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> xadmin</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="built_in">path</span>(<span class="string">'xadmin/'</span>, xadmin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>　　5. adminx注册</p>
<p>　　在每个app内新建一个adminx.py的文件</p>
<p>　　基础配置</p>
<p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> adminx.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@Datetime: 2019/2/26</span></span><br><span class="line"><span class="string">@Author: Zhang Yafei</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> xadmin</span><br><span class="line"><span class="keyword">from</span> xadmin <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> users <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseSetting</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">""" 主题功能设置 """</span></span><br><span class="line">    enable_themes = <span class="literal">True</span></span><br><span class="line">    use_bootswatch = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GlogalSettings</span><span class="params">(object)</span>:</span></span><br><span class="line">    site_title = <span class="string">'幕学后台管理系统'</span></span><br><span class="line">    site_footer = <span class="string">'幕学在线网'</span></span><br><span class="line">    menu_style = <span class="string">'accordion'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmailVerifyRecordAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'code'</span>, <span class="string">'email'</span>, <span class="string">'send_type'</span>, <span class="string">'send_time'</span>]</span><br><span class="line">    search_fields = [<span class="string">'code'</span>, <span class="string">'email'</span>, <span class="string">'send_type'</span>]</span><br><span class="line">    list_filter = [<span class="string">'code'</span>, <span class="string">'email'</span>, <span class="string">'send_type'</span>, <span class="string">'send_time'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BannerAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'title'</span>, <span class="string">'image'</span>, <span class="string">'url'</span>, <span class="string">'index'</span>, <span class="string">'add_time'</span>]</span><br><span class="line">    search_fields = [<span class="string">'title'</span>, <span class="string">'image'</span>, <span class="string">'url'</span>, <span class="string">'index'</span>]</span><br><span class="line">    list_filter = [<span class="string">'title'</span>, <span class="string">'image'</span>, <span class="string">'url'</span>, <span class="string">'index'</span>, <span class="string">'add_time'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xadmin.site.register(models.EmailVerifyRecond, admin_class=EmailVerifyRecordAdmin)</span><br><span class="line">xadmin.site.register(models.Banner, admin_class=BannerAdmin)</span><br><span class="line">xadmin.site.register(views.BaseAdminView, BaseSetting)</span><br><span class="line">xadmin.site.register(views.CommAdminView, GlogalSettings)</span><br><span class="line"></span><br><span class="line">adminx.py</span><br></pre></td></tr></table></figure>



    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章推荐</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2008\01\04\python\2008-01-04-python-draft\" rel="bookmark">python-draft</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2008\01\05\python\2008-01-04-python-ruan\" rel="bookmark">python-ruan</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\11\25\python\python_基础篇\基础篇-目录\" rel="bookmark">基础篇</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\11\24\python\python_基础篇\第10篇：列表和元组的应用\" rel="bookmark">第10篇：列表和元组的应用</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\11\24\python\python_基础篇\第11篇：高级数据类型之集合\" rel="bookmark">第11篇：高级数据类型之集合</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div>赞赏一下吧～</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="tongsiying 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>tongsiying
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tongsiying.github.io/2022/02/07/python/python_%E5%9F%BA%E7%A1%80%E7%AF%87/%E7%AC%AC42%E7%AF%87%EF%BC%9ADjango%E5%9F%BA%E7%A1%80/" title="第42篇：Django基础">https://tongsiying.github.io/2022/02/07/python/python_基础篇/第42篇：Django基础/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/python/" rel="tag"># python</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/02/07/self/2008-01-04-python-ruan/" rel="prev" title="2022">
      <i class="fa fa-chevron-left"></i> 2022
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/05/17/linux/Linux%E4%B8%8A%E5%A4%A9%E4%B9%8B%E8%B7%AF/2022-05-17-Linux%E4%B8%8A%E5%A4%A9%E4%B9%8B%E8%B7%AF%EF%BC%88%E5%9B%9B%EF%BC%89%E4%B9%8BLinux%E7%95%8C%E9%9D%A2%E4%BB%8B%E7%BB%8D/" rel="next" title="Linux上天之路（四）之Linux界面介绍">
      Linux上天之路（四）之Linux界面介绍 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#一、常用命令"><span class="nav-text">一、常用命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二、配置文件"><span class="nav-text">二、配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-配置"><span class="nav-text">1.  配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-读取配置文件"><span class="nav-text">2. 读取配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-补充："><span class="nav-text">3. 补充：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-django入口"><span class="nav-text">4. django入口</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#三、urls：路由分发"><span class="nav-text">三、urls：路由分发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-例子"><span class="nav-text">1. 例子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-django2-0版的path"><span class="nav-text">2. django2.0版的path</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#四、视图函数（views）"><span class="nav-text">四、视图函数（views）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-HttpRequest对象的属性和方法："><span class="nav-text">1. HttpRequest对象的属性和方法：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-HttpResponse对象："><span class="nav-text">2. HttpResponse对象：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#五、models"><span class="nav-text">五、models</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-创建类"><span class="nav-text">1.创建类</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#六、admin：后台管理工具"><span class="nav-text">六、admin：后台管理工具</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#七、后台管理工具之xadmin"><span class="nav-text">七、后台管理工具之xadmin</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="tongsiying"
      src="/images/gutianle.gif">
  <p class="site-author-name" itemprop="name">tongsiying</p>
  <div class="site-description" itemprop="description">问渠那得清如许？为有源头活水来。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">432</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tongsiying" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tongsiying" rel="noopener external nofollow noreferrer" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wxtlucky1015@163.com" title="E-Mail → mailto:wxtlucky1015@163.com" rel="noopener external nofollow noreferrer" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/2964109344" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;2964109344" rel="noopener external nofollow noreferrer" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/" title="tongsiying → https:&#x2F;&#x2F;tongsiying.github.io"><i class="wrench fa-fw"></i>tongsiying</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/ReadingNotes/" title="ReadingNotes → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;ReadingNotes&#x2F;"><i class="book fa-fw"></i>ReadingNotes</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/blog/" title="blog → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;blog&#x2F;"><i class="book fa-fw"></i>blog</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/blog/tools/" title="tools → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;blog&#x2F;tools&#x2F;"><i class="wrench fa-fw"></i>tools</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/lanlan/" title="lanlan → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;lanlan&#x2F;"><i class="wrench fa-fw"></i>lanlan</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/Music/" title="note → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;Music&#x2F;"><i class="wrench fa-fw"></i>note</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/sound/" title="Music → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;sound&#x2F;"><i class="wrench fa-fw"></i>Music</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/JSONFormat/" title="JSONFormat → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;JSONFormat&#x2F;"><i class="wrench fa-fw"></i>JSONFormat</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/HTML5-Canvas/" title="Canvas → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;HTML5-Canvas&#x2F;"><i class="wrench fa-fw"></i>Canvas</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/games/" title="games → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;games&#x2F;"><i class="wrench fa-fw"></i>games</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/love/" title="love → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;love&#x2F;"><i class="wrench fa-fw"></i>love</a>
      </span>
  </div>



		<div style="">
  <canvas id="canvas" style="width:60%;">��ǰ�������֧��canvas������������������</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //����canvas�Ŀ���
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //�洢ʱ������
    var data = [];
    //�洢�˶���С��
    var balls = [];
    //�������Ӱ뾶
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //�洢ʱ�����֣���ʮλСʱ����λСʱ��ð�š�ʮλ���ӡ���λ���ӡ�ð�š�ʮλ���ӡ���λ������7���������
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*���ɵ�������*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*����ʱ��*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //ʱ�䷢���仯
            if(NewData[i] !== data[i]){
                //���仯������ֵ����data�����е������洢��changeNumArray������
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //����С��
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*����С��״̬*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*����Ҫ�˶���С��*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*��Ⱦ*/
    function render(){
        //���û������ȣ��ﵽ��ջ�����Ч��
        canvas.height = 100;
        //��Ⱦʱ��
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //��ȾС��
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //����ʱ��
        updateDigitTime();
        //����С��״̬
        updateBalls();
        //��Ⱦ
        render();
    },50);
}

})();
</script>
      </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; Weeny – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tongsiying</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">7.6m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">114:48</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
