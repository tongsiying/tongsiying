<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/hedgehog.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/hedgehog.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tongsiying.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","b2t":true,"scrollpercent":true,"padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="BlockStorage-vdbench">
<meta property="og:url" content="https://tongsiying.github.io/2008/01/04/project/project_BlockStorage/2008-01-04-BlockStorage-vdbench/index.html">
<meta property="og:site_name" content="tongsiying">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2008-01-04T10:37:19.000Z">
<meta property="article:modified_time" content="2021-02-15T08:47:15.869Z">
<meta property="article:author" content="tongsiying">
<meta property="article:tag" content="BlockStorage-tools">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tongsiying.github.io/2008/01/04/project/project_BlockStorage/2008-01-04-BlockStorage-vdbench/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>BlockStorage-vdbench | tongsiying</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
<!-- 加入APlayer音乐播放器 -->
<link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>
  <div class="container use-motion">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

	<!-- catalog/ -->
	<!--     <a href="/" class="brand" rel="start"> -->
	
    <a href="/catalog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">tongsiying</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">阅读|运动|自律</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/catalog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-目录">

    <a href="/catalog/" rel="section"><i class="fa fa fa-th fa-fw"></i>目录</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-读书清单">

    <a href="/read" rel="section"><i class="fa fa-book fa-fw"></i>读书清单</a>

  </li>
        <li class="menu-item menu-item-读书笔记">

    <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="section"><i class="fa fa-book fa-fw"></i>读书笔记</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tongsiying.github.io/2008/01/04/project/project_BlockStorage/2008-01-04-BlockStorage-vdbench/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/gutianle.gif">
      <meta itemprop="name" content="tongsiying">
      <meta itemprop="description" content="问渠那得清如许？为有源头活水来。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tongsiying">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          BlockStorage-vdbench
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2008-01-04 18:37:19" itemprop="dateCreated datePublished" datetime="2008-01-04T18:37:19+08:00">2008-01-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-15 16:47:15" itemprop="dateModified" datetime="2021-02-15T16:47:15+08:00">2021-02-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/BlockStorage/" itemprop="url" rel="index"><span itemprop="name">BlockStorage</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>35k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>32 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p class="description"></p>
<a id="more"></a>

<h1 id="001-vdbench安装"><a href="#001-vdbench安装" class="headerlink" title="001-vdbench安装"></a>001-vdbench安装</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.安装jdk：</span><br><span class="line">mkdir -p /usr/local/java/;tar -vzxf jdk-8u181-linux-x64.tar.gz -C /usr/local/java/</span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=/usr/local/java/jdk1.8.0_181</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$JAVA_HOME</span>/bin:$PATH</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">CLASSPATH</span>=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line">2、检测vdbench能够使用：</span><br><span class="line">进入vdbench相应目录下./vdbench -t 来测试一下vdbench的可用性，如果正常，会在目录下自动生成一个output目录。</span><br><span class="line">root@node1:/home/vdbench/vdbench50406# ./vdbench -t</span><br><span class="line">如果报错，则需修改vdbench的权限：</span><br><span class="line">root@node03:/home/vdbench/vdbench50406# chmod 777 vdbench</span><br></pre></td></tr></table></figure>

<h1 id="002-文件系统测试"><a href="#002-文件系统测试" class="headerlink" title="002-文件系统测试"></a>002-文件系统测试</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">vdbench文件系统测试详细参数说明：</span><br><span class="line">对于一个文件系统，配置以下参数：</span><br><span class="line">（1）HD：主机定义。与虚拟块设备相同。</span><br><span class="line">（2）FSD：文件系统定义</span><br><span class="line">    fsd= 标识文件系统定义的名称</span><br><span class="line">    anchor= 将在其中创建目录结构的目录</span><br><span class="line">    width= 要在定位符下创建的目录数</span><br><span class="line">    depth= 要在定位符下创建的级别数</span><br><span class="line">    files= 要在最低级别创建的文件数</span><br><span class="line">    sizes= (size,size,...) 将创建的文件大小</span><br><span class="line">    distribution= bottom（如果希望仅在最低级别创建文件）和 all（如果希望在所有目录中创建文件）</span><br><span class="line">    openflags= 用于打开一个文件系统 (Solaris) 的 flag_list</span><br><span class="line">（3）FWD：文件系统工作负载定义</span><br><span class="line">    fwd= 标识文件系统工作负载定义的名称。</span><br><span class="line">    fsd= 要使用的文件系统定义的 ID。</span><br><span class="line">    host= 要用于此工作负载的主机的 ID。</span><br><span class="line">    fileio= random 或 sequential，表示文件 I/O 将执行的方式。</span><br><span class="line">    fileselect= random 或 sequential，标识选择文件或目录的方式。</span><br><span class="line">    xfersizes= 数据传输（读取和写入操作）处理的数据大小。</span><br><span class="line">    operation= mkdir、rmdir、<span class="keyword">create</span>、<span class="keyword">delete</span>、<span class="keyword">open</span>、<span class="keyword">close</span>、<span class="keyword">read</span>、write、getattr和setattr。选择要执行的单个文件操作。</span><br><span class="line">    rdpct= （仅）读取和写入操作的百分比。</span><br><span class="line">    threads= 此工作负载的并发线程数量。每个线程需要至少 <span class="number">1</span> 个文件。</span><br><span class="line">（<span class="number">4</span>）RD：运行定义</span><br><span class="line">    fwd= 要使用的文件系统工作负载定义的 <span class="keyword">ID</span>。</span><br><span class="line">    fwdrate= 每秒执行的文件系统操作数量。</span><br><span class="line">    <span class="keyword">format</span>= yes / <span class="keyword">no</span> / <span class="keyword">only</span> / restart / clean / directories。在开始运行之前要执行的操作。</span><br><span class="line">    yes：是每次都会先删除目录文件，再重新创建</span><br><span class="line">    restart：每次起的时候会先校验文件、目录是否全，不全的补上</span><br><span class="line">    <span class="keyword">no</span>：不校验文件目录直接跑，事先最好将文件灌好</span><br><span class="line">    <span class="keyword">operations</span>= 覆盖fwd操作。选项相同。</span><br><span class="line">    openflags=o_direct：处理缓存的方法。<span class="string">"o_direct"</span>使用Linux的<span class="string">"O_DIRECT"</span>选项不使用缓存直接写入磁盘。</span><br><span class="line"></span><br><span class="line">vdbench文件系统测试Example：</span><br><span class="line">fsd=fsd1,anchor=/mnt/cephfs02,<span class="keyword">depth</span>=<span class="number">3</span>,width=<span class="number">10</span>,files=<span class="number">20</span>,<span class="keyword">size</span>(<span class="number">512</span>,<span class="number">50</span>,<span class="number">4</span>k,<span class="number">50</span>),openflags=o_direct</span><br><span class="line">fwd=fwd1,fsd=fsd1,operation=write,xfersize=(<span class="number">4</span>k,<span class="number">15</span>,<span class="number">8</span>k,<span class="number">35</span>,<span class="number">1</span>M,<span class="number">50</span>),fileio=random,fileselect=random,threads=<span class="number">32</span></span><br><span class="line">rd=rd1,fwd=fwd1,fwdrate=<span class="keyword">max</span>,<span class="keyword">format</span>=yes,elapsed=<span class="number">20</span>,<span class="built_in">interval</span>=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、运行脚本</span><br><span class="line">root@node1:/home/vdbench/vdbench50406<span class="comment"># ./vdbench -f examples/filesys/create_files -jn</span></span><br><span class="line">其中-jn是为了做数据校验，目前还不太懂。</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>、输出结果</span><br><span class="line">会回写输出一大堆东西，如果没有出现错误，最后会出现：</span><br><span class="line">Vdbench execution completed successfully. <span class="keyword">Output</span> <span class="keyword">directory</span>:  /home/vdbench/vdbench50406/<span class="keyword">output</span></span><br><span class="line">每次运行后，vdbench 会创建一个包含以下文件的<span class="keyword">output</span>文件夹：</span><br><span class="line">（<span class="number">1</span>）errorlog.html——当为测试启用了数据验证（-jn）时，它可包含一些数据块中的错误的相关信息：</span><br><span class="line">无效的密钥读取</span><br><span class="line">无效的 lba 读取（一个扇区的逻辑字节地址）</span><br><span class="line">无效的 SD 或 FSD 名称读取</span><br><span class="line">数据损坏，即使在使用错误的 lba 或密钥时</span><br><span class="line">数据损坏</span><br><span class="line">坏扇区</span><br><span class="line">（<span class="number">2</span>）flatfile.html——包含 vdbench 生成的一种逐列的 <span class="keyword">ASCII</span> 格式的信息。</span><br><span class="line">（<span class="number">3</span>）histogram.html——一种包含报告柱状图的响应时间、文本格式的文件。</span><br><span class="line">（<span class="number">4</span>）logfile.html——包含 <span class="keyword">Java</span> 代码写入控制台窗口的每行信息的副本。logfile.html 主要用于调试用途</span><br><span class="line">（<span class="number">5</span>）parmfile.html——显示已包含用于测试的每项内容的最终结果</span><br><span class="line">（<span class="number">6</span>）resourceN-M.html、resourceN.html、resourceN.var_adm_msgs.html</span><br><span class="line">摘要报告、stdout/stderr 报告、主机 N 的摘要报告</span><br><span class="line">最后 “nn” 行文件 /<span class="keyword">var</span>/adm/messages 和 /<span class="keyword">var</span>/adm/messages。每个 M 个 JVM/<span class="keyword">Slave</span> 的目标主机 N 和主机 N 上为 <span class="number">0</span>。</span><br><span class="line">（<span class="number">7</span>）sdN.histogram.html、sdN.html——每个 N 存储定义的柱状图和存储定义 “N” 报告。</span><br><span class="line">（<span class="number">8</span>）summary.html——主要报告文件，显示为在每个报告间隔的每次运行生成的总工作负载，以及除第一个间隔外的所有间隔的加权平均值。</span><br><span class="line">    <span class="built_in">interval</span>：报告间隔序号</span><br><span class="line">    I/O rate：每秒观察到的平均 I/O 速率</span><br><span class="line">    MB sec：传输的数据的平均 MB 数</span><br><span class="line">    <span class="keyword">bytes</span> I/O：平均数据传输大小</span><br><span class="line">    <span class="keyword">read</span> pct：平均读取百分比</span><br><span class="line">    resp <span class="built_in">time</span>：以读/写请求持续时间度量的平均响应时间。所有 vdbench 时间都以毫秒为单位。</span><br><span class="line">    resp <span class="keyword">max</span>：在此间隔中观察到的最大响应时间。最后一行包含最大值总数。</span><br><span class="line">    resp <span class="keyword">stddev</span>：响应时间的标准偏差</span><br><span class="line">    cpu% <span class="keyword">sys</span>+usr：处理器繁忙 = <span class="number">100</span>（系统 + 用户时间）（Solaris、Windows、Linux）</span><br><span class="line">    cpu% <span class="keyword">sys</span>：处理器利用率：系统时间</span><br><span class="line">（<span class="number">9</span>）swat_mon.txt，swat_mon_total.txt</span><br><span class="line">  vdbench 与 Sun StorageTekTM Workload Analysis Tool (Swat) <span class="keyword">Trace</span> Facility (STF) 相结合，支持重放使用 Swat 创建的一个轨迹的 I/O 工作负载。</span><br><span class="line">Swat 使用 <span class="keyword">Create</span> Replay <span class="keyword">File</span> 选项创建和处理的轨迹文件会创建文件 flatfile.bin（flatfile.bin.gz 用于 vdbench403 和更高版本），其中包含 Swat 所识别的每个 I/O 操作的一条记录。</span><br><span class="line">这些文件包含一个格式化的报告，可将该报告导入 Swat <span class="keyword">Performance</span> Monitor (SPM)  中来创建性能图表。</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fsd=fsd1,anchor=/mnt/test832,depth=<span class="number">1</span>,width=<span class="number">1</span>,files=<span class="number">1</span>,size=<span class="number">1024</span>g,openflags=o_direct</span><br><span class="line">fwd=format,threads=<span class="number">1</span>,xfersize=<span class="number">1</span>m</span><br><span class="line">fwd=fwd1,fsd=fsd1,xfersize=<span class="number">1</span>m,fileio=random,fileselect=sequential,rdpct=<span class="number">0</span>,threads=<span class="number">1</span></span><br><span class="line">rd=rd1,fwd=fwd*,fwdrate=max,format=(restart,only),elapsed=<span class="number">600</span>,<span class="built_in">int</span>erval=<span class="number">1</span></span><br></pre></td></tr></table></figure>



<h1 id="003-裸盘测试"><a href="#003-裸盘测试" class="headerlink" title="003-裸盘测试"></a>003-裸盘测试</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">vdbench裸盘测试——详细参数说明：</span><br><span class="line"><span class="number">1</span>、对于一个块设备，配置以下参数：</span><br><span class="line">（<span class="number">1</span>）HD：主机定义</span><br><span class="line">    如果您希望展示当前主机，则设置 hd= localhost。如果希望指定一个远程主机，hd= label。</span><br><span class="line">    system= IP 地址或网络名称。</span><br><span class="line">Example：</span><br><span class="line">     hd=localhost,shell=ssh,vdbench=/home/vdbench/vdbench50406,user=root</span><br><span class="line">     hd=hd1,system=<span class="number">10.147</span><span class="number">.0</span><span class="number">.15</span></span><br><span class="line">     hd=hd2,system=<span class="number">10.147</span><span class="number">.37</span><span class="number">.173</span></span><br><span class="line">注意：vdbench=dir ，这里的目录是指所有主机上的目录，这就表示，所有主机上的vdbench目录都要一样，且对应的配置要放在vdbench下面；</span><br><span class="line"></span><br><span class="line">（<span class="number">2</span>）SD：存储定义</span><br><span class="line">    sd= 标识存储的名称。</span><br><span class="line">    host= 存储所在的主机的 ID。</span><br><span class="line">    lun= 原始磁盘、磁带或文件系统的名称。vdbench 也可为您创建一个磁盘。</span><br><span class="line">    threads= 对 SD 的最大并发 I/O 请求数量。默认为 <span class="number">8</span>。</span><br><span class="line">    hitarea= 调整读取命中百分比的大小。默认为 <span class="number">1</span>m。</span><br><span class="line">    openflags= 用于打开一个lun 或一个文件的 flag_list，为了贴近真实场景，一般在这里选择o_direct，绕过缓存机制，直接写盘。</span><br><span class="line">Example：</span><br><span class="line">      sd=<span class="keyword">default</span>,threads=<span class="number">32</span>,openflags=o_direct,size=<span class="number">340</span>G</span><br><span class="line">      sd=sd1,hd=hd1,lun=/dev/sdb</span><br><span class="line">      sd=sd2,hd=hd1,lun=/dev/sdc</span><br><span class="line">      sd=sd3,hd=hd1,lun=/dev/sdd</span><br><span class="line">      sd=sd4,hd=hd1,lun=/dev/sde</span><br><span class="line">      sd=sd5,hd=hd1,lun=/dev/sdf</span><br><span class="line">      sd=sd6,hd=hd1,lun=/dev/sdg</span><br><span class="line">      sd=sd7,hd=hd1,lun=/dev/sdh</span><br><span class="line">      sd=sd8,hd=hd1,lun=/dev/sdi</span><br><span class="line">      sd=sd1,hd=hd2,lun=/dev/sdb</span><br><span class="line">      sd=sd2,hd=hd2,lun=/dev/sdc</span><br><span class="line">      sd=sd3,hd=hd2,lun=/dev/sdd</span><br><span class="line">      sd=sd4,hd=hd2,lun=/dev/sde</span><br><span class="line">      sd=sd5,hd=hd2,lun=/dev/sdf</span><br><span class="line">      sd=sd6,hd=hd2,lun=/dev/sdg</span><br><span class="line">      sd=sd7,hd=hd2,lun=/dev/sdh</span><br><span class="line">      sd=sd8,hd=hd2,lun=/dev/sdi</span><br><span class="line">      此配置区分了主机<span class="number">1</span>和主机<span class="number">2</span>，第一行是针对以下所有sd的通用配置；</span><br><span class="line">      </span><br><span class="line">（<span class="number">3</span>）WD：工作负载定义</span><br><span class="line">    wd= 标识工作负载的名称。</span><br><span class="line">    sd= 要使用的存储定义的 ID。</span><br><span class="line">    host= 要运行此工作负载的主机的 ID。默认设置为 localhost。</span><br><span class="line">    rdpct= 读取请求占请求总数的百分比。</span><br><span class="line">    rhpct= 读取命中百分比。默认设置为 <span class="number">0</span>。</span><br><span class="line">    whpct= 写入命中百分比。默认设置为 <span class="number">0</span>。</span><br><span class="line">    xfersize= 要传输的数据大小。默认设置为 <span class="number">4</span>k。</span><br><span class="line">    seekpct= 随机寻道的百分比。可为随机值。</span><br><span class="line">    openflags= 用于打开一个 lun 或一个文件的 flag_list。</span><br><span class="line">    iorate= 此工作负载的固定 I/O 速率。</span><br><span class="line">Example:</span><br><span class="line">wd=wd1,sd=sd*,xfersize=<span class="number">4</span>k,rdpct=<span class="number">0</span>,seekpct=<span class="number">100</span></span><br><span class="line">此配置，配置了块的大小，读的比例和随机比例；</span><br><span class="line"></span><br><span class="line">（<span class="number">4</span>）RD：运行定义</span><br><span class="line">    rd= 标识运行的名称。</span><br><span class="line">    wd= 用于此运行的工作负载的 ID。</span><br><span class="line">    iorate= (#,#,...) 一个或多个 I/O 速率。（这里可以控制运行的iops，如果不控制就设置成max）</span><br><span class="line">    elapsed= time：以秒为单位的运行持续时间。默认设置为<span class="number">30</span>。(设置长时间的运行，可能会使得数据更加稳定)</span><br><span class="line">    warmup= time：加热期，最终会被忽略。</span><br><span class="line">    distribution= I/O 请求的分布：指数、统一或确定性。</span><br><span class="line">    pause= 在下一次运行之前休眠的时间，以秒为单位。</span><br><span class="line">    openflags= 用于打开一个 lun 或一个文件的 flag_list。</span><br><span class="line">Example:</span><br><span class="line">rd=run1,wd=wd1,iorate=max,el=<span class="number">100000</span>,<span class="keyword">in</span>=<span class="number">1</span>,warmup=<span class="number">600</span></span><br><span class="line">此配置，配置了iorate（iops），运行时间，数据打印频率</span><br><span class="line">vdbench裸盘测试examples:</span><br><span class="line">hd=localhost,shell=ssh,vdbench=/home/vdbench/vdbench50406,user=root</span><br><span class="line">hd=hd1,system=<span class="number">200.200</span><span class="number">.213</span><span class="number">.30</span></span><br><span class="line">sd=<span class="keyword">default</span>,threads=<span class="number">16</span>,openflags=o_direct,size=<span class="number">30</span>G</span><br><span class="line">sd=sd1,hd=hd1,lun=/dev/sdb</span><br><span class="line">sd=sd2,hd=hd1,lun=/dev/sdc</span><br><span class="line">sd=sd3,hd=hd1,lun=/dev/sdb</span><br><span class="line">sd=sd4,hd=hd1,lun=/dev/sdc</span><br><span class="line">sd=sd5,hd=hd1,lun=/dev/sdb</span><br><span class="line">sd=sd6,hd=hd1,lun=/dev/sdc</span><br><span class="line">sd=sd7,hd=hd1,lun=/dev/sdb</span><br><span class="line">sd=sd8,hd=hd1,lun=/dev/sdc</span><br><span class="line">wd=wd1,sd=sd*,xfersize=<span class="number">4</span>k,rdpct=<span class="number">0</span>,seekpct=<span class="number">100</span></span><br><span class="line">rd=run1,wd=wd1,iorate=max,el=<span class="number">100000</span>,<span class="keyword">in</span>=<span class="number">1</span>,warmup=<span class="number">600</span></span><br><span class="line"></span><br><span class="line">输出结果（部分）：</span><br><span class="line">Aug <span class="number">13</span>, <span class="number">2018</span>  <span class="built_in">int</span>erval        i/o   MB/sec   bytes   read     resp     read    write     resp     resp  queue  cpu%  cpu%</span><br><span class="line">                             rate  <span class="number">1024</span>**<span class="number">2</span>     i/o    pct     time     resp     resp      max    stddev depth sys+u   sys</span><br><span class="line"><span class="number">07</span>:<span class="number">37</span>:<span class="number">56.397</span>         <span class="number">1</span>      <span class="number">85.00</span>     <span class="number">0.33</span>    <span class="number">4096</span>   <span class="number">0.00</span> <span class="number">2968.303</span>    <span class="number">0.000</span> <span class="number">2968.303</span> <span class="number">6136.625</span> <span class="number">1844.150</span>  <span class="number">308.5</span>  <span class="number">83.4</span>  <span class="number">23.9</span></span><br><span class="line"><span class="number">07</span>:<span class="number">37</span>:<span class="number">56.459</span>         <span class="number">2</span>      <span class="number">83.00</span>     <span class="number">0.32</span>    <span class="number">4096</span>   <span class="number">0.00</span> <span class="number">3184.730</span>    <span class="number">0.000</span> <span class="number">3184.730</span> <span class="number">7861.568</span> <span class="number">1795.753</span>  <span class="number">348.0</span>  <span class="number">95.5</span>  <span class="number">68.2</span></span><br><span class="line"><span class="number">07</span>:<span class="number">37</span>:<span class="number">56.478</span>         <span class="number">3</span>      <span class="number">23.00</span>     <span class="number">0.09</span>    <span class="number">4096</span>   <span class="number">0.00</span> <span class="number">3441.907</span>    <span class="number">0.000</span> <span class="number">3441.907</span> <span class="number">5995.742</span> <span class="number">1011.997</span>   <span class="number">61.2</span>  <span class="number">71.4</span>  <span class="number">42.9</span></span><br><span class="line"><span class="number">07</span>:<span class="number">37</span>:<span class="number">56.493</span>         <span class="number">4</span>       <span class="number">0.00</span>     <span class="number">0.00</span>       <span class="number">0</span>   <span class="number">0.00</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.7</span>   NaN   NaN</span><br><span class="line"><span class="number">07</span>:<span class="number">37</span>:<span class="number">56.647</span>         <span class="number">5</span>       <span class="number">0.00</span>     <span class="number">0.00</span>       <span class="number">0</span>   <span class="number">0.00</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.8</span>  <span class="number">83.3</span>  <span class="number">33.3</span></span><br><span class="line"><span class="number">07</span>:<span class="number">38</span>:<span class="number">01.132</span>         <span class="number">6</span>       <span class="number">0.00</span>     <span class="number">0.00</span>       <span class="number">0</span>   <span class="number">0.00</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>   <span class="number">40.8</span>  <span class="number">85.7</span>  <span class="number">33.3</span></span><br><span class="line"><span class="number">07</span>:<span class="number">38</span>:<span class="number">01.162</span>         <span class="number">7</span>      <span class="number">44.00</span>     <span class="number">0.17</span>    <span class="number">4096</span>   <span class="number">0.00</span> <span class="number">4070.731</span>    <span class="number">0.000</span> <span class="number">4070.731</span> <span class="number">10818.509</span> <span class="number">2883.771</span>  <span class="number">226.7</span>  <span class="number">66.7</span>  <span class="number">66.7</span></span><br><span class="line"><span class="number">07</span>:<span class="number">38</span>:<span class="number">01.181</span>         <span class="number">8</span>       <span class="number">0.00</span>     <span class="number">0.00</span>       <span class="number">0</span>   <span class="number">0.00</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">1.4</span>  <span class="number">88.9</span>  <span class="number">11.1</span></span><br><span class="line"><span class="number">07</span>:<span class="number">38</span>:<span class="number">01.201</span>         <span class="number">9</span>      <span class="number">26.00</span>     <span class="number">0.10</span>    <span class="number">4096</span>   <span class="number">0.00</span> <span class="number">4508.067</span>    <span class="number">0.000</span> <span class="number">4508.067</span> <span class="number">15048.031</span> <span class="number">2778.336</span>   <span class="number">27.7</span>  <span class="number">91.7</span>  <span class="number">55.6</span></span><br><span class="line"><span class="number">07</span>:<span class="number">38</span>:<span class="number">01.630</span>        <span class="number">10</span>       <span class="number">8.00</span>     <span class="number">0.03</span>    <span class="number">4096</span>   <span class="number">0.00</span> <span class="number">1806.932</span>    <span class="number">0.000</span> <span class="number">1806.932</span> <span class="number">4328.737</span> <span class="number">1174.638</span>   <span class="number">48.3</span>  <span class="number">90.0</span>  <span class="number">86.7</span></span><br><span class="line"><span class="number">07</span>:<span class="number">38</span>:<span class="number">01.760</span> Detailed reporting <span class="keyword">is</span> running behind; reporting of <span class="built_in">int</span>ervals <span class="number">11</span><span class="number">-27</span> has been skipped.</span><br><span class="line"><span class="number">07</span>:<span class="number">38</span>:<span class="number">54.054</span>        <span class="number">28</span>       <span class="number">0.00</span>     <span class="number">0.00</span>       <span class="number">0</span>   <span class="number">0.00</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>   <span class="number">15.9</span>   NaN   NaN</span><br><span class="line"><span class="number">07</span>:<span class="number">39</span>:<span class="number">01.272</span>        <span class="number">29</span>      <span class="number">17.00</span>     <span class="number">0.07</span>    <span class="number">4096</span>   <span class="number">0.00</span> <span class="number">4937.274</span>    <span class="number">0.000</span> <span class="number">4937.274</span> <span class="number">7454.897</span> <span class="number">1474.074</span>   <span class="number">39.4</span>   NaN   NaN</span><br><span class="line"><span class="number">07</span>:<span class="number">39</span>:<span class="number">03.858</span> Detailed reporting <span class="keyword">is</span> running behind; reporting of <span class="built_in">int</span>ervals <span class="number">30</span><span class="number">-42</span> has been skipped.</span><br><span class="line"><span class="number">07</span>:<span class="number">39</span>:<span class="number">59.480</span>        <span class="number">89</span>      <span class="number">84.00</span>     <span class="number">0.33</span>    <span class="number">4096</span>   <span class="number">0.00</span> <span class="number">7764.630</span>    <span class="number">0.000</span> <span class="number">7764.630</span> <span class="number">14029.705</span> <span class="number">2984.238</span>  <span class="number">654.5</span>  <span class="number">75.9</span>  <span class="number">48.1</span></span><br><span class="line"><span class="number">07</span>:<span class="number">39</span>:<span class="number">59.561</span>        <span class="number">90</span>       <span class="number">0.00</span>     <span class="number">0.00</span>       <span class="number">0</span>   <span class="number">0.00</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>  <span class="number">0.6</span>  NaN NaN</span><br></pre></td></tr></table></figure>

<h1 id="004-多客户端运行"><a href="#004-多客户端运行" class="headerlink" title="004-多客户端运行"></a>004-多客户端运行</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">多客户端运行</span><br><span class="line"><span class="number">1.</span>Vdbench运行及结果查看</span><br><span class="line">  ./vdbench -f parafile</span><br><span class="line">  parafiile为配置文件，如果需要校验文件一致性可以可以指定-v参数，./vdbench -vf parafile</span><br><span class="line">  在vdbench安装目录下面有output目录，可以查看运行及输出结果，适用于windows及linux。</span><br><span class="line">  </span><br><span class="line"><span class="number">2.</span>Linux下联机运行</span><br><span class="line"><span class="number">2.1</span> 每个客户的都需要安装vdbench，路径保持一致</span><br><span class="line"><span class="number">2.2</span> SSH互信，选一个客户的为父节点，把每个子节点都信任父节点(这种互信可能有问题建议dsa)</span><br><span class="line">  父节点为<span class="number">93.93</span><span class="number">.41</span><span class="number">.5</span>，子节点为<span class="number">93.93</span><span class="number">.41</span><span class="number">.6</span></span><br><span class="line">  ssh-keygen -t rsa                           生成秘钥</span><br><span class="line">  chmod <span class="number">755</span> /root/.ssh/                    修改生成秘钥的权限</span><br><span class="line">  scp /root/.ssh/id_rsa.pub <span class="number">93.93</span><span class="number">.41</span><span class="number">.6</span>:/root/.ssh/authorized_keys 拷贝公钥</span><br><span class="line"><span class="number">2.3</span> 验证SSH互信</span><br><span class="line">  在父节点上ssh每一个子节点，如果不需要输入秘钥就能登录，则互信成功。</span><br><span class="line"><span class="number">2.4</span> 多客户端配置文件</span><br><span class="line">hd=<span class="keyword">default</span>,dbench=/home/Vdbench/,user=root,shell=ssh</span><br><span class="line">hd=hd1,system=<span class="number">93.93</span><span class="number">.31</span><span class="number">.7</span></span><br><span class="line">hd=hd2,system=<span class="number">93.93</span><span class="number">.41</span><span class="number">.8</span></span><br><span class="line">hd=hd3,system=<span class="number">93.93</span><span class="number">.41</span><span class="number">.9</span></span><br><span class="line">fsd=fsd1,anchor=/tmp/yht/client1,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">2000</span>,size=<span class="number">100</span>m,<span class="keyword">shared</span>=yes</span><br><span class="line">fsd=fsd2,anchor=/tmp/yht/client2,depth=<span class="number">1</span>,width=<span class="number">1000</span>,files=<span class="number">2000</span>,zies=(<span class="number">20</span>m,<span class="number">40</span>,<span class="number">100</span>m,<span class="number">60</span>),<span class="keyword">shared</span>=yes</span><br><span class="line">fsd=fsd3,anchor=/tmp/yht/client3,depth=<span class="number">1000</span>,width=<span class="number">1</span>,files2000,size=<span class="number">1</span>m,<span class="keyword">shared</span>=yes</span><br><span class="line">fwd=fwd1,fsd=fsd1,host=hd1,operation=read,xfersize=(<span class="number">1</span>m,<span class="number">40</span>,<span class="number">64</span>k,<span class="number">60</span>),fileio=random,fileselect=sequantial,threads=<span class="number">32</span></span><br><span class="line">fwd=fwd2,fsd=fsd2,host=hd2,operation=write,xfersize=<span class="number">64</span>k,fileio=random,fileselect=sequantial,threads=<span class="number">32</span></span><br><span class="line">fwd=fwd3,fsd=fsd3,host=hd3,rdpct=<span class="number">60</span>,xfersize=<span class="number">4</span>k,fileio=random,fileselect=sequantial,threads=<span class="number">32</span></span><br><span class="line">rd=rd1,fwd=(fwd1-fwd3),fwdrate=max,format=restart,elapsed=<span class="number">600</span>,<span class="built_in">int</span>erval=<span class="number">10</span></span><br><span class="line"></span><br><span class="line">elapsed：定义测试时间</span><br><span class="line"><span class="built_in">int</span>erval：测试结果刷新频率（<span class="number">1</span>秒钟刷新一次测试结果）</span><br><span class="line">iorate=max：运行最大io性能</span><br><span class="line">openflags=o_direct：不走缓存，遍历整个磁盘（测试裸设备时使用）</span><br><span class="line">sd：使用之前定义过的sd。</span><br><span class="line">seekpct：定义顺序(seq)或随机(random)。为<span class="number">0</span>则为顺序；为<span class="number">100</span>则为随机</span><br><span class="line">rdpct定义读写比率：<span class="number">100</span>为<span class="number">100</span>%读，<span class="number">100</span>%写。xfersize：定义测试文件块大小。</span><br><span class="line">sd：存储描述，定义测试磁盘。</span><br><span class="line">lun：定义测试磁盘为/dev/sdk。</span><br><span class="line">threads：定义并行测试进程为<span class="number">64</span>进程。</span><br><span class="line">wd：工作描述，定义策略。</span><br><span class="line">fwdrate= 每秒执行的文件系统操作数量。</span><br><span class="line">format=yes/no/only/restart/clean/directories</span><br><span class="line">在开始运行之前要执行的操作</span><br><span class="line">yes：删除之前的文件结构，根据配置文件重新创建目录和文件</span><br><span class="line">no：默认使用原来的文件目录结构，不会创建文件</span><br><span class="line">restart：每次都会校验一下数据，是否达到背景数据要求，没有的话会继续创建目录和文件</span><br><span class="line">elapsed：以秒为单位的运行持续时间，默认设置为  <span class="number">30</span>s</span><br><span class="line"></span><br><span class="line">脚本内容：（可按实际测试要求更改）：</span><br><span class="line">sd=sd1,lun=/dev/sdk,threads=<span class="number">64</span>,range=(<span class="number">100</span>g,<span class="number">150</span>g)或者range=(<span class="number">30</span>,<span class="number">50</span>)容量百分比</span><br><span class="line">wd=wd1,sd=sd*,seekpct=seq,rdpct=<span class="number">100</span>,xfersize=<span class="number">1</span>M,openflags=o_direct</span><br><span class="line">rw=rd1,wd=wd*,elapses=<span class="number">120</span>,<span class="built_in">int</span>erval=<span class="number">1</span>,iorate=max</span><br><span class="line">若是跑文件系统，先要挂载，之后在挂载的盘上建立文件，之后把脚本里的lun=/mnt<span class="comment">/***就可以了</span></span><br><span class="line"><span class="comment">注：fsd中shared，vdbench不允许不同的slave之间共享同一个目录结构下的所有文件，因为这样会带来很大的开销，但是它们允许共享同一个目录结构。加入设置了shared=yes，那么不同的slave可以平分一个目录下所有的文件来进行访问，相当于每个slave有各自等分的访问区域，因此不能测试多个客户的对同一个文件的读写。一般不需要带</span></span><br><span class="line"><span class="comment">例如：</span></span><br><span class="line"><span class="comment">./vdbench -f 1M_seq_read -o /1M 测试脚本名称为1M_seq_read,测试结果放在/1M目录下，到所在目录查看sd1</span></span><br></pre></td></tr></table></figure>

<h1 id="005-vdbench遇到的问题"><a href="#005-vdbench遇到的问题" class="headerlink" title="005-vdbench遇到的问题"></a>005-vdbench遇到的问题</h1><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">报错：</span><br><span class="line"><span class="number">19</span>:<span class="number">24</span>:<span class="number">18.955</span> Trying <span class="keyword">to</span> connect <span class="keyword">to</span> the Vdbench rsh daemon on host <span class="number">10.243</span>.<span class="number">88.221</span></span><br><span class="line"><span class="number">19</span>:<span class="number">24</span>:<span class="number">18.955</span> The Vdbench rsh daemon must be started on each target host.</span><br><span class="line"><span class="number">19</span>:<span class="number">24</span>:<span class="number">18.955</span> This requires a one-time start <span class="keyword">of</span> './vdbench rsh' on the target host.</span><br><span class="line"><span class="number">19</span>:<span class="number">24</span>:<span class="number">18.955</span> Trying this for <span class="number">60</span> seconds only.</span><br><span class="line"><span class="number">19</span>:<span class="number">24</span>:<span class="number">24.029</span> Waiting for slave connection: hd1-<span class="number">0</span></span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line">报错：Connection <span class="keyword">to</span> closed by remote host</span><br><span class="line">解决：</span><br><span class="line">--增加ssh连接数：</span><br><span class="line">修改服务器上的这个文件：/etc/ssh/sshd_config，找到两行：</span><br><span class="line">MaxSessions：最大允许链接数，默认<span class="number">10.</span></span><br><span class="line">MaxStartups：最大允许保持多少个未认证链接（未输入登录密码），默认值是<span class="number">10.</span></span><br><span class="line">把他们的数字改大，例如改成</span><br><span class="line">MaxSessions <span class="number">1000</span></span><br><span class="line">MaxStartups <span class="number">1000</span></span><br><span class="line">修改server端的配置文件/etc/ssh/sshd_config</span><br><span class="line"># server每隔<span class="number">60</span>秒给客户端发送一次保活信息包给客户端</span><br><span class="line">ClientAliveInterval <span class="number">60</span></span><br><span class="line"># server端发出的请求客户端没有回应的次数达到<span class="number">86400</span>次的时候就断开连接，正常情况下客户端都会相应</span><br><span class="line">ClientAliveCountMax <span class="number">86400</span></span><br><span class="line">sed -i 's/#MaxSessions <span class="number">10</span>/MaxSessions <span class="number">1000</span>/g' /etc/ssh/sshd_config</span><br><span class="line">sed -i 's/#MaxStartups <span class="number">10</span>:<span class="number">30</span>:<span class="number">100</span>/MaxStartups <span class="number">1000</span>/g' /etc/ssh/sshd_config</span><br><span class="line">sed -i 's/#ClientAliveInterval <span class="number">0</span>/ClientAliveInterval <span class="number">60</span>/g' /etc/ssh/sshd_config</span><br><span class="line">sed -i 's/#ClientAliveCountMax <span class="number">3</span>/ClientAliveCountMax <span class="number">86400</span>/g' /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line">最终发现：</span><br><span class="line">使用dsa方式免密能解决：</span><br><span class="line">在每台设备执行：</span><br><span class="line"><span class="literal">[<span class="identifier">root</span>@<span class="identifier">sam</span> ~]</span># rm -rf ~/.ssh</span><br><span class="line"><span class="literal">[<span class="identifier">root</span>@<span class="identifier">sam</span> ~]</span># mkdir ~/.ssh</span><br><span class="line"><span class="literal">[<span class="identifier">root</span>@<span class="identifier">sam</span> ~]</span># chmod <span class="number">755</span> ~/.ssh</span><br><span class="line"><span class="literal">[<span class="identifier">root</span>@<span class="identifier">sam</span> .<span class="identifier">ssh</span>]</span># /usr/bin/ssh-keygen -t dsa</span><br><span class="line"></span><br><span class="line">将每个主机上的公共密钥文件id_dsa.pub的内容复制到~/.ssh/authorized_keys文件中。并把这个文件分别放到所有机器中。注意，当您第一次使用ssh访问远程主机时，其RSA密钥是未知的，所以提示确认一下，确认完毕后SSH将记录远程主机的RSA密钥，以后连接该主机就不用密码了。</span><br><span class="line"><span class="literal">[<span class="identifier">root</span>@<span class="identifier">sam</span> .<span class="identifier">ssh</span>]</span># cat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line">将各个设备上的authorized_keys复制到其他设备上</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">报错：</span><br><span class="line"><span class="number">18</span>:<span class="number">55</span>:<span class="number">17.085</span> remove<span class="constructor">KillAtEnd()</span>: Unable <span class="keyword">to</span> find ssh <span class="number">10.238</span>.<span class="number">162.4</span> -l root /opt/vdbench/vdbench SlaveJvm -m <span class="number">10.238</span>.<span class="number">162.1</span> -n <span class="number">10.238</span>.<span class="number">162.4</span>-<span class="number">13</span>-<span class="number">190922</span>-<span class="number">18.44</span>.<span class="number">03.130</span> -l hd4-<span class="number">0</span> -p <span class="number">5570</span></span><br><span class="line"><span class="number">18</span>:<span class="number">55</span>:<span class="number">17.225</span> remove<span class="constructor">KillAtEnd()</span>: Unable <span class="keyword">to</span> find /opt/vdbench/vdbench SlaveJvm -m <span class="number">10.238</span>.<span class="number">162.1</span> -n <span class="number">10.238</span>.<span class="number">162.1</span>-<span class="number">10</span>-<span class="number">190922</span>-<span class="number">18.44</span>.<span class="number">03.130</span> -l hd1-<span class="number">0</span> -p <span class="number">5570</span></span><br><span class="line">java.lang.RuntimeException: Slave hd5-<span class="number">0</span> prematurely terminated.</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Vdb</span>.</span></span>common.failure(common.java:<span class="number">335</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Vdb</span>.</span><span class="module"><span class="identifier">SlaveStarter</span>.</span></span>start<span class="constructor">Slave(SlaveStarter.<span class="params">java</span>:198)</span></span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Vdb</span>.</span><span class="module"><span class="identifier">SlaveStarter</span>.</span></span>run(<span class="module-access"><span class="module"><span class="identifier">SlaveStarter</span>.</span></span>java:<span class="number">47</span>)</span><br><span class="line">解决：</span><br><span class="line">https:<span class="comment">//community.oracle.com/docs/DOC-1020657</span></span><br><span class="line">修复了“ vdbench工作负载在带有errno的linux ext4挂载的分区上失败：INCORRECT_SIZE：'Vdbench确定没有足够的字节被读取或写入'”</span><br><span class="line">将此类文件放在/opt/vdbench/classes/Vdb中</span><br><span class="line"></span><br><span class="line">问题：</span><br><span class="line">vdbench Too many thread blocks报错</span><br><span class="line">解决：</span><br><span class="line">每台设备的目录要不一样</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">正常测试是测试内存的<span class="number">2</span>倍</span><br><span class="line">比如内存是<span class="number">8</span>g，那就是测试<span class="number">16</span>g的数据</span><br><span class="line"><span class="number">16</span>g/目录数=结果*<span class="number">1024</span>*<span class="number">1024</span>=转换的结果/文件大小=结果（结果为每个目录的文件数）</span><br><span class="line">根据上面的vdbench的配置文件就是：</span><br><span class="line"><span class="number">16</span>/<span class="number">100</span>^<span class="number">2</span>=<span class="number">0.0016</span>*<span class="number">1024</span>*<span class="number">1024</span>=<span class="number">1677</span>/<span class="number">128</span>=<span class="number">15</span>  测试的时候需要将file写成<span class="number">15</span>就可以了</span><br><span class="line"></span><br><span class="line">遇到ssh连接数超的情况：</span><br><span class="line">增加ssh连接数：</span><br><span class="line">修改服务器上的这个文件：/etc/ssh/sshd_config，找到两行：</span><br><span class="line">MaxSessions：最大允许链接数，默认<span class="number">10.</span></span><br><span class="line">MaxStartups：最大允许保持多少个未认证链接（未输入登录密码），默认值是<span class="number">10.</span></span><br><span class="line">把他们的数字改大，例如改成</span><br><span class="line">MaxSessions <span class="number">1000</span></span><br><span class="line">MaxStartups <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">Out <span class="keyword">of</span> memory:</span><br><span class="line">modify the vdbench script <span class="keyword">and</span> increase the '-Xmx512m' value where <span class="number">512</span>m equals the java  heap size requested.</span><br><span class="line">解决：</span><br><span class="line">方法<span class="number">1</span>：Xmx改大一点，具体改多大，看你实际内存，Xms256m改小</span><br><span class="line"><span class="keyword">if</span> <span class="literal">[ "<span class="identifier">$1</span>" <span class="operator">==</span> "S<span class="identifier">laveJvm</span>" ]</span>; <span class="keyword">then</span></span><br><span class="line">  $java -client -Xmx16384m  -Xms256m -cp $cp Vdb.SlaveJvm $*</span><br><span class="line">  exit $?</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  $java -client -Xmx1024m  -Xms256m -cp $cp Vdb.Vdbmain $*</span><br><span class="line">其它环境：<span class="number">4096</span>不一定是最大的，我们现在物理环境是：<span class="number">110000</span></span><br><span class="line">ulimit -u <span class="number">4096</span></span><br><span class="line"></span><br><span class="line">网址：</span><br><span class="line">https:<span class="comment">//stackoverflow.com/questions/24763899/vdbench-outofmemoryerror-unable-to-create-new-native-thread</span></span><br><span class="line">或者您正在使用CentOS，编辑/etc/security/limits.d/<span class="number">90</span>-nproc.conf 并将行更改为：</span><br><span class="line">* soft nproc <span class="number">4096</span></span><br><span class="line">workingsetsize=<span class="number">8388608</span>kb，具体值为内存大小除以<span class="number">8</span></span><br><span class="line">fsd=fsd7,workingsetsize=<span class="number">8388608</span>kb,anchor=/mnt/data001/sntest-small/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">200</span>,size=<span class="number">256</span>k,openflags=o_direct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如下报错：</span><br><span class="line"><span class="number">09</span>:<span class="number">06</span>:<span class="number">15.675</span> UnknownHostException: hd=hd1,system=<span class="number">10.244</span>.<span class="number">25.11</span></span><br><span class="line"><span class="number">09</span>:<span class="number">06</span>:<span class="number">15.676</span> ==&gt; where: <span class="module-access"><span class="module"><span class="identifier">Vdb</span>.</span></span>common.get<span class="constructor">CurrentIP(<span class="params">common</span>.<span class="params">java</span>:1656)</span></span><br><span class="line"><span class="number">09</span>:<span class="number">06</span>:<span class="number">16.181</span></span><br><span class="line"><span class="number">09</span>:<span class="number">06</span>:<span class="number">16.181</span> common.failure<span class="literal">()</span>:</span><br><span class="line">            java.net.UnknownHostException: dev-<span class="number">11</span>: dev-<span class="number">11</span>: Temporary  failure <span class="keyword">in</span> name resolution</span><br><span class="line">java.net.UnknownHostException: dev-<span class="number">11</span>: dev-<span class="number">11</span>: Temporary failure <span class="keyword">in</span> name  resolution</span><br><span class="line">      at java.net.<span class="module-access"><span class="module"><span class="identifier">InetAddress</span>.</span></span>get<span class="constructor">LocalHost(InetAddress.<span class="params">java</span>:1505)</span></span><br><span class="line">      at <span class="module-access"><span class="module"><span class="identifier">Vdb</span>.</span></span>common.get<span class="constructor">CurrentIP(<span class="params">common</span>.<span class="params">java</span>:1649)</span></span><br><span class="line">      at <span class="module-access"><span class="module"><span class="identifier">Vdb</span>.</span><span class="module"><span class="identifier">SlaveStarter</span>.</span></span>start<span class="constructor">Slave(SlaveStarter.<span class="params">java</span>:142)</span></span><br><span class="line">      at <span class="module-access"><span class="module"><span class="identifier">Vdb</span>.</span><span class="module"><span class="identifier">SlaveStarter</span>.</span></span>run(<span class="module-access"><span class="module"><span class="identifier">SlaveStarter</span>.</span></span>java:<span class="number">47</span>)</span><br><span class="line">Caused by: java.net.UnknownHostException: dev-<span class="number">11</span>: Temporary failure <span class="keyword">in</span>  name resolution</span><br><span class="line">      at java.net.<span class="module-access"><span class="module"><span class="identifier">Inet6AddressImpl</span>.</span></span>lookup<span class="constructor">AllHostAddr(Native Method)</span></span><br><span class="line">      at java.net.<span class="module-access"><span class="module"><span class="identifier">InetAddress$2</span>.</span></span>lookup<span class="constructor">AllHostAddr(InetAddress.<span class="params">java</span>:928)</span></span><br><span class="line">      at  java.net.<span class="module-access"><span class="module"><span class="identifier">InetAddress</span>.</span></span>get<span class="constructor">AddressesFromNameService(InetAddress.<span class="params">java</span>:1323)</span></span><br><span class="line">      at java.net.<span class="module-access"><span class="module"><span class="identifier">InetAddress</span>.</span></span>get<span class="constructor">LocalHost(InetAddress.<span class="params">java</span>:1500)</span></span><br><span class="line"><span class="operator">      ... </span><span class="number">3</span> more</span><br><span class="line">解决：</span><br><span class="line">修改vdbench case所在设备的hostname，以及/etc/hosts</span><br><span class="line">Thanks ,Henk.</span><br><span class="line">I have a question <span class="keyword">to</span> consult, the about VDbench set time.</span><br><span class="line">_________________________________________________________________________</span><br><span class="line">hd=localhost</span><br><span class="line">sd=default,threads=<span class="number">20</span></span><br><span class="line">sd=sd_ro,lun=\\.\e:,range=(<span class="number">0</span>,<span class="number">50</span>)</span><br><span class="line">sd=sd_rw,lun=\\.\e:,range=(<span class="number">51</span>,<span class="number">100</span>)</span><br><span class="line">wd=default,xfersize=(<span class="number">4</span>k,<span class="number">60</span>,<span class="number">8</span>k,<span class="number">20</span>,<span class="number">16</span>k,<span class="number">14</span>,<span class="number">64</span>k,<span class="number">6</span>)</span><br><span class="line">wd=wd_ro,sd=(sd_ro),rdpct=<span class="number">30</span>,priority=<span class="number">1</span>,seekpct=<span class="number">56</span>,xfersize=(<span class="number">4</span>k,<span class="number">48</span>,<span class="number">8</span>k,<span class="number">30</span>,<span class="number">16</span>k,<span class="number">11</span>,<span class="number">32</span>k,<span class="number">7</span>,<span class="number">64</span>k,<span class="number">3</span>,<span class="number">128</span>k,<span class="number">1</span>)</span><br><span class="line">wd=wd_rw,sd=(sd_rw),rdpct=<span class="number">30</span>,priority=<span class="number">2</span>,seekpct=<span class="number">88</span>,xfersize=(<span class="number">4</span>k,<span class="number">82</span>,<span class="number">8</span>k,<span class="number">9</span>,<span class="number">16</span>k,<span class="number">5</span>,<span class="number">32</span>k,<span class="number">2</span>,<span class="number">64</span>k,<span class="number">1</span>,<span class="number">128</span>k,<span class="number">1</span>)</span><br><span class="line">rd=run1,wd=(wd_ro,wd_rw),iorate=max,interval=<span class="number">1</span>,elapsed=<span class="number">172800</span></span><br><span class="line">_________________________________________________________________________</span><br><span class="line">In the configuration file that setting time is feasible?</span><br><span class="line">Because I read advice on some information <span class="keyword">in</span> the configuration file don't set too long time.</span><br><span class="line">very thankful,</span><br><span class="line">ka</span><br><span class="line">priority优先队列</span><br></pre></td></tr></table></figure>



<h1 id="005-vdbench常见问题"><a href="#005-vdbench常见问题" class="headerlink" title="005-vdbench常见问题"></a>005-vdbench常见问题</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">vdbench常见问题:http:<span class="comment">//blog.sina.com.cn/s/blog_96d0ebdb0102xc3j.html</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、-f参数后面多个配置文件是同时执行还是顺序执行；</span><br><span class="line">   -f后面的配置文件里的参数通过parseParameterLines()函数进行顺序解析，写入并生成输出文件parmfile.html和parmscan.html（包含了完整的参数配置）。</span><br><span class="line">	执行时，首先运行rd，进入RD中调用的wd或fwd，然后进入WD或FWD中的sd或fsd（若有HD，同上调用）。</span><br><span class="line">	</span><br><span class="line"><span class="number">2</span>、-v校验中逻辑字节地址/数据校验关键字是存储在哪个位置；</span><br><span class="line">  	数据块的大小是xfersize的值，数据校验时，每写入数据块<span class="number">512</span>个字节包含一个<span class="number">8</span>字节的lba和一个<span class="number">1</span>字节的key值。</span><br><span class="line">	其中lba指的是字节地址，与文件系统的偏移量和文件的偏移量有关。</span><br><span class="line">	Key值记录了写入块的次数，每写入块一次，key值加<span class="number">1</span>，加到<span class="number">126</span>后直接返回<span class="number">1</span>。</span><br><span class="line"><span class="number">3</span>、-v校验中的校验是发生在什么时候；</span><br><span class="line">	每写入一次数据块时，先读后写，写前写后内容进行校验。</span><br><span class="line">	进行数据校验需要执行-v,也可以在参数文件中写入Validate=yes，也就是说，在配置文件执行生成系统文件后，校验一直进行。</span><br><span class="line"><span class="number">4</span>、-vt时间戳显示在哪，是什么意思，是否可以查看；</span><br><span class="line">	内存中最后一次写入或读取成功的时间戳。可以在输出结果中查看:</span><br><span class="line"><span class="number">5</span>、逻辑地址有啥用。</span><br><span class="line">	Lba记录了每个数据块的地址，校验时根据lba方便查找校验错误的地方。</span><br><span class="line"><span class="number">6</span>、校验错输出script_name什么意思，data_errors参数的作用；</span><br><span class="line">	返回校验错误，描述出错的位置，方便测试人员定位查阅。如问题<span class="number">5</span>，定位在fsd=fsd1文件系统中出错及第二行中显示的文件名字及出错的位置。</span><br><span class="line"><span class="number">7</span>、-v该末尾一个字节。是否能校验么，报错的位置是否正确；</span><br><span class="line">	在文件末尾插入字节，可以被校验出。报错位置正确，定位在文件的结尾位置。</span><br><span class="line"><span class="number">8</span>、lba后面的值有什么意思；</span><br><span class="line">	lba指的是逻辑字节地址，与文件系统的偏移量和文件的偏移量有关。校验错误返回的lba指的是在文件中的出错位置。</span><br><span class="line"><span class="number">9</span>、-j和-v之间的区别；</span><br><span class="line">	-v的数据校验，校验文件会输出到内存中，但是一旦vdbench关闭或者系统重启，校验就会失败。而-j能进行持续校验，等下次重启时，会恢复原始数据重新校验。如果只写-j而不加-v，也会进行-v操作。</span><br><span class="line"><span class="number">10</span>、-j中有几个fsd就有几个jnl文件map文件</span><br><span class="line">	是的</span><br><span class="line">	运行./vdbench –j –f testcount ，生成日志文件所在的目录如下：</span><br><span class="line"><span class="number">11</span>、jnl和map文件有什么区别么？</span><br><span class="line">	开始执行时，vdbench会生成两个文件Map backup file 和journal file。系统出现故障时（仅仅丢失了内存映射表中的数据），这两个文件由于保留了原始数据（恢复数据时首先读取journal文件的数据，如果失败，再从Map backup文件中写入），方便测试人员继续进行读写和校验。</span><br><span class="line">    （<span class="number">1</span>）正常时：内存中数据校验映射表的内容写入到backup和journal文件。日志更新内容持续写入到journal文件结尾部分并生成日志记录。</span><br><span class="line">    （<span class="number">2</span>）系统出现问题时： Vdbench重启并进行数据修复，从journal文件开始部分读出原始数据，并把数据更新到内存映射表中。一旦journal到达文件结尾，读取并验证用“modified” 标记的所有数据块。接着执行（<span class="number">1</span>）过程。</span><br><span class="line">    如果由于系统崩溃，journal文件的原始数据写入内存映射表中失败，直接读取backup文件内容并写入。</span><br><span class="line">    综上，可以看出，map backup文件修复数据性能更高。</span><br><span class="line"><span class="number">12</span>、命令之间有没有冲突</span><br><span class="line">	没有，但是命令设置时必须-f后面加 parmfile文件，如果有-s命令则会模拟执行文件。如果命令中只有-j却无-v，则隐含着进行数据校验生成日志文件。</span><br><span class="line"><span class="number">13</span>、count参数的意思</span><br><span class="line">	count=（nn,mm） 快速创建SD序列（nn是开始数字，mm是数字个数）</span><br><span class="line">	如fsd=fsd,anchor=/ww,count=（<span class="number">1</span>,<span class="number">5</span>）在/ww1-/ww5中创建fsd1-fsd5</span><br><span class="line">	如运行：</span><br><span class="line">	/mnt目录下显示的目录结构如下:</span><br><span class="line">	若在wd中限定fsd1，则只显示wwz1一个目录：</span><br><span class="line">	若在fsd中限定fsd1，则会出错，如下</span><br><span class="line"><span class="number">14</span>、range的wd的寻找范围，是否可以运用到fsd中</span><br><span class="line">	文件系统中不可用, 测试过程如下：</span><br><span class="line"><span class="number">15</span>、rdpct-rhpct-whpct区别</span><br><span class="line">    Sd中：</span><br><span class="line">    rdpct=nn</span><br><span class="line">    读操作的比例，默认为<span class="number">100</span>%。rdpct=<span class="number">80</span>代表读写比例<span class="number">4</span>：<span class="number">1</span>。</span><br><span class="line">    rhpct=nn</span><br><span class="line">    只在读裸设备时使用，读缓存命中率，默认值为<span class="number">0</span>。</span><br><span class="line">    whpct=nn</span><br><span class="line">    只在写裸设备时使用，写缓存命中率，默认值为<span class="number">0</span>。</span><br><span class="line">    Fsd中不存在rhpct及whpct参数：</span><br><span class="line">    rdpct在文件上的读写操作比例。rdpct=<span class="number">80</span>代表读写比例<span class="number">4</span>：<span class="number">1</span>。必须同时添加fileio=random参数，不能留空（系统默认fileio=sequential）</span><br><span class="line">    计算公式如下：</span><br><span class="line">    rdpct  = read.operations * <span class="number">100.</span> / (read.operations + write.operations);</span><br><span class="line"><span class="number">16</span>、缓存命中，rhpct部分，<span class="number">1</span>M的意思。</span><br><span class="line">	只针对sd而言。</span><br><span class="line">	每一个存储体积被分成两部分：hit area指用于缓存命中部分(这由hitarea=nn设定，hitarea默认为<span class="number">1</span>M)，miss area 指SD剩下的部分缓存未命中的部分。</span><br><span class="line"><span class="number">17</span>、xfersize=（<span class="number">1</span><span class="number">-64</span>k，d）执行顺序</span><br><span class="line">   在文件系统中不支持这种方式。只支持xfersize=nn或xfersize=（x1,nn1,x2,nn2,…）其中nn1+nn2+…=<span class="number">100</span>，报错如下：</span><br><span class="line"><span class="number">18</span>、xfersize=（<span class="number">1</span>k,<span class="number">10</span>）这种格式，是报错还是按照<span class="number">4</span>k块大小执行剩余的<span class="number">90</span>%</span><br><span class="line">   直接报错，代码如下：</span><br><span class="line"><span class="number">19</span>、skew，IO倾斜比，没有IOrate参数时，参数是否生效；</span><br><span class="line">    直接会报错</span><br><span class="line">    在fsd中，fwdrate不存在时</span><br><span class="line">    vdbench常见问题</span><br><span class="line"><span class="number">20</span>、skew对IOPS生效还是对带宽生效</span><br><span class="line">	iops生效，skew时对fwdrate或iorate的分配</span><br><span class="line"><span class="number">21</span>、iorate指的是带宽还是iops</span><br><span class="line">	iops</span><br><span class="line"><span class="number">22</span>、rd的名字是否有要求</span><br><span class="line">	没有要求，可以任意定义，只是个名字而已。</span><br><span class="line"><span class="number">23</span>、count中，是否创建多个fsd？还是创建了<span class="number">5</span>个目录？</span><br><span class="line">	多个fsd，每个fsd下又存在多个目录，见问题<span class="number">13</span></span><br><span class="line"><span class="number">24</span>、count中，rd引入部分fsd是否可以？</span><br><span class="line">	可以，见问题<span class="number">13</span></span><br></pre></td></tr></table></figure>

<h1 id="007-脚本举例"><a href="#007-脚本举例" class="headerlink" title="007-脚本举例"></a>007-脚本举例</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.codercto.com/a/49559.html</span></span><br><span class="line">*example workload:  Single run, <span class="number">10</span> raw disk</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*HD:    HOST Define</span><br><span class="line">*SD:    Storage Definition</span><br><span class="line">*WD:    Workload Definition</span><br><span class="line">*RD:    Run Definition</span><br><span class="line">*</span><br><span class="line">hd=<span class="keyword">default</span>,vdbench=/root/vdbench,user=root,shell=ssh</span><br><span class="line">hd=hd1,system=<span class="number">192.168</span><span class="number">.129</span><span class="number">.40</span></span><br><span class="line">hd=hd2,system=<span class="number">192.168</span><span class="number">.129</span><span class="number">.41</span></span><br><span class="line">sd=sd1,lun=/dev/sdb,host=hd1,openflags=o_direct,hitarea=<span class="number">0</span>,range=(<span class="number">0</span>,<span class="number">100</span>),threads=<span class="number">2</span></span><br><span class="line">sd=sd2,lun=/dev/sdb,host=hd2,openflags=o_direct,hitarea=<span class="number">0</span>,range=(<span class="number">0</span>,<span class="number">100</span>),threads=<span class="number">2</span></span><br><span class="line">wd=wd1,sd=(sd1,sd2),xfersize=(<span class="number">4096</span>,<span class="number">100</span>),rdpct=<span class="number">0</span>,seekpct=<span class="number">100</span></span><br><span class="line">rd=run1,wd=wd1,iorate=max,elapsed=<span class="number">600</span>,warmup=<span class="number">300</span></span><br><span class="line">* <span class="number">2</span> rbd disks, <span class="number">100</span>% random, <span class="number">0</span>% read of <span class="number">4</span>k blocks at unlimited rate</span><br><span class="line">上面的例子是测试两台机器的磁盘，每个磁盘两个线程写，<span class="number">4</span>K的块大小，<span class="number">100</span>%的写，<span class="number">100</span>%随机，热身写<span class="number">300</span>s，然后测试<span class="number">600</span>s</span><br><span class="line"></span><br><span class="line">openflags= 用于打开一个 lun 或一个文件的 flag_list，为了贴近真实场景，一般在这里选择o_direct，绕过缓存机制，直接写盘。</span><br><span class="line">hitarea= 调整读取命中百分比的大小。默认为 <span class="number">1</span>m</span><br><span class="line">,range=(<span class="number">100</span>g,<span class="number">150</span>g)或者range=(<span class="number">30</span>,<span class="number">50</span>)容量百分比</span><br></pre></td></tr></table></figure>



<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">文件系统：fileio=sequential/random</span><br><span class="line">创建背景数据：（默认创建文件的块大小为<span class="number">128</span>k）</span><br><span class="line">【实际操作：</span><br><span class="line"><span class="number">1</span>、先通过format=restart将文件和目录数据灌注好</span><br><span class="line"><span class="number">2</span>、将format=restart改为format=no，直接在灌注好的文件目录上进行测试：读写</span><br><span class="line"><span class="number">3</span>、yes是删除原来的数据重新建】</span><br><span class="line"></span><br><span class="line">data_errors=<span class="number">1000000000000000000000000</span></span><br><span class="line">hd=<span class="keyword">default</span>,vdbench=/opt/vdbench,user=root,shell=ssh,jvms=<span class="number">1</span></span><br><span class="line">hd=hd1,system=<span class="number">10.244</span><span class="number">.208</span><span class="number">.11</span></span><br><span class="line">hd=hd2,system=<span class="number">10.244</span><span class="number">.208</span><span class="number">.12</span></span><br><span class="line">hd=hd3,system=<span class="number">10.244</span><span class="number">.208</span><span class="number">.13</span></span><br><span class="line">hd=hd4,system=<span class="number">10.244</span><span class="number">.208</span><span class="number">.14</span></span><br><span class="line">hd=hd5,system=<span class="number">10.244</span><span class="number">.208</span><span class="number">.15</span></span><br><span class="line">hd=hd6,system=<span class="number">10.244</span><span class="number">.208</span><span class="number">.16</span></span><br><span class="line">hd=hd7,system=<span class="number">10.244</span><span class="number">.208</span><span class="number">.17</span></span><br><span class="line">hd=hd8,system=<span class="number">10.244</span><span class="number">.208</span><span class="number">.18</span></span><br><span class="line">hd=hd9,system=<span class="number">10.244</span><span class="number">.208</span><span class="number">.19</span></span><br><span class="line">hd=hd10,system=<span class="number">10.244</span><span class="number">.208</span><span class="number">.20</span></span><br><span class="line"></span><br><span class="line">fsd=fsd1,anchor=/mysql/snbs001/,depth=<span class="number">1</span>,width=<span class="number">5</span>,files=<span class="number">5</span>,size=<span class="number">1</span>g</span><br><span class="line">fsd=fsd2,anchor=/mysql/snbs002/,depth=<span class="number">1</span>,width=<span class="number">5</span>,files=<span class="number">5</span>,size=<span class="number">1</span>g</span><br><span class="line">fsd=fsd3,anchor=/mysql/snbs003/,depth=<span class="number">2</span>,width=<span class="number">10</span>,files=<span class="number">1</span>,size=<span class="number">1</span>g</span><br><span class="line">fsd=fsd4,anchor=/mysql/snbs004/,depth=<span class="number">2</span>,width=<span class="number">10</span>,files=<span class="number">1</span>,size=<span class="number">1</span>g</span><br><span class="line">fsd=fsd5,anchor=/mysql/snbs005/,depth=<span class="number">2</span>,width=<span class="number">10</span>,files=<span class="number">2</span>,size=<span class="number">1</span>g</span><br><span class="line">fsd=fsd6,anchor=/mysql/snbs006/,depth=<span class="number">2</span>,width=<span class="number">10</span>,files=<span class="number">2</span>,size=<span class="number">1</span>g</span><br><span class="line">fsd=fsd7,anchor=/mysql/snbs007/,depth=<span class="number">2</span>,width=<span class="number">10</span>,files=<span class="number">3</span>,size=<span class="number">1</span>g</span><br><span class="line">fsd=fsd8,anchor=/mysql/snbs008/,depth=<span class="number">2</span>,width=<span class="number">10</span>,files=<span class="number">3</span>,size=<span class="number">1</span>g</span><br><span class="line">fsd=fsd9,anchor=/mysql/snbs009/,depth=<span class="number">2</span>,width=<span class="number">10</span>,files=<span class="number">3</span>,size=<span class="number">1</span>g</span><br><span class="line">fsd=fsd10,anchor=/mysql/snbs010/,depth=<span class="number">2</span>,width=<span class="number">10</span>,files=<span class="number">3</span>,size=<span class="number">1</span>g</span><br><span class="line"></span><br><span class="line">fsd=fsd11,anchor=/mysql/snbs011/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">5</span>,size=<span class="number">256</span>k</span><br><span class="line">fsd=fsd12,anchor=/mysql/snbs012/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">5</span>,size=<span class="number">256</span>k</span><br><span class="line">fsd=fsd13,anchor=/mysql/snbs013/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">10</span>,size=<span class="number">256</span>k</span><br><span class="line">fsd=fsd14,anchor=/mysql/snbs014/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">10</span>,size=<span class="number">256</span>k</span><br><span class="line">fsd=fsd15,anchor=/mysql/snbs015/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">30</span>,size=<span class="number">256</span>k</span><br><span class="line">fsd=fsd16,anchor=/mysql/snbs016/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">30</span>,size=<span class="number">256</span>k</span><br><span class="line">fsd=fsd17,anchor=/mysql/snbs017/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">60</span>,size=<span class="number">256</span>k</span><br><span class="line">fsd=fsd18,anchor=/mysql/snbs018/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">60</span>,size=<span class="number">256</span>k</span><br><span class="line">fsd=fsd19,anchor=/mysql/snbs019/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">60</span>,size=<span class="number">256</span>k</span><br><span class="line">fsd=fsd20,anchor=/mysql/snbs020/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">60</span>,size=<span class="number">256</span>k</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fwd=fwd1,fsd=fsd1,host=hd1,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd2,fsd=fsd2,host=hd2,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd3,fsd=fsd3,host=hd3,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd4,fsd=fsd4,host=hd4,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd5,fsd=fsd5,host=hd5,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd6,fsd=fsd6,host=hd6,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd7,fsd=fsd7,host=hd7,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd8,fsd=fsd8,host=hd8,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd9,fsd=fsd9,host=hd9,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd10,fsd=fsd10,host=hd10,operation=create,threads=<span class="number">5</span></span><br><span class="line"></span><br><span class="line">fwd=fwd11,fsd=fsd11,host=hd1,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd12,fsd=fsd12,host=hd2,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd13,fsd=fsd13,host=hd3,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd14,fsd=fsd14,host=hd4,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd15,fsd=fsd15,host=hd5,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd16,fsd=fsd16,host=hd6,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd17,fsd=fsd17,host=hd7,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd18,fsd=fsd18,host=hd8,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd19,fsd=fsd19,host=hd9,operation=create,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd20,fsd=fsd20,host=hd10,operation=create,threads=<span class="number">5</span></span><br><span class="line"></span><br><span class="line">rd=rd1,fwd=fwd*,fwdrate=max,format=restart,elapsed=<span class="number">60</span>,<span class="built_in">int</span>erval=<span class="number">5</span></span><br><span class="line"></span><br><span class="line">顺序写：</span><br><span class="line">[<span class="symbol">root@</span>dev<span class="number">-11</span> cases]# cat seq_write</span><br><span class="line">data_errors=<span class="number">1000000000000000000000000</span></span><br><span class="line">hd=<span class="keyword">default</span>,vdbench=/opt/vdbench,user=root,shell=ssh,jvms=<span class="number">1</span></span><br><span class="line">hd=hd1,system=<span class="number">10.244</span><span class="number">.208</span><span class="number">.11</span></span><br><span class="line">hd=hd2,system=<span class="number">10.244</span><span class="number">.208</span><span class="number">.12</span></span><br><span class="line"></span><br><span class="line">fsd=fsd1,anchor=/mysql/snbs001/,depth=<span class="number">1</span>,width=<span class="number">5</span>,files=<span class="number">5</span>,size=<span class="number">1</span>g</span><br><span class="line">fsd=fsd2,anchor=/mysql/snbs002/,depth=<span class="number">1</span>,width=<span class="number">5</span>,files=<span class="number">5</span>,size=<span class="number">1</span>g</span><br><span class="line"></span><br><span class="line">fsd=fsd11,anchor=/mysql/snbs011/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">5</span>,size=<span class="number">256</span>k</span><br><span class="line">fsd=fsd12,anchor=/mysql/snbs012/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">5</span>,size=<span class="number">256</span>k</span><br><span class="line"></span><br><span class="line">fwd=fwd1,fsd=fsd1,host=hd1,operation=write,xfersize=<span class="number">16</span>k,fileio=sequential,fileselect=random,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd2,fsd=fsd2,host=hd2,operation=write,xfersize=<span class="number">16</span>k,fileio=sequential,fileselect=random,threads=<span class="number">5</span></span><br><span class="line"></span><br><span class="line">fwd=fwd11,fsd=fsd11,host=hd1,operation=write,xfersize=<span class="number">16</span>k,fileio=sequential,fileselect=random,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd12,fsd=fsd12,host=hd2,operation=write,xfersize=<span class="number">16</span>k,fileio=sequential,fileselect=random,threads=<span class="number">5</span></span><br><span class="line"></span><br><span class="line">rd=rd1,fwd=fwd*,fwdrate=max,format=restart,elapsed=<span class="number">600</span>,<span class="built_in">int</span>erval=<span class="number">5</span></span><br><span class="line"></span><br><span class="line">随机读写：</span><br><span class="line">[<span class="symbol">root@</span>dev<span class="number">-11</span> cases]# cat rand_readwrite</span><br><span class="line">data_errors=<span class="number">1000000000000000000000000</span></span><br><span class="line">hd=<span class="keyword">default</span>,vdbench=/opt/vdbench,user=root,shell=ssh,jvms=<span class="number">1</span></span><br><span class="line">hd=hd1,system=<span class="number">10.244</span><span class="number">.208</span><span class="number">.11</span></span><br><span class="line">hd=hd2,system=<span class="number">10.244</span><span class="number">.208</span><span class="number">.12</span></span><br><span class="line"></span><br><span class="line">fsd=fsd1,anchor=/mysql/snbs001/,depth=<span class="number">1</span>,width=<span class="number">5</span>,files=<span class="number">5</span>,size=<span class="number">1</span>g</span><br><span class="line">fsd=fsd2,anchor=/mysql/snbs002/,depth=<span class="number">1</span>,width=<span class="number">5</span>,files=<span class="number">5</span>,size=<span class="number">1</span>g</span><br><span class="line"></span><br><span class="line">fsd=fsd11,anchor=/mysql/snbs011/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">5</span>,size=<span class="number">256</span>k</span><br><span class="line">fsd=fsd12,anchor=/mysql/snbs012/,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">5</span>,size=<span class="number">256</span>k</span><br><span class="line"></span><br><span class="line">fwd=fwd1,fsd=fsd1,host=hd1,operation=read,xfersize=<span class="number">16</span>k,fileio=random,fileselect=random,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd2,fsd=fsd2,host=hd2,operation=read,xfersize=<span class="number">16</span>k,fileio=random,fileselect=random,threads=<span class="number">5</span></span><br><span class="line"></span><br><span class="line">fwd=fwd11,fsd=fsd11,host=hd1,operation=read,xfersize=<span class="number">16</span>k,fileio=random,fileselect=random,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd12,fsd=fsd12,host=hd2,operation=read,xfersize=<span class="number">16</span>k,fileio=random,fileselect=random,threads=<span class="number">5</span></span><br><span class="line"></span><br><span class="line">fwd=fwd21,fsd=fsd1,host=hd1,operation=write,xfersize=<span class="number">16</span>k,fileio=random,fileselect=random,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd22,fsd=fsd2,host=hd2,operation=write,xfersize=<span class="number">16</span>k,fileio=random,fileselect=random,threads=<span class="number">5</span></span><br><span class="line"></span><br><span class="line">fwd=fwd31,fsd=fsd11,host=hd1,operation=write,xfersize=<span class="number">16</span>k,fileio=random,fileselect=random,threads=<span class="number">5</span></span><br><span class="line">fwd=fwd32,fsd=fsd12,host=hd2,operation=write,xfersize=<span class="number">16</span>k,fileio=random,fileselect=random,threads=<span class="number">5</span></span><br><span class="line"></span><br><span class="line">rd=rd1,fwd=fwd*,fwdrate=max,format=restart,elapsed=<span class="number">600</span>,<span class="built_in">int</span>erval=<span class="number">5</span></span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">文件系统顺序读写：</span><br><span class="line">fwd=fwd1,fsd=fsd*,operation=read,xfersize=<span class="number">1</span>m,fileio=sequential,fileselect=random,threads=<span class="number">32</span></span><br><span class="line">fwd=fwd2,fsd=fsd*,operation=write,xfersize=<span class="number">1</span>m,fileio=sequential,fileselect=random,threads=<span class="number">32</span></span><br><span class="line"></span><br><span class="line">块设备</span><br><span class="line">hd=<span class="keyword">default</span>,vdbench=/var/www/html/vdbench504,user=root,shell=sshs</span><br><span class="line">sd=sd1,lun=/dev/vdc,openflags=o_direct,threads=<span class="number">1</span>w</span><br><span class="line">wd=wd1,sd=sd1,xfersize=<span class="number">16</span>k,readpct=<span class="number">0</span>,seekpct=<span class="number">100</span>r</span><br><span class="line">rd=rd1,wd=wd1,iorate=max,elapsed=<span class="number">120</span>,maxdata=<span class="number">5500</span>g,<span class="built_in">int</span>erval=<span class="number">1</span>,warmup=<span class="number">30</span></span><br></pre></td></tr></table></figure>

<h1 id="008-python脚本"><a href="#008-python脚本" class="headerlink" title="008-python脚本"></a>008-python脚本</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">生成vedbench脚本：</span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf8 -*-</span></span><br><span class="line"> </span><br><span class="line">import sys</span><br><span class="line">import commands</span><br><span class="line">BLOCK_NUM=["vdb","vdc"]</span><br><span class="line">def gen_test_file(file_name, rs_list): </span><br><span class="line">    for num,rs in enumerate(rs_list):</span><br><span class="line">        <span class="keyword">with</span> <span class="keyword">open</span>(file_name + <span class="string">"-"</span> + <span class="keyword">str</span>(<span class="keyword">num</span>), <span class="string">'w'</span>) <span class="keyword">as</span> fw:</span><br><span class="line">		    fw.write(<span class="string">"hd=default,vdbench=/opt/vdbench/vdbench,user=root,shell=ssh"</span>+<span class="string">"\n"</span>)</span><br><span class="line">		    <span class="keyword">for</span> <span class="keyword">num</span>,<span class="keyword">block</span> <span class="keyword">in</span> enumerate(BLOCK_NUM):</span><br><span class="line">		      fw.write(<span class="string">"sd=sd"</span>+<span class="keyword">str</span>(<span class="keyword">num</span>)+<span class="string">",lun=/dev/"</span>+<span class="keyword">block</span>+<span class="string">",openflags=o_direct,threads=1"</span>+<span class="string">"\n"</span>)</span><br><span class="line">                    TEST_CONF=<span class="string">"wd=wd1,sd=sd*,xfersize=16k,readpct=&#123;readpct&#125;,seekpct=&#123;seekpct&#125;"</span></span><br><span class="line">                    fw.write(TEST_CONF.format(readpct=rs[<span class="string">'readpct'</span>], seekpct=rs[<span class="string">'seekpct'</span>])+<span class="string">"\n"</span>)</span><br><span class="line">		    fw.write(<span class="string">"rd=rd1,wd=wd1,iorate=max,elapsed=300,maxdata=10g,interval=1,warmup=3"</span>+<span class="string">"\n"</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="keyword">main</span>():</span><br><span class="line">    fn = <span class="string">'test'</span></span><br><span class="line">    rs_list = [</span><br><span class="line">        &#123;<span class="string">'readpct'</span>:<span class="number">100</span>, <span class="string">'seekpct'</span>:<span class="number">100</span>&#125;,</span><br><span class="line">        &#123;<span class="string">'readpct'</span>:<span class="number">0</span>, <span class="string">'seekpct'</span>:<span class="number">100</span>&#125;,</span><br><span class="line">        &#123;<span class="string">'readpct'</span>:<span class="number">100</span>, <span class="string">'seekpct'</span>:<span class="number">0</span>&#125;,</span><br><span class="line">        &#123;<span class="string">'readpct'</span>:<span class="number">0</span>, <span class="string">'seekpct'</span>:<span class="number">0</span>&#125;,</span><br><span class="line">    ]*<span class="number">3</span>                               <span class="comment">#*3是这4个用例循环3次的意思</span></span><br><span class="line">    gen_test_file(<span class="string">'./&#123;&#125;'</span>.format(fn), rs_list)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">main</span>()</span><br><span class="line">    sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf8 -*-</span></span><br><span class="line"> </span><br><span class="line">import sys</span><br><span class="line">import commands</span><br><span class="line">BLOCK_NUM=["vdb","vdc"]</span><br><span class="line">def gen_test_file(file_name, rs_list): </span><br><span class="line">    for num,rs in enumerate(rs_list):</span><br><span class="line">        <span class="keyword">with</span> <span class="keyword">open</span>(file_name + <span class="string">"-"</span> + <span class="keyword">str</span>(<span class="keyword">num</span>), <span class="string">'w'</span>) <span class="keyword">as</span> fw:</span><br><span class="line">		    fw.write(<span class="string">"hd=default,vdbench=/opt/vdbench/vdbench,user=root,shell=ssh"</span>+<span class="string">"\n"</span>)</span><br><span class="line">		    <span class="keyword">for</span> <span class="keyword">num</span>,<span class="keyword">block</span> <span class="keyword">in</span> enumerate(BLOCK_NUM):</span><br><span class="line">		      fw.write(<span class="string">"sd=sd"</span>+<span class="keyword">str</span>(<span class="keyword">num</span>)+<span class="string">",lun=/dev/"</span>+<span class="keyword">block</span>+<span class="string">",openflags=o_direct,threads=1"</span>+<span class="string">"\n"</span>)</span><br><span class="line">                    TEST_CONF=<span class="string">"wd=wd1,sd=sd*,xfersize=16k,readpct=&#123;readpct&#125;,seekpct=&#123;seekpct&#125;"</span></span><br><span class="line">                    fw.write(TEST_CONF.format(readpct=rs[<span class="string">'readpct'</span>], seekpct=rs[<span class="string">'seekpct'</span>])+<span class="string">"\n"</span>)</span><br><span class="line">		    fw.write(<span class="string">"rd=rd1,wd=wd1,iorate=max,elapsed=300,maxdata=10g,interval=1,warmup=3"</span>+<span class="string">"\n"</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="keyword">main</span>():</span><br><span class="line">    fn = <span class="string">'test'</span></span><br><span class="line">    rs_list = [</span><br><span class="line">        &#123;<span class="string">'readpct'</span>:<span class="number">100</span>, <span class="string">'seekpct'</span>:<span class="number">100</span>&#125;,</span><br><span class="line">        &#123;<span class="string">'readpct'</span>:<span class="number">0</span>, <span class="string">'seekpct'</span>:<span class="number">100</span>&#125;,</span><br><span class="line">        &#123;<span class="string">'readpct'</span>:<span class="number">100</span>, <span class="string">'seekpct'</span>:<span class="number">0</span>&#125;,</span><br><span class="line">        &#123;<span class="string">'readpct'</span>:<span class="number">0</span>, <span class="string">'seekpct'</span>:<span class="number">0</span>&#125;,</span><br><span class="line">    ]*<span class="number">3</span>                               <span class="comment">#*3是这4个用例循环3次的意思</span></span><br><span class="line">    gen_test_file(<span class="string">'./&#123;&#125;'</span>.format(fn), rs_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> num0,rs <span class="keyword">in</span> enumerate(rs_list):</span><br><span class="line">	    cmd=<span class="string">'/opt/vdbench/vdbench -f &#123;&#125;'</span>.format(fn) + <span class="string">"-"</span> + <span class="keyword">str</span>(num0) + <span class="string">' -o ./res'</span> + <span class="keyword">str</span>(num0)</span><br><span class="line">            print cmd</span><br><span class="line">            print commands.getoutput(cmd)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">main</span>()</span><br><span class="line">    sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> commands</span><br><span class="line"> </span><br><span class="line">TEST_CONF=<span class="string">"""</span></span><br><span class="line"><span class="string">#hd=default,vdbench=/opt/vdbench/vdbench,user=root,shell=ssh</span></span><br><span class="line"><span class="string">sd=sd1,lun=/dev/vdb,openflags=o_direct,threads=1</span></span><br><span class="line"><span class="string">wd=wd1,sd=sd1,xfersize=16k,readpct=&#123;readpct&#125;,seekpct=&#123;seekpct&#125;</span></span><br><span class="line"><span class="string">rd=rd1,wd=wd1,iorate=max,elapsed=300,maxdata=10g,interval=1,warmup=3</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_test_file</span><span class="params">(file_name, rs_list)</span>:</span> </span><br><span class="line">    <span class="keyword">for</span> num,rs <span class="keyword">in</span> enumerate(rs_list):</span><br><span class="line">        <span class="keyword">with</span> open(file_name + <span class="string">"-"</span> + str(num), <span class="string">'w'</span>) <span class="keyword">as</span> fw:</span><br><span class="line">            fw.write(TEST_CONF.format(</span><br><span class="line">                readpct=rs[<span class="string">'readpct'</span>], seekpct=rs[<span class="string">'seekpct'</span>])</span><br><span class="line">            )</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    fn = <span class="string">'test'</span></span><br><span class="line">    rs_list = [</span><br><span class="line">        &#123;<span class="string">'readpct'</span>:<span class="number">100</span>, <span class="string">'seekpct'</span>:<span class="number">100</span>&#125;,</span><br><span class="line">        &#123;<span class="string">'readpct'</span>:<span class="number">0</span>, <span class="string">'seekpct'</span>:<span class="number">100</span>&#125;,</span><br><span class="line">        &#123;<span class="string">'readpct'</span>:<span class="number">100</span>, <span class="string">'seekpct'</span>:<span class="number">0</span>&#125;,</span><br><span class="line">        &#123;<span class="string">'readpct'</span>:<span class="number">0</span>, <span class="string">'seekpct'</span>:<span class="number">0</span>&#125;,</span><br><span class="line">    ]*<span class="number">3</span>                               <span class="comment">#*3是这4个用例循环3次的意思</span></span><br><span class="line">    gen_test_file(<span class="string">'./&#123;&#125;'</span>.format(fn), rs_list)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> num0,rs <span class="keyword">in</span> enumerate(rs_list):</span><br><span class="line">	    cmd=<span class="string">'/opt/vdbench/vdbench -f &#123;&#125;'</span>.format(fn) + <span class="string">"-"</span> + str(num0) + <span class="string">' -o ./res'</span> + str(num0)</span><br><span class="line">            <span class="keyword">print</span> cmd</span><br><span class="line">            <span class="keyword">print</span> commands.getoutput(cmd)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br><span class="line">    sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">004</span> vdbench-python生成图片</span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line">import matplotlib </span><br><span class="line">matplotlib.use(<span class="string">'Agg'</span>)</span><br><span class="line">import matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="built_in">file</span> = <span class="built_in">open</span>(<span class="string">'map.txt'</span>)  <span class="comment">#打开文档</span></span><br><span class="line">data = <span class="built_in">file</span>.readlines() <span class="comment">#读取文档数据</span></span><br><span class="line">para_1 = []  <span class="comment">#新建列表，用于保存第一列数据</span></span><br><span class="line">para_2 = []  <span class="comment">#新建列表，用于保存第二列数据</span></span><br><span class="line">para_3 = []</span><br><span class="line">para_4 = []</span><br><span class="line">para_5 = []</span><br><span class="line">para_6 = []</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">num</span> <span class="keyword">in</span> data:</span><br><span class="line">    para_1.append(float(<span class="built_in">num</span>.<span class="built_in">split</span>(<span class="string">','</span>)[<span class="number">0</span>]))</span><br><span class="line">    para_2.append(float(<span class="built_in">num</span>.<span class="built_in">split</span>(<span class="string">','</span>)[<span class="number">1</span>]))</span><br><span class="line">    para_3.append(float(<span class="built_in">num</span>.<span class="built_in">split</span>(<span class="string">','</span>)[<span class="number">2</span>]))</span><br><span class="line">    para_4.append(float(<span class="built_in">num</span>.<span class="built_in">split</span>(<span class="string">','</span>)[<span class="number">4</span>]))</span><br><span class="line">    para_5.append(float(<span class="built_in">num</span>.<span class="built_in">split</span>(<span class="string">','</span>)[<span class="number">5</span>]))</span><br><span class="line">    para_6.append(float(<span class="built_in">num</span>.<span class="built_in">split</span>(<span class="string">','</span>)[<span class="number">6</span>]))</span><br><span class="line">	</span><br><span class="line">def figure_show(<span class="keyword">a</span>,x,y):</span><br><span class="line">	plt.figure()</span><br><span class="line">	plt.title(<span class="keyword">a</span>)</span><br><span class="line">	plt.plot(x, y)</span><br><span class="line">	plt.xlabel(<span class="string">"second"</span>)</span><br><span class="line">	plt.ylabel(<span class="keyword">a</span>)</span><br><span class="line">	plt.figtext(<span class="number">0.75</span>, <span class="number">0.45</span>, <span class="keyword">a</span>,</span><br><span class="line">			 fontsize=<span class="number">40</span>, color=<span class="string">'gray'</span>,</span><br><span class="line">			 ha=<span class="string">'right'</span>, va=<span class="string">'bottom'</span>, alpha=<span class="number">0.4</span>)</span><br><span class="line">	</span><br><span class="line">	plt.savefig(<span class="keyword">a</span>+<span class="string">".png"</span>)</span><br><span class="line"></span><br><span class="line">name = [<span class="string">"iops"</span>,<span class="string">"MB"</span>,<span class="string">"resp"</span>,<span class="string">"read-resp"</span>,<span class="string">"write-resp"</span>]</span><br><span class="line">y = [para_2, para_3, para_4, para_5, para_6]</span><br><span class="line"><span class="keyword">for</span> (i, j) <span class="keyword">in</span> zip(name, y):</span><br><span class="line">    figure_show(i,para_1,j)</span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">005 vdbench 批量生成脚本</span><br><span class="line">config.py</span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf8 -*-</span></span><br><span class="line"> </span><br><span class="line">import sys</span><br><span class="line">import commands</span><br><span class="line">import os</span><br><span class="line">import ConfigParser</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 项目路径</span></span><br><span class="line">rootDir = os.path.split(os.path.realpath(__file__))[0]</span><br><span class="line"><span class="comment"># config.ini文件路径</span></span><br><span class="line">configFilePath = os.path.join(rootDir, <span class="string">'config.ini'</span>)</span><br><span class="line"> </span><br><span class="line">def get_config_values(section, option):</span><br><span class="line">    <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    根据传入的section获取对应的value</span></span><br><span class="line"><span class="string">    :param section: ini配置文件中用[]标识的内容</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">   <span class="built_in"> config </span>= ConfigParser.ConfigParser()</span><br><span class="line">    config.read(configFilePath)</span><br><span class="line">    return config.<span class="builtin-name">get</span>(<span class="attribute">section</span>=section, <span class="attribute">option</span>=option)</span><br><span class="line"></span><br><span class="line">block = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'block'</span>)</span><br><span class="line">ip = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'ip'</span>)</span><br><span class="line">xfersize = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'xfersize'</span>)</span><br><span class="line">readpct = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'readpct'</span>)</span><br><span class="line">seekpct = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'seekpct'</span>)</span><br><span class="line">iorate = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'iorate'</span>)</span><br><span class="line">elapsed = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'elapsed'</span>)</span><br><span class="line">interval = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'interval'</span>)</span><br><span class="line">threads = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'threads'</span>)</span><br><span class="line"></span><br><span class="line">def gen_test_file(file_name):</span><br><span class="line">        with open(file_name , <span class="string">'w'</span>) as fw:</span><br><span class="line">		    fw.write(<span class="string">"hd=default,vdbench=/opt/vdbench/vdbench,user=root,shell=ssh"</span>+<span class="string">"\n"</span>+<span class="string">"\n"</span>)</span><br><span class="line">                    <span class="keyword">for</span> num,IP <span class="keyword">in</span> enumerate(ip.split(<span class="string">","</span>)):</span><br><span class="line">                      fw.write(<span class="string">"hd=hd"</span>+str(num)+<span class="string">",system="</span>+IP+<span class="string">"\n"</span>)</span><br><span class="line">                    fw.write(<span class="string">"\n"</span>)</span><br><span class="line">                    num2 = 0</span><br><span class="line">                    <span class="keyword">for</span> time <span class="keyword">in</span> range(len(ip.split(<span class="string">","</span>))): </span><br><span class="line">                      <span class="keyword">for</span> BLOCK <span class="keyword">in</span> block.split(<span class="string">","</span>):</span><br><span class="line">                        num2 = num2+1</span><br><span class="line">		        fw.write(<span class="string">"sd=sd"</span>+str(num2)+<span class="string">",host=hd"</span>+str(time)+<span class="string">",lun=/dev/"</span>+BLOCK+<span class="string">",openflags=o_direct,threads="</span>+threads+<span class="string">"\n"</span>)</span><br><span class="line">                      fw.write(<span class="string">"\n"</span>)</span><br><span class="line">                    fw.write(<span class="string">"wd=wd1,sd=sd*,xfersize="</span>+xfersize+<span class="string">",readpct="</span>+readpct+<span class="string">",seekpct="</span>+seekpct+<span class="string">"\n"</span>)</span><br><span class="line">		    fw.write(<span class="string">"rd=rd1,wd=wd1,iorate=max,elapsed="</span>+elapsed+<span class="string">",interval="</span>+interval+<span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    gen_test_file(<span class="string">"test-0"</span>)</span><br><span class="line">    sys.exit(0)</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">config.ini配置文件：注释，多种场景就在配置文件中加[config3]...</span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>ceph4 vdench]# cat config.ini</span><br><span class="line">[vdbench]</span><br><span class="line">block=sdc,sdd,sde,sdf,sdg,sdh,sdi,sdj,sdk,sdl,sdm,sdn,sdo,sdp,sdq,sdr,sds,sdt,sdu,sdv</span><br><span class="line">ip=<span class="number">10.244</span><span class="number">.25</span><span class="number">.44</span>,<span class="number">10.244</span><span class="number">.25</span><span class="number">.48</span>,<span class="number">10.244</span><span class="number">.25</span><span class="number">.55</span></span><br><span class="line">threads=<span class="number">1</span></span><br><span class="line">iorate=<span class="number">2000</span></span><br><span class="line">elapsed=<span class="number">300</span></span><br><span class="line"><span class="built_in">int</span>erval=<span class="number">5</span></span><br><span class="line">readpct=<span class="number">70</span></span><br><span class="line">seekpct=<span class="number">100</span></span><br><span class="line">xfersize=(<span class="number">1024</span>k,<span class="number">20</span>,<span class="number">4</span>k,<span class="number">20</span>,<span class="number">129</span>k,<span class="number">20</span>,<span class="number">16</span>k,<span class="number">20</span>,<span class="number">256</span>k,<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>ceph4 vdench]# cat config.ini.back </span><br><span class="line">[vdbench]</span><br><span class="line">block=vdb</span><br><span class="line">ip=<span class="number">10.27</span><span class="number">.38</span><span class="number">.56</span></span><br><span class="line">iorate=<span class="number">2000</span></span><br><span class="line">elapsed=<span class="number">600</span></span><br><span class="line"><span class="built_in">int</span>erval=<span class="number">5</span></span><br><span class="line">threads=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">[config1]</span><br><span class="line">readpct=<span class="number">100</span></span><br><span class="line">seekpct=<span class="number">100</span></span><br><span class="line">xfersize=(<span class="number">1024</span>k,<span class="number">20</span>,<span class="number">2049</span>k,<span class="number">20</span>,<span class="number">129</span>k,<span class="number">20</span>,<span class="number">256</span>k,<span class="number">20</span>,<span class="number">512</span>k,<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">[config2]</span><br><span class="line">readpct=<span class="number">0</span></span><br><span class="line">seekpct=<span class="number">100</span></span><br><span class="line">xfersize=(<span class="number">1024</span>k,<span class="number">20</span>,<span class="number">2049</span>k,<span class="number">20</span>,<span class="number">129</span>k,<span class="number">20</span>,<span class="number">256</span>k,<span class="number">20</span>,<span class="number">512</span>k,<span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">005</span> vdbench 批量脚本+执行+折现图</span><br><span class="line">vdbench.<span class="keyword">py</span></span><br><span class="line">#!/usr/bin/<span class="keyword">python</span></span><br><span class="line"># -*- codin<span class="variable">g:utf8</span> -*-</span><br><span class="line"> </span><br><span class="line">import sys</span><br><span class="line">import commands</span><br><span class="line">import os</span><br><span class="line">import ConfigParser</span><br><span class="line">import matplotlib </span><br><span class="line">matplotlib.use(<span class="string">'Agg'</span>)</span><br><span class="line">import matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"> </span><br><span class="line"># 项目路径</span><br><span class="line">rootDir = os.path.<span class="keyword">split</span>(os.path.realpath(__file__))[<span class="number">0</span>]</span><br><span class="line"># config.ini文件路径</span><br><span class="line">configFilePath = os.path.<span class="keyword">join</span>(rootDir, <span class="string">'config.ini'</span>)</span><br><span class="line">config = ConfigParser.ConfigParser()</span><br><span class="line">config.<span class="keyword">read</span>(configFilePath)</span><br><span class="line"></span><br><span class="line">def get_config_values(section, option):</span><br><span class="line">    <span class="string">""</span><span class="comment">"</span></span><br><span class="line">    根据传入的section获取对应的value</span><br><span class="line">    :param section: ini配置文件中用[]标识的内容</span><br><span class="line">    :<span class="keyword">return</span>:</span><br><span class="line">    <span class="string">""</span><span class="comment">"</span></span><br><span class="line">    <span class="keyword">return</span> config.<span class="built_in">get</span>(section=section, option=option)</span><br><span class="line"></span><br><span class="line">block = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'block'</span>)</span><br><span class="line">ip = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'ip'</span>)</span><br><span class="line">iorate = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'iorate'</span>)</span><br><span class="line">elapsed = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'elapsed'</span>)</span><br><span class="line">interval = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'interval'</span>)</span><br><span class="line">threads = get_config_values(<span class="string">'vdbench'</span>, <span class="string">'threads'</span>)</span><br><span class="line"></span><br><span class="line">def gen_test_file(file_name,xfersize,readpct,seekpct):</span><br><span class="line">  with <span class="keyword">open</span>(file_name, <span class="string">'w'</span>) <span class="keyword">as</span> <span class="keyword">f</span><span class="variable">w:</span></span><br><span class="line">          fw.<span class="keyword">write</span>(<span class="string">"hd=default,vdbench=/opt/vdbench,user=root,shell=ssh"</span>+<span class="string">"\n"</span>+<span class="string">"\n"</span>)</span><br><span class="line">          <span class="keyword">for</span> num1,IP in enumerate(ip.<span class="keyword">split</span>(<span class="string">","</span>)):</span><br><span class="line">            num =num1 + <span class="number">1</span></span><br><span class="line">            fw.<span class="keyword">write</span>(<span class="string">"hd=hd"</span>+str(num1)+<span class="string">",system="</span>+IP+<span class="string">"\n"</span>)</span><br><span class="line">          fw.<span class="keyword">write</span>(<span class="string">"\n"</span>)</span><br><span class="line">          num2 = <span class="number">0</span></span><br><span class="line">          <span class="keyword">for</span> time in <span class="built_in">range</span>(<span class="built_in">len</span>(ip.<span class="keyword">split</span>(<span class="string">","</span>))):</span><br><span class="line">            <span class="keyword">for</span> BLOCK in block.<span class="keyword">split</span>(<span class="string">","</span>):</span><br><span class="line">              num2 = num2+<span class="number">1</span></span><br><span class="line">              fw.<span class="keyword">write</span>(<span class="string">"sd=sd"</span>+str(num2)+<span class="string">",host=hd"</span>+str(time)+<span class="string">",lun=/dev/"</span>+BLOCK+<span class="string">",openflags=o_direct,threads="</span>+threads+<span class="string">"+"</span>\n<span class="comment">")</span></span><br><span class="line">            fw.<span class="keyword">write</span>(<span class="string">"\n"</span>)</span><br><span class="line">          fw.<span class="keyword">write</span>(<span class="string">"wd=wd1,sd=sd*,xfersize="</span>+str(xfersize)+<span class="string">",readpct="</span>+str(readpct)+<span class="string">",seekpct="</span>+str(seekpct)+<span class="string">"\n"</span>)</span><br><span class="line">          fw.<span class="keyword">write</span>(<span class="string">"rd=rd1,wd=wd1,iorate=max,elapsed="</span>+elapsed+<span class="string">",interval="</span>+interval+<span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line">def png_show(path):</span><br><span class="line">  <span class="keyword">file</span> = <span class="keyword">open</span>(path+<span class="string">"map.txt"</span>)  #打开文档</span><br><span class="line">  data = <span class="keyword">file</span>.readlines() #读取文档数据</span><br><span class="line">  para_1 = []  #新建列表，用于保存第一列数据</span><br><span class="line">  para_2 = []  #新建列表，用于保存第二列数据</span><br><span class="line">  para_3 = []</span><br><span class="line">  para_4 = []</span><br><span class="line">  para_5 = []</span><br><span class="line">  para_6 = []</span><br><span class="line">  <span class="keyword">for</span> num in dat<span class="variable">a:</span></span><br><span class="line">      para_1.<span class="keyword">append</span>(float(num.<span class="keyword">split</span>(<span class="string">','</span>)[<span class="number">0</span>]))</span><br><span class="line">      para_2.<span class="keyword">append</span>(float(num.<span class="keyword">split</span>(<span class="string">','</span>)[<span class="number">1</span>]))</span><br><span class="line">      para_3.<span class="keyword">append</span>(float(num.<span class="keyword">split</span>(<span class="string">','</span>)[<span class="number">2</span>]))</span><br><span class="line">      para_4.<span class="keyword">append</span>(float(num.<span class="keyword">split</span>(<span class="string">','</span>)[<span class="number">4</span>]))</span><br><span class="line">      para_5.<span class="keyword">append</span>(float(num.<span class="keyword">split</span>(<span class="string">','</span>)[<span class="number">5</span>]))</span><br><span class="line">      para_6.<span class="keyword">append</span>(float(num.<span class="keyword">split</span>(<span class="string">','</span>)[<span class="number">6</span>]))</span><br><span class="line">	</span><br><span class="line">  def figure_show(<span class="keyword">a</span>,<span class="keyword">x</span>,<span class="keyword">y</span>):</span><br><span class="line">	plt.figure()</span><br><span class="line">	plt.title(<span class="keyword">a</span>)</span><br><span class="line">	plt.plot(<span class="keyword">x</span>, <span class="keyword">y</span>)</span><br><span class="line">	plt.xlabel(<span class="string">"second"</span>)</span><br><span class="line">	plt.ylabel(<span class="keyword">a</span>)</span><br><span class="line">	plt.figtext(<span class="number">0.75</span>, <span class="number">0.45</span>, <span class="keyword">a</span>,</span><br><span class="line">			 fontsize=<span class="number">40</span>, color=<span class="string">'gray'</span>,</span><br><span class="line">			 <span class="keyword">ha</span>=<span class="string">'right'</span>, va=<span class="string">'bottom'</span>, alpha=<span class="number">0.4</span>)</span><br><span class="line">	</span><br><span class="line">	plt.savefig(path+<span class="keyword">a</span>+<span class="string">".png"</span>)</span><br><span class="line"></span><br><span class="line">  name = [<span class="string">"iops"</span>,<span class="string">"MB"</span>,<span class="string">"resp"</span>,<span class="string">"read-resp"</span>,<span class="string">"write-resp"</span>]</span><br><span class="line">  <span class="keyword">y</span> = [para_2, para_3, para_4, para_5, para_6]</span><br><span class="line">  <span class="keyword">for</span> (i, <span class="keyword">j</span>) in zip(name, <span class="keyword">y</span>):</span><br><span class="line">      figure_show(i,para_1,<span class="keyword">j</span>)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    fn = <span class="string">'test'</span></span><br><span class="line">    CONF=[]</span><br><span class="line">    <span class="keyword">for</span> each in config.sections():</span><br><span class="line">      <span class="keyword">if</span> <span class="string">'config'</span> in each:</span><br><span class="line">        CONF.<span class="keyword">append</span>(each)</span><br><span class="line">    <span class="keyword">for</span> num,<span class="keyword">cf</span> in enumerate(CONF):</span><br><span class="line">      readpct = get_config_values(<span class="keyword">cf</span>, <span class="string">'readpct'</span>)</span><br><span class="line">      seekpct = get_config_values(<span class="keyword">cf</span>, <span class="string">'seekpct'</span>)</span><br><span class="line">      xfersize = get_config_values(<span class="keyword">cf</span>, <span class="string">'xfersize'</span>)</span><br><span class="line">      gen_test_file(<span class="string">'./&#123;&#125;'</span>.format(fn)+<span class="string">"-"</span>+str(num),xfersize,readpct,seekpct)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> num,<span class="keyword">cf</span> in enumerate(CONF):</span><br><span class="line">      PATH=<span class="string">'output/'</span> + format(fn)+<span class="string">"-"</span>+str(num)+<span class="string">'/'</span></span><br><span class="line">      cmd=<span class="string">'/opt/vdbench/vdbench -f &#123;&#125;'</span>.format(fn) + <span class="string">"-"</span> + str(num) + <span class="string">' -o '</span>+PATH</span><br><span class="line">      <span class="keyword">print</span>(cmd)</span><br><span class="line">      <span class="keyword">print</span> commands.getoutput(cmd)</span><br><span class="line">      <span class="keyword">com</span>=<span class="string">"grep -v \"[a-Z]\" "</span>+PATH+<span class="string">"logfile.html|awk \'&#123;$1=\"\";print $0&#125;\'|sed \'s/^[ \t]*//\'|sed \'s/[ ][ ]*/,/g\'|sed \'/^\s*$/d\'|sed \'/*/d' &gt;&gt;"</span> +PATH+<span class="string">"/map.txt"</span></span><br><span class="line">      os.<span class="built_in">system</span>(<span class="keyword">com</span>)</span><br><span class="line">      png_show(PATH)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br><span class="line">    sys.<span class="keyword">exit</span>(<span class="number">0</span>)</span><br><span class="line">config.ini配置文件：注释，多种场景就在配置文件中加[config3]...</span><br><span class="line"></span><br><span class="line">[root@ceph4 vdench]# <span class="keyword">cat</span> config.ini</span><br><span class="line">[vdbench]</span><br><span class="line">block=sdc,sdd,sde,sdf,sdg,sdh,sdi,sdj,sdk,sdl,sdm,sdn,sdo,sdp,sdq,sdr,sds,sdt,sdu,sdv</span><br><span class="line">ip=<span class="number">10.244</span>.<span class="number">25.44</span>,<span class="number">10.244</span>.<span class="number">25.48</span>,<span class="number">10.244</span>.<span class="number">25.55</span></span><br><span class="line">threads=<span class="number">1</span></span><br><span class="line">iorate=<span class="number">2000</span></span><br><span class="line">elapsed=<span class="number">300</span></span><br><span class="line">interval=<span class="number">5</span></span><br><span class="line">readpct=<span class="number">70</span></span><br><span class="line">seekpct=<span class="number">100</span></span><br><span class="line">xfersize=(<span class="number">1024</span><span class="keyword">k</span>,<span class="number">20</span>,<span class="number">4</span><span class="keyword">k</span>,<span class="number">20</span>,<span class="number">129</span><span class="keyword">k</span>,<span class="number">20</span>,<span class="number">16</span><span class="keyword">k</span>,<span class="number">20</span>,<span class="number">256</span><span class="keyword">k</span>,<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@ceph4 vdench]# <span class="keyword">cat</span> config.ini.back </span><br><span class="line">[vdbench]</span><br><span class="line">block=vdb</span><br><span class="line">ip=<span class="number">10.27</span>.<span class="number">38.56</span></span><br><span class="line">iorate=<span class="number">2000</span></span><br><span class="line">elapsed=<span class="number">600</span></span><br><span class="line">interval=<span class="number">5</span></span><br><span class="line">threads=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">[config1]</span><br><span class="line">readpct=<span class="number">100</span></span><br><span class="line">seekpct=<span class="number">100</span></span><br><span class="line">xfersize=(<span class="number">1024</span><span class="keyword">k</span>,<span class="number">20</span>,<span class="number">2049</span><span class="keyword">k</span>,<span class="number">20</span>,<span class="number">129</span><span class="keyword">k</span>,<span class="number">20</span>,<span class="number">256</span><span class="keyword">k</span>,<span class="number">20</span>,<span class="number">512</span><span class="keyword">k</span>,<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">[config2]</span><br><span class="line">readpct=<span class="number">0</span></span><br><span class="line">seekpct=<span class="number">100</span></span><br><span class="line">xfersize=(<span class="number">1024</span><span class="keyword">k</span>,<span class="number">20</span>,<span class="number">2049</span><span class="keyword">k</span>,<span class="number">20</span>,<span class="number">129</span><span class="keyword">k</span>,<span class="number">20</span>,<span class="number">256</span><span class="keyword">k</span>,<span class="number">20</span>,<span class="number">512</span><span class="keyword">k</span>,<span class="number">20</span>)</span><br></pre></td></tr></table></figure>



<h1 id="ossfuse-vdbench测试"><a href="#ossfuse-vdbench测试" class="headerlink" title="ossfuse-vdbench测试"></a>ossfuse-vdbench测试</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">配置文件：</span><br><span class="line">[<span class="symbol">root@</span>sdfspstapp04 cases]# cat random_read_100_100_300<span class="number">-100</span>th </span><br><span class="line">hd=<span class="keyword">default</span>,vdbench=/home/vdbench,user=root,shell=ssh</span><br><span class="line">hd=hd1,system=<span class="number">10.244</span><span class="number">.124</span><span class="number">.90</span></span><br><span class="line">hd=hd2,system=<span class="number">10.244</span><span class="number">.124</span><span class="number">.91</span></span><br><span class="line">hd=hd3,system=<span class="number">10.244</span><span class="number">.124</span><span class="number">.92</span></span><br><span class="line">hd=hd4,system=<span class="number">10.244</span><span class="number">.124</span><span class="number">.93</span></span><br><span class="line"></span><br><span class="line">fsd=fsd1,anchor=/mnt/sdoss/read_1023a1,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">300</span>,size=<span class="number">128</span>k</span><br><span class="line">fsd=fsd2,anchor=/mnt/sdoss/read_1023a2,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">300</span>,size=<span class="number">128</span>k</span><br><span class="line">fsd=fsd3,anchor=/mnt/sdoss/read_1023a3,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">300</span>,size=<span class="number">128</span>k</span><br><span class="line">fsd=fsd4,anchor=/mnt/sdoss/read_1023a4,depth=<span class="number">2</span>,width=<span class="number">100</span>,files=<span class="number">300</span>,size=<span class="number">128</span>k</span><br><span class="line"></span><br><span class="line">fwd=fwd1,fsd=fsd1,host=hd1,operation=read,xfersize=<span class="number">8</span>k,fileio=random,fileselect=random,threads=<span class="number">100</span></span><br><span class="line">fwd=fwd2,fsd=fsd2,host=hd2,operation=read,xfersize=<span class="number">8</span>k,fileio=random,fileselect=random,threads=<span class="number">100</span></span><br><span class="line">fwd=fwd3,fsd=fsd3,host=hd3,operation=read,xfersize=<span class="number">8</span>k,fileio=random,fileselect=random,threads=<span class="number">100</span></span><br><span class="line">fwd=fwd4,fsd=fsd4,host=hd4,operation=read,xfersize=<span class="number">8</span>k,fileio=random,fileselect=random,threads=<span class="number">100</span></span><br><span class="line"></span><br><span class="line">rd=rd1,fwd=fwd1,fwdrate=max,format=restart,elapesed=<span class="number">600</span>,<span class="built_in">int</span>erval=<span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">测试时间：elapesed=<span class="number">600</span></span><br><span class="line">vdbench测试原理：会先将目录文件建立好，在从文件中随机选出文件来进行读或者写，所以事先准备好的文件越多越好，概率问题</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">执行：</span><br><span class="line">../vdbench -f ./random_read_100_100_300<span class="number">-100</span>th -o ../output/res_random_read_100_100_300<span class="number">-100</span>th_a2.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">实际操作：</span><br><span class="line"><span class="number">1</span>、先通过format=restart将文件和目录数据灌注好</span><br><span class="line"><span class="number">2</span>、将format=restart改为format=no，直接在灌注好的文件目录上进行测试：读写</span><br><span class="line"><span class="number">3</span>、yes是删除原来的数据重新建</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章推荐</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2008\01\04\project\project_BlockStorage\2008-01-04-BlockStorage-cosbeach\" rel="bookmark">BlockStorage-cosbeach</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2008\01\04\project\project_BlockStorage\2008-01-04-BlockStorage-filebench\" rel="bookmark">BlockStorage-filebench</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2008\01\04\project\project_BlockStorage\2008-01-04-BlockStorage-fio\" rel="bookmark">BlockStorage-fio</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2008\01\04\project\project_BlockStorage\2008-01-04-BlockStorage-ftest\" rel="bookmark">BlockStorage-ftest</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2008\01\04\project\project_BlockStorage\2008-01-04-BlockStorage-iozone\" rel="bookmark">BlockStorage-iozone</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div>赞赏一下吧～</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="tongsiying 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>tongsiying
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tongsiying.github.io/2008/01/04/project/project_BlockStorage/2008-01-04-BlockStorage-vdbench/" title="BlockStorage-vdbench">https://tongsiying.github.io/2008/01/04/project/project_BlockStorage/2008-01-04-BlockStorage-vdbench/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/BlockStorage-tools/" rel="tag"># BlockStorage-tools</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2008/01/04/project/project_BlockStorage/2008-01-04-BlockStorage-%E4%B8%80%E8%87%B4%E6%80%A7%E5%AF%B9%E6%AF%94/" rel="prev" title="BlockStorage-一致性对比">
      <i class="fa fa-chevron-left"></i> BlockStorage-一致性对比
    </a></div>
      <div class="post-nav-item">
    <a href="/2008/01/04/project/project_BlockStorage/2008-01-04-BlockStorage-snbsfuse/" rel="next" title="BlockStorage-snbsfuse">
      BlockStorage-snbsfuse <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#001-vdbench安装"><span class="nav-text">001-vdbench安装</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#002-文件系统测试"><span class="nav-text">002-文件系统测试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#003-裸盘测试"><span class="nav-text">003-裸盘测试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#004-多客户端运行"><span class="nav-text">004-多客户端运行</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#005-vdbench遇到的问题"><span class="nav-text">005-vdbench遇到的问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#005-vdbench常见问题"><span class="nav-text">005-vdbench常见问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#007-脚本举例"><span class="nav-text">007-脚本举例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#008-python脚本"><span class="nav-text">008-python脚本</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ossfuse-vdbench测试"><span class="nav-text">ossfuse-vdbench测试</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="tongsiying"
      src="/images/gutianle.gif">
  <p class="site-author-name" itemprop="name">tongsiying</p>
  <div class="site-description" itemprop="description">问渠那得清如许？为有源头活水来。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">432</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tongsiying" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tongsiying" rel="noopener external nofollow noreferrer" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wxtlucky1015@163.com" title="E-Mail → mailto:wxtlucky1015@163.com" rel="noopener external nofollow noreferrer" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/2964109344" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;2964109344" rel="noopener external nofollow noreferrer" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/" title="tongsiying → https:&#x2F;&#x2F;tongsiying.github.io"><i class="wrench fa-fw"></i>tongsiying</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/ReadingNotes/" title="ReadingNotes → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;ReadingNotes&#x2F;"><i class="book fa-fw"></i>ReadingNotes</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/blog/" title="blog → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;blog&#x2F;"><i class="book fa-fw"></i>blog</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/blog/tools/" title="tools → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;blog&#x2F;tools&#x2F;"><i class="wrench fa-fw"></i>tools</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/lanlan/" title="lanlan → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;lanlan&#x2F;"><i class="wrench fa-fw"></i>lanlan</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/Music/" title="note → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;Music&#x2F;"><i class="wrench fa-fw"></i>note</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/sound/" title="Music → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;sound&#x2F;"><i class="wrench fa-fw"></i>Music</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/JSONFormat/" title="JSONFormat → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;JSONFormat&#x2F;"><i class="wrench fa-fw"></i>JSONFormat</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/HTML5-Canvas/" title="Canvas → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;HTML5-Canvas&#x2F;"><i class="wrench fa-fw"></i>Canvas</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/games/" title="games → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;games&#x2F;"><i class="wrench fa-fw"></i>games</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/love/" title="love → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;love&#x2F;"><i class="wrench fa-fw"></i>love</a>
      </span>
  </div>



		<div style="">
  <canvas id="canvas" style="width:60%;">��ǰ�������֧��canvas������������������</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //����canvas�Ŀ���
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //�洢ʱ������
    var data = [];
    //�洢�˶���С��
    var balls = [];
    //�������Ӱ뾶
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //�洢ʱ�����֣���ʮλСʱ����λСʱ��ð�š�ʮλ���ӡ���λ���ӡ�ð�š�ʮλ���ӡ���λ������7���������
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*���ɵ�������*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*����ʱ��*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //ʱ�䷢���仯
            if(NewData[i] !== data[i]){
                //���仯������ֵ����data�����е������洢��changeNumArray������
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //����С��
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*����С��״̬*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*����Ҫ�˶���С��*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*��Ⱦ*/
    function render(){
        //���û������ȣ��ﵽ��ջ�����Ч��
        canvas.height = 100;
        //��Ⱦʱ��
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //��ȾС��
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //����ʱ��
        updateDigitTime();
        //����С��״̬
        updateBalls();
        //��Ⱦ
        render();
    },50);
}

})();
</script>
      </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; Weeny – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tongsiying</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">7.6m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">114:48</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
