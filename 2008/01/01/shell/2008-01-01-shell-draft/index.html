<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/hedgehog.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/hedgehog.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tongsiying.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","b2t":true,"scrollpercent":true,"padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="shell-draft">
<meta property="og:url" content="https://tongsiying.github.io/2008/01/01/shell/2008-01-01-shell-draft/index.html">
<meta property="og:site_name" content="tongsiying">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2008-01-01T10:37:19.000Z">
<meta property="article:modified_time" content="2022-01-24T13:28:30.832Z">
<meta property="article:author" content="tongsiying">
<meta property="article:tag" content="shell">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tongsiying.github.io/2008/01/01/shell/2008-01-01-shell-draft/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>shell-draft | tongsiying</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
<!-- 加入APlayer音乐播放器 -->
<link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>
  <div class="container use-motion">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">tongsiying</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">阅读|运动|自律</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/catalog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-目录">

    <a href="/catalog/" rel="section"><i class="fa fa fa-th fa-fw"></i>目录</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-读书清单">

    <a href="/read" rel="section"><i class="fa fa-book fa-fw"></i>读书清单</a>

  </li>
        <li class="menu-item menu-item-读书笔记">

    <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="section"><i class="fa fa-book fa-fw"></i>读书笔记</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tongsiying.github.io/2008/01/01/shell/2008-01-01-shell-draft/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/gutianle.gif">
      <meta itemprop="name" content="tongsiying">
      <meta itemprop="description" content="问渠那得清如许？为有源头活水来。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tongsiying">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          shell-draft
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2008-01-01 18:37:19" itemprop="dateCreated datePublished" datetime="2008-01-01T18:37:19+08:00">2008-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-24 21:28:30" itemprop="dateModified" datetime="2022-01-24T21:28:30+08:00">2022-01-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/shell/" itemprop="url" rel="index"><span itemprop="name">shell</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>63k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>57 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p class="description"></p>
<a id="more"></a>



<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">break</span>（循环控制）</span><br><span class="line"><span class="keyword">continue</span>（循环控制）</span><br><span class="line"><span class="keyword">exit</span>（退出脚本）</span><br><span class="line">return（退出函数）</span><br></pre></td></tr></table></figure>



<h1 id="小数和整数比较"><a href="#小数和整数比较" class="headerlink" title="小数和整数比较"></a>小数和整数比较</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/shixun/p/6179642.html</span><br><span class="line">shell脚本小数和整数比较</span><br><span class="line">1.错误：</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$mya</span> -le 4 ]; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">"ok"</span>;<span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"fail"</span>; <span class="keyword">fi</span></span><br><span class="line">-bash: [: 5.7: <span class="built_in">integer</span> expression expecte</span><br><span class="line">2.正确：</span><br><span class="line"><span class="keyword">if</span> [ $(<span class="built_in">echo</span> <span class="string">"<span class="variable">$mya</span> &lt;= 4"</span>|bc) = 1 ]; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">"ok"</span>;<span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"fail"</span>;<span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">https://www.jianshu.com/p/f7234405eb79</span><br><span class="line"></span><br><span class="line">假设我们定义了一个变量为：</span><br><span class="line"><span class="keyword">file</span>=/dir1/dir2/dir3/my.<span class="keyword">file</span>.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#是左，$是右</span></span><br><span class="line"></span><br><span class="line">可以用$&#123; &#125;分别替换得到不同的值：</span><br><span class="line">$&#123;file#*/&#125;：删掉第一个/ 及其左边的字符串：dir1/dir2/dir3/my.<span class="keyword">file</span>.txt</span><br><span class="line">$&#123;file##*/&#125;：删掉最后一个/ 及其左边的字符串：my.<span class="keyword">file</span>.txt</span><br><span class="line">$&#123;file#*.&#125;：删掉第一个.  及其左边的字符串：<span class="keyword">file</span>.txt</span><br><span class="line">$&#123;file##*.&#125;：删掉最后一个.  及其左边的字符串：txt</span><br><span class="line">$&#123;file%/*&#125;：删掉最后一个 /  及其右边的字符串：/dir1/dir2/dir3</span><br><span class="line">$&#123;file%%/*&#125;：删掉第一个/  及其右边的字符串：(空值)</span><br><span class="line">$&#123;file%.*&#125;：删掉最后一个 .  及其右边的字符串：/dir1/dir2/dir3/my.<span class="keyword">file</span></span><br><span class="line">$&#123;file%%.*&#125;：删掉第一个. 及其右边的字符串：/dir1/dir2/dir3/my</span><br><span class="line"></span><br><span class="line">记忆的方法为：</span><br><span class="line"><span class="comment"># 是 去掉左边（键盘上#在 $ 的左边）</span></span><br><span class="line">%是去掉右边（键盘上% 在$ 的右边）</span><br><span class="line">单一符号是最小匹配；两个符号是最大匹配</span><br><span class="line"></span><br><span class="line">$&#123;file:<span class="number">0</span>:<span class="number">5</span>&#125;：提取最左边的<span class="number">5</span> 个字节：/dir1</span><br><span class="line">$&#123;file:<span class="number">5</span>:<span class="number">5</span>&#125;：提取第<span class="number">5</span> 个字节右边的连续<span class="number">5</span>个字节：/dir2</span><br><span class="line"></span><br><span class="line">也可以对变量值里的字符串作替换：</span><br><span class="line">$&#123;file/dir/path&#125;：将第一个dir 替换为path：/path1/dir2/dir3/my.<span class="keyword">file</span>.txt</span><br><span class="line">$&#123;file//dir/path&#125;：将全部dir 替换为path：/path1/path2/path3/my.<span class="keyword">file</span>.txt</span><br><span class="line"></span><br><span class="line">利用$&#123; &#125; 还可针对不同的变数状态赋值(沒设定、空值、非空值)： </span><br><span class="line">$&#123;file-my.<span class="keyword">file</span>.txt&#125; ：假如$file 沒有设定，則使用my.<span class="keyword">file</span>.txt 作传回值。(空值及非空值時不作处理) </span><br><span class="line">$&#123;file:-my.<span class="keyword">file</span>.txt&#125; ：假如$file 沒有設定或為空值，則使用my.<span class="keyword">file</span>.txt 作傳回值。(非空值時不作处理)</span><br><span class="line">$&#123;file+my.<span class="keyword">file</span>.txt&#125; ：假如$file 設為空值或非空值，均使用my.<span class="keyword">file</span>.txt 作傳回值。(沒設定時不作处理)</span><br><span class="line">$&#123;file:+my.<span class="keyword">file</span>.txt&#125; ：若$file 為非空值，則使用my.<span class="keyword">file</span>.txt 作傳回值。(沒設定及空值時不作处理)</span><br><span class="line">$&#123;file=my.<span class="keyword">file</span>.txt&#125; ：若$file 沒設定，則使用my.<span class="keyword">file</span>.txt 作傳回值，同時將$file 賦值為my.<span class="keyword">file</span>.txt 。(空值及非空值時不作处理)</span><br><span class="line">$&#123;file:=my.<span class="keyword">file</span>.txt&#125; ：若$file 沒設定或為空值，則使用my.<span class="keyword">file</span>.txt 作傳回值，同時將$file 賦值為my.<span class="keyword">file</span>.txt 。(非空值時不作处理)</span><br><span class="line">$&#123;file?my.<span class="keyword">file</span>.txt&#125; ：若$file 沒設定，則將my.<span class="keyword">file</span>.txt 輸出至STDERR。(空值及非空值時不作处理)</span><br><span class="line">$&#123;file:?my.<span class="keyword">file</span>.txt&#125; ：若$file 没设定或为空值，则将my.<span class="keyword">file</span>.txt 输出至STDERR。(非空值時不作处理)</span><br><span class="line">$&#123;#var&#125; 可计算出变量值的长度：</span><br><span class="line">$&#123;#<span class="keyword">file</span>&#125; 可得到<span class="number">27</span> ，因为/dir1/dir2/dir3/my.<span class="keyword">file</span>.txt 是<span class="number">27</span>个字节</span><br></pre></td></tr></table></figure>

<h1 id="read"><a href="#read" class="headerlink" title="read"></a>read</h1><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">情景</span></span><br><span class="line"><span class="attr">我们知道，read命令可以读取文件内容，并把内容赋值给变量。</span></span><br><span class="line"><span class="attr">以如下的数据文件为例。</span></span><br><span class="line"><span class="meta">$</span> <span class="string">cat data.txt</span></span><br><span class="line"><span class="attr">1</span> <span class="string">201623210021 wangzhiguo 25</span></span><br><span class="line"><span class="attr">2</span> <span class="string">201623210022 yangjiangbo 26</span></span><br><span class="line"><span class="attr">3</span> <span class="string">201623210023 yangzhen 24</span></span><br><span class="line"><span class="attr">4</span> <span class="string">201623210024 wangdong 23</span></span><br><span class="line"><span class="attr">5</span> <span class="string">201623210025 songdong 25</span></span><br><span class="line"></span><br><span class="line"><span class="attr">以上文件的四列分别为序号（index）、学号（number）、姓名（name）、年龄（age）。用shell脚本读取该文件并输出每行的值：</span></span><br><span class="line"><span class="meta">$</span> <span class="string">cat read_data.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="attr">cat</span> <span class="string">data.txt | while read index number name age</span></span><br><span class="line"><span class="attr">do</span></span><br><span class="line">    <span class="attr">echo</span> <span class="string">"index:$&#123;index&#125;"</span></span><br><span class="line">    <span class="attr">echo</span> <span class="string">"number:$&#123;number&#125;"</span></span><br><span class="line">    <span class="attr">echo</span> <span class="string">"name:$&#123;name&#125;"</span></span><br><span class="line">    <span class="attr">echo</span> <span class="string">"age:$&#123;age&#125;"</span></span><br><span class="line">    <span class="attr">echo</span> <span class="string">" "</span></span><br><span class="line"><span class="attr">done</span></span><br><span class="line"><span class="attr">执行脚本，查看结果：</span></span><br><span class="line"><span class="meta">$</span> <span class="string">sh read_data.sh </span></span><br><span class="line"><span class="attr">index</span>:<span class="string">1</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210021</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">wangzhiguo</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">25</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">index</span>:<span class="string">2</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210022</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">yangjiangbo</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">26</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">index</span>:<span class="string">3</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210023</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">yangzhen</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">24</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">index</span>:<span class="string">4</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210024</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">wangdong</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">23</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">index</span>:<span class="string">5</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210025</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">songdong</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">25</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">不知你发现没有，这样的实现方式有着明显的弊端：</span></span><br><span class="line"><span class="meta">列名（read</span> <span class="string">index number name age）显式地在代码中指定，如果只是想弄清楚数据文件的每列含义，则需要阅读脚本；</span></span><br><span class="line"><span class="attr">该脚本中指明了每列的名称，如果希望修改各字段的英文名称（比如序号的英文名称希望改为NUMBER）则需要修改脚本，且修改多处；</span></span><br><span class="line"><span class="attr">该脚本按一定顺序读取数据文件，因此，如果数据文件中的列顺序发生了变化，则依然需要修改脚本；</span></span><br><span class="line"><span class="attr">如果有其他数据文件需要按此方式读取，则需要根据数据文件的实际情况再重写一个新脚本；</span></span><br><span class="line"><span class="attr">上述实现方式虽然看起来简单，但基于上述的弊端，我们还应对其进行优化。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">方案</span></span><br><span class="line"><span class="attr">解决的根本应该是写尽可能通用的脚本，不依赖数据文件本身的列数、列顺序、列名称（含义）等。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">可以将数据文件的各字段名称存于该数据文件的首行。当读取数据文件时，首先读取数据文件的首行，以获取各字段名称的列表；读取其它行时，将首行的值与非首行的值进行一一对应即可。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">数据文件：</span></span><br><span class="line"><span class="meta">$</span> <span class="string">cat new_data.txt </span></span><br><span class="line"><span class="attr">index</span> <span class="string">number name age</span></span><br><span class="line"><span class="attr">1</span> <span class="string">201623210021 wangzhiguo 25</span></span><br><span class="line"><span class="attr">2</span> <span class="string">201623210022 yangjiangbo 26</span></span><br><span class="line"><span class="attr">3</span> <span class="string">201623210023 yangzhen 24</span></span><br><span class="line"><span class="attr">4</span> <span class="string">201623210024 wangdong 23</span></span><br><span class="line"><span class="attr">5</span> <span class="string">201623210025 songdong 25</span></span><br><span class="line"><span class="attr">脚本</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> <span class="string">cat new_read_data.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取文件头行，存于一个数组中</span></span><br><span class="line"><span class="attr">tablehead</span>=<span class="string">(`head -n 1 new_data.txt`)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件第二行开始读取，按上述数组顺序读取各字段</span></span><br><span class="line"><span class="attr">tail</span> <span class="string">-n +2 new_data.txt | while read $&#123;tablehead[*]&#125;</span></span><br><span class="line"><span class="attr">do</span></span><br><span class="line"><span class="comment">    # 遍历数组的下标，获取tablehead数组的对应值，以及以该值命名的变量的值</span></span><br><span class="line">    <span class="attr">for</span> <span class="string">i in `seq 0 $(($&#123;#tablehead[@]&#125;-1))`</span></span><br><span class="line">    <span class="attr">do</span></span><br><span class="line">        <span class="attr">temp</span>=<span class="string">$&#123;tablehead[$i]&#125;</span></span><br><span class="line">        <span class="attr">echo</span> <span class="string">"$&#123;temp&#125;:$&#123;!temp&#125;"</span></span><br><span class="line">    <span class="attr">done</span></span><br><span class="line">    <span class="attr">echo</span> <span class="string">""</span></span><br><span class="line"><span class="attr">done</span></span><br><span class="line"><span class="attr">结果</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> <span class="string">sh new_read_data.sh </span></span><br><span class="line"><span class="attr">index</span>:<span class="string">1</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210021</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">wangzhiguo</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">25</span></span><br><span class="line"></span><br><span class="line"><span class="attr">index</span>:<span class="string">2</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210022</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">yangjiangbo</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">26</span></span><br><span class="line"></span><br><span class="line"><span class="attr">index</span>:<span class="string">3</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210023</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">yangzhen</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">index</span>:<span class="string">4</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210024</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">wangdong</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">23</span></span><br><span class="line"></span><br><span class="line"><span class="attr">index</span>:<span class="string">5</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210025</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">songdong</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">25</span></span><br><span class="line"><span class="attr">要写出更通用的脚本，还可以做一些判断和处理，比如：数据文件作为参数传入、检查数据文件的行数、检查数据文件的列数，等等。</span></span><br></pre></td></tr></table></figure>

<h1 id="EOT、EOF"><a href="#EOT、EOF" class="headerlink" title="EOT、EOF"></a>EOT、EOF</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">EOT：EOT是“end of file”，表示文本结束符。即可避免使用多行echo命令的方式，并实现多行输出的结果。</span><br><span class="line">function usage ()</span><br><span class="line">&#123;</span><br><span class="line">  cat &lt;&lt;- EOT</span><br><span class="line">  Usage :  <span class="variable">$0</span> [options] -p package -s<span class="built_in"> script </span>file1 file2 file3 <span class="built_in">..</span></span><br><span class="line"></span><br><span class="line">  Options:</span><br><span class="line">  -h|help       Display this message</span><br><span class="line">  -p|package    The output package name</span><br><span class="line">  -j|jar file   The jar file</span><br><span class="line">EOT</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">usage</span><br><span class="line"></span><br><span class="line"><span class="comment">#EOT只是标识，不是固定的，可以写成EOF、HHH等</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">其它用法：</span><br><span class="line">在某些场合，可能我们需要在脚本中生成一个临时文件，然后把该文件作为最终文件放入目录中。（可参考ntop.spec文件）这样有几个好处，其中之一就是临时文件不是唯一的，可以通过变量赋值，也可根据不同的判断生成不同的最终文件等等。</span><br><span class="line"></span><br><span class="line">一、cat和EOF</span><br><span class="line">cat命令是linux下的一个文本输出命令，通常是用于观看某个文件的内容的；</span><br><span class="line">EOF是“end of file”，表示文本结束符。</span><br><span class="line">结合这两个标识，即可避免使用多行echo命令的方式，并实现多行输出的结果。</span><br><span class="line"></span><br><span class="line">二、使用</span><br><span class="line">看例子是最快的熟悉方法：</span><br><span class="line"><span class="comment"># cat &lt;&lt; EOF &gt; test.sh</span></span><br><span class="line">&gt; #!/bin/bash</span><br><span class="line">&gt; #you Shell<span class="built_in"> script </span>writes here.</span><br><span class="line">&gt; EOF</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">引用</span><br><span class="line">cat test.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#you Shell script writes here.。</span></span><br><span class="line"></span><br><span class="line">三、其他写法</span><br><span class="line">1、追加文件</span><br><span class="line"><span class="comment"># cat &lt;&lt; EOF &gt;&gt; test.sh</span></span><br><span class="line">2、换一种写法</span><br><span class="line"><span class="comment"># cat &gt; test.sh &lt;&lt; EOF</span></span><br><span class="line">3、非脚本中</span><br><span class="line">如果不是在脚本中，我们可以用Ctrl-D输出EOF的标识</span><br><span class="line"><span class="comment"># cat &gt; iii.txt</span></span><br><span class="line">skldjfklj</span><br><span class="line">sdkfjkl</span><br><span class="line">kljkljklj</span><br><span class="line">kljlk</span><br><span class="line">Ctrl-D</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">引用</span><br><span class="line"><span class="comment"># cat iii.txt</span></span><br><span class="line">skldjfklj</span><br><span class="line">sdkfjkl</span><br><span class="line">kljkljklj</span><br><span class="line">kljlk</span><br></pre></td></tr></table></figure>

<h1 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">懒的整理：http://xstarcd.github.io/wiki/shell/exec_redirect.html</span><br><span class="line">简明说说<span class="built_in">exec</span>使用，不深究：</span><br><span class="line">1.作为日志打印重定向使用</span><br><span class="line">SCRTIP_NAME=<span class="string">"cp_image.sh"</span>  <span class="comment">#脚本名</span></span><br><span class="line"><span class="built_in">exec</span> 5&gt;&gt;/tmp/<span class="variable">$&#123;SCRTIP_NAME/.sh/&#125;</span>.<span class="built_in">log</span> <span class="comment">#带&gt;&amp;5都输出到这个日志</span></span><br><span class="line">echolog <span class="string">"Error, Delete the image file failed!"</span> &gt;&amp;5</span><br></pre></td></tr></table></figure>

<h1 id><a href="#" class="headerlink" title="$"></a>$</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$0:</span> 脚本本身文件名称</span><br><span class="line"><span class="variable">$1:</span> 命令行第一个参数，<span class="variable">$2</span>为第二个，以此类推</span><br><span class="line"><span class="variable">$</span>*: 所有参数列表</span><br><span class="line"><span class="variable">$</span><span class="selector-tag">@</span>: 所有参数列表</span><br><span class="line"><span class="variable">$</span><span class="comment">#: 参数个数</span></span><br><span class="line"><span class="variable">$</span><span class="variable">$</span>: 脚本运行时的PID</span><br><span class="line"><span class="variable">$</span>?: 脚本退出码</span><br><span class="line"></span><br><span class="line">*与<span class="selector-tag">@</span>的区别</span><br><span class="line"></span><br><span class="line">当命令行为test.sh <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="string">"<span class="variable">$</span>*“表示"</span><span class="number">1</span> <span class="number">2</span> <span class="number">3</span>”</span><br><span class="line"><span class="string">"<span class="variable">$</span>@“表示"</span><span class="number">1</span>” “<span class="number">2</span>” “<span class="number">3</span>”</span><br><span class="line">二者没有被引号括起来时是一样的都为<span class="string">"1 2 3"</span>，只有当被引号括起来后才表现出差异</span><br></pre></td></tr></table></figure>

<h1 id="printf"><a href="#printf" class="headerlink" title="printf"></a>printf</h1><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">printf</span></span><br><span class="line">https:<span class="regexp">//www</span>.cnblogs.com/simadongyang/p/<span class="number">8228098</span>.html</span><br><span class="line"></span><br><span class="line">上一章节我们学习了Shell的echo命令，本章节我们来学习Shell的另一个输出命令printf.</span><br><span class="line"><span class="keyword">printf</span>命令模仿C程序库(library)里的<span class="keyword">printf</span>()程序。</span><br><span class="line"><span class="keyword">printf</span>由POSIX标准多定义，因此使用<span class="keyword">printf</span> 的脚本比使用echo 移值性好。</span><br><span class="line"><span class="keyword">printf</span> 使用引用文本或空格分隔的参数，外面可以在<span class="keyword">printf</span>中使用格式化字符串，还可以制定字符串的宽度 左右对齐方式等。</span><br><span class="line">默认<span class="keyword">printf</span>不会向echo 自动添加换行符， 我们可以手动添加 \n.</span><br><span class="line"></span><br><span class="line"><span class="keyword">printf</span> 命令的语法：</span><br><span class="line"><span class="keyword">printf</span> <span class="keyword">format</span>-string [arguments ...]</span><br><span class="line">参数说明：</span><br><span class="line"><span class="keyword">format</span>-string:为格式控制字符串</span><br><span class="line">arguments:为参数列表。</span><br><span class="line">实例如下：</span><br><span class="line">$ echo <span class="string">"Hello,Shell"</span></span><br><span class="line">Hello,Shell</span><br><span class="line">$ prinrf <span class="string">"Hello,Shell\n"</span></span><br><span class="line">Hello,Shell</span><br><span class="line">$</span><br><span class="line">接下来，我来用一个脚本来体现<span class="keyword">printf</span>的强大功能：</span><br><span class="line"><span class="comment">#！/binbash</span></span><br><span class="line"><span class="comment"># author:菜鸟教程</span></span><br><span class="line"><span class="comment"># url:www.runoob.com</span></span><br><span class="line"><span class="keyword">printf</span> <span class="string">"%-10s %-8s %-4s\n"</span> 姓名 性别 体重kg</span><br><span class="line"><span class="keyword">printf</span> <span class="string">"%-10s %-8s %-4.2f\n"</span> 郭靖 男 <span class="number">66.1234</span></span><br><span class="line">执行脚本，输出结果如下所示：</span><br><span class="line">姓名 性别 体重kg</span><br><span class="line">郭靖  男  <span class="number">66.12</span></span><br><span class="line"> </span><br><span class="line">%s %c %d %都是格式替代符</span><br><span class="line">%-<span class="number">10</span><span class="keyword">s</span> 指一个宽度为<span class="number">10</span>个字符(-表示左对齐，没有则表示右对齐),任何字符都会被显示在<span class="number">10</span>个字符宽的字符内，如果不足则自动以空格填充，超过也会将内容全部显示出来。</span><br><span class="line">%-<span class="number">4</span> <span class="number">2</span>f 指格式化小数，其中，.<span class="number">2</span>指保留<span class="number">2</span>为小数。</span><br><span class="line">更多实例：</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># author:菜鸟教程</span></span><br><span class="line"><span class="comment"># url:www.runoob.com</span></span><br><span class="line"><span class="comment"># fotmat-sting为双引号</span></span><br><span class="line"><span class="keyword">printf</span> <span class="string">"%d %s\n"</span> <span class="number">1</span>  <span class="string">"abc"</span></span><br><span class="line"><span class="comment"># 单引号与双引号效果一样</span></span><br><span class="line"><span class="keyword">printf</span> <span class="string">'%d %s\n'</span> <span class="number">1</span> <span class="string">"abc"</span></span><br><span class="line"><span class="comment"># 没有引号也可以输出</span></span><br><span class="line"><span class="keyword">printf</span> %s abcdef</span><br><span class="line"><span class="comment"># 格式只指定了一个参数，但多出的参数仍然会按照该格式输出， format-string 被重用</span></span><br><span class="line"><span class="keyword">printf</span> %s abc def</span><br><span class="line"><span class="keyword">printf</span> <span class="string">"%s\n"</span> abc def </span><br><span class="line"><span class="keyword">printf</span> <span class="string">"%s %s %s\n"</span> a b c e f g h </span><br><span class="line"><span class="comment"># 如果没有 arguments,那么 %s 用HULL 代替， %d 用0 代替</span></span><br><span class="line"><span class="keyword">printf</span> <span class="string">"%s and %d \n"</span></span><br><span class="line">执行脚本 ，输出结果如下所示：</span><br><span class="line"><span class="keyword">printf</span>的转义序列</span><br><span class="line">序列  说明</span><br><span class="line">\a  警告字符，通常为ASCII的BEL字符</span><br><span class="line">\b 后退</span><br><span class="line">\c 抑制(不显示)输出结果中任何结尾的换行字符(只在%b格式指示符控制下的参数字符串中有效),而且， 任何留在参数里的字符，</span><br><span class="line">任何接下来的参数以及任何留在格式字符串中的字符，都被忽略</span><br><span class="line">\f 换页(formfeed)</span><br><span class="line">\n 换行</span><br><span class="line">\r 回车(Carriage <span class="keyword">return</span>)</span><br><span class="line">\t  水平制表符</span><br><span class="line">\v 垂直制表符</span><br><span class="line">\\ 一个字面上的反斜杠字符</span><br><span class="line">\ddd 表示<span class="number">1</span>到<span class="number">3</span>位数八进制的字符，仅在格式字符串中有效</span><br><span class="line">\0ddd 表示<span class="number">1</span>到<span class="number">3</span>位的八进制值字符</span><br><span class="line">笔记</span><br><span class="line">%d %s %c %f  格式替代符详解</span><br><span class="line">d:Decimal 十进制整数 对应位置参数必须是十进制整数，否则报错!</span><br><span class="line"><span class="keyword">s</span>:String 字符串 对应位置参数必须是字符串或者字符型 否则报错</span><br><span class="line">c:Char 字符 对应位置参数必须是字符串或者字符型 否则报错</span><br><span class="line">f: Float 浮点 对应位置参数必须是数字型 否则报错</span><br><span class="line">如： 其中最后一个参数是 <span class="string">"def"</span> %c 自动截取字符串的第一个字符作为结果输出。</span><br></pre></td></tr></table></figure>
<h1 id="printf：001"><a href="#printf：001" class="headerlink" title="printf：001"></a>printf：001</h1><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@host102442549 install.b]# printf <span class="string">"%03d<span class="subst">\n</span>"</span> &#123;<span class="number">1.</span><span class="number">.20</span>&#125;</span><br><span class="line"><span class="number">001</span></span><br><span class="line"><span class="number">002</span></span><br><span class="line"><span class="number">003</span></span><br><span class="line"><span class="number">004</span></span><br><span class="line"><span class="number">005</span></span><br><span class="line"><span class="number">006</span></span><br><span class="line"><span class="number">007</span></span><br><span class="line"><span class="number">008</span></span><br><span class="line"><span class="number">009</span></span><br><span class="line"><span class="number">010</span></span><br><span class="line"><span class="number">011</span></span><br><span class="line"><span class="number">012</span></span><br><span class="line"><span class="number">013</span></span><br><span class="line"><span class="number">014</span></span><br><span class="line"><span class="number">015</span></span><br><span class="line"><span class="number">016</span></span><br><span class="line"><span class="number">017</span></span><br><span class="line"><span class="number">018</span></span><br><span class="line"><span class="number">019</span></span><br><span class="line"><span class="number">020</span></span><br></pre></td></tr></table></figure>

<h1 id="shift："><a href="#shift：" class="headerlink" title="shift："></a>shift：</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">参数左移</span><br><span class="line">shell脚本shfit</span><br><span class="line"><span class="built_in">shift</span>其实很简单的，就是左移参数列表，<span class="built_in">shift</span>一次就将最左边的参数<span class="variable">$1</span>移出去了，然后 </span><br><span class="line">原来的<span class="variable">$2</span>现在就变成了<span class="variable">$1</span>。</span><br><span class="line"></span><br><span class="line"><span class="built_in">shift</span>后面还可以带上一个数字，指明要移出多少个参数（默认只移出一个），比如说 </span><br><span class="line"><span class="built_in">shift</span> 3 就是移出3个参数，之后原来的<span class="variable">$4</span>就变成了现在的<span class="variable">$1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">shift</span>命令用于对参数的移动(左移)，通常用于在不知道传入参数个数的情况下依次遍历每个参数然后进行相应处理（常见于Linux中各种程序的启动脚本）。</span><br><span class="line"></span><br><span class="line">示例1:依次读取输入的参数并打印参数个数：</span><br><span class="line">run.sh:</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$#</span> != 0 ];<span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"第一个参数为：<span class="variable">$1</span>,参数个数为：<span class="variable">$#</span>"</span></span><br><span class="line"><span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">输入如下命令运行：run.sh a b c d e f</span><br><span class="line">结果显示如下：</span><br><span class="line">第一个参数为：a,参数个数为：6</span><br><span class="line">第一个参数为：b,参数个数为：5</span><br><span class="line">第一个参数为：c,参数个数为：4</span><br><span class="line">第一个参数为：d,参数个数为：3</span><br><span class="line">第一个参数为：e,参数个数为：2</span><br><span class="line">第一个参数为：f,参数个数为：1</span><br><span class="line">从上可知 <span class="built_in">shift</span>(<span class="built_in">shift</span> 1) 命令每执行一次，变量的个数(<span class="variable">$#</span>)减一（之前的<span class="variable">$1</span>变量被销毁,之后的<span class="variable">$2</span>就变成了<span class="variable">$1</span>），而变量值提前一位。</span><br><span class="line"></span><br><span class="line">同理，<span class="built_in">shift</span> n后，前n位参数都会被销毁，比如：</span><br><span class="line">输入5个参数： abcde</span><br><span class="line">那么<span class="variable">$1</span>=a,<span class="variable">$2</span>=b,<span class="variable">$3</span>=c,<span class="variable">$4</span>=d,<span class="variable">$5</span>=e,执行<span class="built_in">shift</span> 3操作后，前3个参数a、b、c被销毁，就剩下了2个参数：d,e（这时d=<span class="variable">$1</span>,e=<span class="variable">$2</span>，其中d由<span class="variable">$4</span>—&gt;<span class="variable">$1</span>,e由<span class="variable">$5</span>—&gt;<span class="variable">$2</span>）,参考示例如下：</span><br><span class="line">示例2：</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"参数个数为：<span class="variable">$#</span>,其中："</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 <span class="variable">$#</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">eval</span> j=\$<span class="variable">$i</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"第<span class="variable">$i</span>个参数($"</span><span class="variable">$i</span><span class="string">")：<span class="variable">$j</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">shift</span> 3</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"执行shift 3操作后："</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"参数个数为：<span class="variable">$#</span>,其中："</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 <span class="variable">$#</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="comment">#通过eval把i变量的值($i)作为变量j的名字</span></span><br><span class="line"><span class="built_in">eval</span> j=\$<span class="variable">$i</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"第<span class="variable">$i</span>个参数($"</span><span class="variable">$i</span><span class="string">")：<span class="variable">$j</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line">输出结果为：</span><br><span class="line">参数个数为：5,其中：</span><br><span class="line">第1个参数(<span class="variable">$1</span>)：a</span><br><span class="line">第2个参数(<span class="variable">$2</span>)：b</span><br><span class="line">第3个参数(<span class="variable">$3</span>)：c</span><br><span class="line">第4个参数(<span class="variable">$4</span>)：d</span><br><span class="line">第5个参数(<span class="variable">$5</span>)：e</span><br><span class="line">执行<span class="built_in">shift</span> 3操作后：</span><br><span class="line">参数个数为：2,其中：</span><br><span class="line">第1个参数(<span class="variable">$1</span>)：d</span><br><span class="line">第2个参数(<span class="variable">$2</span>)：e</span><br></pre></td></tr></table></figure>

<h1 id="readlink"><a href="#readlink" class="headerlink" title="readlink"></a>readlink</h1><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">全路径文件名/<span class="keyword">dirname</span>:文件所在的目录</span><br><span class="line"><span class="keyword">dirname</span>:文件所在的目录</span><br><span class="line"><span class="keyword">dirname</span></span><br><span class="line">直接从<span class="keyword">dirname</span>返回的未必是绝对路径，取决于提供给<span class="keyword">dirname</span>的参数是否是绝对路径。 </span><br><span class="line">例子<span class="number">1</span>：</span><br><span class="line">[root@ceph4 home]# <span class="keyword">dirname</span>  /home/<span class="number">1.</span>sh </span><br><span class="line">/home</span><br><span class="line"></span><br><span class="line">例子<span class="number">2</span>：</span><br><span class="line">SHELL_FOLDER=$(<span class="keyword">dirname</span> <span class="string">"$0"</span>)</span><br><span class="line">echo $SHELL_FOLDER</span><br><span class="line">返回.</span><br><span class="line"></span><br><span class="line">例子<span class="number">3</span>：</span><br><span class="line">SHELL_FOLDER1=$(cd <span class="string">"$(dirname "</span>$0<span class="string">")"</span>;<span class="keyword">pwd</span>)</span><br><span class="line">echo $SHELL_FOLDER1</span><br><span class="line">返回：/home</span><br><span class="line"></span><br><span class="line">SHELL_FOLDER=$(<span class="keyword">dirname</span> <span class="string">"$0"</span>)</span><br><span class="line"></span><br><span class="line">readlink ：全路径文件名</span><br><span class="line">[hadoopet2-centos6 codemgrs]$ readlink --<span class="keyword">help</span></span><br><span class="line">用法: readlink [选项]...文件</span><br><span class="line">输出符号链接值或权威文件名.</span><br><span class="line">-f, --canonicalize 递归跟随给出文件名的所有符号链接以标准化,除最后一个外所有组件必须存在</span><br><span class="line">-e, --canonicalize-existing 递归跟随给出文件名的所有符号链接以标准化,所有组件都必须存在</span><br><span class="line">-m, --canonicalize-missing 递归跟随给出文件名的所有符号链接以标准化,但不对组件存在性作出要求</span><br><span class="line">-n, --no-newline	不输出尾随的新行</span><br><span class="line">-q, --quiet,</span><br><span class="line">-S, --silent	缩减大多数的错误消息</span><br><span class="line">-v, --verbose	报告所有错误消息</span><br><span class="line">	--<span class="keyword">help</span>		显示此帮助信息并退出</span><br><span class="line">	--version	显示版本信息并退出</span><br><span class="line">所以用readlink命令我们可以直接获取$0参数的全路径文件名，然后再用<span class="keyword">dirname</span>获取其所在的绝对路径：</span><br><span class="line">举例<span class="number">1</span>：</span><br><span class="line">readlink -f <span class="string">"$0"</span></span><br><span class="line">/home/<span class="number">6.</span>sh</span><br><span class="line"></span><br><span class="line">举例<span class="number">2</span>：</span><br><span class="line">SHELL_FOLDER=$(<span class="keyword">dirname</span> $(readlink -f <span class="string">"$0"</span>))</span><br><span class="line">echo $SHELL_FOLDER</span><br><span class="line">/home</span><br></pre></td></tr></table></figure>

<h1 id="random："><a href="#random：" class="headerlink" title="random："></a>random：</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">从数组中随机抽取元素</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">student=(1 DPL YPD LT ZZM HY CQW LSJ ybr)</span><br><span class="line">a=$[RANDOM%4+3]</span><br><span class="line">c=$[RANDOM%2+1]</span><br><span class="line"><span class="built_in">echo</span> -----------------------------------</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span>号 <span class="variable">$&#123;student[$a]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> $((<span class="variable">$a</span>+<span class="variable">$c</span>))号 <span class="variable">$&#123;student[$(($a+$c))]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> $((<span class="variable">$a</span>-<span class="variable">$c</span>))号 <span class="variable">$&#123;student[$(($a-$c))]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> -----------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment">#done</span></span><br></pre></td></tr></table></figure>

<h1 id="getopt"><a href="#getopt" class="headerlink" title="getopt"></a>getopt</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">getopt（一个外部工具）</span><br><span class="line">https://www.cnblogs.com/lidabo/p/5382617.html</span><br><span class="line">具体用用法可以 man getopt</span><br><span class="line">char*optstring = “ab:c::”;</span><br><span class="line"><span class="comment">#单个字符a         表示选项a没有参数            格式：-a即可，不加参数</span></span><br><span class="line"><span class="comment">#单字符加冒号b:     表示选项b有且必须加参数      格式：-b 100或-b100,但-b=100错</span></span><br><span class="line"><span class="comment">#单字符加2冒号c::   表示选项c可以有，也可以无     格式：-c200，其它格式错误</span></span><br><span class="line"><span class="comment">#getopt处理以'-’开头的命令行参数，如optstring="ab:c::d::",命令行为getopt.exe -a -b host -ckeke -d haha </span></span><br><span class="line"><span class="comment">#在这个命令行参数中，-a是选项元素。host是b的参数，keke是c的参数。但haha并不是d的参数，因为它们中间有空格隔开。</span></span><br><span class="line"><span class="comment">#还要注意的是默认情况下getopt会重新排列命令行参数的顺序，所以到最后所有不包含选项的命令行参数都排到最后。</span></span><br><span class="line"><span class="comment">#-o表示短选项</span></span><br><span class="line"><span class="comment">#--long表示长选项</span></span><br><span class="line"><span class="comment">#"$@"在上面解释过</span></span><br><span class="line"><span class="comment"># -n:出错时的信息</span></span><br><span class="line"><span class="comment"># -- ：举一个例子比较好理解：</span></span><br><span class="line">我们要创建一个名字为 <span class="string">"-f"</span>的目录你会怎么办？</span><br><span class="line">mkdir -f <span class="comment">#不成功，因为-f会被mkdir当作选项来解析，这时就可以使用</span></span><br><span class="line">mkdir -- -f 这样-f就不会被作为选项。</span><br><span class="line"><span class="comment">#下面的例子都是使用的$2</span></span><br><span class="line">举例：</span><br><span class="line">!/bin/bash</span><br><span class="line">TEMP=`getopt -o ab:c:: --long a-long,b-long:,c-long:: \</span><br><span class="line">     -n <span class="string">'example.bash'</span> -- <span class="string">"<span class="variable">$@</span>"</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ $? != 0 ] ; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">"Terminating..."</span> &gt;&amp;2 ; <span class="built_in">exit</span> 1 ; <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#set 会重新排列参数的顺序，也就是改变$1,$2...$n的值，这些值在getopt中重新排列过了</span></span><br><span class="line"><span class="built_in">eval</span> <span class="built_in">set</span> -- <span class="string">"<span class="variable">$TEMP</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#经过getopt的处理，下面处理具体选项。</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> ; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">                -a|--a-long) <span class="built_in">echo</span> <span class="string">"Option a"</span> ; <span class="built_in">shift</span> ;;</span><br><span class="line">                -b|--b-long) <span class="built_in">echo</span> <span class="string">"Option b, argument \`<span class="variable">$2</span>'"</span> ; <span class="built_in">shift</span> 2 ;;</span><br><span class="line">                -c|--c-long)</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">"<span class="variable">$2</span>"</span> <span class="keyword">in</span></span><br><span class="line">                                <span class="string">""</span>) <span class="built_in">echo</span> <span class="string">"Option c, no argument"</span>; <span class="built_in">shift</span> 2 ;;</span><br><span class="line">                                *)  <span class="built_in">echo</span> <span class="string">"Option c, argument \`<span class="variable">$2</span>'"</span> ; <span class="built_in">shift</span> 2 ;;</span><br><span class="line">                        <span class="keyword">esac</span> ;;</span><br><span class="line">                --) <span class="built_in">shift</span> ; <span class="built_in">break</span> ;;</span><br><span class="line">                *) <span class="built_in">echo</span> <span class="string">"Internal error!"</span> ; <span class="built_in">exit</span> 1 ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Remaining arguments:"</span></span><br><span class="line"><span class="keyword">for</span> arg <span class="keyword">do</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">'--&gt; '</span><span class="string">"\`<span class="variable">$arg</span>'"</span> ;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">运行命令：</span><br><span class="line">./getopt.sh -b abc -a -c33 remain</span><br><span class="line">Option b, argument `abc<span class="string">'</span></span><br><span class="line"><span class="string">Option a</span></span><br><span class="line"><span class="string">Option c, argument `33'</span></span><br><span class="line">Remaining arguments:</span><br><span class="line">--&gt; `remain<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">再举一个例子：（安装脚本里面的）</span></span><br><span class="line"><span class="string">function parse()</span></span><br><span class="line"><span class="string">&#123;"</span></span><br><span class="line"><span class="string">    RET=`getopt -o ht:e: \</span></span><br><span class="line"><span class="string">                --long help,type:,env: \</span></span><br><span class="line"><span class="string">                -n "ERROR" -- "$@"`</span></span><br><span class="line"><span class="string">    if [ $? -ne 0 ]</span></span><br><span class="line"><span class="string">    then</span></span><br><span class="line"><span class="string">        usage</span></span><br><span class="line"><span class="string">        exit 0</span></span><br><span class="line"><span class="string">    fi</span></span><br><span class="line"><span class="string">    eval set -- "$RET"</span></span><br><span class="line"><span class="string">    while true</span></span><br><span class="line"><span class="string">    do</span></span><br><span class="line"><span class="string">        case "$1" in</span></span><br><span class="line"><span class="string">            -h|--help)</span></span><br><span class="line"><span class="string">                usage</span></span><br><span class="line"><span class="string">                exit 0</span></span><br><span class="line"><span class="string">                ;;</span></span><br><span class="line"><span class="string">            -t|--type)</span></span><br><span class="line"><span class="string">                TYPE=$2</span></span><br><span class="line"><span class="string">                shift 2</span></span><br><span class="line"><span class="string">                ;;</span></span><br><span class="line"><span class="string">            -e|--env)</span></span><br><span class="line"><span class="string">                ENV=$2</span></span><br><span class="line"><span class="string">                shift 2</span></span><br><span class="line"><span class="string">                ;;</span></span><br><span class="line"><span class="string">            --)</span></span><br><span class="line"><span class="string">                shift</span></span><br><span class="line"><span class="string">                break</span></span><br><span class="line"><span class="string">                ;;</span></span><br><span class="line"><span class="string">            *)</span></span><br><span class="line"><span class="string">                usage</span></span><br><span class="line"><span class="string">                exit 0</span></span><br><span class="line"><span class="string">                ;;</span></span><br><span class="line"><span class="string">        esac</span></span><br><span class="line"><span class="string">    done</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/f-ck-need-u/p/7426371.html</span><br><span class="line">使用示例来说明：</span><br><span class="line">[root@xuexi ~]<span class="comment"># a=24;name='long$a'     # 注意，使用的是单引号，禁止$a被扩展</span></span><br><span class="line">如果直接执行 <span class="built_in">echo</span> <span class="variable">$name</span> ，则结果为<span class="string">"long<span class="variable">$a</span>"</span>，但如果执行 <span class="built_in">eval</span> <span class="built_in">echo</span> <span class="variable">$name</span> ，结果将是<span class="string">"long24"</span>。</span><br><span class="line">[root@xuexi ~]<span class="comment"># eval echo $name</span></span><br><span class="line">long24</span><br></pre></td></tr></table></figure>

<h1 id="exit"><a href="#exit" class="headerlink" title="exit"></a>exit</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">exit</span>（<span class="number">0</span>）：正常运行程序并退出程序；</span><br><span class="line"><span class="keyword">exit</span>（<span class="number">1</span>）：非正常运行导致退出程序；</span><br></pre></td></tr></table></figure>
<h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/sco1234/p/8906527.html</span><br><span class="line">1、数组定义</span><br><span class="line">1.1 <span class="built_in">declare</span>定义</span><br><span class="line">使用<span class="built_in">declare</span> -a 命令定义数组（数组的索引是从0开始计数的），接下来就可以通过[]操作符为不同索引位置的元素赋值。</span><br><span class="line"><span class="built_in">declare</span> -a names</span><br><span class="line">names[0]=tom</span><br><span class="line">names[1]=jack</span><br><span class="line">注意：shell变量是弱类型的，比要求数组中元素类型相同</span><br><span class="line">在定义数组的同时，可以同时赋值，用()表示，各元素之间用空格隔开</span><br><span class="line"><span class="comment">#定义的同时直接赋值</span></span><br><span class="line"><span class="built_in">declare</span> -a names=(tom jack)</span><br><span class="line"><span class="comment">#增加元素</span></span><br><span class="line">names[2]=sue</span><br><span class="line">1.2直接定义</span><br><span class="line">创建数组最简单的方法是使用()直接定义数组，括号中元素用空格隔开；在括号中也可以声明下标。实例：</span><br><span class="line"><span class="comment">#使用()直接数组</span></span><br><span class="line">days1=(one two three four five)</span><br><span class="line"><span class="comment">#或者在()中声明下标，默认从0开始</span></span><br><span class="line">days2=([0]=’one’ [1]=’two’ [2]=’three’ [3]=’four’)</span><br><span class="line"><span class="comment">#下标可以不连续</span></span><br><span class="line">days3=([0]=’one’ [2]=’three’)</span><br><span class="line">1.3带下标定义</span><br><span class="line">使用[]操作符，为每一个指定下标赋值，下标也可以不连续</span><br><span class="line">header[0]=’user’</span><br><span class="line">header[1]=’pid’</span><br><span class="line">header[2]=’%CPU’</span><br><span class="line">header[3]=’%MEM’</span><br><span class="line">1.4从文件读取数组</span><br><span class="line">days=(`cat days.txt`)</span><br><span class="line">2、数组操作</span><br><span class="line">2.1赋值</span><br><span class="line">指定下标，使用[]操作符为元素赋值，当下标不存在时，相当于为数组增加元素</span><br><span class="line"><span class="built_in">declare</span> -a names</span><br><span class="line">names[0]=tom</span><br><span class="line">2.2取值</span><br><span class="line">指定下标，使用[]操作符从数组中对应元素，然后使用$取值，格式：<span class="variable">$&#123;数组名[索引]&#125;</span></span><br><span class="line">days=(one two three four five)</span><br><span class="line"><span class="comment">#取出第1个元素</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;days[0]&#125;</span></span><br><span class="line"><span class="comment">#取出第3个元素</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;days[2]&#125;</span></span><br><span class="line">获得数组中所有值：<span class="variable">$&#123;数组名[@]&#125;</span>、<span class="variable">$&#123;数组名[*]&#125;</span></span><br><span class="line"><span class="variable">$&#123;数组名[@]&#125;</span>得到是以空格隔开的元素，可以用在数组遍历中；<span class="variable">$&#123;数组名[*]&#125;</span>得到的是一整个字符串。</span><br><span class="line">注意：<span class="variable">$&#123;数组名&#125;</span>并不会获得所有值，它只会获得到第一个元素的值。即<span class="variable">$&#123;数组名&#125;</span>等价于<span class="variable">$&#123;数组名[0]&#125;</span></span><br><span class="line">示例：</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#数组取值</span></span><br><span class="line"></span><br><span class="line">days=(one two three four)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;days&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;days[0]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;days[1]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;days[@]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;days[*]&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"**********"</span></span><br><span class="line">names=()</span><br><span class="line">names[1]=tom</span><br><span class="line">names[2]=jack</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;names&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;names[1]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;names[@]&#125;</span></span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line"> </span><br><span class="line">2.3长度</span><br><span class="line">利用”@”或“*”字符，将数组扩展成列表，然后使用”<span class="comment">#”来获取数组元素的个数。</span></span><br><span class="line">示例：</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#数组个数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">days=(one two three four)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"数组days的元素个数为：<span class="variable">$&#123;#days[@]&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"**********"</span></span><br><span class="line"></span><br><span class="line">names=()</span><br><span class="line"></span><br><span class="line">names[1]=tom</span><br><span class="line"></span><br><span class="line">names[2]=jack</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"数组names的元素个数为：<span class="variable">$&#123;#names[*]&#125;</span>"</span></span><br><span class="line">结果：</span><br><span class="line"></span><br><span class="line">注意：如果某个元素是字符串，可以通过制定索引的方式获得该元素的长度。</span><br><span class="line">2.4遍历</span><br><span class="line">存在以下三种方式：</span><br><span class="line">（1）<span class="variable">$&#123;数组名[@]&#125;</span>、<span class="variable">$&#123;数组名[@]&#125;</span>均可以获得所有元素（不管是元素列表，还是一整个字符串），使用<span class="keyword">for</span>循环遍历即可</span><br><span class="line">（2）带数组下标的遍历，当需要使用到数组的下标时，可以使用<span class="variable">$&#123;!数组名[@]&#125;</span></span><br><span class="line">（3）<span class="keyword">while</span>循环：根据元素的个数遍历，但对于稀疏数组，可能会丢失数据</span><br><span class="line">示例：</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#数组遍历</span></span><br><span class="line"></span><br><span class="line">days=(one two three four)</span><br><span class="line"><span class="comment">#for循环遍历</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> day <span class="keyword">in</span> <span class="variable">$&#123;days[*]&#125;</span>  <span class="comment">#或$&#123;days[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$day</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"***************"</span></span><br><span class="line"><span class="comment">#fou循环带下标遍历</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;!days[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$&#123;days[$i]&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"***************"</span></span><br><span class="line"><span class="comment">#while循环</span></span><br><span class="line">names=()   <span class="comment">#数组names是一个稀疏数组</span></span><br><span class="line">names[1]=tom</span><br><span class="line">names[2]=jack</span><br><span class="line">i=0</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -lt <span class="variable">$&#123;#names[*]&#125;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$&#123;names[$i]&#125;</span></span><br><span class="line">        <span class="built_in">let</span> i++</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">结果：</span><br><span class="line"></span><br><span class="line">2.5删除</span><br><span class="line">删除一个数组或数组中元素用<span class="built_in">unset</span>命令。</span><br><span class="line"><span class="built_in">unset</span> 数组名[索引]      <span class="comment">#删除索引下的元素</span></span><br><span class="line"><span class="built_in">unset</span> 数组名         <span class="comment">#删除整个数组</span></span><br><span class="line"></span><br><span class="line">2.6连接</span><br><span class="line">用()将多个数组连接在一起，()中各个数组用空格隔开。</span><br><span class="line">days=(one two three four)</span><br><span class="line">names=(tom jack)</span><br><span class="line">days=(<span class="variable">$&#123;days[@]&#125;</span> <span class="variable">$&#123;names[@]&#125;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1. 单行注释</span><br><span class="line"><span class="comment"># echo "ni"</span></span><br><span class="line"></span><br><span class="line">2. 多行注释：</span><br><span class="line">法一：</span><br><span class="line">: &lt;&lt; !</span><br><span class="line">语句</span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">例如：</span><br><span class="line">linux101:/home/wsj <span class="comment"># more dian</span></span><br><span class="line"><span class="meta">#!/bin/ksh</span></span><br><span class="line">:&lt;&lt;!</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"ni"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"ni"</span></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">法二：</span><br><span class="line">: <span class="string">'</span></span><br><span class="line"><span class="string">语句</span></span><br><span class="line"><span class="string">'</span></span><br><span class="line"></span><br><span class="line">例如：</span><br><span class="line">linux101:/home/wsj <span class="comment"># more dian</span></span><br><span class="line"><span class="meta">#!/bin/ksh</span></span><br><span class="line">: <span class="string">'</span></span><br><span class="line"><span class="string">echo "ni"</span></span><br><span class="line"><span class="string">echo "ni"</span></span><br><span class="line"><span class="string">'</span></span><br></pre></td></tr></table></figure>
<h1 id="ssh到另一台设备执行命令"><a href="#ssh到另一台设备执行命令" class="headerlink" title="ssh到另一台设备执行命令"></a>ssh到另一台设备执行命令</h1><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssh</span> root<span class="variable">@ceph2</span> <span class="string">"cd /home;mkdir 123"</span></span><br></pre></td></tr></table></figure>

<h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">https://www.runoob.com/linux/linux-shell-basic-operators.html</span><br><span class="line"></span><br><span class="line">%：整除</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">sum=0</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> `seq 1 300`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="keyword">if</span> [ $((<span class="variable">$a</span>%4)) = <span class="string">'0'</span> ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">let</span> sum=<span class="variable">$sum</span>+<span class="variable">$a</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$sum</span></span><br></pre></td></tr></table></figure>

<h1 id="nohup"><a href="#nohup" class="headerlink" title="nohup"></a>nohup</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup ./start.sh &gt;output <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br></pre></td></tr></table></figure>

<h1 id="nohup免enter"><a href="#nohup免enter" class="headerlink" title="nohup免enter"></a>nohup免enter</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">str=$<span class="string">"\n"</span></span><br><span class="line">nohup hadoop jar analysis_v4_test_args.jar -1 8 8 &gt;/dev/null 1&gt;logs&amp;</span><br><span class="line">sstr=$(<span class="built_in">echo</span> -e <span class="variable">$str</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$sstr</span></span><br><span class="line">tail -20 logs</span><br></pre></td></tr></table></figure>

<h1 id="timeout"><a href="#timeout" class="headerlink" title="timeout"></a>timeout</h1><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果该命令长时间没有执行结束，则自动停止</span><br><span class="line"><span class="keyword">timeout</span> <span class="number">60</span> ./<span class="built_in">run</span>.sh</span><br></pre></td></tr></table></figure>

<h1 id="for：循环"><a href="#for：循环" class="headerlink" title="for：循环"></a>for：循环</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>循环：</span><br><span class="line"><span class="keyword">for</span>((i=1;i&lt;=10;i++));  </span><br><span class="line"><span class="keyword">do</span>   </span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$i</span>;  </span><br><span class="line"><span class="keyword">done</span> </span><br><span class="line"><span class="keyword">for</span>死循环：</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> i=0</span><br><span class="line"><span class="built_in">set</span> j=0</span><br><span class="line"><span class="keyword">for</span>((i=0;i&lt;10;))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="built_in">let</span> <span class="string">"j=j+1"</span></span><br><span class="line">        <span class="built_in">echo</span>  <span class="variable">$j</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (( i=1, j=7; i&lt;5 &amp;&amp; j &gt;3; i++, j-- ))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"i <span class="variable">$i</span>, j <span class="variable">$j</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">第一类：数字性循环</span><br><span class="line">-----------------------------</span><br><span class="line">for1-1.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span>((i=1;i&lt;=10;i++));</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">	<span class="built_in">echo</span> $(expr <span class="variable">$i</span> \* 3 + 1);</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">-----------------------------</span><br><span class="line">for1-2.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 10)</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">	<span class="built_in">echo</span> $(expr <span class="variable">$i</span> \* 3 + 1);</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">-----------------------------</span><br><span class="line">for1-3.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> $(expr <span class="variable">$i</span> \* 3 + 1);</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">-----------------------------</span><br><span class="line">for1-4.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;for(i=1; i&lt;=10; i++) print i&#125;'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">第二类：字符性循环</span><br><span class="line">-----------------------------</span><br><span class="line">for2-1.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">list=<span class="string">"rootfs usr data data2"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$list</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$i</span> is appoint ;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">-----------------------------</span><br><span class="line">for2-2.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $* ;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$i</span> is input chart\! ;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">-----------------------------</span><br><span class="line">for2-3.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f1 f2 f3 ;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$i</span> is appoint ;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">-----------------------------</span><br><span class="line">for2-4.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">list=<span class="string">"rootfs usr data data2"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$list</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$i</span> is appoint ;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">第三类：路径查找</span><br><span class="line">-----------------------------</span><br><span class="line">for3-1.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> /proc/*;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$file</span> is file path \! ;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">-----------------------------</span><br><span class="line">for3-2.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> $(ls *.sh)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$file</span> is file path \! ;</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h1 id="if：判断"><a href="#if：判断" class="headerlink" title="if：判断"></a>if：判断</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">-gt 等只能判断整数：</span><br><span class="line">小数：</span><br><span class="line">https://blog.csdn.net/david__peng/article/details/82980288</span><br><span class="line">前言</span><br><span class="line">用于数值比较的无非大于、小于、等于、大于等于、小于等于这几个。</span><br><span class="line"></span><br><span class="line">比较格式： [ 数值1 比较符 数值2 ] 注意左边的括号与数值1之间有一个空格，同样，数值2和右边的括号之间也有空格。</span><br><span class="line"></span><br><span class="line">数值比较运算符对应下面几个：</span><br><span class="line">-eq 判断相等，相等返回<span class="literal">true</span>，否则返回<span class="literal">false</span></span><br><span class="line">-ne 判断是否不相等，不相等返回<span class="literal">true</span>，否则返回<span class="literal">false</span></span><br><span class="line">-gt 判断左边是否大于右边的值，大于则返回<span class="literal">true</span>，否则返回<span class="literal">false</span></span><br><span class="line">-lt 判断左边是否小于右边的值，小于则返回<span class="literal">true</span>，否则返回<span class="literal">false</span></span><br><span class="line">-ge 判断左边是否大于或等于右边的值，大于则返回<span class="literal">true</span>，否则返回<span class="literal">false</span></span><br><span class="line">-le 判断左边是否小于右边的值，小于则返回<span class="literal">true</span>，否则返回<span class="literal">false</span></span><br><span class="line"></span><br><span class="line">小数的比较</span><br><span class="line">1.shell中 可以用 bc 对小数进行运算</span><br><span class="line"><span class="comment">#echo 5.5+1.1 | bc</span></span><br><span class="line">6.6</span><br><span class="line"></span><br><span class="line">2.使用，awk判断小数点后的位数</span><br><span class="line">num=6.6666;<span class="built_in">echo</span> <span class="variable">$num</span> | awk <span class="string">'BEGIN&#123;FS="."&#125;&#123;printlength($2)&#125;'</span></span><br><span class="line"></span><br><span class="line">3.直接使用awk比较大小</span><br><span class="line">awk -v num1=6.6 -v num2=5.5<span class="string">'BEGIN&#123;print(num1&gt;num2)?"0":"1"&#125;'</span></span><br><span class="line">如果num1&gt;num2打印输出0，否则输出1</span><br><span class="line"></span><br><span class="line">4.使用expr，返回1表示a&gt; a&amp;gt;a&gt;b, 0表示a&amp;lt; a&amp;lt;a&lt;b</span><br><span class="line">a=6.6 b=5.5;expr <span class="variable">$a</span> &gt; <span class="variable">$b</span></span><br><span class="line"></span><br><span class="line">5.使用br</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"6.6&gt;5.5"</span> |br</span><br><span class="line"></span><br><span class="line">linux shell 中小数进行比较</span><br><span class="line"><span class="keyword">if</span> [ `expr <span class="variable">$a</span> \&gt; <span class="variable">$b</span>` -eq 0 ];<span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="variable">$b</span> is bigger</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$a</span> is bigger</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">shell脚本报错：<span class="string">"[: =: unary operator expected"</span>解决办法</span><br><span class="line">https://www.jb51.net/article/107710.htm</span><br><span class="line">在匹配字符串相等时，我用了类似这样的语句：</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$STATUS</span> == <span class="string">"OK"</span> ]; <span class="keyword">then</span>  </span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"OK"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">在运行时出现了 [: =: unary operator expected 的错误，就一直找不到原因，尝试了删除等号两侧的空格和括号里的空格都不管用，最后baidu了一下，才找到原因。把语句改成这样就不会出错了.</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$STATUS</span> = <span class="string">"OK"</span> ]]; </span><br><span class="line"><span class="keyword">then</span>  </span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"OK"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">字符串比较：</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$port</span> -eq 1 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">return</span> 0</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">return</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#判断字符串是否相等</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$A</span>"</span> = <span class="string">"<span class="variable">$B</span>"</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[ = ]"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#判断字符串是否相等，与上面的=等价</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$A</span>"</span> == <span class="string">"<span class="variable">$B</span>"</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[ == ]"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注意:==的功能在[[]]和[]中的行为是不同的，如下</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果$A以”a”开头(模式匹配)那么将为true </span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">"<span class="variable">$A</span>"</span> == a* ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[[ ==a* ]]"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果$A等于a*(字符匹配),那么结果为true</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">"<span class="variable">$A</span>"</span> == <span class="string">"a*"</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"==/"</span>a*/<span class="string">""</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#字符串不相等</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$A</span>"</span> != <span class="string">"<span class="variable">$B</span>"</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[ != ]"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#字符串不相等</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">"<span class="variable">$A</span>"</span> != <span class="string">"<span class="variable">$B</span>"</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[[ != ]]"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#字符串不为空，长度不为0</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$A</span>"</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[ -n ]"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#字符串为空.就是长度为0.</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$A</span>"</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[ -z ]"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#需要转义&lt;，否则认为是一个重定向符号</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$A</span> /&lt; <span class="variable">$B</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[ &lt; ]"</span>  </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$A</span> &lt; <span class="variable">$B</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[[ &lt; ]]"</span>  </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#需要转义&gt;，否则认为是一个重定向符号</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$A</span> /&gt; <span class="variable">$B</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[ &gt; ]"</span>  </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$A</span> &gt; <span class="variable">$B</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[[ &gt; ]]"</span>  </span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>


<h1 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">$ cat test4.sh </span><br><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"></span><br><span class="line">all_num=10<span class="comment"># 任务总数</span></span><br><span class="line">thread_num=5<span class="comment"># 设置并发的进程数</span></span><br><span class="line"></span><br><span class="line">a=$(date +%H%M%S)</span><br><span class="line"></span><br><span class="line"><span class="comment"># mkfifo</span></span><br><span class="line">tempfifo=<span class="string">"my_temp_fifo"</span></span><br><span class="line">mkfifo <span class="variable">$&#123;tempfifo&#125;</span></span><br><span class="line"><span class="comment"># 使文件描述符为非阻塞式</span></span><br><span class="line"><span class="built_in">exec</span> 6&lt;&gt;<span class="variable">$&#123;tempfifo&#125;</span><span class="comment">#将fd6指向fifo类型</span></span><br><span class="line">rm -f <span class="variable">$&#123;tempfifo&#125;</span><span class="comment">#删也可以</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#根据线程总数量设置令牌个数</span></span><br><span class="line"><span class="keyword">for</span> ((i=1;i&lt;=<span class="variable">$&#123;thread_num&#125;</span>;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">echo</span> </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">done</span> &gt;&amp;6 </span><br><span class="line"></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> `seq 1 <span class="variable">$&#123;all_num&#125;</span>`<span class="comment">#任务数量</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="comment"># 一个read -u6命令执行一次，就从fd6中减去一个回车符，然后向下执行，</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># fd6中没有回车符的时候，就停在这了，从而实现了线程数量控制</span></span><br><span class="line">    <span class="built_in">read</span> -u6</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">#可以把具体的需要执行的命令封装成一个函数</span></span><br><span class="line">        sleep 1</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$&#123;num&#125;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">""</span> &gt;&amp;6    <span class="comment">#当进程结束以后，再向fd6中加上一个回车符，即补上了read -u6减去的那个</span></span><br><span class="line">    &#125; &amp; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">done</span> </span><br><span class="line"></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">exec</span> 6&gt;&amp;-<span class="comment">#关闭fd6管道</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line">b=$(date +%H%M%S)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"startTime:\t<span class="variable">$a</span>"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"endTime:\t<span class="variable">$b</span>"</span></span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">$ sh test4.sh </span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">startTime:  195227</span><br><span class="line">endTime:    195229</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@ns_10.2.1.242 <span class="built_in">test</span>]$ cat p3.sh </span><br><span class="line"><span class="meta">#!bash</span></span><br><span class="line"><span class="comment"># 2014-12-5</span></span><br><span class="line"><span class="comment"># --------------------</span></span><br><span class="line"><span class="comment">#  此例子说明了一种用wait、read命令模拟多线程的一种技巧</span></span><br><span class="line"><span class="comment">#  此技巧往往用于多主机检查，比如ssh登录、ping等等这种单进程比较慢而不耗费cpu的情况</span></span><br><span class="line"><span class="comment"># -------------------------</span></span><br><span class="line"><span class="function"><span class="title">operation</span></span>()&#123;</span><br><span class="line">    sleep <span class="variable">$1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tmp_fifofile=/tmp/$$.fifo</span><br><span class="line"><span class="comment">#echo $tmp_fifofile</span></span><br><span class="line"></span><br><span class="line">mkfifo <span class="variable">$tmp_fifofile</span> <span class="comment"># 新建一个fifo的管道文件</span></span><br><span class="line"><span class="built_in">exec</span> 6&lt;&gt;<span class="variable">$tmp_fifofile</span> <span class="comment"># 绑定fd6</span></span><br><span class="line">rm <span class="variable">$tmp_fifofile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里是向管道添加了$thread个空行</span></span><br><span class="line">THREAD=3 <span class="comment"># 线程数，可以改变</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 0 <span class="variable">$THREAD</span>);<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span> &gt;&amp;6</span><br><span class="line"></span><br><span class="line">CONFIG_FILE=config.txt</span><br><span class="line"><span class="comment"># 修改这个脚本到生成环境，主要是修改operation和CONFIG_FILE配置</span></span><br><span class="line"><span class="comment"># 每次读取一行数据</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="comment"># 一个read -u6命令执行一次，就从fd6中减去一个回车符，然后向下执行，</span></span><br><span class="line">    <span class="comment"># fd6 中没有回车符的时候，就停在这了，从而实现了线程数量控制</span></span><br><span class="line">    <span class="built_in">read</span> -u6</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">       <span class="comment"># 操作成功，记录到成功日志,修改echo</span></span><br><span class="line">       <span class="comment"># 操作失败，记录到错误日志</span></span><br><span class="line">       operation  <span class="variable">$line</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">" <span class="variable">$line</span> success"</span> || <span class="built_in">echo</span> <span class="string">"<span class="variable">$line</span> error"</span></span><br><span class="line">    </span><br><span class="line">       <span class="comment"># 当进程结束以后，再向fd6中加上一个回车符，即补上了read -u6减去的那个</span></span><br><span class="line">       <span class="built_in">echo</span>  &gt;&amp;6</span><br><span class="line">    &#125; &amp; <span class="comment"># 后台执行，这里的 &amp;是非常重要的，同时有$THREAD个后台进程 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$&#123;CONFIG_FILE&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">wait</span> <span class="comment"># 等待所有的后台子进程结束</span></span><br><span class="line"><span class="built_in">exec</span> 6&gt;&amp;- <span class="comment"># 关闭df6</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">shell 中用管道模拟多线程</span><br><span class="line">这里以两个例子来对比多线程和单进程</span><br><span class="line">单线程的例子</span><br><span class="line"># config.txt在这个例子和多线程的例子中都会用到</span><br><span class="line">[<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ cat config.txt </span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 下面的代码，是从config.txt中读取配置，然后sleep一定时间，然后打印sleep 的时间长度,</span><br><span class="line"># 注意 <span class="keyword">while</span>从文本读取数据，是逐行读取的</span><br><span class="line">[<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ cat <span class="keyword">while</span>.sh </span><br><span class="line"><span class="keyword">while</span> read line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    sleep $line &amp;&amp; echo <span class="string">"$line success"</span></span><br><span class="line">done &lt; config.txt</span><br><span class="line"></span><br><span class="line"># 这个脚本，消耗了<span class="number">20</span>秒，结果如下：</span><br><span class="line">[<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ time sh <span class="keyword">while</span>.sh</span><br><span class="line"><span class="number">1</span> success</span><br><span class="line"><span class="number">2</span> success</span><br><span class="line"><span class="number">3</span> success</span><br><span class="line"><span class="number">4</span> success</span><br><span class="line"><span class="number">1</span> success</span><br><span class="line"><span class="number">2</span> success</span><br><span class="line"><span class="number">3</span> success</span><br><span class="line"><span class="number">4</span> success</span><br><span class="line"></span><br><span class="line">real    <span class="number">0</span>m20<span class="number">.011</span>s</span><br><span class="line">user    <span class="number">0</span>m0<span class="number">.000</span>s</span><br><span class="line">sys     <span class="number">0</span>m0<span class="number">.004</span>s</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">多线程的例子：</span><br><span class="line"># config.txt在这个例子和多线程的例子中都会用到</span><br><span class="line">[<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ cat config.txt </span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多线程的代码，如下</span></span><br><span class="line">[root@ns_10.2.1.242 <span class="built_in">test</span>]$ cat p3.sh </span><br><span class="line"><span class="meta">#!bash</span></span><br><span class="line"><span class="comment"># 2014-12-5</span></span><br><span class="line"><span class="comment"># --------------------</span></span><br><span class="line"><span class="comment">#  此例子说明了一种用wait、read命令模拟多线程的一种技巧</span></span><br><span class="line"><span class="comment">#  此技巧往往用于多主机检查，比如ssh登录、ping等等这种单进程比较慢而不耗费cpu的情况</span></span><br><span class="line"><span class="comment"># -------------------------</span></span><br><span class="line"><span class="function"><span class="title">operation</span></span>()&#123;</span><br><span class="line">    sleep <span class="variable">$1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tmp_fifofile=/tmp/$$.fifo</span><br><span class="line"><span class="comment">#echo $tmp_fifofile</span></span><br><span class="line"></span><br><span class="line">mkfifo <span class="variable">$tmp_fifofile</span> <span class="comment"># 新建一个fifo的管道文件</span></span><br><span class="line"><span class="built_in">exec</span> 6&lt;&gt;<span class="variable">$tmp_fifofile</span> <span class="comment"># 绑定fd6</span></span><br><span class="line">rm <span class="variable">$tmp_fifofile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里是向管道添加了$thread个空行</span></span><br><span class="line">THREAD=3 <span class="comment"># 线程数，可以改变</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 0 <span class="variable">$THREAD</span>);<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span> &gt;&amp;6</span><br><span class="line"></span><br><span class="line">CONFIG_FILE=config.txt</span><br><span class="line"><span class="comment"># 修改这个脚本到生成环境，主要是修改operation和CONFIG_FILE配置</span></span><br><span class="line"><span class="comment"># 每次读取一行数据</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="comment"># 一个read -u6命令执行一次，就从fd6中减去一个回车符，然后向下执行，</span></span><br><span class="line">    <span class="comment"># fd6 中没有回车符的时候，就停在这了，从而实现了线程数量控制</span></span><br><span class="line">    <span class="built_in">read</span> -u6</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">       <span class="comment"># 操作成功，记录到成功日志,修改echo</span></span><br><span class="line">       <span class="comment"># 操作失败，记录到错误日志</span></span><br><span class="line">       operation  <span class="variable">$line</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">" <span class="variable">$line</span> success"</span> || <span class="built_in">echo</span> <span class="string">"<span class="variable">$line</span> error"</span></span><br><span class="line">    </span><br><span class="line">       <span class="comment"># 当进程结束以后，再向fd6中加上一个回车符，即补上了read -u6减去的那个</span></span><br><span class="line">       <span class="built_in">echo</span>  &gt;&amp;6</span><br><span class="line">    &#125; &amp; <span class="comment"># 后台执行，这里的 &amp;是非常重要的，同时有$THREAD个后台进程 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$&#123;CONFIG_FILE&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">wait</span> <span class="comment"># 等待所有的后台子进程结束</span></span><br><span class="line"><span class="built_in">exec</span> 6&gt;&amp;- <span class="comment"># 关闭df6</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 脚本的结果，执行了7秒</span></span><br><span class="line">[root@ns_10.2.1.242 <span class="built_in">test</span>]$ time sh p3.sh </span><br><span class="line"> 1 success</span><br><span class="line"> 2 success</span><br><span class="line"> 1 success</span><br><span class="line"> 3 success</span><br><span class="line"> 4 success</span><br><span class="line"> 2 success</span><br><span class="line"> 3 success</span><br><span class="line"> 4 success</span><br><span class="line"></span><br><span class="line">real    0m7.007s</span><br><span class="line">user    0m0.000s</span><br><span class="line">sys     0m0.003s</span><br><span class="line">[root@ns_10.2.1.242 <span class="built_in">test</span>]$</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">另外一个 命名管道基础的文章</span><br><span class="line">多进程脚本中需要注意的知识点，有<span class="number">3</span>个</span><br><span class="line"><span class="number">1.</span><span class="keyword">while</span>读取文件</span><br><span class="line"><span class="keyword">while</span> read line </span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">         echo $line </span><br><span class="line">done &lt; config.txt</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>管道的绑定， exec <span class="number">6</span>&lt;&gt;$tmp_fifofile 和 向管道写数据 echo &gt;&amp;<span class="number">6</span></span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ mkfifo testfifo</span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ exec  <span class="number">6</span>&lt;&gt;testfifo </span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ echo <span class="number">1</span> &gt;&amp;<span class="number">6</span>   </span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ cat testfifo </span><br><span class="line"> <span class="number">1</span></span><br><span class="line">#注意，进程会卡死的</span><br><span class="line"></span><br><span class="line"> # 没有&amp; 符号，是创建了文件名为<span class="number">6</span>的文件，然后把<span class="number">1</span> 输出问文件名为<span class="number">6</span>的文件</span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ echo <span class="number">1</span> &gt;<span class="number">6</span></span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ cat <span class="number">6</span>    </span><br><span class="line"> <span class="number">1</span></span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ ls -alh <span class="number">6</span></span><br><span class="line"> -rw-r--r--. <span class="number">1</span> root root <span class="number">2</span> Jan <span class="number">22</span> <span class="number">20</span>:<span class="number">26</span> <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>read -u6</span><br><span class="line">  read </span><br><span class="line">     -u Read input <span class="keyword">from</span> file descriptor fd(从文件描述符读取输入)</span><br><span class="line"></span><br><span class="line"> read 读取一行，向管道写n行，就可以读取n次，n+<span class="number">1</span>会堵塞</span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ mkfifo testfifo</span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ exec  <span class="number">6</span>&lt;&gt;testfifo </span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ echo <span class="number">1</span> &gt;&amp;<span class="number">6</span>   </span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ echo <span class="number">1</span> &gt;&amp;<span class="number">6</span></span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ echo <span class="number">1</span> &gt;&amp;<span class="number">6</span></span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ read -u6</span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ read -u6</span><br><span class="line"> [<span class="symbol">root@</span>ns_10<span class="number">.2</span><span class="number">.1</span><span class="number">.242</span> test]$ read -u6</span><br><span class="line">注意:</span><br><span class="line">多线程脚本应用在真实环境的时候，只需要修改CONFIG_FILE和operation函数</span><br><span class="line">THREAD控制线程数量</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line">情景</span><br><span class="line">shell脚本的执行效率虽高，但当任务量巨大时仍然需要较长的时间，尤其是需要执行一大批的命令时。因为默认情况下，shell脚本中的命令是串行执行的。如果这些命令相互之间是独立的，则可以使用“并发”的方式执行这些命令，这样可以更好地利用系统资源，提升运行效率，缩短脚本执行的时间。如果命令相互之间存在交互，则情况就复杂了，那么不建议使用shell脚本来完成多线程的实现。</span><br><span class="line">为了方便阐述，使用一段测试代码。在这段代码中，通过seq命令输出<span class="number">1</span>到<span class="number">10</span>，使用<span class="keyword">for</span>...<span class="keyword">in</span>语句产生一个执行<span class="number">10</span>次的循环。每一次循环都执行sleep <span class="number">1</span>，并echo出当前循环对应的数字。</span><br><span class="line">注意：</span><br><span class="line">真实的使用场景下，循环次数不一定等于<span class="number">10</span>，或高或低，具体取决于实际的需求。</span><br><span class="line">真实的使用场景下，循环体内执行的语句往往比较耗费系统资源，或比较耗时等。</span><br><span class="line"></span><br><span class="line">请根据真实场景的各种情况理解本文想要表达的内容。</span><br><span class="line">$ cat test1.sh  </span><br><span class="line">#/bin/bash</span><br><span class="line">all_num=<span class="number">10</span></span><br><span class="line">a=$(date +%H%M%S)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> `seq <span class="number">1</span> $&#123;all_num&#125;`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    sleep <span class="number">1</span></span><br><span class="line">    echo $&#123;num&#125;</span><br><span class="line">done</span><br><span class="line">b=$(date +%H%M%S)</span><br><span class="line">echo -e <span class="string">"startTime:\t$a"</span></span><br><span class="line">echo -e <span class="string">"endTime:\t$b"</span></span><br><span class="line"></span><br><span class="line">通过上述代码可知，为了体现执行的时间，将循环体开始前后的时间打印了出来。</span><br><span class="line">运行结果：</span><br><span class="line">$ sh test1.sh </span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line">startTime:  <span class="number">193649</span></span><br><span class="line">endTime:    <span class="number">193659</span></span><br><span class="line"><span class="number">10</span>次循环，每次sleep <span class="number">1</span>秒，所以总执行时间<span class="number">10</span>s。</span><br><span class="line"></span><br><span class="line">方案<span class="number">1</span>：使用<span class="string">"&amp;"</span>使命令后台运行</span><br><span class="line">在linux中，在命令的末尾加上&amp;符号，则表示该命令将在后台执行，这样后面的命令不用等待前面的命令执行完就可以开始执行了。示例中的循环体内有多条命令，则可以以&#123;&#125;括起来，在大括号后面添加&amp;符号。</span><br><span class="line">$ cat test2.sh </span><br><span class="line">#/bin/bash</span><br><span class="line">all_num=<span class="number">10</span></span><br><span class="line">a=$(date +%H%M%S)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> `seq <span class="number">1</span> $&#123;all_num&#125;`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    sleep <span class="number">1</span></span><br><span class="line">    echo $&#123;num&#125;</span><br><span class="line">&#125; &amp;</span><br><span class="line">done</span><br><span class="line">b=$(date +%H%M%S)</span><br><span class="line"></span><br><span class="line">echo -e <span class="string">"startTime:\t$a"</span></span><br><span class="line">echo -e <span class="string">"endTime:\t$b"</span></span><br><span class="line">运行结果：</span><br><span class="line">sh test2.sh </span><br><span class="line">startTime:  <span class="number">194147</span></span><br><span class="line">endTime:    <span class="number">194147</span></span><br><span class="line">[j-<span class="symbol">tester@</span>merger142 ~/bin/multiple_process]$ <span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"></span><br><span class="line">通过结果可知，程序没有先打印数字，而是直接输出了开始和结束时间，然后显示出了命令提示符[j-<span class="symbol">tester@</span>merger142 ~/bin/multiple_process]$（出现命令提示符表示脚本已运行完毕），然后才是数字的输出。这是因为循环体内的命令全部进入后台，所以均在sleep了<span class="number">1</span>秒以后输出了数字。开始和结束时间相同，即循环体的执行时间不到<span class="number">1</span>秒钟，这是由于循环体在后台执行，没有占用脚本主进程的时间。</span><br><span class="line"></span><br><span class="line">方案<span class="number">2</span>：命令后台运行+wait命令</span><br><span class="line">解决上面的问题，只需要在上述循环体的done语句后面加上wait命令，该命令等待当前脚本进程下的子进程结束，再运行后面的语句。</span><br><span class="line">$ cat test3.sh </span><br><span class="line">#/bin/bash</span><br><span class="line">all_num=<span class="number">10</span></span><br><span class="line">a=$(date +%H%M%S)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> `seq <span class="number">1</span> $&#123;all_num&#125;`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    sleep <span class="number">1</span></span><br><span class="line">    echo $&#123;num&#125;</span><br><span class="line">&#125; &amp;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">wait</span><br><span class="line"></span><br><span class="line">b=$(date +%H%M%S)</span><br><span class="line"></span><br><span class="line">echo -e <span class="string">"startTime:\t$a"</span></span><br><span class="line">echo -e <span class="string">"endTime:\t$b"</span></span><br><span class="line">运行结果：</span><br><span class="line"></span><br><span class="line">$ sh test3.sh </span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line">startTime:  <span class="number">194221</span></span><br><span class="line">endTime:    <span class="number">194222</span></span><br><span class="line">但这样依然存在一个问题：</span><br><span class="line">因为&amp;使得所有循环体内的命令全部进入后台运行，那么倘若循环的次数很多，会使操作系统在瞬间创建出所有的子进程，这会非常消耗系统的资源。如果循环体内的命令又很消耗系统资源，则结果可想而知。</span><br><span class="line">最好的方法是并发的进程是可配置的。</span><br><span class="line"></span><br><span class="line">方案<span class="number">3</span>：使用文件描述符控制并发数</span><br><span class="line">$ cat test4.sh </span><br><span class="line">#/bin/bash</span><br><span class="line"></span><br><span class="line">all_num=<span class="number">10</span></span><br><span class="line"># 设置并发的进程数</span><br><span class="line">thread_num=<span class="number">5</span></span><br><span class="line"></span><br><span class="line">a=$(date +%H%M%S)</span><br><span class="line"></span><br><span class="line"># mkfifo</span><br><span class="line">tempfifo=<span class="string">"my_temp_fifo"</span></span><br><span class="line">mkfifo $&#123;tempfifo&#125;</span><br><span class="line"># 使文件描述符为非阻塞式</span><br><span class="line">exec <span class="number">6</span>&lt;&gt;$&#123;tempfifo&#125;</span><br><span class="line">rm -f $&#123;tempfifo&#125;</span><br><span class="line"></span><br><span class="line"># 为文件描述符创建占位信息</span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">1</span>;i&lt;=$&#123;thread_num&#125;;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    echo </span><br><span class="line">&#125;</span><br><span class="line">done &gt;&amp;<span class="number">6</span> </span><br><span class="line"></span><br><span class="line"># </span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> `seq <span class="number">1</span> $&#123;all_num&#125;`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    read -u6</span><br><span class="line">    &#123;</span><br><span class="line">        sleep <span class="number">1</span></span><br><span class="line">        echo $&#123;num&#125;</span><br><span class="line">        echo <span class="string">""</span> &gt;&amp;<span class="number">6</span></span><br><span class="line">    &#125; &amp; </span><br><span class="line">&#125; </span><br><span class="line">done </span><br><span class="line"></span><br><span class="line">wait</span><br><span class="line"></span><br><span class="line"># 关闭fd6管道</span><br><span class="line">exec <span class="number">6</span>&gt;&amp;-</span><br><span class="line"></span><br><span class="line">b=$(date +%H%M%S)</span><br><span class="line"></span><br><span class="line">echo -e <span class="string">"startTime:\t$a"</span></span><br><span class="line">echo -e <span class="string">"endTime:\t$b"</span></span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">$ sh test4.sh </span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line">startTime:  <span class="number">195227</span></span><br><span class="line">endTime:    <span class="number">195229</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方案<span class="number">4</span>：使用xargs -P控制并发数</span><br><span class="line">xargs命令有一个-P参数，表示支持的最大进程数，默认为<span class="number">1</span>。为<span class="number">0</span>时表示尽可能地大，即方案<span class="number">2</span>的效果。</span><br><span class="line">$ cat test5.sh </span><br><span class="line">#/bin/bash</span><br><span class="line"></span><br><span class="line">all_num=<span class="number">10</span></span><br><span class="line">thread_num=<span class="number">5</span></span><br><span class="line"></span><br><span class="line">a=$(date +%H%M%S)</span><br><span class="line"></span><br><span class="line">seq <span class="number">1</span> $&#123;all_num&#125; | xargs -n <span class="number">1</span> -I &#123;&#125; -P $&#123;thread_num&#125; sh -c <span class="string">"sleep 1;echo &#123;&#125;"</span></span><br><span class="line"></span><br><span class="line">b=$(date +%H%M%S)</span><br><span class="line"></span><br><span class="line">echo -e <span class="string">"startTime:\t$a"</span></span><br><span class="line">echo -e <span class="string">"endTime:\t$b"</span></span><br><span class="line">运行结果：</span><br><span class="line"></span><br><span class="line">$ sh test5.sh </span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line">startTime:  <span class="number">195257</span></span><br><span class="line">endTime:    <span class="number">195259</span></span><br><span class="line"></span><br><span class="line">方案<span class="number">5</span>：使用GNU parallel命令控制并发数</span><br><span class="line">GNU parallel命令是非常强大的并行计算命令，使用-j参数控制其并发数量。</span><br><span class="line">$ cat test6.sh </span><br><span class="line">#/bin/bash</span><br><span class="line"></span><br><span class="line">all_num=<span class="number">10</span></span><br><span class="line">thread_num=<span class="number">6</span></span><br><span class="line"></span><br><span class="line">a=$(date +%H%M%S)</span><br><span class="line"></span><br><span class="line">parallel -j <span class="number">5</span> <span class="string">"sleep 1;echo &#123;&#125;"</span> ::: `seq <span class="number">1</span> <span class="number">10</span>`</span><br><span class="line"></span><br><span class="line">b=$(date +%H%M%S)</span><br><span class="line"></span><br><span class="line">echo -e <span class="string">"startTime:\t$a"</span></span><br><span class="line">echo -e <span class="string">"endTime:\t$b"</span></span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">$ sh test6.sh </span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line">startTime:  <span class="number">195616</span></span><br><span class="line">endTime:    <span class="number">195618</span></span><br><span class="line"></span><br><span class="line">总结</span><br><span class="line">“多线程”的好处不言而喻，虽然shell中并没有真正的多线程，但上述解决方案可以实现“多线程”的效果，重要的是，在实际编写脚本时应有这样的考虑和实现。</span><br><span class="line">另外：</span><br><span class="line">方案<span class="number">3</span>、<span class="number">4</span>、<span class="number">5</span>虽然都可以控制并发数量，但方案<span class="number">3</span>显然写起来太繁琐。</span><br><span class="line">方案<span class="number">4</span>和<span class="number">5</span>都以非常简洁的形式完成了控制并发数的效果，但由于方案<span class="number">5</span>的parallel命令非常强大，所以十分建议系统学习下。</span><br><span class="line">方案<span class="number">3</span>、<span class="number">4</span>、<span class="number">5</span>设置的并发数均为<span class="number">5</span>，实际编写时可以将该值作为一个参数传入。</span><br><span class="line"></span><br><span class="line">参考文章</span><br><span class="line">http:<span class="comment">//blog.csdn.net/qq_34409701/article/details/52488964</span></span><br><span class="line">https:<span class="comment">//www.codeword.xyz/2015/09/02/three-ways-to-script-processes-in-parallel/</span></span><br><span class="line">http:<span class="comment">//www.gnu.org/software/parallel/</span></span><br></pre></td></tr></table></figure>

<h1 id="多线程删除文件：oss"><a href="#多线程删除文件：oss" class="headerlink" title="多线程删除文件：oss"></a>多线程删除文件：oss</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">i=0</span><br><span class="line">a=()</span><br><span class="line">a=`find /mnt/sdoss/read_1023a1 -name <span class="string">"*.file"</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable">$&#123;a[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">		i=`expr <span class="variable">$i</span> + 1`</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">rm -rf read_1023a1.txt</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$i</span> &gt;&gt;read_1023a1.txt</span><br><span class="line">在oss上删除文件，通过删除接口删除</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">a=()</span><br><span class="line">a=`find /mnt/sdoss/90/ -name <span class="string">"vdb_*.file"</span>|sed <span class="string">'s/\/mnt\/sdoss\///g'</span>`</span><br><span class="line">pid=$$</span><br><span class="line">thread=200</span><br><span class="line">tmp_fifo=<span class="string">"/tmp/$$.fifo"</span></span><br><span class="line">mkfifo <span class="variable">$tmp_fifo</span></span><br><span class="line"><span class="built_in">exec</span> 8&lt;&gt;<span class="variable">$tmp_fifo</span></span><br><span class="line">rm <span class="variable">$tmp_fifo</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 <span class="variable">$thread</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span> &gt;&amp;8</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&gt;&gt;&gt; start delete file!"</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable">$&#123;a[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="built_in">read</span> -u8</span><br><span class="line">        &#123;</span><br><span class="line">		curl -v -X DELETE <span class="string">"http://10.244.76.87:8888/ossfuse/testfuse90/<span class="variable">$&#123;item&#125;</span>"</span> 1&gt;&amp;2 2&gt;/dev/null</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">""</span> &gt;&amp;8</span><br><span class="line">        &#125; &amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">exec</span> 8&gt;&amp;-</span><br></pre></td></tr></table></figure>



<h1 id="多线程举例"><a href="#多线程举例" class="headerlink" title="多线程举例"></a>多线程举例</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph-mon ~]<span class="comment"># cat /opt/test/test-swift.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">url=`curl -s -d <span class="string">'&#123;"auth":&#123;"tenantName": "adminTenant","passwordCredentials":&#123;"username": "admin","password": "admin"&#125;&#125;&#125;'</span> -H <span class="string">"Content-type:application/json"</span> http://10.37.2.15:5000/v2.0/tokens | python -mjson.tool |grep <span class="string">"publicURL"</span> |head -n1 |awk -F <span class="string">'"'</span> <span class="string">'&#123;print $4&#125;'</span>`</span><br><span class="line">id=`curl -s -d <span class="string">'&#123;"auth":&#123;"tenantName": "adminTenant","passwordCredentials":&#123;"username": "admin","password": "admin"&#125;&#125;&#125;'</span> -H <span class="string">"Content-type:application/json"</span> http://10.37.2.15:5000/v2.0/tokens | python -mjson.tool |grep -A 12 token |grep -w id |head -n 1 |awk -F <span class="string">'"'</span> <span class="string">'&#123;print $4&#125;'</span>`</span><br><span class="line">pid=$$</span><br><span class="line">thread=10</span><br><span class="line">tmp_fifo=<span class="string">"/tmp/$$.fifo"</span></span><br><span class="line">mkfifo <span class="variable">$tmp_fifo</span></span><br><span class="line"><span class="built_in">exec</span> 7&lt;&gt;<span class="variable">$tmp_fifo</span></span><br><span class="line">rm <span class="variable">$tmp_fifo</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 <span class="variable">$thread</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span> &gt;&amp;7</span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">test</span>-error.log</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&gt;&gt;&gt; start upload file!"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 1000)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">read</span> -u7</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> $(seq 1 1000)</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            ret=`curl -s -w <span class="string">"%&#123;http_code&#125;"</span> -X PUT -T <span class="string">"test.jpg"</span> -H <span class="string">"X-Auth-Token:<span class="variable">$&#123;id&#125;</span>"</span> <span class="variable">$&#123;url&#125;</span>/mycontainers1/test_<span class="variable">$&#123;pid&#125;</span>_<span class="variable">$&#123;i&#125;</span>_<span class="variable">$&#123;j&#125;</span>.jpg |tail -1 |awk -F <span class="string">'[&#123;&#125;]'</span> <span class="string">'&#123;print $NF&#125;'</span>`</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">"x<span class="variable">$&#123;ret&#125;</span>"</span> != <span class="string">"x201"</span> ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"[`date '+%F %T'`] upload <span class="variable">$&#123;url&#125;</span>/mycontainers1/test_<span class="variable">$&#123;pid&#125;</span>_<span class="variable">$&#123;i&#125;</span>_<span class="variable">$&#123;j&#125;</span>.jpg error, code <span class="variable">$&#123;ret&#125;</span>!"</span> &gt;&gt; <span class="built_in">test</span>-error.log</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="built_in">echo</span> &gt;&amp;7</span><br><span class="line">    &#125; &amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"></span><br><span class="line">sleep 5</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&gt;&gt;&gt; start download file!"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 1000)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">read</span> -u7</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> $(seq 1 1000)</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            ret=`curl -s -w <span class="string">"%&#123;http_code&#125;"</span> -X GET -H <span class="string">"X-Auth-Token:<span class="variable">$&#123;id&#125;</span>"</span> -H <span class="string">"X-Storage-Policy:swiftonfile"</span> -o /dev/null <span class="variable">$&#123;url&#125;</span>/mycontainers1/test_<span class="variable">$&#123;pid&#125;</span>_<span class="variable">$&#123;i&#125;</span>_<span class="variable">$&#123;j&#125;</span>.jpg`</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">"x<span class="variable">$&#123;ret&#125;</span>"</span> != <span class="string">"x200"</span> ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"[`date '+%F %T'`] download <span class="variable">$&#123;url&#125;</span>/mycontainers1/test_<span class="variable">$&#123;pid&#125;</span>_<span class="variable">$&#123;i&#125;</span>_<span class="variable">$&#123;j&#125;</span>.jpg error, code <span class="variable">$&#123;ret&#125;</span>!"</span> &gt;&gt; <span class="built_in">test</span>-error.log</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="built_in">echo</span> &gt;&amp;7</span><br><span class="line">    &#125; &amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 7&gt;&amp;-</span><br></pre></td></tr></table></figure>



<h1 id="多并发"><a href="#多并发" class="headerlink" title="多并发"></a>多并发</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><span class="line">一、普及（网址http://www.cnblogs.com/zhengbin/p/9513762.html<span class="comment">#_label1）</span></span><br><span class="line">Shell 实现多线程（多任务）</span><br><span class="line">阅读目录</span><br><span class="line">1.命令结尾添加：&amp;</span><br><span class="line">2.解决主线程提前退出问题，添加 <span class="built_in">wait</span></span><br><span class="line">3.控制后台执行数（线程数），mkfifo</span><br><span class="line">实现方案：</span><br><span class="line">1.命令结尾添加：&amp;</span><br><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line">all_num=10</span><br><span class="line">a=$(date +%H%M%S)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> `seq 1 <span class="variable">$&#123;all_num&#125;</span>`</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    sleep 1</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;num&#125;</span></span><br><span class="line">&#125; &amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">b=$(date +%H%M%S)</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"startTime:\t<span class="variable">$a</span>"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"endTime:\t<span class="variable">$b</span>"</span></span><br><span class="line">在命令的末尾加 &amp; 符号，则命令将在后台执行，这样后面的命令不需要等待该命令执行完再开始执行。</span><br><span class="line"></span><br><span class="line">2.解决主线程提前退出问题，添加 <span class="built_in">wait</span></span><br><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line">all_num=10</span><br><span class="line">a=$(date +%H%M%S)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> `seq 1 <span class="variable">$&#123;all_num&#125;</span>`</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    sleep 1</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;num&#125;</span></span><br><span class="line">&#125; &amp; <span class="comment"># 将命令在后台执行，命令范围用&#123;&#125;包围</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment"># 等待当前脚本进程下的子进程结束</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line">b=$(date +%H%M%S)</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"startTime:\t<span class="variable">$a</span>"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"endTime:\t<span class="variable">$b</span>"</span></span><br><span class="line"></span><br><span class="line">3.控制后台执行数（线程数），mkfifo</span><br><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line">all_num=10</span><br><span class="line"><span class="comment"># 设置并发的进程数</span></span><br><span class="line">thread_num=5</span><br><span class="line">a=$(date +%H%M%S)</span><br><span class="line"><span class="comment"># mkfifo</span></span><br><span class="line">tempfifo=<span class="string">"my_temp_fifo"</span></span><br><span class="line">mkfifo <span class="variable">$&#123;tempfifo&#125;</span></span><br><span class="line"><span class="comment"># 使文件描述符为非阻塞式</span></span><br><span class="line"><span class="built_in">exec</span> 6&lt;&gt;<span class="variable">$&#123;tempfifo&#125;</span></span><br><span class="line">rm -f <span class="variable">$&#123;tempfifo&#125;</span></span><br><span class="line"><span class="comment"># 为文件描述符创建占位信息</span></span><br><span class="line"><span class="keyword">for</span> ((i=1;i&lt;=<span class="variable">$&#123;thread_num&#125;</span>;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">echo</span> </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">done</span> &gt;&amp;6 </span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> `seq 1 <span class="variable">$&#123;all_num&#125;</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">read</span> -u6</span><br><span class="line">    &#123;</span><br><span class="line">        sleep 1</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$&#123;num&#125;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">""</span> &gt;&amp;6</span><br><span class="line">    &#125; &amp; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">done</span> </span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="comment"># 关闭fd6管道</span></span><br><span class="line"><span class="built_in">exec</span> 6&gt;&amp;-</span><br><span class="line">b=$(date +%H%M%S)</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"startTime:\t<span class="variable">$a</span>"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"endTime:\t<span class="variable">$b</span>"</span></span><br><span class="line">二、普及</span><br><span class="line">（参考网址：https://blog.csdn.net/qq_34409701/article/details/52488964）</span><br><span class="line">默认的情况下，Shell脚本中的命令是串行执行的，必须等到前一条命令执行完后才执行接下来的命令，但是如果我有一大批的的命令需要执行，而且互相又没有影响的情况下（有影响的话就比较复杂了），那么就要使用命令的并发执行了。 </span><br><span class="line"></span><br><span class="line">如下：</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">IPLIST=/home/meta/ipinfo/iplist</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(cat <span class="variable">$&#123;IPLIST&#125;</span> |grep -viE <span class="string">"^#|备机|ts"</span>|awk <span class="string">'&#123;print $1&#125;'</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    ssh <span class="variable">$i</span> <span class="string">"cd ~/update/;tar zxf patch-20160909.tgz -C ~/LMDG/ &amp;&amp; echo '/<span class="variable">$i</span> ok' || echo '/<span class="variable">$i</span> bad'"</span></span><br><span class="line"><span class="keyword">done</span> &gt;&gt; result.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"resutl"</span>|mutt -a result.txt -s update-result meta@126.com12345678</span><br><span class="line"></span><br><span class="line">对于上面的代码，因为 iplist 中有好多ip，每个”tar zxf”都挺耗时的，所以打算使用并发编程，这样就可以节省大量时间了。</span><br><span class="line"></span><br><span class="line">修改如下：</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">IPLIST=/home/meta/ipinfo/iplist</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(cat <span class="variable">$&#123;IPLIST&#125;</span> |grep -viE <span class="string">"^#|备机|ts"</span>|awk <span class="string">'&#123;print $1&#125;'</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    ssh <span class="variable">$i</span> <span class="string">"cd ~/update/;tar zxf patch-20160909.tgz -C ~/LMDG/ &amp;&amp; echo '/<span class="variable">$i</span> ok' || echo '/<span class="variable">$i</span> bad'"</span> &amp;</span><br><span class="line"><span class="keyword">done</span> &gt;&gt; result.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"resutl"</span>|mutt -a result.txt -s update-result meta@126.com12345678</span><br><span class="line"></span><br><span class="line">加上“&amp;” 之后 “tar zxf”就可以并行执行了。 实质是将”tar zxf” 作为后台进程在执行，这样该命令就不会占用当前bash，其他命令也不用等待前面命令执行完再继续了，而且可以放入多个任务到后台，这样就实现了多任务并发。</span><br><span class="line"></span><br><span class="line">我本来目的是让”tar zxf”这个循环都执行结束后，再“mutt”前面的结果。如果像上面这样写的话，在”tar zxf”都还没结束时就已经开始执行“mutt”了，得到了错误的结果，因此需要做如下修改：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">IPLIST=/home/meta/ipinfo/iplist</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(cat <span class="variable">$&#123;IPLIST&#125;</span> |grep -viE <span class="string">"^#|备机|ts"</span>|awk <span class="string">'&#123;print $1&#125;'</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    ssh <span class="variable">$i</span> <span class="string">"cd ~/update/;tar zxf patch-20160909.tgz -C ~/LMDG/ &amp;&amp; echo '/<span class="variable">$i</span> ok' || echo '/<span class="variable">$i</span> bad'"</span> &amp;</span><br><span class="line"><span class="keyword">done</span> &gt;&gt; result.txt</span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"resutl"</span>|mutt -a result.txt -s update-result meta@126.com12345678</span><br><span class="line"></span><br><span class="line">这里添加了“<span class="built_in">wait</span>” 之后就可以达到我们预期的效果了，<span class="built_in">wait</span>的作用就是等待子任务都执行完之后在结束父任务，继而执行下面的任务。</span><br><span class="line"></span><br><span class="line">但是，紧接着又有问题了，如果这个iplist中的量巨大，这样一口气都放到后台，系统超出负载后，会有性能变差或者宕机风险，因此我们需要一个控制并发数的机制。 </span><br><span class="line">因此我们引入了任务队列的概念，有点类似之前socket举例中的消费者生产者模型，通过消息队列来调节供需的不平衡 </span><br><span class="line">修改如下：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">IPLIST=/home/meta/ipinfo/iplist <span class="comment">#任务（消费者）</span></span><br><span class="line">THREAD=50                       <span class="comment">#声明并发线程并发个数，这个是此应用的关键，也就是设置管道的最大任务数</span></span><br><span class="line">TMPFIFO=/tmp/$$.fifo			<span class="comment">#声明管道名称，'$$'表示脚本当前运行的进程PID</span></span><br><span class="line">mkfifo <span class="variable">$TMPFIFO</span>                <span class="comment">#创建管道</span></span><br><span class="line"><span class="built_in">exec</span> 5&lt;&gt;<span class="variable">$&#123;TMPFIFO&#125;</span>             <span class="comment">#创建文件标示符“5”，这个数字可以为除“0”、“1”、“2”之外的所有未声明过的字符，以读写模式操作管道文件；系统调用exec是以新的进程去代替原来的进程，但进程的PID保持不变，换句话说就是在调用进程内部执行一个可执行文件</span></span><br><span class="line">rm -rf <span class="variable">$&#123;TMPFIFO&#125;</span>              <span class="comment">#清除创建的管道文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#为并发线程创建同样个数的占位</span></span><br><span class="line"><span class="keyword">for</span>((i=1;i&lt;=<span class="variable">$THREAD</span>;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">echo</span> ;               </span><br><span class="line"> <span class="comment">#借用read命令一次读取一行的特性，使用一个echo默认输出一个换行符，来确保每一行只有一个线程占位；这里让人联想到生产者&amp;消费者模型，管道文件充当消息队列，来记录消费者的需求，然后由生产者去领任务，并完成任务，这里运用了异步解耦的思想。</span></span><br><span class="line"><span class="keyword">done</span> &gt;&amp;5                </span><br><span class="line"> <span class="comment">#将占位信息写入管道</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(cat <span class="variable">$&#123;IPLIST&#125;</span> |grep -viE <span class="string">"^#|备机|ts"</span>|awk <span class="string">'&#123;print $1&#125;'</span>) <span class="comment">#从任务队列中依次读取任务</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="built_in">read</span> -u5        </span><br><span class="line"> <span class="comment">#从文件描述符管道中，获取一个管道的线程占位然后开始执行操作；read中 -u 后面跟fd，表示从文件描述符中读入，该文件描述符可以是exec新开启的。</span></span><br><span class="line">        &#123;</span><br><span class="line">               <span class="built_in">echo</span> $(cat ~/ipinfo/iplist|grep <span class="variable">$i</span>|awk <span class="string">'&#123;print $2&#125;'</span>);</span><br><span class="line">               ssh -oConnectTimeout=10 -oConnectionAttempts=3 <span class="variable">$i</span> <span class="string">"cd /home/Log/;grep 'MIL' mission_2016-08-03*.log |awk -F, '&#123;if(\$19==1370) print \$0&#125;'|</span></span><br><span class="line"><span class="string">               awk -F, '&#123;if(\$20==0) print \$0&#125;'&gt;miss_info.txt"</span></span><br><span class="line">               <span class="built_in">echo</span> <span class="string">""</span> &gt;&amp;5  </span><br><span class="line"> <span class="comment">#任务执行完后在fd5中写入一个占位符，以保证这个线程执行完后，线程继续保持占位，继而维持管道中永远是50个线程数，&amp;表示该部分命令/任务放入后台不占当前的bash，实现并行处理</span></span><br><span class="line">        &#125; &amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span>                <span class="comment">#等待父进程的子进程都执行结束后再结束父进程          </span></span><br><span class="line"><span class="built_in">exec</span> 5&gt;&amp;-           <span class="comment">#关闭fd5的管道</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line">二、举例：</span><br><span class="line">[root@ceph-mon ~]<span class="comment"># cat /opt/test/test-swift.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">url=`curl -s -d <span class="string">'&#123;"auth":&#123;"tenantName": "adminTenant","passwordCredentials":&#123;"username": "admin","password": "admin"&#125;&#125;&#125;'</span> -H <span class="string">"Content-type:application/json"</span> http://10.37.2.15:5000/v2.0/tokens | python -mjson.tool |grep <span class="string">"publicURL"</span> |head -n1 |awk -F <span class="string">'"'</span> <span class="string">'&#123;print $4&#125;'</span>`</span><br><span class="line">id=`curl -s -d <span class="string">'&#123;"auth":&#123;"tenantName": "adminTenant","passwordCredentials":&#123;"username": "admin","password": "admin"&#125;&#125;&#125;'</span> -H <span class="string">"Content-type:application/json"</span> http://10.37.2.15:5000/v2.0/tokens | python -mjson.tool |grep -A 12 token |grep -w id |head -n 1 |awk -F <span class="string">'"'</span> <span class="string">'&#123;print $4&#125;'</span>`</span><br><span class="line">pid=$$</span><br><span class="line">thread=10</span><br><span class="line">tmp_fifo=<span class="string">"/tmp/$$.fifo"</span></span><br><span class="line">mkfifo <span class="variable">$tmp_fifo</span></span><br><span class="line"><span class="built_in">exec</span> 7&lt;&gt;<span class="variable">$tmp_fifo</span></span><br><span class="line">rm <span class="variable">$tmp_fifo</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 <span class="variable">$thread</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span> &gt;&amp;7</span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">test</span>-error.log</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&gt;&gt;&gt; start upload file!"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 1000)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">read</span> -u7</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> $(seq 1 1000)</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            ret=`curl -s -w <span class="string">"%&#123;http_code&#125;"</span> -X PUT -T <span class="string">"test.jpg"</span> -H <span class="string">"X-Auth-Token:<span class="variable">$&#123;id&#125;</span>"</span> <span class="variable">$&#123;url&#125;</span>/mycontainers1/test_<span class="variable">$&#123;pid&#125;</span>_<span class="variable">$&#123;i&#125;</span>_<span class="variable">$&#123;j&#125;</span>.jpg |tail -1 |awk -F <span class="string">'[&#123;&#125;]'</span> <span class="string">'&#123;print $NF&#125;'</span>`</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">"x<span class="variable">$&#123;ret&#125;</span>"</span> != <span class="string">"x201"</span> ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"[`date '+%F %T'`] upload <span class="variable">$&#123;url&#125;</span>/mycontainers1/test_<span class="variable">$&#123;pid&#125;</span>_<span class="variable">$&#123;i&#125;</span>_<span class="variable">$&#123;j&#125;</span>.jpg error, code <span class="variable">$&#123;ret&#125;</span>!"</span> &gt;&gt; <span class="built_in">test</span>-error.log</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="built_in">echo</span> &gt;&amp;7</span><br><span class="line">    &#125; &amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"></span><br><span class="line">sleep 5</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&gt;&gt;&gt; start download file!"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 1000)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">read</span> -u7</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> $(seq 1 1000)</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            ret=`curl -s -w <span class="string">"%&#123;http_code&#125;"</span> -X GET -H <span class="string">"X-Auth-Token:<span class="variable">$&#123;id&#125;</span>"</span> -H <span class="string">"X-Storage-Policy:swiftonfile"</span> -o /dev/null <span class="variable">$&#123;url&#125;</span>/mycontainers1/test_<span class="variable">$&#123;pid&#125;</span>_<span class="variable">$&#123;i&#125;</span>_<span class="variable">$&#123;j&#125;</span>.jpg`</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">"x<span class="variable">$&#123;ret&#125;</span>"</span> != <span class="string">"x200"</span> ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"[`date '+%F %T'`] download <span class="variable">$&#123;url&#125;</span>/mycontainers1/test_<span class="variable">$&#123;pid&#125;</span>_<span class="variable">$&#123;i&#125;</span>_<span class="variable">$&#123;j&#125;</span>.jpg error, code <span class="variable">$&#123;ret&#125;</span>!"</span> &gt;&gt; <span class="built_in">test</span>-error.log</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="built_in">echo</span> &gt;&amp;7</span><br><span class="line">    &#125; &amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 7&gt;&amp;-</span><br></pre></td></tr></table></figure>

<h1 id="进程间通信"><a href="#进程间通信" class="headerlink" title="进程间通信"></a>进程间通信</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//</span>www.cnblogs.com<span class="regexp">/scue/</span>p<span class="regexp">/4075088.html</span></span><br></pre></td></tr></table></figure>

<h1 id="脚本打印进度-过程"><a href="#脚本打印进度-过程" class="headerlink" title="脚本打印进度+过程"></a>脚本打印进度+过程</h1><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">读下去文件并打印百分比以及当前数和总数的比，以及运行时间：</span><br><span class="line">#!/bin/bash</span><br><span class="line">ProgressBar()</span><br><span class="line">&#123;</span><br><span class="line">  local current=$<span class="number">1</span>; local total=$<span class="number">2</span></span><br><span class="line">  local now=$((current*<span class="number">100</span>/total))</span><br><span class="line">  local last=$(((current<span class="number">-1</span>)*<span class="number">100</span>/total))</span><br><span class="line">  [[ $((last % <span class="number">2</span>)) -eq <span class="number">1</span> ]]&amp;&amp;<span class="keyword">let</span> last++</span><br><span class="line">  local str=$(for i <span class="keyword">in</span> `seq <span class="number">1</span> $((last/<span class="number">2</span>))`; do printf <span class="string">'#'</span>; done)</span><br><span class="line">  use_time=`ps -p $$ -o etime|column -t|tail <span class="number">-1</span>`</span><br><span class="line">  for ((i=$last;$i&lt;=$now;i+=<span class="number">2</span>));do printf <span class="string">"\r[%-50s]%d%%[%03d/%03d][%-5s]\r"</span> <span class="string">"$str"</span> $i $current $total $&#123;use_time&#125;;str+=<span class="string">'#'</span>;done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">len=`cat <span class="number">4.</span>log|wc -l`</span><br><span class="line">num=<span class="number">0</span></span><br><span class="line">cat <span class="number">4.</span>log | while read line</span><br><span class="line">do</span><br><span class="line">  <span class="keyword">let</span> num=num+<span class="number">1</span></span><br><span class="line">  ProgressBar $num $&#123;len&#125;</span><br><span class="line">done</span><br><span class="line">echo</span><br><span class="line">效果：</span><br><span class="line">[##################################################]<span class="number">100</span>%[<span class="number">924</span>/<span class="number">924</span>][<span class="number">00</span>:<span class="number">22</span>]</span><br><span class="line">打印过程</span><br><span class="line">echo `date <span class="string">"+%Y-%m-%d %T"</span>`    <span class="string">"******安装mysql......"</span></span><br><span class="line">#第一步：停止并卸载原有的mysql</span><br><span class="line"></span><br><span class="line">echo `date <span class="string">"+%Y-%m-%d %T"</span>`    <span class="string">"----&gt;&gt;停止彻底卸载已有的mysql......"</span></span><br><span class="line">echo `date <span class="string">"+%Y-%m-%d %T"</span>`    <span class="string">"----&gt;&gt;配置优化、开机自启设置完毕"</span></span><br><span class="line">echo `date <span class="string">"+%Y-%m-%d %T"</span>`    <span class="string">"******mysql安装完毕，登录密码为$&#123;mysql_passwd&#125;"</span></span><br><span class="line"></span><br><span class="line">返回如下：</span><br><span class="line"><span class="number">2019</span><span class="number">-11</span><span class="number">-28</span> <span class="number">08</span>：<span class="number">54</span>：<span class="number">14</span> ******安装mysgl ...</span><br><span class="line"><span class="number">2019</span><span class="number">-11</span><span class="number">-28</span> <span class="number">08</span>：<span class="number">54</span>：<span class="number">14</span> ---&gt;&gt;停止彻底卸载已有的mysql....</span><br><span class="line"><span class="number">2019</span><span class="number">-11</span><span class="number">-28</span> <span class="number">08</span>：<span class="number">54</span>：<span class="number">14</span> ---&gt;&gt;配置优化、开机自启设置完毕</span><br><span class="line"><span class="number">2019</span><span class="number">-11</span><span class="number">-28</span> <span class="number">08</span>：<span class="number">54</span>：<span class="number">14</span> ******mysq1安装完毕，登录密码为</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">读取文件并打印百分比以及当前数和总数的比：</span><br><span class="line">#!/bin/bash</span><br><span class="line">ProgressBar()</span><br><span class="line">&#123;</span><br><span class="line">  local current=$<span class="number">1</span>; local total=$<span class="number">2</span></span><br><span class="line">  local now=$((current*<span class="number">100</span>/total))</span><br><span class="line">  local last=$(((current<span class="number">-1</span>)*<span class="number">100</span>/total))</span><br><span class="line">  [[ $((last % <span class="number">2</span>)) -eq <span class="number">1</span> ]]&amp;&amp;<span class="keyword">let</span> last++</span><br><span class="line">  local str=$(for i <span class="keyword">in</span> `seq <span class="number">1</span> $((last/<span class="number">2</span>))`; do printf <span class="string">'#'</span>; done)</span><br><span class="line">  for ((i=$last;$i&lt;=$now;i+=<span class="number">2</span>));do printf <span class="string">"\r[%-50s]%d%%[%03d/%03d]\r"</span> <span class="string">"$str"</span> $i $current $total;str+=<span class="string">'#'</span>;done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">len=`cat <span class="number">4.</span>log|wc -l`</span><br><span class="line">num=<span class="number">0</span></span><br><span class="line">cat <span class="number">4.</span>log | while read line</span><br><span class="line">do</span><br><span class="line">  <span class="keyword">let</span> num=num+<span class="number">1</span></span><br><span class="line">  ProgressBar $num $&#123;len&#125;</span><br><span class="line">done</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">效果：</span><br><span class="line">[##################################################]<span class="number">100</span>%[<span class="number">924</span>/<span class="number">924</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">读取大于<span class="number">100</span>的文件百分比：</span><br><span class="line">#!/bin/bash</span><br><span class="line">ProgressBar()</span><br><span class="line">&#123;</span><br><span class="line">  local current=$<span class="number">1</span>; local total=$<span class="number">2</span></span><br><span class="line">  local now=$((current*<span class="number">100</span>/total))</span><br><span class="line">  local last=$(((current<span class="number">-1</span>)*<span class="number">100</span>/total))</span><br><span class="line">  [[ $((last % <span class="number">2</span>)) -eq <span class="number">1</span> ]]&amp;&amp;<span class="keyword">let</span> last++</span><br><span class="line">  local str=$(for i <span class="keyword">in</span> `seq <span class="number">1</span> $((last/<span class="number">2</span>))`; do printf <span class="string">'#'</span>; done)</span><br><span class="line">  for ((i=$last;$i&lt;=$now;i+=<span class="number">2</span>));do printf <span class="string">"\r[%-50s]%d%%"</span> <span class="string">"$str"</span>  $i;sleep <span class="number">0.02</span>;str+=<span class="string">'#'</span>;done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">len=`cat <span class="number">4.</span>log|wc -l`</span><br><span class="line">num=<span class="number">0</span></span><br><span class="line">cat <span class="number">4.</span>log | while read line</span><br><span class="line">do</span><br><span class="line">  <span class="keyword">let</span> num=num+<span class="number">1</span></span><br><span class="line">  ProgressBar $num $&#123;len&#125;</span><br><span class="line">done</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Shell 进度条效果的一个实现;https:<span class="comment">//www.cnblogs.com/tangxin-blog/p/6293488.html</span></span><br><span class="line">#!/bin/bash</span><br><span class="line">processBar()</span><br><span class="line">&#123;</span><br><span class="line">    now=$<span class="number">1</span></span><br><span class="line">    all=$<span class="number">2</span></span><br><span class="line">    percent=`awk BEGIN<span class="string">'&#123;printf "%f", ('</span>$now<span class="string">'/'</span>$all<span class="string">')&#125;'</span>`</span><br><span class="line">    len=`awk BEGIN<span class="string">'&#123;printf "%d", (100*'</span>$percent<span class="string">')&#125;'</span>`</span><br><span class="line">    bar=<span class="string">'&gt;'</span></span><br><span class="line">    for((i=<span class="number">0</span>;i&lt;len<span class="number">-1</span>;i++))</span><br><span class="line">    do</span><br><span class="line">        bar=<span class="string">"="</span>$bar</span><br><span class="line">    done</span><br><span class="line">    printf <span class="string">"[%-100s][%03d/%03d]\r"</span> $bar $len <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">whole=<span class="number">100</span></span><br><span class="line">process=<span class="number">0</span></span><br><span class="line">while [ $process -lt $whole ] </span><br><span class="line">do</span><br><span class="line">    <span class="keyword">let</span> process++</span><br><span class="line">    processBar $process $whole</span><br><span class="line">    sleep <span class="number">0.1</span></span><br><span class="line">done</span><br><span class="line">printf <span class="string">"\n"</span></span><br><span class="line"></span><br><span class="line">效果：</span><br><span class="line">[root@host102442549 Master]# sh <span class="number">2.</span>sh </span><br><span class="line">[==============================================================================&gt;[<span class="number">100</span>/<span class="number">100</span>]</span><br><span class="line"></span><br><span class="line"> shell实现进度条（<span class="number">100</span>%）</span><br><span class="line">##方法<span class="number">1</span>：https:<span class="comment">//www.jianshu.com/p/7ba06b47e0b6</span></span><br><span class="line">#!/bin/bash</span><br><span class="line">ProgressBar()</span><br><span class="line">&#123;</span><br><span class="line">  local current=$<span class="number">1</span>; local total=$<span class="number">2</span></span><br><span class="line">  local now=$((current*<span class="number">100</span>/total))</span><br><span class="line">  local last=$(((current<span class="number">-1</span>)*<span class="number">100</span>/total))</span><br><span class="line">  [[ $((last % <span class="number">2</span>)) -eq <span class="number">1</span> ]]&amp;&amp;<span class="keyword">let</span> last++</span><br><span class="line">  local str=$(for i <span class="keyword">in</span> `seq <span class="number">1</span> $((last/<span class="number">2</span>))`; do printf <span class="string">'#'</span>; done)</span><br><span class="line">  for ((i=$last;$i&lt;=$now;i+=<span class="number">2</span>));do printf <span class="string">"\r[%-50s]%d%%"</span> <span class="string">"$str"</span>  $i;sleep <span class="number">0.02</span>;str+=<span class="string">'#'</span>;done</span><br><span class="line">&#125;</span><br><span class="line">for  n <span class="keyword">in</span> `seq <span class="number">1</span> <span class="number">100</span>`</span><br><span class="line">  do</span><br><span class="line">  ProgressBar $n <span class="number">100</span></span><br><span class="line">  done</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">效果：</span><br><span class="line">[##################################################]<span class="number">100</span>%</span><br><span class="line"></span><br><span class="line">##方法<span class="number">2</span>：http:<span class="comment">//blog.chinaunix.net/uid-9188830-id-2007059.html</span></span><br><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">b=<span class="string">''</span></span><br><span class="line">for ((i=<span class="number">0</span>;$i&lt;=<span class="number">100</span>;i+=<span class="number">2</span>))</span><br><span class="line">do</span><br><span class="line">        printf <span class="string">"progress:[%-50s]%d%%\r"</span> $b $i</span><br><span class="line">        sleep <span class="number">0.1</span></span><br><span class="line">        b=#$b</span><br><span class="line">done</span><br><span class="line">echo</span><br><span class="line">效果：</span><br><span class="line">progress:[##################################################]<span class="number">100</span>%</span><br></pre></td></tr></table></figure>



<h1 id="读配置文件"><a href="#读配置文件" class="headerlink" title="读配置文件"></a>读配置文件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">配置文件config内容如下</span><br><span class="line">ID=123</span><br><span class="line">I</span><br><span class="line">IP=192.168.3.154</span><br><span class="line">N</span><br><span class="line">Name=test</span><br><span class="line"></span><br><span class="line">方法一，利用eval方法解析</span><br><span class="line">while read line;do</span><br><span class="line">    eval "$line"</span><br><span class="line">done &lt; config  </span><br><span class="line">echo $ID  </span><br><span class="line">echo $IP  </span><br><span class="line">echo $Name  </span><br><span class="line"></span><br><span class="line">方法二，直接将配置信息加载到session的环境变量中</span><br><span class="line">source config</span><br><span class="line">echo $ID</span><br><span class="line"></span><br><span class="line">123</span><br><span class="line">echo $IP</span><br><span class="line">192.168.3.154</span><br><span class="line">echo $Name</span><br><span class="line">t</span><br><span class="line">test</span><br></pre></td></tr></table></figure>

<h1 id="脚本执行时间统计"><a href="#脚本执行时间统计" class="headerlink" title="脚本执行时间统计"></a>脚本执行时间统计</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a=$(date +%H%M%S)</span><br><span class="line">b=$(date +%H%M%S)</span><br><span class="line"></span><br><span class="line">echo -e "startTime:\t$a"</span><br><span class="line">echo -e "endTime:\t$b"</span><br></pre></td></tr></table></figure>

<h1 id="getopt：选项参数"><a href="#getopt：选项参数" class="headerlink" title="getopt：选项参数"></a>getopt：选项参数</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/f-ck-need-u/p/9758075.html</span><br><span class="line">https://www.cnblogs.com/lidabo/p/5382617.html</span><br><span class="line">"a:b:cd::e"，这就是一个选项字符串。对应到命令行就是-a ,-b ,-c ,-d, -e 。冒号又是什么呢？ 冒号表示参数，一个冒号就表示这个选项后面必须带有参数（没有带参数会报错哦），但是这个参数可以和选项连在一起写，也可以用空格隔开，比如-a123 和-a   123（中间有空格） 都表示123是-a的参数；两个冒号的就表示这个选项的参数是可选的，即可以有参数，也可以没有参数，但要注意有参数时，参数与选项之间不能有空格（有空格会报错的哦），这一点和一个冒号时是有区别的。</span><br><span class="line"></span><br><span class="line">24.getopt（一个外部工具）</span><br><span class="line">https://www.cnblogs.com/lidabo/p/5382617.html</span><br><span class="line">具体用用法可以 man getopt</span><br><span class="line">char*optstring = “ab:c::”;</span><br><span class="line"><span class="meta">#</span><span class="bash">单个字符a         表示选项a没有参数            格式：-a即可，不加参数</span></span><br><span class="line"><span class="meta">#</span><span class="bash">单字符加冒号b:     表示选项b有且必须加参数      格式：-b 100或-b100,但-b=100错</span></span><br><span class="line"><span class="meta">#</span><span class="bash">单字符加2冒号c::   表示选项c可以有，也可以无     格式：-c200，其它格式错误</span></span><br><span class="line"><span class="meta">#</span><span class="bash">getopt处理以<span class="string">'-’开头的命令行参数，如optstring="ab:c::d::",命令行为getopt.exe -a -b  host -ckeke -d haha</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">在这个命令行参数中，-a是选项元素。host是b的参数，keke是c的参数。但haha并不是d的参数，因为它们中间有空格隔开。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">还要注意的是默认情况下getopt会重新排列命令行参数的顺序，所以到最后所有不包含选项的命令行参数都排到最后。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">-o表示短选项</span></span><br><span class="line"><span class="meta">#</span><span class="bash">--long表示长选项</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">"<span class="variable">$@</span>"</span>在上面解释过</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -n:出错时的信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -- ：举一个例子比较好理解：</span></span><br><span class="line">我们要创建一个名字为 "-f"的目录你会怎么办？</span><br><span class="line">mkdir -f #不成功，因为-f会被mkdir当作选项来解析，这时就可以使用</span><br><span class="line">mkdir -- -f 这样-f就不会被作为选项。</span><br><span class="line"><span class="meta">#</span><span class="bash">下面的例子都是使用的<span class="variable">$2</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">举例：</span><br><span class="line">!/bin/bash</span><br><span class="line">TEMP=`getopt -o ab:c:: --long a-long,b-long:,c-long:: \</span><br><span class="line">     -n 'example.bash' -- "$@"`</span><br><span class="line">if [ $? != 0 ] ; then echo "Terminating..." &gt;&amp;2 ; exit 1 ; fi</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">set</span> 会重新排列参数的顺序，也就是改变<span class="variable">$1</span>,<span class="variable">$2</span>...<span class="variable">$n</span>的值，这些值在getopt中重新排列过了</span></span><br><span class="line">eval set -- "$TEMP"</span><br><span class="line"><span class="meta">#</span><span class="bash">经过getopt的处理，下面处理具体选项。</span></span><br><span class="line">while true ; do</span><br><span class="line">        case "$1" in</span><br><span class="line">                -a|--a-long) echo "Option a" ; shift ;;</span><br><span class="line">                -b|--b-long) echo "Option b, argument \`$2'" ; shift 2 ;;</span><br><span class="line">                -c|--c-long)</span><br><span class="line">                        case "$2" in</span><br><span class="line">                                "") echo "Option c, no argument"; shift 2 ;;</span><br><span class="line">                                *)  echo "Option c, argument \`$2'" ; shift 2 ;;</span><br><span class="line">                        esac ;;</span><br><span class="line">                --) shift ; break ;;</span><br><span class="line">                *) echo "Internal error!" ; exit 1 ;;</span><br><span class="line">        esac</span><br><span class="line">done</span><br><span class="line">echo "Remaining arguments:"</span><br><span class="line">for arg do</span><br><span class="line">   echo '--&gt; '"\`$arg'" ;</span><br><span class="line">done</span><br><span class="line">运行命令：</span><br><span class="line">./getopt.sh -b abc -a -c33 remain</span><br><span class="line">Option b, argument `abc'</span><br><span class="line">Option a</span><br><span class="line">Option c, argument `33'</span><br><span class="line">Remaining arguments:</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> `remain<span class="string">'</span></span></span><br><span class="line">再举一个例子：（安装脚本里面的）</span><br><span class="line">function parse()</span><br><span class="line">&#123;"</span><br><span class="line">    RET=`getopt -o ht:e: \</span><br><span class="line">                --long help,type:,env: \</span><br><span class="line">                -n "ERROR" -- "$@"`</span><br><span class="line">    if [ $? -ne 0 ]</span><br><span class="line">    then</span><br><span class="line">        usage</span><br><span class="line">        exit 0</span><br><span class="line">    fi</span><br><span class="line">    eval set -- "$RET"</span><br><span class="line">    while true</span><br><span class="line">    do</span><br><span class="line">        case "$1" in</span><br><span class="line">            -h|--help)</span><br><span class="line">                usage</span><br><span class="line">                exit 0</span><br><span class="line">                ;;</span><br><span class="line">            -t|--type)</span><br><span class="line">                TYPE=$2</span><br><span class="line">                shift 2</span><br><span class="line">                ;;</span><br><span class="line">            -e|--env)</span><br><span class="line">                ENV=$2</span><br><span class="line">                shift 2</span><br><span class="line">                ;;</span><br><span class="line">            --)</span><br><span class="line">                shift</span><br><span class="line">                break</span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                usage</span><br><span class="line">                exit 0</span><br><span class="line">                ;;</span><br><span class="line">        esac</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="生成随机数"><a href="#生成随机数" class="headerlink" title="生成随机数"></a>生成随机数</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">1.使用系统的 $RANDOM 变量</span><br><span class="line">fdipzone@ubuntu:~$ echo $RANDOM  </span><br><span class="line">17617 </span><br><span class="line"><span class="meta">$</span><span class="bash">RANDOM 的范围是 [0, 32767]</span></span><br><span class="line">如需要生成超过32767的随机数，可以用以下方法实现。</span><br><span class="line">例：生成400000~500000的随机数</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">function rand()&#123;</span><br><span class="line">    min=$1</span><br><span class="line">    max=$(($2-$min+1))</span><br><span class="line">    num=$(($RANDOM+1000000000)) #增加一个10位的数再求余</span><br><span class="line">    echo $(($num%$max+$min))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rnd=$(rand 400000 500000)</span><br><span class="line">echo $rnd</span><br><span class="line">exit 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.使用date +%s%N</span><br><span class="line">例：生成1~50的随机数</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">function rand()&#123;</span><br><span class="line">    min=$1</span><br><span class="line">    max=$(($2-$min+1))</span><br><span class="line">    num=$(date +%s%N)</span><br><span class="line">    echo $(($num%$max+$min))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rnd=$(rand 1 50)</span><br><span class="line">echo $rnd</span><br><span class="line"></span><br><span class="line">exit 0</span><br><span class="line"></span><br><span class="line">3.使用/dev/random 和 /dev/urandom</span><br><span class="line">/dev/random 存储着系统当前运行环境的实时数据，是阻塞的随机数发生器，读取有时需要等待。</span><br><span class="line">/dev/urandom 非阻塞随机数发生器，读取操作不会产生阻塞。</span><br><span class="line">例：使用/dev/urandom生成100~500的随机数，使用urandom避免阻塞。</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">function rand()&#123;</span><br><span class="line">    min=$1</span><br><span class="line">    max=$(($2-$min+1))</span><br><span class="line">    num=$(cat /dev/urandom | head -n 10 | cksum | awk -F ' ' '&#123;print $1&#125;')</span><br><span class="line">    echo $(($num%$max+$min))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rnd=$(rand 100 500)</span><br><span class="line">echo $rnd</span><br><span class="line"></span><br><span class="line">exit 0</span><br><span class="line"></span><br><span class="line">4.使用linux uuid</span><br><span class="line">uuid 全称是通用唯一识别码，格式包含32个16进制数字，以'-'连接号分为5段。形式为8-4-4-4-12 的32个字符。</span><br><span class="line">fdipzone@ubuntu:~/shell$ cat /proc/sys/kernel/random/uuid</span><br><span class="line">fd496199-372a-403e-8ec9-bf4c52cbd9cd</span><br><span class="line">例：使用linux uuid 生成100~500随机数</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">function rand()&#123;</span><br><span class="line">    min=$1</span><br><span class="line">    max=$(($2-$min+1))</span><br><span class="line">    num=$(cat /proc/sys/kernel/random/uuid | cksum | awk -F ' ' '&#123;print $1&#125;')</span><br><span class="line">    echo $(($num%$max+$min))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rnd=$(rand 100 500)</span><br><span class="line">echo $rnd</span><br><span class="line"></span><br><span class="line">exit 0</span><br><span class="line"></span><br><span class="line">5.生成随机字符串</span><br><span class="line">例：生成10位随机字符串</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">使用date 生成随机字符串</span></span><br><span class="line">date +%s%N | md5sum | head -c 10</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">使用 /dev/urandom 生成随机字符串</span></span><br><span class="line">cat /dev/urandom | head -n 10 | md5sum | head -c 10</span><br></pre></td></tr></table></figure>

<h1 id="数组脚本"><a href="#数组脚本" class="headerlink" title="数组脚本"></a>数组脚本</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function swift_delete() &#123;</span><br><span class="line">url=`curl -s -d '&#123;"auth":&#123;"tenantName": "adminTenant","passwordCredentials":&#123;"username": "admin","password": "admin"&#125;&#125;&#125;' -H "Content-type:application/json" http://10.37.2.15:5000/v2.0/tokens | python -mjson.tool |grep "publicURL" |head -n 1 |awk -F '"' '&#123;print $4&#125;'`</span><br><span class="line">id=`curl -s -d '&#123;"auth":&#123;"tenantName": "adminTenant","passwordCredentials":&#123;"username": "admin","password": "admin"&#125;&#125;&#125;' -H "Content-type:application/json" http://10.37.2.15:5000/v2.0/tokens | python -mjson.tool |grep -A 12 token |grep -w id |head -n 1 |awk -F '"' '&#123;print $4&#125;'`</span><br><span class="line">a=()</span><br><span class="line">a=`curl -s -w  "%&#123;http_code&#125;" -X GET -H "X-Auth-Token:$&#123;id&#125;" $&#123;url&#125;/mycontainers1?format=json|jq .|grep name|sed 's/    "name": "//g'|sed 's/",//g'`</span><br><span class="line">for item in $&#123;a[@]&#125;</span><br><span class="line">do</span><br><span class="line">ret=`curl -s -w "%&#123;http_code&#125;" -X DELETE -H "X-Auth-Token:$&#123;id&#125;" $&#123;url&#125;/mycontainers1/$&#123;item&#125; |tail -1 |awk -F '[&#123;&#125;]' '&#123;print $NF&#125;'`</span><br><span class="line">done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">set i=0</span><br><span class="line">set j=0</span><br><span class="line">for((i=0;i&lt;3;))</span><br><span class="line">do</span><br><span class="line">        let "i=i+1"</span><br><span class="line">        swift_delete</span><br><span class="line">done</span><br></pre></td></tr></table></figure>



<h1 id="shell-中的动态变量名"><a href="#shell-中的动态变量名" class="headerlink" title="shell 中的动态变量名"></a>shell 中的动态变量名</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">vr_0=</span><br><span class="line">avr_1=</span><br><span class="line">avr_2=</span><br><span class="line">avr_3=</span><br><span class="line">avr_4=</span><br><span class="line">avr_5=</span><br><span class="line">avr_6=</span><br><span class="line">avr_7=</span><br><span class="line"></span><br><span class="line"><span class="comment"># 赋值 avr_x = </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 0 7)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">eval</span> avr_<span class="variable">$&#123;i&#125;</span>=<span class="variable">$&#123;i&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取值</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 0 7)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">tmp=$(<span class="built_in">eval</span> <span class="built_in">echo</span> <span class="string">'$'</span>avr_<span class="variable">$&#123;i&#125;</span>)</span><br><span class="line"><span class="built_in">eval</span> <span class="built_in">echo</span> <span class="variable">$&#123;tmp&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>



<h1 id="使用-dev-urandom生成固定位数的随机数"><a href="#使用-dev-urandom生成固定位数的随机数" class="headerlink" title="使用/dev/urandom生成固定位数的随机数"></a>使用/dev/urandom生成固定位数的随机数</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>纯数字</span><br><span class="line">head /dev/urandom | tr -dc <span class="number">0</span><span class="number">-9</span> | head -c n</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>小写字母+数字</span><br><span class="line">head /dev/urandom | tr -dc a-z0<span class="number">-9</span> | head -c n</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>大小写字母+数字</span><br><span class="line">head /dev/urandom | tr -dc A-Za-z0<span class="number">-9</span> | head -c n</span><br><span class="line">最后的n代表要生成的随机数的位数</span><br></pre></td></tr></table></figure>



<h1 id="监控脚本：check-sh"><a href="#监控脚本：check-sh" class="headerlink" title="监控脚本：check.sh"></a>监控脚本：check.sh</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">check.sh：</span><br><span class="line">function sar_count() &#123;</span><br><span class="line">echo "网络流量："</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">echo</span> <span class="string">"[<span class="variable">$(date +'%F %H:%M:%S')</span>]"</span></span></span><br><span class="line">sar_count=`sar -n DEV 1 1|sed -n '3p;5p'`</span><br><span class="line">echo "$&#123;sar_count&#125;"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function MEN_count() &#123;</span><br><span class="line">echo "内存："</span><br><span class="line">a=`free -m | sed -n '2p'|awk '&#123;print $2&#125;'`</span><br><span class="line">b=`free -m | sed -n '3p'|awk '&#123;print $3&#125;'`</span><br><span class="line">c=`echo "scale=2;$b/$a*100" |bc`</span><br><span class="line">d=`echo "total:"$a"M"`</span><br><span class="line">e=`echo "used:"$b"M"`</span><br><span class="line">f=`echo "%used:$&#123;c&#125;%"`</span><br><span class="line">echo "$(date +'%H:%M:%S')" "$&#123;d&#125;" "$&#123;e&#125;" "$&#123;f&#125;"</span><br><span class="line">echo " "</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function CPU_count() &#123;</span><br><span class="line">echo "CPU："</span><br><span class="line">date_count=`date +'%H:%M:%S'`</span><br><span class="line">sar -u 1 1|sed -n '3,4p'</span><br><span class="line"><span class="meta">#</span><span class="bash">iostat -x 1 1|sed -n <span class="string">'3,4p'</span>|sed <span class="string">'s/avg-cpu/'</span><span class="string">"<span class="variable">$date_count</span>"</span><span class="string">'/g'</span></span></span><br><span class="line">echo " "</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function IO_count() &#123;</span><br><span class="line">echo "磁盘IO："</span><br><span class="line">date_count=`date +'%H:%M:%S'`</span><br><span class="line">iostat -x 1 1|sed -n '6,16p'|sed 's/Device:/'"$date_count"'/g'</span><br><span class="line">echo " "</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for((j=0;j&lt;10;)); do</span><br><span class="line">sar_count</span><br><span class="line">MEN_count</span><br><span class="line">CPU_count</span><br><span class="line">IO_count</span><br><span class="line">echo "================================================================================================================="</span><br><span class="line">sleep 10</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h1 id="美女"><a href="#美女" class="headerlink" title="美女"></a>美女</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//                       .::::.</span><br><span class="line">//                     .::::::::. </span><br><span class="line">//                    :::::::::::    </span><br><span class="line">//                 ..:::::::::::'    </span><br><span class="line">//              '::::::::::::'       </span><br><span class="line">//                .::::::::::        </span><br><span class="line">//           '::::::::::::::..       </span><br><span class="line">//                ..::::::::::::.</span><br><span class="line">//              ``::::::::::::::::</span><br><span class="line">//               ::::``:::::::::'        .:::.</span><br><span class="line">//              ::::'   ':::::'       .::::::::.</span><br><span class="line">//            .::::'      ::::     .:::::::'::::.</span><br><span class="line">//           .:::'       :::::  .:::::::::' ':::::.</span><br><span class="line">//          .::'        :::::.:::::::::'      ':::::.</span><br><span class="line">//         .::'         ::::::::::::::'         ``::::.</span><br><span class="line">//     ...:::           ::::::::::::'              ``::.</span><br><span class="line">//    ```` ':.          ':::::::::'                  ::::..</span><br><span class="line">//                       '.:::::'                    ':'````.</span><br></pre></td></tr></table></figure>

<h1 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h1><p>top.sh</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">WHERE=$&#123;2&#125;</span><br><span class="line">mkdir -p $&#123;1&#125;</span><br><span class="line">rm -rf $&#123;1&#125;*</span><br><span class="line">for i in `cat $&#123;WHERE&#125;/needtomon.conf`</span><br><span class="line">do</span><br><span class="line">                mkdir $&#123;1&#125;$&#123;i&#125;</span><br><span class="line">done</span><br><span class="line">sleep 1</span><br><span class="line">for i in `cat $&#123;WHERE&#125;/needtomon.conf`</span><br><span class="line">do</span><br><span class="line">	ssh $&#123;i&#125; "sar -n DEV 1" &gt;&gt;$&#123;1&#125;$&#123;i&#125;/sar.txt &amp;</span><br><span class="line">	ssh $&#123;i&#125; "iostat -tkx 1" &gt;&gt;$&#123;1&#125;$&#123;i&#125;/iostat.txt &amp;</span><br><span class="line"><span class="meta">	#</span><span class="bash">ssh <span class="variable">$&#123;i&#125;</span> <span class="string">"ps auxw|head -1;ps auxw|sort -rn -k3|head -5"</span> &gt;&gt;<span class="variable">$&#123;1&#125;</span><span class="variable">$&#123;i&#125;</span>/cpu-top.txt</span></span><br><span class="line"><span class="meta">	#</span><span class="bash">ssh <span class="variable">$&#123;i&#125;</span> <span class="string">"ps auxw|head -1;ps auxw|sort -rn -k4|head -5"</span> &gt;&gt;<span class="variable">$&#123;1&#125;</span><span class="variable">$&#123;i&#125;</span>/mem-top.txt</span></span><br><span class="line">	ssh $&#123;i&#125; "vmstat -t 1" &gt;&gt;$&#123;1&#125;$&#123;i&#125;/vmstat.txt &amp;</span><br><span class="line">	ssh $&#123;i&#125; free |sed -n '2p'|awk '&#123;print $2&#125;' &gt;&gt;$&#123;1&#125;$&#123;i&#125;/memtotal.txt</span><br><span class="line">	ssh $&#123;i&#125; "cachehit" &gt;&gt; $&#123;1&#125;$&#123;i&#125;/CacheHit.txt &amp;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>log.sh</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">STARTTIME=$&#123;1&#125;</span><br><span class="line">ENDTIME=$&#123;2&#125;</span><br><span class="line">WHERE=$&#123;4&#125;</span><br><span class="line">SPSTARTTIME=`echo $&#123;STARTTIME&#125;|awk '&#123;print $2&#125;'|cut -b 1-5`</span><br><span class="line">SPENDTIME=`echo $&#123;ENDTIME&#125;|awk '&#123;print $2&#125;'|cut -b 1-5`</span><br><span class="line"></span><br><span class="line">k=0</span><br><span class="line">for i in `cat $&#123;WHERE&#125;/needtomon.conf` </span><br><span class="line">do</span><br><span class="line">	let k=k+1</span><br><span class="line">	echo "============="$&#123;i&#125;"=============" &gt;&gt;$&#123;3&#125;$&#123;i&#125;/$&#123;k&#125;.txt</span><br><span class="line">	enscript -B -p - $&#123;3&#125;$&#123;i&#125;/$&#123;k&#125;.txt | ps2pdf - |convert -background "rgb(199,237,204)" -extent 600x50 - $&#123;3&#125;$&#123;i&#125;/$&#123;k&#125;.png &gt;&gt; /dev/null 2&gt;&amp;1;</span><br><span class="line">	rm -rf $&#123;3&#125;$&#123;i&#125;/$&#123;k&#125;.txt </span><br><span class="line">	ssh $&#123;i&#125; "sed -n '/$&#123;SPSTARTTIME&#125;/,/$&#123;SPENDTIME&#125;/'p /mnt/snbslog/snbs/Gateway/gateway.INFO" &gt;&gt;$&#123;3&#125;$&#123;i&#125;/gateway.log</span><br><span class="line">	ssh $&#123;i&#125; "sed -n '/$&#123;SPSTARTTIME&#125;/,/$&#123;SPENDTIME&#125;/'p /mnt/snbslog/snbs/ChunkServer/chunkserver.INFO" &gt;&gt;$&#123;3&#125;$&#123;i&#125;/chunkserver.log</span><br><span class="line">	ssh $&#123;i&#125; "sed -n '/$&#123;SPSTARTTIME&#125;:/,/$&#123;SPENDTIME&#125;:/'p /mnt/snbslog/snbs/Speed/gateway.INFO" &gt;&gt;$&#123;3&#125;$&#123;i&#125;/gateway-speed.log</span><br><span class="line">	ssh $&#123;i&#125; "sed -n '/$&#123;SPSTARTTIME&#125;:/,/$&#123;SPENDTIME&#125;:/'p /mnt/snbslog/snbs/Speed/chunkserver.INFO" &gt;&gt;$&#123;3&#125;$&#123;i&#125;/chunkserver-speed.log</span><br><span class="line">	cat $&#123;3&#125;$&#123;i&#125;/gateway-speed.log|sed '/read/d;/rate/d;s/[ ][ ]*/,/g'|awk '$0=NR","$0' &gt;&gt; $&#123;3&#125;$&#123;i&#125;/gwspeed.log</span><br><span class="line">	cat $&#123;3&#125;$&#123;i&#125;/chunkserver-speed.log|sed '/read/d;/rate/d;s/[ ][ ]*/,/g'|awk '$0=NR","$0' &gt;&gt; $&#123;3&#125;$&#123;i&#125;/chspeed.log</span><br><span class="line">	cat $&#123;3&#125;$&#123;i&#125;/gateway.log|grep -A 81  Session|sed 's/      				//g'|sed 's/(0,4]ms://g'|sed 's/(4,8]ms://g'|sed 's/(8,12]ms://g'|sed 's/(16,20]ms://g'|sed 's/(20,30]ms://g'|sed 's/(30,...]ms://g'|sed 's/(12,16]ms://g'|sed 's/      /,/g'|sed 's/ //g'|sed 's/,,/,/g'|grep -v Session|grep -v 2020 &gt;&gt; $&#123;3&#125;$&#123;i&#125;/$&#123;i&#125;.log</span><br><span class="line">	a=`cat $&#123;3&#125;$&#123;i&#125;/$&#123;i&#125;.log|grep -E "write|read|request"|sort -n| uniq|grep -E "gateway_singlechunk|gateway"|grep -v gather`</span><br><span class="line">	for j in $&#123;a[@]&#125;</span><br><span class="line">	do</span><br><span class="line">		cat $&#123;3&#125;$&#123;i&#125;/$&#123;i&#125;.log|grep -A 2 "$&#123;j&#125;$"|grep -v $&#123;j&#125; &gt;&gt; $&#123;3&#125;$&#123;i&#125;/$&#123;j&#125;.txt</span><br><span class="line">		echo "--" &gt;&gt; $&#123;3&#125;$&#123;i&#125;/$&#123;j&#125;.txt</span><br><span class="line">		sed -i "1i--" $&#123;3&#125;$&#123;i&#125;/$&#123;j&#125;.txt</span><br><span class="line">		cat $&#123;3&#125;$&#123;i&#125;/$&#123;j&#125;.txt|grep -A 1 "\-\-"|grep -v "\-\-"|awk '$0=NR"\t"$0'|sed 's/	/,/g' &gt;&gt; $&#123;3&#125;$&#123;i&#125;/delay-$&#123;j&#125;.txt</span><br><span class="line">		rm -rf $&#123;3&#125;$&#123;i&#125;/$&#123;j&#125;.txt</span><br><span class="line">	done</span><br><span class="line">	python $&#123;WHERE&#125;/3.pyc $&#123;3&#125;$&#123;i&#125;/ $&#123;i&#125; &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">	python $&#123;WHERE&#125;/speed.py $&#123;3&#125;$&#123;i&#125;/ gwspeed.log gwspeed- &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">	python $&#123;WHERE&#125;/speed.py $&#123;3&#125;$&#123;i&#125;/ chspeed.log chspeed- &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">	cp -r $&#123;3&#125;$&#123;i&#125;/delay.png $&#123;3&#125;delay-$&#123;k&#125;.png</span><br><span class="line">	ssh $&#123;i&#125; "sh /opt/peace/cacehit.sh"</span><br><span class="line">done</span><br><span class="line">cd $&#123;3&#125;</span><br><span class="line">PNG=`ls delay*|sort -t - -k2 -n`</span><br><span class="line">convert $&#123;PNG&#125; -append gw-delay.png &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">convert vdbench.png gw-delay.png cpu-mem-all.png iostatall.png sarall.png  -append all.png &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">rm -rf delay* vdbench.png gw-delay.png cpu-mem-all.png iostatall.png sarall.png iostat-all.txt sar-all.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">DIR=`<span class="built_in">echo</span> <span class="variable">$&#123;3&#125;</span>|awk -F / <span class="string">'&#123;print $(NF-1)&#125;'</span>`</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">cd</span> ../</span></span><br><span class="line"><span class="meta">#</span><span class="bash">tar -zcvf <span class="variable">$&#123;DIR&#125;</span>.tar.gz <span class="variable">$&#123;DIR&#125;</span>/ &gt;&gt; /dev/null 2&gt;&amp;1</span></span><br><span class="line"><span class="meta">#</span><span class="bash">mv <span class="variable">$&#123;DIR&#125;</span>.tar.gz <span class="variable">$&#123;DIR&#125;</span>/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">cd</span> - &gt;&gt; /dev/null 2&gt;&amp;1</span></span><br><span class="line"></span><br><span class="line">j=0</span><br><span class="line">for i in `cat $&#123;WHERE&#125;/needtomon.conf`</span><br><span class="line">do</span><br><span class="line">	cd $&#123;i&#125;</span><br><span class="line">	let j=j+1</span><br><span class="line">	rm -rf mem-a.txt vmstat-a.txt vmstat-b.txt vmstat-all.txt $&#123;i&#125;.log delay*.txt</span><br><span class="line">        convert gwspeed-io-rate.png gwspeed-read-iops.png gwspeed-read-bytes.png gwspeed-read-resp.png gwspeed-read-maxResp.png gwspeed-write-iops.png gwspeed-write-bytes.png gwspeed-write-resp.png gwspeed-write-maxResp.png gwspeed-MBsec-1024-2.png gwspeed-queue-depth.png -append gwspeed.png &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">        convert chspeed-io-rate.png chspeed-read-iops.png chspeed-read-bytes.png chspeed-read-resp.png chspeed-read-maxResp.png chspeed-write-iops.png chspeed-write-bytes.png chspeed-write-resp.png chspeed-write-maxResp.png chspeed-MBsec-1024-2.png chspeed-queue-depth.png -append chspeed.png &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">	convert $&#123;j&#125;.png gwspeed.png -append ../gwspeed-$&#123;j&#125;.png &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">	convert $&#123;j&#125;.png chspeed.png -append ../chspeed-$&#123;j&#125;.png &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">        rm -rf gwspeed*.png</span><br><span class="line">        rm -rf chspeed*.png</span><br><span class="line">	cd - &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">done</span><br><span class="line">PNG1=`ls gwspeed*.png|sort -t - -k2 -n`</span><br><span class="line">convert $&#123;PNG1&#125; -append gw-speed.png &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">PNG2=`ls chspeed*.png|sort -t - -k2 -n`</span><br><span class="line">convert $&#123;PNG2&#125; -append ch-speed.png &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">rm -rf $&#123;PNG1&#125; $&#123;PNG2&#125;</span><br><span class="line"></span><br><span class="line">DIR=`echo $&#123;3&#125;|awk -F / '&#123;print $(NF-1)&#125;'`</span><br><span class="line">cd ../</span><br><span class="line">tar -zcvf $&#123;DIR&#125;.tar.gz $&#123;DIR&#125;/ &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">mv $&#123;DIR&#125;.tar.gz $&#123;DIR&#125;/</span><br><span class="line">cd - &gt;&gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>order.sh</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">WHERE=$&#123;2&#125;</span><br><span class="line">cd $&#123;1&#125;</span><br><span class="line">rm -rf  $&#123;1&#125;iostat-all.txt</span><br><span class="line">rm -rf $&#123;1&#125;sar-all.txt</span><br><span class="line">j=0</span><br><span class="line">for i in `cat $&#123;WHERE&#125;/needtomon.conf`</span><br><span class="line">do</span><br><span class="line">	let j=j+1</span><br><span class="line">	cd $i</span><br><span class="line">	rm -rf vmstat-b.txt vmstat-a.txt mem-a.txt vmstat-all.txt</span><br><span class="line">	echo "============="$&#123;i&#125;"=============" &gt;&gt; ../iostat-all.txt</span><br><span class="line">	echo "============="$&#123;i&#125;"=============" &gt;&gt; ../sar-all.txt</span><br><span class="line">	cat iostat.txt | head -n 299 | tail -n +219 &gt;&gt; ../iostat-all.txt</span><br><span class="line">	cat sar.txt | head -n 209 | tail -n +175    &gt;&gt; ../sar-all.txt</span><br><span class="line">	cat vmstat.txt |sed '/procs/d'|sed '/swpd/d'|awk '&#123;print 100-$15","$13","$14","$16","$4","$5","$6&#125;' &gt;&gt; vmstat-b.txt</span><br><span class="line">	totalmem=`cat memtotal.txt`</span><br><span class="line">	sed -i 's/$/,'$&#123;totalmem&#125;'/' vmstat-b.txt</span><br><span class="line">	cat vmstat-b.txt|awk '$0=NR"\t"$0'|sed 's/	/,/g' &gt;&gt; vmstat-a.txt</span><br><span class="line">	cat vmstat-a.txt |awk -F , '&#123;print ($9-$8-$7-$6)*100/$9&#125;' &gt;&gt; mem-a.txt</span><br><span class="line">	paste -d, vmstat-a.txt mem-a.txt  &gt;&gt; vmstat-all.txt</span><br><span class="line">	python $&#123;WHERE&#125;/5.pyc ./ $&#123;i&#125;</span><br><span class="line">	convert cpu.png mem.png -append cpu-mem.png &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">        mv cpu-mem.png ../cpu-mem-$&#123;j&#125;.png</span><br><span class="line">	cd - &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">cd</span> <span class="variable">$&#123;1&#125;</span></span></span><br><span class="line">for i in iostat sar</span><br><span class="line">do </span><br><span class="line">	enscript -B -p - $&#123;i&#125;-all.txt | ps2pdf - |convert -background "rgb(199,237,204)" -extent 600x800 - $&#123;i&#125;.png &gt; /dev/null 2&gt;&amp;1;</span><br><span class="line">	PNG=`ls $&#123;i&#125;-*.png|sort -t - -k2 -n`</span><br><span class="line">	convert $&#123;PNG&#125; -append $&#123;i&#125;all.png &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">done</span><br><span class="line">rm -rf iostat-*.png sar-*.png</span><br><span class="line">convert iops.png  MB.png  read-resp.png write-resp.png resp.png resp-max.png -append vdbench.png</span><br><span class="line">rm -rf iops.png  MB.png  read-resp.png write-resp.png resp.png resp-max.png resp-max.png</span><br><span class="line"></span><br><span class="line">PNG=`ls cpu-mem-*|sort -t - -k2 -n`</span><br><span class="line">convert $&#123;PNG&#125; -append cpu-mem-all.png &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">convert cpu-mem-1.png cpu-mem-2.png cpu-mem-3.png cpu-mem-4.png cpu-mem-5.png cpu-mem-6.png -append cpu-mem-all.png</span><br><span class="line">rm -rf cpu-mem-1.png cpu-mem-2.png cpu-mem-3.png cpu-mem-4.png cpu-mem-5.png cpu-mem-6.png</span><br></pre></td></tr></table></figure>

<h1 id="ip是否通验证脚本"><a href="#ip是否通验证脚本" class="headerlink" title="ip是否通验证脚本"></a>ip是否通验证脚本</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">for i in `cat hostip.txt`</span><br><span class="line">do</span><br><span class="line"><span class="meta">#</span><span class="bash">ping -c 4 <span class="variable">$i</span>|grep -q <span class="string">'ttl='</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span> ok"</span> || <span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span> failed"</span></span></span><br><span class="line">ping -c 4 $i|grep -q 'ttl=' || echo "$i failed"</span><br><span class="line">done</span><br></pre></td></tr></table></figure>



<h1 id="shell脚本转换成二进制的可执行文件方法–加密"><a href="#shell脚本转换成二进制的可执行文件方法–加密" class="headerlink" title="shell脚本转换成二进制的可执行文件方法–加密"></a>shell脚本转换成二进制的可执行文件方法–加密</h1><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">shell</span>脚本转换成二进制的可执行文件方法--加密</span><br><span class="line"></span><br><span class="line">第一种方法(gzexe)：</span><br><span class="line">这种加密方式不是非常保险的方法，但是能够满足一般的加密用途，可以隐蔽脚本中的密码等信息。</span><br><span class="line">它是使用系统自带的gzexe程序，它不但加密，同时压缩文件。</span><br><span class="line">使用方法:</span><br><span class="line">gzexe <span class="keyword">file</span>.<span class="keyword">sh</span></span><br><span class="line">它会把原来没有加密的文件备份为 <span class="keyword">file</span>.<span class="keyword">sh</span>~ ,同时 <span class="keyword">file</span>.<span class="keyword">sh</span> 即被变成加密文件；</span><br></pre></td></tr></table></figure>



<h1 id="echo-在shell及脚本中显示色彩及闪烁警告效果"><a href="#echo-在shell及脚本中显示色彩及闪烁警告效果" class="headerlink" title="echo 在shell及脚本中显示色彩及闪烁警告效果"></a>echo 在shell及脚本中显示色彩及闪烁警告效果</h1><p><a href="https://www.cnblogs.com/su-root/p/10743544.html" target="_blank" rel="noopener external nofollow noreferrer">https://www.cnblogs.com/su-root/p/10743544.html</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">语法格式：</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[颜色1:颜色2m 要展示的文字 \033[0m"</span></span><br></pre></td></tr></table></figure>



<h1 id="，-：-，：-，-？的使用"><a href="#，-：-，：-，-？的使用" class="headerlink" title="${}，##, %% , ：- ，：+， ？的使用"></a>${}，##, %% , ：- ，：+， ？的使用</h1><p><a href="https://www.jianshu.com/p/f7234405eb79" target="_blank" rel="noopener external nofollow noreferrer">https://www.jianshu.com/p/f7234405eb79</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">假设我们定义了一个变量为：</span><br><span class="line">file=/dir1/dir2/dir3/my.file.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">是左，$是右</span></span><br><span class="line"></span><br><span class="line">可以用$&#123; &#125;分别替换得到不同的值：</span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file<span class="comment">#*/&#125;：删掉第一个/ 及其左边的字符串：dir1/dir2/dir3/my.file.txt</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file<span class="comment">##*/&#125;：删掉最后一个/ 及其左边的字符串：my.file.txt</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file<span class="comment">#*.&#125;：删掉第一个.  及其左边的字符串：file.txt</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file<span class="comment">##*.&#125;：删掉最后一个.  及其左边的字符串：txt</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file%/*&#125;：删掉最后一个 /  及其右边的字符串：/dir1/dir2/dir3</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file%%/*&#125;：删掉第一个/  及其右边的字符串：(空值)</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file%.*&#125;：删掉最后一个 .  及其右边的字符串：/dir1/dir2/dir3/my.file</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file%%.*&#125;：删掉第一个. 及其右边的字符串：/dir1/dir2/dir3/my</span></span><br><span class="line"></span><br><span class="line">记忆的方法为：</span><br><span class="line"><span class="meta">#</span><span class="bash"> 是 去掉左边（键盘上<span class="comment">#在 $ 的左边）</span></span></span><br><span class="line"><span class="meta">%</span><span class="bash">是去掉右边（键盘上% 在$ 的右边）</span></span><br><span class="line">单一符号是最小匹配；两个符号是最大匹配</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file:0:5&#125;：提取最左边的5 个字节：/dir1</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file:5:5&#125;：提取第5 个字节右边的连续5个字节：/dir2</span></span><br><span class="line"></span><br><span class="line">也可以对变量值里的字符串作替换：</span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file/dir/path&#125;：将第一个dir 替换为path：/path1/dir2/dir3/my.file.txt</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file//dir/path&#125;：将全部dir 替换为path：/path1/path2/path3/my.file.txt</span></span><br><span class="line"></span><br><span class="line">利用$&#123; &#125; 还可针对不同的变数状态赋值(沒设定、空值、非空值)： </span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file-my.file.txt&#125; ：假如<span class="variable">$file</span> 沒有设定，則使用my.file.txt 作传回值。(空值及非空值時不作处理) </span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file:-my.file.txt&#125; ：假如<span class="variable">$file</span> 沒有設定或為空值，則使用my.file.txt 作傳回值。(非空值時不作处理)</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file+my.file.txt&#125; ：假如<span class="variable">$file</span> 設為空值或非空值，均使用my.file.txt 作傳回值。(沒設定時不作处理)</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file:+my.file.txt&#125; ：若<span class="variable">$file</span> 為非空值，則使用my.file.txt 作傳回值。(沒設定及空值時不作处理)</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file=my.file.txt&#125; ：若<span class="variable">$file</span> 沒設定，則使用my.file.txt 作傳回值，同時將<span class="variable">$file</span> 賦值為my.file.txt 。(空值及非空值時不作处理)</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file:=my.file.txt&#125; ：若<span class="variable">$file</span> 沒設定或為空值，則使用my.file.txt 作傳回值，同時將<span class="variable">$file</span> 賦值為my.file.txt 。(非空值時不作处理)</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file?my.file.txt&#125; ：若<span class="variable">$file</span> 沒設定，則將my.file.txt 輸出至STDERR。(空值及非空值時不作处理)</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;file:?my.file.txt&#125; ：若<span class="variable">$file</span> 没设定或为空值，则将my.file.txt 输出至STDERR。(非空值時不作处理)</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;<span class="comment">#var&#125; 可计算出变量值的长度：</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;<span class="comment">#file&#125; 可得到27 ，因为/dir1/dir2/dir3/my.file.txt 是27个字节</span></span></span><br></pre></td></tr></table></figure>



<h1 id="脚本举例："><a href="#脚本举例：" class="headerlink" title="脚本举例："></a>脚本举例：</h1><h2 id="SHELL打印两个日期之间的日期"><a href="#SHELL打印两个日期之间的日期" class="headerlink" title="SHELL打印两个日期之间的日期"></a>SHELL打印两个日期之间的日期</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@umout shell]# cat date_to_date.sh    </span><br><span class="line"><span class="attribute">THIS_PATH</span>=$(cd `dirname <span class="variable">$0</span>`;)</span><br><span class="line">cd <span class="variable">$THIS_PATH</span></span><br><span class="line"><span class="comment">##要求传入的数据格式为yyyyMMdd的两个开始和结束参数，如20170201 20170310</span></span><br><span class="line"><span class="attribute">start_input</span>=<span class="variable">$1</span></span><br><span class="line"><span class="attribute">end_input</span>=<span class="variable">$2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##将输入的日期转为的时间戳格式</span></span><br><span class="line"><span class="attribute">startDate</span>=`date -d <span class="string">"<span class="variable">$&#123;start_input&#125;</span>"</span> +%s`</span><br><span class="line"><span class="attribute">endDate</span>=`date -d <span class="string">"<span class="variable">$&#123;end_input&#125;</span>"</span> +%s`</span><br><span class="line"></span><br><span class="line"><span class="comment">##计算两个时间戳的差值除于每天86400s即为天数差</span></span><br><span class="line"><span class="attribute">stampDiff</span>=`expr <span class="variable">$endDate</span> - <span class="variable">$startDate</span>`</span><br><span class="line"><span class="attribute">dayDiff</span>=`expr <span class="variable">$stampDiff</span> / 86400`</span><br><span class="line"></span><br><span class="line"><span class="comment">##根据天数差循环输出日期</span></span><br><span class="line"><span class="keyword">for</span>((<span class="attribute">i</span>=0;i&lt;$dayDiff;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="attribute">process_date</span>=`date -d <span class="string">"<span class="variable">$&#123;start_input&#125;</span> <span class="variable">$i</span> day"</span> +<span class="string">'%Y-%m-%d'</span>`</span><br><span class="line">    echo <span class="variable">$process_date</span></span><br><span class="line">done</span><br></pre></td></tr></table></figure>



<h2 id="shell中AScll值和字符之间的转换"><a href="#shell中AScll值和字符之间的转换" class="headerlink" title="shell中AScll值和字符之间的转换"></a>shell中AScll值和字符之间的转换</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Shell中ASCII值和字符之间的转换</span><br><span class="line"><span class="number">97</span><span class="number">-121</span></span><br><span class="line">  <span class="number">1</span>、ASCII值转换为字符</span><br><span class="line">       方法一：</span><br><span class="line">       i=<span class="number">97</span></span><br><span class="line">       echo $i | awk '&#123;printf(<span class="string">"%c"</span>, $<span class="number">1</span>)&#125;'</span><br><span class="line">      方法二：</span><br><span class="line"></span><br><span class="line">      t=`printf <span class="string">"%x"</span> <span class="number">97</span>`</span><br><span class="line">      printf <span class="string">"<span class="subst">\\</span>x$t"</span></span><br><span class="line">      或者直接</span><br><span class="line">      printf \\x`printf %x <span class="number">97</span>`</span><br><span class="line">         注意上面是的字符不是“’”,而是数字键<span class="number">1</span>前面的那个字符“·”。</span><br><span class="line"></span><br><span class="line">  <span class="number">2</span>、字符转换为ASCII值</span><br><span class="line">      方法一：</span><br><span class="line">       printf <span class="string">"%d"</span> \'a</span><br><span class="line">       或者</span><br><span class="line">       printf <span class="string">"%d"</span> <span class="string">"'a"</span></span><br><span class="line">    方法二：</span><br><span class="line">        echo <span class="string">"A"</span>| tr -d <span class="string">"<span class="subst">\n</span>"</span> | od -An -t dC</span><br></pre></td></tr></table></figure>



<h2 id="切换用户执行脚本："><a href="#切换用户执行脚本：" class="headerlink" title="切换用户执行脚本："></a>切换用户执行脚本：</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su - browsr &lt;&lt; EOF</span><br><span class="line">xxxx;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>





<h1 id="简单的将Shell和一些文件打包成一个单独的“可执行文件”"><a href="#简单的将Shell和一些文件打包成一个单独的“可执行文件”" class="headerlink" title="简单的将Shell和一些文件打包成一个单独的“可执行文件”"></a>简单的将Shell和一些文件打包成一个单独的“可执行文件”</h1><p><a href="https://www.cnblogs.com/scue/p/4447911.html" target="_blank" rel="noopener external nofollow noreferrer">https://www.cnblogs.com/scue/p/4447911.html</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">有时候给别人分享一个工具的时候，同时需要提供的文件比较多；</span><br><span class="line"></span><br><span class="line">如果分享一个压缩包还得教会对方如何解压、执行哪个脚本，感觉需要传输的内容多了就不方便；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">把几个Shell脚本和文件打包成一个“单独的可执行文件”，对方接收到这个文件，只需要执行一下这个文件，就可以实现解压、执行对应脚本了，相对比较方便；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash - </span></span><br><span class="line"><span class="meta">#</span><span class="bash">===============================================================================</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">          FILE: shell_pack.sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash">         USAGE: ./shell_pack.sh </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash">   DESCRIPTION: </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash">       OPTIONS: ---</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  REQUIREMENTS: ---</span></span><br><span class="line"><span class="meta">#</span><span class="bash">          BUGS: ---</span></span><br><span class="line"><span class="meta">#</span><span class="bash">         NOTES: ---</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        AUTHOR: lwq (28120), scue@vip.qq.com</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  ORGANIZATION: </span></span><br><span class="line"><span class="meta">#</span><span class="bash">       CREATED: 04/22/2015 02:38:01 PM CST</span></span><br><span class="line"><span class="meta">#</span><span class="bash">      REVISION:  ---</span></span><br><span class="line"><span class="meta">#</span><span class="bash">===============================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">===  FUNCTION  ================================================================</span></span><br><span class="line"><span class="meta">#</span><span class="bash">         NAME:  usage</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  DESCRIPTION:  Display usage information.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">===============================================================================</span></span><br><span class="line">function usage ()</span><br><span class="line">&#123;</span><br><span class="line">        cat &lt;&lt;- EOT</span><br><span class="line"></span><br><span class="line">  Usage :  $0 -p package -s script file1 file2 file3 ..</span><br><span class="line"></span><br><span class="line">  Options:</span><br><span class="line">  -h|help       Display this message</span><br><span class="line">  -p|package    The output package name</span><br><span class="line">  -s|script     The script will run when unpack package</span><br><span class="line">  Other         The all files what you want to pack</span><br><span class="line"></span><br><span class="line">EOT</span><br><span class="line">&#125;    # ----------  end of function usage  ----------</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  Handle <span class="built_in">command</span> line arguments</span></span><br><span class="line"><span class="meta">#</span><span class="bash">-----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">while getopts ":hp:s:" opt</span><br><span class="line">do</span><br><span class="line">  case $opt in</span><br><span class="line"></span><br><span class="line">    h|help    ) usage; exit 0   ;;</span><br><span class="line">    p|package ) package_name=$OPTARG ;;</span><br><span class="line">    s|script  ) install_script=$OPTARG ;;</span><br><span class="line">    \?        ) echo -e "\n  Option does not exist : $OPTARG\n"</span><br><span class="line">          usage; exit 1   ;;</span><br><span class="line"></span><br><span class="line">  esac    # --- end of case ---</span><br><span class="line">done</span><br><span class="line">shift $(($OPTIND-1))</span><br><span class="line"></span><br><span class="line">if [[ -z $package_name ]]; then</span><br><span class="line">    echo "package_name can't not be empty"</span><br><span class="line">    usage</span><br><span class="line">    exit</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ -z $package_name ]]; then</span><br><span class="line">    echo "install_script can't not be empty"</span><br><span class="line">    usage</span><br><span class="line">    exit</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">files=$@</span><br><span class="line"></span><br><span class="line">generate_wrapper_script()&#123;</span><br><span class="line">    local install_script=$1</span><br><span class="line">    local wrapper_script=$2</span><br><span class="line">    cat &lt;&lt;-'EOT' &gt;$wrapper_script</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">echo "begin ..."</span><br><span class="line">unpackdir=/tmp/$(basename $0)_unpack</span><br><span class="line">rm -rf $unpackdir 2&gt;/dev/null</span><br><span class="line">mkdir -p $unpackdir</span><br><span class="line">echo "unpacking ..."</span><br><span class="line">sed '1, /^#__SCRIPTEND__/d' $0 | tar zxf - -C $unpackdir</span><br><span class="line">if [ $? -ne 0 ]; then</span><br><span class="line">    echo "unpack package failed."</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line">echo ""</span><br><span class="line">echo "installing ..."</span><br><span class="line">cd $unpackdir</span><br><span class="line">EOT</span><br><span class="line">    cat &lt;&lt;-EOR &gt;&gt;$wrapper_script</span><br><span class="line">chmod +x $install_script</span><br><span class="line">./$install_script</span><br><span class="line">EOR</span><br><span class="line">    cat &lt;&lt;-'EOE' &gt;&gt;$wrapper_script</span><br><span class="line">if [ $? -ne 0 ]; then</span><br><span class="line">    echo "install failed."</span><br><span class="line">    exit 2</span><br><span class="line">elif [[ -d $unpackdir ]]; then</span><br><span class="line">    rm -rf $unpackdir</span><br><span class="line">fi</span><br><span class="line">echo "install ok, enjoy!"</span><br><span class="line">exit 0</span><br><span class="line"><span class="meta">#</span><span class="bash">__SCRIPTEND__</span></span><br><span class="line">EOE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tarfile=package_content_$$.tgz</span><br><span class="line">wrapfile=wrap_$$.sh</span><br><span class="line"></span><br><span class="line">echo -e "start packing ..\n"</span><br><span class="line">tar zcvf $tarfile $files $install_script</span><br><span class="line">generate_wrapper_script $install_script $wrapfile</span><br><span class="line">cat $wrapfile $tarfile &gt; $package_name</span><br><span class="line">chmod +x $package_name</span><br><span class="line"></span><br><span class="line">echo -e "\noutput: $package_name\n"</span><br><span class="line"></span><br><span class="line">rm -f $tarfile</span><br><span class="line">rm -f $wrapfile</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">文件内容保存到 shell_pack.sh，使用方法举例：</span><br><span class="line"></span><br><span class="line">　　./shell_pack.sh -p logcat_install -s logcat_install.sh logcat_all.sh logcat_wrapper.sh vmstat2</span><br><span class="line"></span><br><span class="line">将产生可执行文件“logcat_install”，执行logcat_install时，会解压自身文件内的tar.gz文件，并执行关键的脚本 logcat_install.sh</span><br></pre></td></tr></table></figure>

<h1 id="Linux高级编程"><a href="#Linux高级编程" class="headerlink" title="Linux高级编程"></a>Linux高级编程</h1><p>进程间通信（Interprocess Communication）</p>
<h2 id="ALP-Chapter-5-进程间通信（Interprocess-Communication）"><a href="#ALP-Chapter-5-进程间通信（Interprocess-Communication）" class="headerlink" title="ALP Chapter 5 进程间通信（Interprocess Communication）"></a>ALP Chapter 5 进程间通信（Interprocess Communication）</h2><ul>
<li>这一章就是著名的IPC，这个东西实际的作用和它的名字一样普及。例如我们浏览网页，打印文章，等等。</li>
<li>IPC总共有五种类型：<ul>
<li>共享内存(Shared Memory)：最容易理解的一种，就像一个特工把情报放在特定地点(内存)，另一个特工再过来取走一样。</li>
<li>内存映射(Mapped Memory)：和共享内存几乎相同，除了特工们把地点从内存改成了文件系统。</li>
<li>管道(Pipes)：从一个进程到另一个进程的有序通信，用电话来比喻再恰当不过了。</li>
<li>FIFOs：和管道和类似，唯一的区别是FIFOs比管道更神通一些，允许没有关系的进程之间的有序通信。</li>
<li>套接字(Sockets)：为什么说浏览网页也是IPC？就是因为它。</li>
</ul>
</li>
</ul>
<h2 id="5-1-共享内存（Shared-Memory）"><a href="#5-1-共享内存（Shared-Memory）" class="headerlink" title="5.1 共享内存（Shared Memory）"></a>5.1 共享内存（Shared Memory）</h2><ul>
<li>共享内存是最快捷的进程间通信方式。访问共享内存的效率和访问进程自己的非共享内存的效率是相同的，而且这种通信方式不需要任何额外的系统调用。</li>
<li>系统不会自动为共享内存处理同步问题，这个问题必须由用户自己解决。</li>
<li>共享内存的步骤通常是：<ul>
<li>一个进程申请一块共享内存，即在它的页表中加入新的一项</li>
<li>所有进程Attach该共享内存，即从申请内存的进程中拷贝对应的页表</li>
<li>使用该内存进行通讯</li>
<li>结束后所有进程detach该共享内存</li>
<li>申请共享内存的进程在确定所有进程都detach后，释放该内存</li>
</ul>
</li>
<li>由于共享内存是通过页表来实现的，我们可以得出一个结论：共享内存的大小是页面大小的整数倍，页面的大小可以通过getpagesize()来得到，通常在Linux下该值是4KB</li>
<li>相关的API函数：<ul>
<li>申请共享内存：shmget，返回共享内存segment的id</li>
<li>Attach，Detach函数：shmat，shmdt。需要共享内存segment的id</li>
<li>释放申请的内存：shmctl。一定要记得释放！调用exit和exec会自动detach，但不会自动释放。</li>
</ul>
</li>
<li>使用 ipcs -m来观看当前系统存在的共享内存</li>
</ul>
<h2 id="5-2-进程信号量"><a href="#5-2-进程信号量" class="headerlink" title="5.2 进程信号量"></a>5.2 进程信号量</h2><ul>
<li>信号量(Semaphore)的概念前面已经介绍过了。Linux对用来同步进程的信号量采取了一种特别的实现方式。这些信号量也就被称为进程信号量(Process Semaphore)。（这一节下面所提到的所有信号量默认都是指进程信号量）</li>
<li>相关的API函数：<ul>
<li>申请：semget</li>
<li>释放：semctl。需要注意的是信号量不会被自动释放，我们必须显式释放它。</li>
<li>Wait和Post：semop</li>
</ul>
</li>
<li>使用ipcs -s来观看当前系统存在的信号量</li>
</ul>
<h2 id="5-3-内存映射"><a href="#5-3-内存映射" class="headerlink" title="5.3 内存映射"></a>5.3 内存映射</h2><ul>
<li>内存映射使得不同的进程可以通过一个共享文件来互相通信。</li>
<li>相关的API函数：<ul>
<li>映射：mmap</li>
<li>同步：msync。用来指定对文件的修改是否被buffer。</li>
<li>释放：munmap。在程序结束的时候会自动unmap</li>
</ul>
</li>
<li>mmap的其他用法：<ul>
<li>可以替代read和write，有时使用内存映射后的效率比单纯使用I/O操作来的更快</li>
<li>在内存映射文件中构建structure，修改structure再次将文件映射到内存中可以快速的将structure恢复到原来的状态</li>
<li>把/dev/zero文件映射到内存中。该文件可以提供无限的0，并且写到该文件的所有内容将被直接丢弃</li>
</ul>
</li>
</ul>
<h2 id="5-4-管道（Pipes）"><a href="#5-4-管道（Pipes）" class="headerlink" title="5.4 管道（Pipes）"></a>5.4 管道（Pipes）</h2><ul>
<li>管道是单向的，即一个线程写，另一个线程读，无法互换</li>
<li>如果写的速度太快，造成管道满了，那么写的线程就会被block；如果读的速度太快，造成管道空了，那么读的进程就会被block。因此事实上我们可以说管道自动实现了同步机制</li>
<li>我们可以通过调用pipe函数来生成一对pipe file description。（为什么是一对？因为一个读一个写）。可是，生成的pipe file description无法传送给不相关的进程（因为做为file descriptor即使它拿到了也没法用）。但是我们注意到fork之后父进程所有的file descriptor在子进程中依然有效，因此管道最大的作用是在父子进程之间通信。或者更确切的说，是在有共同祖先的进程之间通信。</li>
<li>典型的创建管道的流程如下：<ul>
<li>用pipe生成2个pipe file description（简称fds）。然后调用fork</li>
<li>在父进程关闭fds<a href="或fds[1]">0</a>，并以只读（或只写）方式打开fds<a href="或fds[0]">1</a>。在子进程中关闭fds<a href="或fds[0]">1</a>，并以只写(或只读)方式打开fds<a href="或fds[1]">0</a>。打开的函数是fdopen。</li>
<li>开始通信。结束后用close函数关闭剩下的fds。</li>
</ul>
</li>
<li>这里有一个技巧：可以利用管道来达成重定向stdin, stdout和stderr。注意到dup2这个API可以把一个file descriptor复制到另一个上。</li>
<li>事实上，我们有一对更为简洁的函数popen/pclose来完成上面的一系列复杂的操作。popen有两个参数：<ul>
<li>第一个参数接受一个exec，子进程将执行这个exec</li>
<li>第二个参数为”w”或者”r”，”w”表示父进程写子进程读，”r”则反之</li>
<li>返回值为管道的一端，也就是一个file descriptor</li>
<li>pclose用来关闭popen返回的file descriptor</li>
</ul>
</li>
<li>FIFO（First In First Out）文件事实上是一个有名字的管道，换句话说，他可以用来让“不相干”的程序互相通信。<ul>
<li>我们使用mkfifo函数来创建一个FIFO文件</li>
<li>我们可以使用任何的低级I/O函数(open, write, read, close等)以及C库I/O函数(fopen, fprintf, fscanf, fclose等)来操作FIFO文件。</li>
</ul>
</li>
<li>Linux的管道和Windows下的命名管道(Named Pipes)的区别<ul>
<li>Windows的命名管道更像一个套接字(sockets)，它可以通过网络让不同主机上的程序进行通信</li>
<li>Linux的管道允许有多个reader和writer，每个reader和writer进行读/写的最大容量为 PIPE_BUF(4KB)，如果有多个writer同时写，他们写的东西会被分为一个一个的chunk（每个4KB）并允许交错写。（例如进程A有两个 chunk，A1，A2。进程B也有两个chunk，B1，B2。A和B同时写，则顺序可能为A1,B1,A2,B2） Windows的管道允许在同一个管道上有多个reader/writer对，他们之间读写的数据没有交叉。</li>
</ul>
</li>
</ul>
<h2 id="5-5-套接字-Sockets"><a href="#5-5-套接字-Sockets" class="headerlink" title="5.5 套接字(Sockets)"></a>5.5 套接字(Sockets)</h2><ul>
<li>套接字的特点：<ul>
<li>它是双向通信的</li>
<li>它是进程间通信的，包括其他机器上的进程</li>
</ul>
</li>
<li>套接字有三个参数：<ul>
<li>通讯类型(communication style)<ul>
<li>连接(connection)类型：保证所有的包按发送的顺序到达接受方。（类似于电话）如果包丢失或者抵达顺序错误，会自动重发。</li>
<li>datagram类型：所有包单独发送，可能会出现丢失或者晚发早到的现象。（类似于邮寄）</li>
</ul>
</li>
<li>命名空间(namespace)：描述套接字的地址是如何表示的，例如本地就是文件名，internet上就是ip地址。</li>
<li>协议(protocol)：通讯协议，常用的有TCI/IP，AppleTalk等。</li>
</ul>
</li>
<li>相关的API（套接字也是通过file descriptor来表示的）：<ul>
<li>socket：创建一个socket</li>
<li>closes：销毁一个socket</li>
<li>connect：在两个socket之间创建一个连接。这个API通常由客户端调用。</li>
<li>bind：给服务器的一个套接字绑定一个地址，服务器端调用。</li>
<li>listen：让一个套接字开始侦听，准备接受请求，服务器端调用。</li>
<li>accept：接受一个连接请求，并且为该连接创建一个新的套接字，服务器端调用。</li>
</ul>
</li>
<li>服务器端的生命流程：<ul>
<li>创建一个connection类型的socket</li>
<li>给该socket绑定一个地址</li>
<li>调用listen来enable该socket（listen可以指定最多有多少个请求在等待队列中，如果等待队列满了，又有新的请求到达的时候，则该请求被拒绝）</li>
<li>对于收到的连接请求调用accept来接受</li>
<li>关闭socket</li>
</ul>
</li>
<li>本地socket（local socket）<ul>
<li>如果是同一台电脑上的两个进程需要通信的话，可以使用本地socket。这种情况下socket的地址是文件路径。注意进程必须对该路径拥有可写权限，否则无法建立连接</li>
<li>完成之后使用unlink来关闭一个socket</li>
</ul>
</li>
</ul>

    </div>

    
    
    
      

        <div class="reward-container">
  <div>赞赏一下吧～</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="tongsiying 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>tongsiying
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tongsiying.github.io/2008/01/01/shell/2008-01-01-shell-draft/" title="shell-draft">https://tongsiying.github.io/2008/01/01/shell/2008-01-01-shell-draft/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/shell/" rel="tag"># shell</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2007/02/03/network/2021-06-11-Network-Network/" rel="prev" title="计算机网络基础知识总结">
      <i class="fa fa-chevron-left"></i> 计算机网络基础知识总结
    </a></div>
      <div class="post-nav-item">
    <a href="/2008/01/01/%E5%89%8D%E7%AB%AF/HTML5/" rel="next" title="HTML5">
      HTML5 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#小数和整数比较"><span class="nav-text">小数和整数比较</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#变量"><span class="nav-text">变量</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#read"><span class="nav-text">read</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#EOT、EOF"><span class="nav-text">EOT、EOF</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#exec"><span class="nav-text">exec</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#"><span class="nav-text">$</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#printf"><span class="nav-text">printf</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#printf：001"><span class="nav-text">printf：001</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#shift："><span class="nav-text">shift：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#readlink"><span class="nav-text">readlink</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#random："><span class="nav-text">random：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#getopt"><span class="nav-text">getopt</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#eval"><span class="nav-text">eval</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#exit"><span class="nav-text">exit</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数组"><span class="nav-text">数组</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#注释"><span class="nav-text">注释</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ssh到另一台设备执行命令"><span class="nav-text">ssh到另一台设备执行命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#运算符"><span class="nav-text">运算符</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nohup"><span class="nav-text">nohup</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nohup免enter"><span class="nav-text">nohup免enter</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#timeout"><span class="nav-text">timeout</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#for：循环"><span class="nav-text">for：循环</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#if：判断"><span class="nav-text">if：判断</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#多线程"><span class="nav-text">多线程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#多线程删除文件：oss"><span class="nav-text">多线程删除文件：oss</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#多线程举例"><span class="nav-text">多线程举例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#多并发"><span class="nav-text">多并发</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#进程间通信"><span class="nav-text">进程间通信</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#脚本打印进度-过程"><span class="nav-text">脚本打印进度+过程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#读配置文件"><span class="nav-text">读配置文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#脚本执行时间统计"><span class="nav-text">脚本执行时间统计</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#getopt：选项参数"><span class="nav-text">getopt：选项参数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#生成随机数"><span class="nav-text">生成随机数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数组脚本"><span class="nav-text">数组脚本</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#shell-中的动态变量名"><span class="nav-text">shell 中的动态变量名</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用-dev-urandom生成固定位数的随机数"><span class="nav-text">使用&#x2F;dev&#x2F;urandom生成固定位数的随机数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#监控脚本：check-sh"><span class="nav-text">监控脚本：check.sh</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#美女"><span class="nav-text">美女</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#监控"><span class="nav-text">监控</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ip是否通验证脚本"><span class="nav-text">ip是否通验证脚本</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#shell脚本转换成二进制的可执行文件方法–加密"><span class="nav-text">shell脚本转换成二进制的可执行文件方法–加密</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#echo-在shell及脚本中显示色彩及闪烁警告效果"><span class="nav-text">echo 在shell及脚本中显示色彩及闪烁警告效果</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#，-：-，：-，-？的使用"><span class="nav-text">${}，##, %% , ：- ，：+， ？的使用</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#脚本举例："><span class="nav-text">脚本举例：</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SHELL打印两个日期之间的日期"><span class="nav-text">SHELL打印两个日期之间的日期</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shell中AScll值和字符之间的转换"><span class="nav-text">shell中AScll值和字符之间的转换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#切换用户执行脚本："><span class="nav-text">切换用户执行脚本：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#简单的将Shell和一些文件打包成一个单独的“可执行文件”"><span class="nav-text">简单的将Shell和一些文件打包成一个单独的“可执行文件”</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux高级编程"><span class="nav-text">Linux高级编程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ALP-Chapter-5-进程间通信（Interprocess-Communication）"><span class="nav-text">ALP Chapter 5 进程间通信（Interprocess Communication）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-共享内存（Shared-Memory）"><span class="nav-text">5.1 共享内存（Shared Memory）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-进程信号量"><span class="nav-text">5.2 进程信号量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-内存映射"><span class="nav-text">5.3 内存映射</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-管道（Pipes）"><span class="nav-text">5.4 管道（Pipes）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-套接字-Sockets"><span class="nav-text">5.5 套接字(Sockets)</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="tongsiying"
      src="/images/gutianle.gif">
  <p class="site-author-name" itemprop="name">tongsiying</p>
  <div class="site-description" itemprop="description">问渠那得清如许？为有源头活水来。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">431</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tongsiying" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tongsiying" rel="noopener external nofollow noreferrer" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wxtlucky1015@163.com" title="E-Mail → mailto:wxtlucky1015@163.com" rel="noopener external nofollow noreferrer" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/2964109344" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;2964109344" rel="noopener external nofollow noreferrer" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/" title="tongsiying → https:&#x2F;&#x2F;tongsiying.github.io"><i class="wrench fa-fw"></i>tongsiying</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/ReadingNotes/" title="ReadingNotes → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;ReadingNotes&#x2F;"><i class="book fa-fw"></i>ReadingNotes</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/blog/" title="blog → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;blog&#x2F;"><i class="book fa-fw"></i>blog</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/blog/tools/" title="tools → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;blog&#x2F;tools&#x2F;"><i class="wrench fa-fw"></i>tools</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/lanlan/" title="lanlan → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;lanlan&#x2F;"><i class="wrench fa-fw"></i>lanlan</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/Music/" title="note → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;Music&#x2F;"><i class="wrench fa-fw"></i>note</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/sound/" title="Music → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;sound&#x2F;"><i class="wrench fa-fw"></i>Music</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/JSONFormat/" title="JSONFormat → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;JSONFormat&#x2F;"><i class="wrench fa-fw"></i>JSONFormat</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/HTML5-Canvas/" title="Canvas → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;HTML5-Canvas&#x2F;"><i class="wrench fa-fw"></i>Canvas</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/games/" title="games → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;games&#x2F;"><i class="wrench fa-fw"></i>games</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/love/" title="love → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;love&#x2F;"><i class="wrench fa-fw"></i>love</a>
      </span>
  </div>



		<div style="">
  <canvas id="canvas" style="width:60%;">��ǰ�������֧��canvas������������������</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //����canvas�Ŀ���
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //�洢ʱ������
    var data = [];
    //�洢�˶���С��
    var balls = [];
    //�������Ӱ뾶
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //�洢ʱ�����֣���ʮλСʱ����λСʱ��ð�š�ʮλ���ӡ���λ���ӡ�ð�š�ʮλ���ӡ���λ������7���������
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*���ɵ�������*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*����ʱ��*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //ʱ�䷢���仯
            if(NewData[i] !== data[i]){
                //���仯������ֵ����data�����е������洢��changeNumArray������
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //����С��
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*����С��״̬*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*����Ҫ�˶���С��*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*��Ⱦ*/
    function render(){
        //���û������ȣ��ﵽ��ջ�����Ч��
        canvas.height = 100;
        //��Ⱦʱ��
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //��ȾС��
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //����ʱ��
        updateDigitTime();
        //����С��״̬
        updateBalls();
        //��Ⱦ
        render();
    },50);
}

})();
</script>
      </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; Weeny – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tongsiying</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">7.6m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">114:28</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
