<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/hedgehog.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/hedgehog.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tongsiying.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","b2t":true,"scrollpercent":true,"padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="linux-draft">
<meta property="og:url" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/index.html">
<meta property="og:site_name" content="tongsiying">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584950864092-1585551848364.png">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584950877483-1585551867171.png">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584950901855-1585551881417.png">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584950916178-1585551894581.png">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584950933865-1585551912922.png">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584948682984-1585553407634.png">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584948967541-1585553611037.png">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584948981764-1585553611038.png">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584948995283-1585553611038.png">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584949016403-1585553611038.png">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584949025247-1585553611038.png">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/2008-01-02-linux-draft%5Cimage-20210629222344217.png">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/image-20210623075924347.png">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/image-20210623075933798.png">
<meta property="og:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/image-20210623075945543.png">
<meta property="article:published_time" content="2008-01-02T10:37:19.000Z">
<meta property="article:modified_time" content="2022-02-07T12:05:33.983Z">
<meta property="article:author" content="tongsiying">
<meta property="article:tag" content="linux-文件管理">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584950864092-1585551848364.png">

<link rel="canonical" href="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>linux-draft | tongsiying</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
<!-- 加入APlayer音乐播放器 -->
<link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>
  <div class="container use-motion">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">tongsiying</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">阅读|运动|自律</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/catalog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-目录">

    <a href="/catalog/" rel="section"><i class="fa fa fa-th fa-fw"></i>目录</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-读书清单">

    <a href="/read" rel="section"><i class="fa fa-book fa-fw"></i>读书清单</a>

  </li>
        <li class="menu-item menu-item-读书笔记">

    <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="section"><i class="fa fa-book fa-fw"></i>读书笔记</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/gutianle.gif">
      <meta itemprop="name" content="tongsiying">
      <meta itemprop="description" content="问渠那得清如许？为有源头活水来。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tongsiying">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          linux-draft
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2008-01-02 18:37:19" itemprop="dateCreated datePublished" datetime="2008-01-02T18:37:19+08:00">2008-01-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-07 20:05:33" itemprop="dateModified" datetime="2022-02-07T20:05:33+08:00">2022-02-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>139k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2:06</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p class="description"></p>
<a id="more"></a>

<h1 id="001-文件管理"><a href="#001-文件管理" class="headerlink" title="001-文件管理"></a>001-文件管理</h1><h2 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*：匹配<span class="number">0</span>或多个字符</span><br><span class="line">?：匹配随意一个字符</span><br><span class="line">[list]：匹配list中的随意单一字符</span><br><span class="line">[!list]：匹配非list中的随意单一字符</span><br><span class="line">[a1-a3]：匹配a1和a3之间的随意一个字符。如<span class="number">0</span><span class="number">-9</span>，a-z</span><br><span class="line">&#123;<span class="built_in">string</span>1,<span class="built_in">string</span>2,<span class="built_in">string</span>3...&#125;：匹配<span class="built_in">string</span>1，或<span class="built_in">string</span>2或……当中的一个字符串</span><br></pre></td></tr></table></figure>



<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、字符串或串(String)是由数字、字母、下划线组成的一串字符。一般记为 s=“a1a2···an”(n&gt;=<span class="number">0</span>)。它是编程语言中表示文本的数据类型。在程序设计中，字符串（<span class="built_in">string</span>）为符号或数值的一个连续序列，如符号串（一串字符）或二进制数字串（一串二进制数字）。</span><br><span class="line"><span class="number">2</span>、只要用双引号“ ”括起来的都是String</span><br></pre></td></tr></table></figure>



<h2 id="ASCII比较大小"><a href="#ASCII比较大小" class="headerlink" title="ASCII比较大小"></a>ASCII比较大小</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ASCII比较大小的时候,是比较两个数中的第一个字符 </span><br><span class="line"><span class="number">1</span>）常用字符有<span class="number">128</span>个，编码从<span class="number">0</span>到<span class="number">127</span>。 </span><br><span class="line"><span class="number">2</span>）控制字符：<span class="number">0</span>~<span class="number">31</span>、<span class="number">127</span>，共<span class="number">33</span>个，不可显示； </span><br><span class="line"><span class="number">3</span>）普通字符：<span class="number">95</span>个，包括<span class="number">10</span>个阿拉伯数字、<span class="number">52</span>个英文大小写字母、<span class="number">33</span>个运算符。 </span><br><span class="line"><span class="number">4</span>）每个字符占一个字节，<span class="number">7</span>位，最高位为<span class="number">0</span>。 </span><br><span class="line"></span><br><span class="line">常见ASCII码的大小规则，<span class="number">0</span>－<span class="number">9</span>＜A－Z＜a－z： </span><br><span class="line"><span class="number">1</span>）数字比字母要小。如 “<span class="number">7</span>”＜“F” </span><br><span class="line"><span class="number">2</span>）数字<span class="number">0</span>比数字<span class="number">9</span>要小，并按<span class="number">0</span>到<span class="number">9</span>顺序递增。如 “<span class="number">3</span>”＜“<span class="number">8</span>” </span><br><span class="line"><span class="number">3</span>）字母A比字母Z要小，并按A到Z顺序递增。如“A”＜“Z” </span><br><span class="line"><span class="number">4</span>）同个字母的大写字母比小写字母要小<span class="number">32</span>。如“A”＜“a” </span><br><span class="line"></span><br><span class="line">记住几个常见字母的ASCII码大小： </span><br><span class="line">“A”为<span class="number">65</span>；“a”为<span class="number">97</span>；“<span class="number">0</span>”为<span class="number">48</span>；</span><br></pre></td></tr></table></figure>



<h2 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">突破</span><br><span class="line">在搜索引擎项目工作时，看到过研发工程师在调试问题时这样使用了cat——他们启动服务后，使用了命令cat some_data.txt &gt; /dev/<span class="literal">null</span>，虽然当时没有直接向他们请教原委，但这个命令给我留下了深刻的印象：</span><br><span class="line">/dev/<span class="literal">null</span>是linux的位桶文件，写入它的内容会永远丢失，从它那里什么也读取不到。一般用法是想丢弃命令产生的标准输出和标准错误时，通常使用command &gt; /dev/<span class="literal">null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span>，因此，cat some_data.txt &gt; /dev/<span class="literal">null</span>似乎没有任何效果。</span><br><span class="line">当时观察到cat some_data.txt &gt; /dev/<span class="literal">null</span>这个命令的执行时间常长，这说明了some_data.txt这个文件也足够大。但第二次执行这个命令时，执行时间则大大缩减了。</span><br><span class="line">由以上大致可以判断出，该用法是为了将文件内容导入到内存中，以便需要使用文件内容时能够快速获取。一般来说，从硬盘中读取数据需要<span class="number">5</span>ms到<span class="number">10</span>ms的时间，而从内存中读取数据时通常只需要<span class="number">50</span>ns到<span class="number">100</span>ns的时间，这就是page cache（页高速缓冲存储器）的作用。</span><br><span class="line"></span><br><span class="line">总结</span><br><span class="line">这个经历给我的体会是，许多时候，我们认为自己掌握了全部或绝大部分，而实际上，只是因为自己知道的太少，并且不认为自己知道的太少——我们压根不觉得是因为自己不知道。就像美国前国防部长拉姆斯菲尔德说过的那样：</span><br><span class="line">because as we know, there are known knowns; there are things we know we know. We also know there are known unknowns; that <span class="keyword">is</span> to say we know there are some things we <span class="keyword">do</span> <span class="keyword">not</span> know. But there are also unknown unknowns - the ones we don<span class="string">'t know we don'</span>t know.</span><br><span class="line">我们有已知的已知，已知的未知，以及未知的未知。</span><br><span class="line"></span><br><span class="line"> 其它读文件：</span><br><span class="line">cat     由第一行开始显示内容，并将所有内容输出</span><br><span class="line">tac     从最后一行倒序显示内容，并将所有内容输出</span><br><span class="line">more    根据窗口大小，一页一页的显示文件内容</span><br><span class="line">less    和more类似，但其优点可以往前翻页，而且进行可以搜索字符</span><br><span class="line">head    只显示头几行</span><br><span class="line">tail    只显示最后几行</span><br><span class="line">nl     类似于cat -n，显示时输出行号</span><br><span class="line"></span><br><span class="line">https:<span class="comment">//www.cnblogs.com/chenxiaomeng/p/10066821.html</span></span><br><span class="line"> echo <span class="string">"123456789abcdefghjklmnopq"</span> | cut -b <span class="number">11</span><span class="number">-14</span></span><br></pre></td></tr></table></figure>



<h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-w 完全匹配</span><br><span class="line"><span class="keyword">grep</span> -w <span class="string">"cao"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">报错Binary <span class="keyword">file</span> (standard <span class="built_in">input</span>) matches：</span><br><span class="line">解决：</span><br><span class="line"><span class="keyword">cat</span> mt.output-<span class="number">20180807</span>|<span class="keyword">grep</span> -<span class="keyword">a</span> l129093</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A -B -C 后面都跟阿拉伯数字 </span><br><span class="line">-A是显示匹配后和它后面的n行。 </span><br><span class="line">-B是显示匹配行和它前面的n行。 </span><br><span class="line">-C是匹配行和它前后各n行。 </span><br><span class="line">总体来说，-C覆盖面最大。用它保险些。哈哈。这<span class="number">3</span>个开关都是关于匹配行的上下文的（context）。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查找当前目录下包含关键字“checknetiflinkstat”的所有文件，并列出行号。</span><br><span class="line"><span class="keyword">grep</span> -nr <span class="string">"checknetiflinkstat"</span> /home/zxcdn/ottcache/nginx/<span class="keyword">lua</span></span><br></pre></td></tr></table></figure>



<h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">删除多少天之前的文件</span><br><span class="line"><span class="built_in">find</span> /mnt/snbslog/snbs -<span class="built_in">type</span> f -name '*' -mtime +<span class="number">1</span> -exec rm &#123;&#125; \;</span><br><span class="line"></span><br><span class="line">基本思路是，<span class="built_in">find</span>找到相应的文件，然后执行某个命令。这里是找到<span class="built_in">N</span>天前的文件，然后执行删除指令。</span><br><span class="line"></span><br><span class="line">-<span class="built_in">type</span> <span class="symbol">f:</span> 指定查找的为文件，而非文件夹或文件链接等</span><br><span class="line">-name ‘*.txt’<span class="symbol">:</span> 指定查找的文件名的模式</span><br><span class="line">-mti<span class="symbol">me:</span> 指定文件的修改时间，以天为单位。＋<span class="built_in">N</span>是<span class="built_in">N</span>天以前，-<span class="built_in">N</span>是<span class="built_in">N</span>天以内，<span class="built_in">N</span>是第<span class="built_in">N</span>天。另外有，-mmin按分钟为单位指定文件的修改时间。还另外可以另外的参数指定文件上次使用的时间等。</span><br></pre></td></tr></table></figure>



<h2 id="rm删除文件不释放"><a href="#rm删除文件不释放" class="headerlink" title="rm删除文件不释放"></a>rm删除文件不释放</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">解决linux删除文件后空间没有释放问题</span><br><span class="line"><span class="symbol">https:</span>/<span class="regexp">/www.cnblogs.com/mfryf</span><span class="regexp">/p/</span><span class="number">3334451</span>.html</span><br><span class="line">[root<span class="variable">@ticketb</span> ~]<span class="comment"># lsof |grep deleted</span></span><br></pre></td></tr></table></figure>



<h2 id="shuf命令"><a href="#shuf命令" class="headerlink" title="shuf命令"></a>shuf命令</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">shuf命令把输入行按随机顺序输出到标准输出。</span><br><span class="line"></span><br><span class="line">用法</span><br><span class="line">shuf [选项]... [文件]</span><br><span class="line">或者</span><br><span class="line">shuf -e [选项]... [参数]...</span><br><span class="line">又或者</span><br><span class="line">shuf -i LO-HI [选项]...</span><br><span class="line"></span><br><span class="line">常用参数</span><br><span class="line">-e, --echo</span><br><span class="line">将每个参数视为输入行</span><br><span class="line">-i, --input-range=LO-HI</span><br><span class="line">将LO 到HI 的每个数字视为输入行</span><br><span class="line">-n, --head-count=行数</span><br><span class="line">最多输出指定的行数</span><br><span class="line">-o, --output=文件</span><br><span class="line">将结果输出到指定文件而非标准输出</span><br><span class="line">--random-source=文件</span><br><span class="line">从指定文件获得随机比特</span><br><span class="line">-z, --zero-terminated</span><br><span class="line">以<span class="number">0</span> 结束行而非新行</span><br><span class="line">--help</span><br><span class="line">显示此帮助信息并退出</span><br><span class="line">--version</span><br><span class="line">显示版本信息并退出</span><br><span class="line">如果没有指定文件，或者文件为<span class="string">"-"</span>，则从标准输入读取。</span><br><span class="line"></span><br><span class="line">我有一个名为 ostechnix.txt 的文件，内容如下：</span><br><span class="line">$ cat ostechnix.txt</span><br><span class="line">line1</span><br><span class="line">line2</span><br><span class="line">line3</span><br><span class="line">line4</span><br><span class="line">line5</span><br><span class="line">line6</span><br><span class="line">line7</span><br><span class="line">line8</span><br><span class="line">line9</span><br><span class="line">line10</span><br><span class="line">现在让我们以随机顺序显示上面的行。为此，请运行：</span><br><span class="line">$ shuf ostechnix.txt</span><br><span class="line">line2</span><br><span class="line">line8</span><br><span class="line">line5</span><br><span class="line">line10</span><br><span class="line">line7</span><br><span class="line">line1</span><br><span class="line">line4</span><br><span class="line">line6</span><br><span class="line">line9</span><br><span class="line">line3</span><br><span class="line">看到了吗？上面的命令将名为 ostechnix.txt 中的行随机排列并输出了结果。</span><br><span class="line"></span><br><span class="line">你可能想将输出写入另一个文件。例如，我想将输出保存到 output.txt 中。为此，请先创建 output.txt：</span><br><span class="line">$ <span class="section">touch</span> output.txt</span><br><span class="line">然后，像下面使用 -o 标志将输出写入该文件：</span><br><span class="line">$ shuf ostechnix.txt -o output.txt</span><br><span class="line">上面的命令将随机随机打乱 ostechnix.txt 的内容并将输出写入 output.txt。你可以使用命令查看 output.txt 的内容：</span><br><span class="line">$ cat output.txt</span><br><span class="line">line2</span><br><span class="line">line8</span><br><span class="line">line9</span><br><span class="line">line10</span><br><span class="line">line1</span><br><span class="line">line3</span><br><span class="line">line7</span><br><span class="line">line6</span><br><span class="line">line4</span><br><span class="line">line5</span><br><span class="line">我只想显示文件中的任意一行。我该怎么做？很简单！</span><br><span class="line">$ shuf -n <span class="number">1</span> ostechnix.txt</span><br><span class="line">line6</span><br><span class="line">同样，我们可以选择前 “n” 个随机条目。以下命令将只显示前五个随机条目：</span><br><span class="line">$ shuf -n <span class="number">5</span> ostechnix.txt</span><br><span class="line">line10</span><br><span class="line">line4</span><br><span class="line">line5</span><br><span class="line">line9</span><br><span class="line">line3</span><br><span class="line">如下所示，我们可以直接使用 -e 标志传入输入，而不是从文件中读取行：</span><br><span class="line">$ shuf -e line1 line2 line3 line4 line5</span><br><span class="line">line1</span><br><span class="line">line3</span><br><span class="line">line5</span><br><span class="line">line4</span><br><span class="line">line2</span><br><span class="line">你也可以传入数字：</span><br><span class="line">$ shuf -e <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">要快速在给定范围选择一个，请改用此命令：</span><br><span class="line">$ shuf -n <span class="number">1</span> -e <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></span><br><span class="line">或者，选择下面的任意三个随机数字：</span><br><span class="line">$ shuf -n <span class="number">3</span> -e <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">我们也可以在特定范围内生成随机数。例如，要显示 <span class="number">1</span> 到 <span class="number">10</span> 之间的随机数，只需使用：</span><br><span class="line">$ shuf -i <span class="number">1</span><span class="number">-10</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>



<h2 id="grep-和-awk的buffer"><a href="#grep-和-awk的buffer" class="headerlink" title="grep 和 awk的buffer"></a><a href="https://www.cnblogs.com/cobbliu/p/4954146.html" target="_blank" rel="noopener external nofollow noreferrer">grep 和 awk的buffer</a></h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tail -f <span class="keyword">test</span>.<span class="keyword">log</span> | grep <span class="string">"mode"</span> | awk '&#123;<span class="keyword">print</span> <span class="variable">$5&#125;</span>'命令</span><br><span class="line">或者 tail -f <span class="keyword">test</span>.<span class="keyword">log</span> | awk '/mode/ &#123;<span class="keyword">print</span> <span class="variable">$5&#125;</span>'的时候，如果<span class="keyword">test</span>.<span class="keyword">log</span>中满足模式mode的数据很少，会发现即便是<span class="keyword">test</span>.<span class="keyword">log</span>中新出现了满足mode的行，但是上面两个命令都没有任何输出。</span><br><span class="line"></span><br><span class="line">原因在于grep和awk处于效率的考量，会缓存一批数据再输出到标准输出。</span><br><span class="line"></span><br><span class="line">grep的--<span class="keyword">line</span>-buffered选项和awk的fflush(stdout)命令可以使得grep和awk不缓存数据。如：</span><br><span class="line"></span><br><span class="line">tail -f <span class="keyword">test</span>.<span class="keyword">log</span> | grep --<span class="keyword">line</span>-buffered <span class="string">"mode"</span> | awk '&#123;<span class="keyword">print</span> <span class="variable">$5&#125;</span>'</span><br><span class="line">tail -f <span class="keyword">test</span>.<span class="keyword">log</span> | awk '/mode/ &#123;<span class="keyword">print</span> <span class="variable">$5</span>,<span class="variable">$6</span>; fflush(stdout)&#125;''</span><br></pre></td></tr></table></figure>



<h2 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span>/<span class="regexp">/www.cnblogs.com/fiberhome</span><span class="regexp">/p/</span><span class="number">6898786</span>.html</span><br><span class="line"></span><br><span class="line">在每行的头添加字符，比如<span class="string">"HEAD"</span>，命令如下：</span><br><span class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># sed -i 's/^/HEAD&amp;/' /tmp/input.txt </span></span><br><span class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># cat /tmp/input.txt</span></span><br><span class="line">HEADnull</span><br><span class="line">HEAD000011112222</span><br><span class="line">HEAD</span><br><span class="line">HEADtest</span><br><span class="line"></span><br><span class="line"><span class="comment">#替换关键字的后面两位</span></span><br><span class="line">sed -ri <span class="string">'s/(20230907..)/\110/g'</span></span><br><span class="line">sed -ri <span class="string">'s/(20230907..)/\110/'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在包含某个关键字的行上面插入一行文字，命令如下：</span></span><br><span class="line">sed -i <span class="string">'/hello/i\\555555'</span> testfile</span><br><span class="line"></span><br><span class="line"><span class="comment">#在包含某个关键字的行下面插入一行文字，命令如下：</span></span><br><span class="line">sed -i <span class="string">'/hello/a\\66666'</span> testfile</span><br><span class="line"></span><br><span class="line"><span class="comment">#替换第21次匹配的字符</span></span><br><span class="line">sed -i <span class="string">'s/xxx/12344/21/'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在文件的第一行插入字符串</span></span><br><span class="line">sed  -i  <span class="string">'1i include /etc/cinder/volumes/*'</span>  /etc/tgt/targets .conf</span><br><span class="line">其中i表示插入，而且是添加到当前行的上一行；而a是添加到当前行的后一行。</span><br><span class="line">注意：在sed中没有第0行之说。</span><br><span class="line"></span><br><span class="line">显示文件X行到Y行的内容：</span><br><span class="line"><span class="comment">#sed -n 'x,yp' filename</span></span><br><span class="line"></span><br><span class="line">删除文件最后一行：</span><br><span class="line">sed <span class="string">'$d'</span></span><br><span class="line"></span><br><span class="line">对第十八行进行注释：sed <span class="string">'18s/^/#/'</span> /etc/fstab </span><br><span class="line"></span><br><span class="line">sed中支持变量的处理方法</span><br><span class="line"><span class="number">1</span>.eval sed ’s/<span class="variable">$a</span>/<span class="variable">$b</span>/’ filename</span><br><span class="line"><span class="number">2</span>.sed <span class="string">"s/$a/$b/"</span> filename</span><br><span class="line"><span class="number">3</span>.sed ’s/’<span class="variable">$a</span>’/’<span class="variable">$b</span>’/’ filename </span><br><span class="line"><span class="number">4</span>.sed s/<span class="variable">$a</span>/<span class="variable">$b</span>/ filename</span><br><span class="line">第一种eval sed -i <span class="string">'s!gcomm://!gcomm://$IP_2!g'</span> /etc/my.cnf.d/server.cnf</span><br><span class="line">第二种sed -i <span class="string">"s/localhost-IP/$IP_2/g"</span> /etc/my.cnf.d/server.cnf</span><br><span class="line"></span><br><span class="line">sed删除含有某个字符的行</span><br><span class="line">readzone1=<span class="number">12345</span></span><br><span class="line">sed -i <span class="string">"/$readzone1/d"</span> zone1.log zone2.log zone3.log</span><br><span class="line"></span><br><span class="line">linux 删除文件里的标点符号</span><br><span class="line">sed  -i <span class="string">'s /[,."]//g  filename</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">删除空行：</span></span><br><span class="line"><span class="string">sed '</span>/^\s*<span class="variable">$/</span>d<span class="string">'</span></span><br><span class="line"><span class="string">注：d代表删除该行</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">行尾追加字符：</span></span><br><span class="line"><span class="string">sed '</span>s/<span class="variable">$/</span> ABC/<span class="string">' file1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">行首：</span></span><br><span class="line"><span class="string">sed '</span>s/^<span class="regexp">/xxx/</span><span class="string">'  filename &gt;output：^符号代表行首</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">awk NF</span></span><br><span class="line"><span class="string">注：NF代表当前行的字段数，空行的话字段数为0,被awk解释为假，因此不进行输出。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Sed 删除包含某些字符串的行</span></span><br><span class="line"><span class="string">sed -i '</span>/关键字符/d<span class="string">' 文件名</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">https://www.cnblogs.com/Berryxiong/p/6232283.html</span></span><br><span class="line"><span class="string">sed '</span>s/[ ][ ]*<span class="regexp">/,/g</span><span class="string">' 1.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">脚本说明：</span></span><br><span class="line"><span class="string">s代表替换指令；</span></span><br><span class="line"><span class="string">每个[ ]都包含有一个空格；</span></span><br><span class="line"><span class="string">*号代表0个或多个；</span></span><br><span class="line"><span class="string">g代表替换每行的所有匹配；</span></span><br><span class="line"><span class="string">-------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">linux 如何截取一段时间内log日志 </span></span><br><span class="line"><span class="string">sed -n '</span>/<span class="number">2020-02</span><span class="number">-12 08</span><span class="symbol">:</span><span class="number">50</span>/,<span class="regexp">/2020-02-12 09:00/</span><span class="string">'p  server.INFO</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">shell替换一个或多个空格为逗号</span></span><br><span class="line"><span class="string">sed '</span>s/[ ][ ]*<span class="regexp">/,/g</span><span class="string">' 1.txt</span></span><br><span class="line"><span class="string">脚本说明：</span></span><br><span class="line"><span class="string">s代表替换指令；</span></span><br><span class="line"><span class="string">每个[ ]都包含有一个空格；</span></span><br><span class="line"><span class="string">*号代表0个或多个；</span></span><br><span class="line"><span class="string">g代表替换每行的所有匹配；</span></span><br></pre></td></tr></table></figure>



<h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><p><a href="https://www.cnblogs.com/doflamingo/p/13209610.html" target="_blank" rel="noopener external nofollow noreferrer">awk中执行Linux命令的两种方式</a></p>
<blockquote>
<p>在使用awk处理内容时，有时会按行执行Linux命令，下面介绍两种执行Linux命令方式。</p>
</blockquote>
<p><strong>方式一</strong>：<strong><em>用system()：</em></strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost shell_script]<span class="comment"># awk 'BEGIN &#123;system("pwd")&#125;'</span></span><br><span class="line">[root@localhost shell_script]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>test.log文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost shell_script]<span class="comment"># cat test.log </span></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line">ls</span><br><span class="line"><span class="built_in">which</span> sh</span><br><span class="line">[root@localhost shell_script]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>按文件行作为输入执行：</p>
<blockquote>
<p><strong>$0</strong> 表示一行数据</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost shell_script]<span class="comment"># awk '&#123;print "执行命令："$0; system($0); print "\r"&#125;' test.log</span></span><br><span class="line">执行命令：<span class="built_in">pwd</span></span><br><span class="line">/root/shell_script</span><br><span class="line"></span><br><span class="line">执行命令：ls</span><br><span class="line">awk_system.sh  test.log</span><br><span class="line"></span><br><span class="line">执行命令：<span class="built_in">which</span> sh</span><br><span class="line">/usr/bin/sh</span><br><span class="line"></span><br><span class="line">[root@localhost shell_script]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>拼接命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost shell_script]<span class="comment"># echo "sh601236" | awk '&#123;cmd = "curl -X GET http://hq.sinajs.cn/list="$0; system(cmd);&#125;'</span></span><br><span class="line">var hq_str_sh601236=<span class="string">"红塔证券,19.930,20.320,19.150,19.930,18.710,19.150,19.160,41190044,791608359.000,198000,19.150,53300,19.140,60100,19.130,74200,19.120,24100,19.110,50500,19.160,28500,19.170,18300,19.180,15500,19.190,59300,19.200,2020-06-29,15:00:00,00,"</span>;</span><br><span class="line">[root@localhost shell_script]<span class="comment">#</span></span><br></pre></td></tr></table></figure>



<p><strong>方式二</strong>：借助|和sh命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost shell_script]<span class="comment"># echo "pwd" | sh</span></span><br><span class="line">/root/shell_script</span><br><span class="line">[root@localhost shell_script]<span class="comment"># cat test.log | sh</span></span><br><span class="line">/root/shell_script</span><br><span class="line">awk_system.sh  test.log</span><br><span class="line">/usr/bin/sh</span><br><span class="line">[root@localhost shell_script]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>print</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost shell_script]<span class="comment"># awk 'BEGIN &#123;print "pwd" | "sh"&#125;'</span></span><br><span class="line">/root/shell_script</span><br><span class="line">[root@localhost shell_script]<span class="comment">#</span></span><br><span class="line">[root@localhost shell_script]<span class="comment"># echo "pwd" | awk '&#123;print $0 | "sh"&#125;'</span></span><br><span class="line">/root/shell_script</span><br><span class="line">[root@localhost shell_script]<span class="comment">#</span></span><br><span class="line">[root@localhost shell_script]<span class="comment"># awk '&#123;print "执行命令："$0; print $0 | "sh"; print "\r"&#125;' test.log</span></span><br><span class="line">执行命令：<span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line">执行命令：ls</span><br><span class="line"></span><br><span class="line">执行命令：<span class="built_in">which</span> sh</span><br><span class="line"></span><br><span class="line">/root/shell_script</span><br><span class="line">awk_system.sh  test.log</span><br><span class="line">/usr/bin/sh</span><br><span class="line">[root@localhost shell_script]<span class="comment">#</span></span><br></pre></td></tr></table></figure>





<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.cnblogs.com/xudong-bupt/p/3721210.html</span></span><br><span class="line">https:<span class="comment">//www.cnblogs.com/jackhub/p/3549091.html</span></span><br><span class="line">http:<span class="comment">//www.mamicode.com/info-detail-1187091.html</span></span><br><span class="line">http:<span class="comment">//www.voidcn.com/article/p-pycljjoj-btv.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">IF</span>语句</span><br><span class="line">必须用在&#123;&#125;中，且比较内容用()扩起来</span><br><span class="line">awk -F: '&#123;<span class="keyword">if</span>(<span class="variable">$1</span>~/mail/) <span class="keyword">print</span> <span class="variable">$1&#125;</span>' /etc/passwd                                       <span class="comment">//简写</span></span><br><span class="line">awk -F: '&#123;<span class="keyword">if</span>(<span class="variable">$1</span>~/mail/) &#123;<span class="keyword">print</span> <span class="variable">$1&#125;</span>&#125;'  /etc/passwd                                   <span class="comment">//全写</span></span><br><span class="line">awk -F: '&#123;<span class="keyword">if</span>(<span class="variable">$1</span>~/mail/) &#123;<span class="keyword">print</span> <span class="variable">$1&#125;</span> <span class="keyword">else</span> &#123;<span class="keyword">print</span> <span class="variable">$2&#125;</span>&#125;' /etc/passwd            <span class="comment">//if...else...</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">条件表达式</span><br><span class="line">==   !=   &gt;   &gt;=  </span><br><span class="line">awk -F<span class="string">":"</span> '<span class="variable">$1</span>==<span class="string">"mysql"</span>&#123;<span class="keyword">print</span> <span class="variable">$3&#125;</span>' /etc/passwd  </span><br><span class="line">awk -F<span class="string">":"</span> '&#123;<span class="keyword">if</span>(<span class="variable">$1</span>==<span class="string">"mysql"</span>) <span class="keyword">print</span> <span class="variable">$3&#125;</span>' /etc/passwd          <span class="comment">//与上面相同 </span></span><br><span class="line">awk -F<span class="string">":"</span> '<span class="variable">$1</span>!=<span class="string">"mysql"</span>&#123;<span class="keyword">print</span> <span class="variable">$3&#125;</span>' /etc/passwd                 <span class="comment">//不等于</span></span><br><span class="line">awk -F<span class="string">":"</span> '<span class="variable">$3</span>&gt;1000&#123;<span class="keyword">print</span> <span class="variable">$3&#125;</span>' /etc/passwd                      <span class="comment">//大于</span></span><br><span class="line">awk -F<span class="string">":"</span> '<span class="variable">$3</span>&gt;=100&#123;<span class="keyword">print</span> <span class="variable">$3&#125;</span>' /etc/passwd                     <span class="comment">//大于等于</span></span><br><span class="line">awk -F<span class="string">":"</span> '<span class="variable">$3</span>&lt;1&#123;<span class="keyword">print</span> <span class="variable">$3&#125;</span>' /etc/passwd                            <span class="comment">//小于</span></span><br><span class="line">awk -F<span class="string">":"</span> '<span class="variable">$3</span>&lt;=1&#123;<span class="keyword">print</span> <span class="variable">$3&#125;</span>' /etc/passwd                         <span class="comment">//小于等于</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">awk判断某字段为空</span><br><span class="line"><span class="keyword">more</span> aaa.txt | awk -F '|' '<span class="variable">$11</span> ~/^$/&#123;<span class="keyword">print</span> <span class="variable">$0&#125;</span>'</span><br><span class="line"></span><br><span class="line">#在每一行插入字符</span><br><span class="line">1. 如何在一个文本文件中的每一行头插入一个字符</span><br><span class="line">awk '&#123;<span class="keyword">print</span> <span class="string">"X"</span><span class="variable">$0&#125;</span>' urfile</span><br><span class="line">2. 如何在一个文本文件中的每一行尾插入一个字符</span><br><span class="line">awk '&#123;<span class="keyword">print</span> <span class="variable">$0</span><span class="string">"X"</span>&#125;' urfile</span><br><span class="line">3. 如何在一个文本文件中的每一行的指定列插入一串字符</span><br><span class="line">awk '<span class="variable">$O</span>=<span class="variable">$O</span><span class="string">" X"</span>' urfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">awk匹配指定的字符串并打印该字符串所在的列 简书</span><br><span class="line">df|awk '/%/ &#123;<span class="keyword">for</span>(i=1;i&lt;=NF;i++) <span class="keyword">if</span> (<span class="variable">$i</span>~/%/)<span class="keyword">print</span> <span class="variable">$i</span> &#125;'</span><br><span class="line"></span><br><span class="line">【-----awk之行与列的<span class="keyword">count</span> Chinaunix----】</span><br><span class="line">1） 每行字段数</span><br><span class="line">awk '&#123;<span class="keyword">print</span> NF&#125;' <span class="keyword">file</span></span><br><span class="line">5</span><br><span class="line">1</span><br><span class="line">4</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line"> </span><br><span class="line">2） 最大字段数</span><br><span class="line">awk '&#123;max=max</span><br><span class="line">5</span><br><span class="line"> </span><br><span class="line">3） 总共字段个数</span><br><span class="line">awk '&#123;x+=NF&#125;END&#123;<span class="keyword">print</span> x&#125;' <span class="keyword">file</span></span><br><span class="line">16</span><br><span class="line"></span><br><span class="line">4） 所有字段的总和</span><br><span class="line">awk '&#123;<span class="keyword">for</span>(i=1;i&lt;=NF;i++)x+=<span class="variable">$i&#125;</span>END&#123;<span class="keyword">print</span> x&#125;' <span class="keyword">file</span></span><br><span class="line">280</span><br><span class="line"></span><br><span class="line">5） 各行的总和</span><br><span class="line">awk '&#123;x=0;<span class="keyword">for</span>(i=1;i&lt;=NF;i++)&#123;x+=<span class="variable">$i&#125;</span>;<span class="keyword">print</span> x&#125;' <span class="keyword">file</span></span><br><span class="line">60</span><br><span class="line">15</span><br><span class="line">70</span><br><span class="line">41</span><br><span class="line">94</span><br><span class="line"></span><br><span class="line">6） 各列的总和</span><br><span class="line">awk '&#123;<span class="keyword">for</span>(i=1;i&lt;=NF;i++)a[i]+=<span class="variable">$i&#125;</span>END&#123;<span class="keyword">l</span>=<span class="built_in">length</span>(a);<span class="keyword">for</span>(j=1;j&lt;=<span class="keyword">l</span>;j++) printf a[j]<span class="string">" "</span>;printf <span class="string">"\n"</span>&#125;' <span class="keyword">file</span></span><br><span class="line">83 72 54 57 14</span><br><span class="line"> </span><br><span class="line">7） 行列交换</span><br><span class="line">awk '&#123;<span class="keyword">for</span>(i=1;i&lt;=NF;i++)a[NR,i]=<span class="variable">$i</span>;x=x10 15 16 20 22 </span><br><span class="line">11 17 21 23 </span><br><span class="line">12 18 24 </span><br><span class="line">13 19 25 </span><br><span class="line">14</span><br><span class="line">或者以空格补齐空白处</span><br><span class="line">awk '&#123;<span class="keyword">for</span>(i=1;i&lt;=NF;i++)a[NR,i]=<span class="variable">$i</span>;x=x10 15 16 20 22 </span><br><span class="line">11    17 21 23 </span><br><span class="line">12    18    24 </span><br><span class="line">13    19    25 </span><br><span class="line">14</span><br><span class="line"></span><br><span class="line">【----<span class="keyword">Shell</span>获取字符串长度的多种方法总结---】</span><br><span class="line">方法如下：</span><br><span class="line">【方法一】:利用$&#123;#str&#125;来获取字符串的长度</span><br><span class="line">str=<span class="string">"ABCDEF"</span></span><br><span class="line">echo $&#123;#str&#125;</span><br><span class="line"></span><br><span class="line">【方法二】:利用awk的length方法</span><br><span class="line">str=<span class="string">"ABCDEF"</span></span><br><span class="line">echo <span class="variable">$&#123;str&#125;</span>|awk '&#123;<span class="keyword">print</span> <span class="built_in">length</span>(<span class="variable">$0</span>)&#125;'</span><br><span class="line"></span><br><span class="line">备注:</span><br><span class="line">1) 最好用&#123;&#125;来放置变量</span><br><span class="line">2) 也可以用<span class="built_in">length</span>(<span class="variable">$0</span>)来统计文件中每行的长度</span><br><span class="line">awk '&#123;<span class="keyword">print</span> <span class="built_in">length</span>(<span class="variable">$0</span>)&#125;' /etc/passwd</span><br><span class="line">awk '&#123;<span class="keyword">print</span> <span class="built_in">length</span>(<span class="variable">$NF</span>)&#125;' /etc/passwd #计算最后一个字段的长度</span><br><span class="line"></span><br><span class="line">【方法三】:利用awk的NF项来获取字符串长度</span><br><span class="line">str=<span class="string">"ABCDEF"</span></span><br><span class="line">echo <span class="variable">$&#123;str&#125;</span>|awk -F<span class="string">""</span> '&#123;<span class="keyword">print</span> NF&#125;'</span><br><span class="line"></span><br><span class="line">备注: -F为分隔符，NF为域的个数，即单行字符串的长度</span><br><span class="line"></span><br><span class="line">【方法四】:利用wc的-<span class="keyword">L</span>参数来获取字符串的长度</span><br><span class="line">str=<span class="string">"ABCDEF"</span></span><br><span class="line">echo <span class="variable">$&#123;str&#125;</span>|wc -<span class="keyword">L</span></span><br><span class="line"><span class="keyword">cat</span> /etc/passwd |wc -<span class="keyword">L</span> # 输出：82</span><br><span class="line"></span><br><span class="line">备注: -<span class="keyword">L</span>参数</span><br><span class="line">1) 对多行文件来说，表示打印最长行的长度！82，表示/etc/passwd文件最长行的长度为82。</span><br><span class="line">2) 对单行字符串而言，表示当前行字符串的长度！</span><br><span class="line"></span><br><span class="line">【方法五】:利用wc的-<span class="keyword">l</span>参数，结合echo -<span class="keyword">n</span>参数</span><br><span class="line">str=<span class="string">"ABCDEF"</span></span><br><span class="line">echo -<span class="keyword">n</span> <span class="variable">$&#123;str&#125;</span>|wc -c</span><br><span class="line">echo <span class="variable">$&#123;str&#125;</span> |wc -c</span><br><span class="line"></span><br><span class="line">备注:</span><br><span class="line">1) -c参数: 统计字符的个数</span><br><span class="line">2) -<span class="keyword">n</span>参数: 去除<span class="string">"\n"</span>换行符，不去除的话，默认带换行符，字符个数就成了7</span><br><span class="line"></span><br><span class="line">【方法六】:利用expr的length方法</span><br><span class="line">str=<span class="string">"ABCDEF"</span></span><br><span class="line">expr length <span class="variable">$&#123;str&#125;</span></span><br><span class="line"></span><br><span class="line">【方法七】:利用expr的<span class="variable">$str</span> : <span class="string">".*"</span>技巧，变量带不带花括号无差别</span><br><span class="line">str=<span class="string">"ABCDEF"</span></span><br><span class="line">expr <span class="variable">$&#123;str&#125;</span> : <span class="string">".*"</span></span><br><span class="line"></span><br><span class="line">备注: .*代表任意字符，即用任意字符来匹配字符串，结果是匹配到6个，即字符串的长度为6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">awk输出前最多ip地址：</span><br><span class="line">awk '&#123;ip[<span class="variable">$1</span>]++&#125; END &#123;<span class="keyword">for</span> (i <span class="keyword">in</span> ip) <span class="keyword">print</span> i,ip[i]&#125;' /<span class="keyword">var</span>/<span class="keyword">log</span>/httpd/access_log </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">显示第一行和最后一行：</span><br><span class="line">awk 'NF==1；END｛<span class="keyword">print</span>｝'</span><br><span class="line"></span><br><span class="line">【-------awk去掉某字符串前面所有字符 vOFS-----】</span><br><span class="line">比如：</span><br><span class="line"><span class="keyword">test</span> 1</span><br><span class="line">aaaaatest 2</span><br><span class="line">    <span class="keyword">test</span> 3</span><br><span class="line">tesbbbbbtest <span class="keyword">test</span> 4</span><br><span class="line"></span><br><span class="line">每行去掉<span class="keyword">test</span>前面所有字符之后，输出：</span><br><span class="line"><span class="keyword">test</span> 1</span><br><span class="line"><span class="keyword">test</span> 2</span><br><span class="line"><span class="keyword">test</span> 3</span><br><span class="line"><span class="keyword">test</span> <span class="keyword">test</span> 4</span><br><span class="line"></span><br><span class="line">处理：</span><br><span class="line">awk -F'<span class="keyword">test</span>' -vOFS=<span class="string">"test"</span> '&#123;<span class="variable">$1</span>=<span class="string">""</span>;<span class="variable">$1</span>=<span class="variable">$1&#125;</span>1' <span class="keyword">file</span></span><br><span class="line">awk '&#123;<span class="built_in">match</span>(<span class="variable">$0</span>,<span class="string">"test"</span>);<span class="keyword">print</span> <span class="built_in">substr</span>(<span class="variable">$0</span>,RSTART)&#125;' <span class="keyword">file</span></span><br><span class="line"></span><br><span class="line">解析：</span><br><span class="line">这两种处理方法都很好，</span><br><span class="line">第一种是利用<span class="keyword">test</span>作为分隔符，然后把第一个字段赋值为空，也是就是第一个<span class="keyword">test</span>前面的字符。同时，输出的字段的分隔符还必须是<span class="keyword">test</span>字符串。</span><br><span class="line">第二种方法的话首先查找到<span class="keyword">test</span>字符串的位置，然后这时候RSTART的变量的值就是<span class="keyword">test</span>的开始的位置，而后利用substr函数从此处开始到结束位置。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">awk多个分隔符：</span><br><span class="line">但是如果我想根据多个分隔符进行分割呢？一种办法是两次awk，但是我们可以一次告诉awk我们所有的分隔符，如-和|这两个，如</span><br><span class="line">awk -F ‘[-|]’ ‘&#123;<span class="keyword">print</span> <span class="variable">$3</span>;&#125;’ data</span><br><span class="line"></span><br><span class="line">就这么简单，还有一个问题，如果我们想用[]作为分隔符怎么办？有办法，这样就行：</span><br><span class="line">awk -F ‘[][]’ ‘&#123;<span class="keyword">print</span> <span class="variable">$3</span>;&#125;’ data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">去重命令（去除重复行）：</span><br><span class="line">awk '!a[<span class="variable">$0</span>]++' 42in.txt &gt;42in-new.txt</span><br><span class="line"></span><br><span class="line">awk打印出每一列</span><br><span class="line"> [root@block-storage04 wxttest]# <span class="keyword">cat</span> snbs.<span class="keyword">conf</span> |grep gateway|sed 's/gateway=<span class="comment">//g'|awk -F ";"  '&#123;for(i=1;i&lt;=NF;i++)printf("%s\n",$i);print&#125;'</span></span><br><span class="line">10.242.180.211:8585</span><br><span class="line">10.242.180.210:8585</span><br><span class="line">10.242.180.209:8585</span><br><span class="line">10.242.180.211:8585;10.242.180.210:8585;10.242.180.209:8585</span><br><span class="line"></span><br><span class="line">第一列求和：</span><br><span class="line">awk -F ':' 'BEGIN&#123;<span class="keyword">sum</span>=0&#125;&#123;<span class="keyword">sum</span>+=<span class="variable">$1&#125;</span>END&#123;<span class="keyword">print</span> <span class="keyword">sum</span>&#125;'</span><br><span class="line"></span><br><span class="line">删除第一列：</span><br><span class="line">awk '&#123;<span class="variable">$1</span>=<span class="string">""</span>;<span class="keyword">print</span> <span class="variable">$0&#125;</span>' text</span><br><span class="line"></span><br><span class="line">awk 求平均：awk '&#123;<span class="keyword">sum</span>+=<span class="variable">$1&#125;</span> END &#123;<span class="keyword">print</span> <span class="string">"$k = "</span>, <span class="keyword">sum</span>/NR&#125;'</span><br><span class="line"></span><br><span class="line">每一行行首加上行号:</span><br><span class="line">awk '<span class="variable">$0</span>=NR<span class="string">","</span><span class="variable">$0</span>'</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line">单行、多行转换</span><br><span class="line">#一行数据分割成多行</span><br><span class="line">awk 'BEGIN&#123;i=1&#125;&#123;gsub(/,/,<span class="string">",\n"</span>);i++;<span class="keyword">print</span>&#125;' <span class="keyword">file</span>.txt</span><br><span class="line"></span><br><span class="line">#每两行数据合并成一行（这个可以作为每两行合为一行使用）</span><br><span class="line">sed -<span class="keyword">n</span> '&#123;<span class="keyword">N</span>;s/\<span class="keyword">n</span>/ /p&#125;' <span class="keyword">file</span>.txt</span><br><span class="line"></span><br><span class="line">#指定几行数据合并成一行(此为10行)</span><br><span class="line">awk '&#123;<span class="keyword">if</span> (NR%10==0)&#123;<span class="keyword">print</span> <span class="variable">$0&#125;</span> <span class="keyword">else</span> &#123;printf<span class="string">"%s "</span>,<span class="variable">$0&#125;</span>&#125;' <span class="keyword">file</span>.txt</span><br><span class="line">或</span><br><span class="line"><span class="keyword">cat</span> <span class="keyword">file</span>.txt | awk '&#123;<span class="keyword">if</span>(NR%10!=0)ORS=<span class="string">" "</span>;<span class="keyword">else</span> ORS=<span class="string">"\n"</span>;<span class="keyword">print</span>&#125;'</span><br><span class="line"></span><br><span class="line">#多行数据合并成一行</span><br><span class="line">awk BEGIN&#123;RS=EOF&#125;'&#123;gsub(/\<span class="keyword">n</span>/,<span class="string">" "</span>);<span class="keyword">print</span>&#125;' <span class="keyword">file</span>.txt</span><br><span class="line">或</span><br><span class="line">sed ':a ; <span class="keyword">N</span>;s/\<span class="keyword">n</span>/ / ; t a ; ' <span class="keyword">file</span>.txt</span><br><span class="line">或</span><br><span class="line"><span class="keyword">cat</span> <span class="keyword">file</span>.txt | xargs</span><br><span class="line">或</span><br><span class="line"><span class="keyword">cat</span> <span class="keyword">file</span>.txt | tr '\<span class="keyword">n</span>' ' '</span><br></pre></td></tr></table></figure>

<h2 id="split"><a href="#split" class="headerlink" title="split"></a>split</h2><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">split</span> -b <span class="number">10</span>k <span class="built_in">date</span>.<span class="built_in">file</span> -d -<span class="keyword">a</span> <span class="number">3</span></span><br><span class="line"><span class="built_in">split</span> -l <span class="number">500000</span> -d -<span class="keyword">a</span> <span class="number">3</span> $<span class="number">1</span> value_</span><br><span class="line"><span class="built_in">split</span> -b <span class="number">300</span>m <span class="built_in">date</span>.<span class="built_in">file</span>  -d -<span class="keyword">a</span> <span class="number">3</span> $<span class="number">1</span> value_</span><br><span class="line"><span class="built_in">split</span> -b <span class="number">5</span>m check-error.<span class="built_in">log</span> -d -<span class="keyword">a</span> <span class="number">3</span> value_</span><br><span class="line"></span><br><span class="line"><span class="built_in">split</span> -l <span class="number">10</span> <span class="built_in">date</span>.<span class="built_in">file</span>按行切割</span><br><span class="line"></span><br><span class="line"><span class="built_in">split</span> -l -d -<span class="keyword">a</span> <span class="number">3</span> value_</span><br></pre></td></tr></table></figure>

<h2 id="qemu-img"><a href="#qemu-img" class="headerlink" title="qemu-img"></a>qemu-img</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">qemu-img convert -S 8k -f qcow2  CentOS7U3_GLOBAL_64bit_75G_20180404_APP.qcow2 -O <span class="built_in"> raw </span>/dev/sdc1   ----直接将qcow2文件转换并写入sdc1磁盘，记得设置-S 8k   ---这个参数指定稀疏拷贝，只写有效数据@王星童</span><br><span class="line"></span><br><span class="line">qemu-img convert -S 8k -f qcow2 new_sdoss-50G-20190225.qcow2 -O<span class="built_in"> raw </span>/os_instance/cyq.raw</span><br><span class="line">qemu-img convert -S 8k -f qcow2 new_sdoss-50G-20190225.qcow2 -O<span class="built_in"> raw </span>/dev/sdc</span><br><span class="line"></span><br><span class="line">在centos7上可以安装这个qemu-img工具，以覆盖方安装。</span><br><span class="line">rpm -ivh --force --nodeps qemu-img-ev-2.6.0-28.el7.centos.10.1.x86_64.rpm</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------------</span><br><span class="line">1.yum install  qemu-img</span><br><span class="line"></span><br><span class="line">2.qcw2镜像转化为raw镜像文件</span><br><span class="line">qemu-img convert -f qcow2  CentOS7U3_GLOBAL_64bit_75G_20180404_APP.qcow2 -O <span class="built_in"> raw </span>CentOS7U3.raw</span><br><span class="line"></span><br><span class="line">3.raw镜像转化为qcw2镜像文件</span><br><span class="line">qemu-img convert -f qcow2  win7.raw  -O <span class="built_in"> raw </span> win7.qcow2</span><br><span class="line"></span><br><span class="line">4.压测环境上传：</span><br><span class="line">time qemu-img convert -S 8k -f qcow2 -O<span class="built_in"> raw </span>/os_data/RHEL6U3_GLOBAL_64bit_75G_20180109_APP.qcow2 /mnt/snbsfuse/snpool001/fusetest</span><br></pre></td></tr></table></figure>



<h2 id="dd"><a href="#dd" class="headerlink" title="dd"></a>dd</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>是来源，of是目的。</span><br><span class="line">生成一个5G的文件：</span><br><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=/tmp/test.txt <span class="attribute">bs</span>=1M <span class="attribute">count</span>=5120</span><br><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=/tmp/test.txt <span class="attribute">bs</span>=1M <span class="attribute">count</span>=5120</span><br><span class="line">读：</span><br><span class="line">dd <span class="attribute">if</span>=/dev/sdb <span class="attribute">of</span>=/dev/null <span class="attribute">bs</span>=4k</span><br><span class="line">dd <span class="attribute">if</span>=/dev/sdb <span class="attribute">of</span>=/testrw.dbf <span class="attribute">bs</span>=4k</span><br><span class="line"></span><br><span class="line">读磁盘io：</span><br><span class="line">先dd一个5g的文件：</span><br><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=/tmp/test.txt <span class="attribute">bs</span>=1M <span class="attribute">count</span>=5120</span><br><span class="line"></span><br><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">oflag</span>=direct <span class="attribute">of</span>=./10GB <span class="attribute">bs</span>=1M <span class="attribute">count</span>=10240</span><br><span class="line"></span><br><span class="line">dd <span class="attribute">iflag</span>=direct,nonblock <span class="attribute">oflag</span>=direct,nonblock <span class="attribute">if</span>=./bigfile <span class="attribute">of</span>=/dev/null</span><br><span class="line">金泉洁 2019-01-24 10:20:12</span><br><span class="line">dd <span class="attribute">if</span>=./bigfile <span class="attribute">iflag</span>=direct,nonblock <span class="attribute">of</span>=/dev/null</span><br></pre></td></tr></table></figure>

<h2 id="tr：去除字母"><a href="#tr：去除字母" class="headerlink" title="tr：去除字母"></a>tr：去除字母</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> <span class="keyword">file</span> | <span class="keyword">tr</span> -d <span class="string">"a-zA-Z"</span>&gt;new_file</span><br></pre></td></tr></table></figure>

<h2 id="column-对齐"><a href="#column-对齐" class="headerlink" title="column :对齐"></a>column :对齐</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">以将文本结果转换为整齐的表格，上下对齐</span><br><span class="line">命令: Column</span><br><span class="line">使用的参数：</span><br><span class="line">-t ：表格，默认以空格间隔</span><br><span class="line">-s：需要配合-t使用，指定分隔符</span><br><span class="line"></span><br><span class="line">-t举例：</span><br><span class="line">[root@uyhd000225 ~]# mount</span><br><span class="line">/dev/hda1 on /<span class="built_in"> type </span>ext3 (rw)</span><br><span class="line">proc on /proc<span class="built_in"> type </span>proc (rw)</span><br><span class="line">sysfs on /sys<span class="built_in"> type </span>sysfs (rw)</span><br><span class="line">devpts on /dev/pts<span class="built_in"> type </span>devpts (rw,<span class="attribute">gid</span>=5,mode=620)</span><br><span class="line">tmpfs on /dev/shm<span class="built_in"> type </span>tmpfs (rw)</span><br><span class="line">/dev/xvdb1 on /data<span class="built_in"> type </span>ext3 (rw)</span><br><span class="line">none on /proc/sys/fs/binfmt_misc<span class="built_in"> type </span>binfmt_misc (rw)</span><br><span class="line">[root@uyhd000225 ~]# mount |column -t</span><br><span class="line">/dev/hda1   on  /                        <span class="built_in"> type </span> ext3         (rw)</span><br><span class="line">proc        on  /proc                    <span class="built_in"> type </span> proc         (rw)</span><br><span class="line">sysfs       on  /sys                     <span class="built_in"> type </span> sysfs        (rw)</span><br><span class="line">devpts      on  /dev/pts                 <span class="built_in"> type </span> devpts       (rw,<span class="attribute">gid</span>=5,mode=620)</span><br><span class="line">tmpfs       on  /dev/shm                 <span class="built_in"> type </span> tmpfs        (rw)</span><br><span class="line">/dev/xvdb1  on  /data                    <span class="built_in"> type </span> ext3         (rw)</span><br><span class="line">none        on  /proc/sys/fs/binfmt_misc <span class="built_in"> type </span> binfmt_misc  (rw)</span><br><span class="line"></span><br><span class="line">-s举例：</span><br><span class="line">[root@uyhd000225 testDir]# cat testcolumn</span><br><span class="line">Jackie | 18 | male</span><br><span class="line">Helen | 20 | female</span><br><span class="line">Daniel Liu | 23 | male</span><br><span class="line">[root@uyhd000225 testDir]# cat testcolumn | column -s <span class="string">'|'</span> -t</span><br><span class="line">Jackie        18    male</span><br><span class="line">Helen         20    female</span><br><span class="line">Daniel Liu    23    male</span><br></pre></td></tr></table></figure>

<h2 id="stat：文件的状态信息"><a href="#stat：文件的状态信息" class="headerlink" title="stat：文件的状态信息"></a>stat：文件的状态信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stat</span>命令文件权限属性设置</span><br><span class="line"><span class="built_in">stat</span>命令用于显示文件的状态信息。</span><br><span class="line"><span class="built_in">stat</span>命令的输出信息比ls命令的输出信息要更详细。</span><br><span class="line">语法 <span class="built_in">stat</span>(选项)(参数)</span><br><span class="line">选项</span><br><span class="line">-L：支持符号连接；</span><br><span class="line">-f：显示文件系统状态而非文件状态；</span><br><span class="line">-t：以简洁方式输出信息；</span><br><span class="line">--<span class="built_in">help</span>：显示指令的帮助信息；</span><br><span class="line">--version：显示指令的版本信息。</span><br><span class="line"></span><br><span class="line">参数</span><br><span class="line">文件：指定要显示信息的普通文件或者文件系统对应的设备文件名。</span><br></pre></td></tr></table></figure>

<h2 id="paste-d"><a href="#paste-d" class="headerlink" title="paste -d,"></a>paste -d,</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@host</span>102442549 ChunkServer]# cat /etc/snbs.conf.back|grep -E <span class="string">"VolDev"</span>|awk -F = <span class="string">'&#123;print <span class="subst">$2</span>&#125;'</span>|sed <span class="string">'s/,/\n/g'</span></span><br><span class="line">sdb</span><br><span class="line">sdc</span><br><span class="line">sdd</span><br><span class="line">sde</span><br><span class="line">sdf</span><br><span class="line">sdh</span><br><span class="line">sdi</span><br><span class="line">sdj</span><br><span class="line">[root<span class="meta">@host</span>102442549 ChunkServer]# lsblk|grep <span class="string">"5.7G"</span>|awk <span class="string">'&#123;print <span class="subst">$1</span>&#125;'</span>|sed <span class="string">'s/├─//g'</span></span><br><span class="line">sdg1</span><br><span class="line">sdg2</span><br><span class="line">sdg3</span><br><span class="line">sdg4</span><br><span class="line">sdg5</span><br><span class="line">sdg6</span><br><span class="line">sdg7</span><br><span class="line">sdg8</span><br><span class="line">[root<span class="meta">@host</span>102442549 ChunkServer]# cat /etc/snbs.conf.back|grep -E <span class="string">"VolDev"</span>|awk -F = <span class="string">'&#123;print <span class="subst">$2</span>&#125;'</span>|sed <span class="string">'s/,/\n/g'</span> &gt;&gt; disk.txt;lsblk|grep <span class="string">"5.7G"</span>|awk <span class="string">'&#123;print <span class="subst">$1</span>&#125;'</span>|sed <span class="string">'s/├─//g'</span> &gt;&gt; cache.sh</span><br><span class="line">[root<span class="meta">@host</span>102442549 ChunkServer]# </span><br><span class="line">[root<span class="meta">@host</span>102442549 ChunkServer]# </span><br><span class="line">[root<span class="meta">@host</span>102442549 ChunkServer]# paste -d, disk.txt cache.sh</span><br><span class="line">sdb,sdg1</span><br><span class="line">sdc,sdg2</span><br><span class="line">sdd,sdg3</span><br><span class="line">sde,sdg4</span><br><span class="line">sdf,sdg5</span><br><span class="line">sdh,sdg6</span><br><span class="line">sdi,sdg7</span><br><span class="line">sdj,sdg8</span><br></pre></td></tr></table></figure>



<h2 id="sort：排序"><a href="#sort：排序" class="headerlink" title="sort：排序"></a>sort：排序</h2><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">去除重复行</span><br><span class="line">sort -<span class="built_in">n</span> partition_id.txt |uniq|sort -<span class="built_in">n</span></span><br><span class="line">去重必须搭配sort -<span class="built_in">n</span>使用</span><br><span class="line">sort -<span class="built_in">n</span>单独使用是按照数字排序</span><br></pre></td></tr></table></figure>

<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">按数字排序：<span class="built_in">sort</span> -n <span class="built_in">number</span>.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>snbs161<span class="number">-201</span>-instance opt]# head stat.log </span><br><span class="line">/opt/write/<span class="number">1</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">655362</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375690</span> <span class="number">1573375353</span> <span class="number">1573375353</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">3</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">655364</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375832</span> <span class="number">1573375724</span> <span class="number">1573375724</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">7</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">655368</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375835</span> <span class="number">1573375724</span> <span class="number">1573375724</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">5</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">655366</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375832</span> <span class="number">1573375724</span> <span class="number">1573375724</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">9</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">655370</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375838</span> <span class="number">1573375724</span> <span class="number">1573375724</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">11</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">655372</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375832</span> <span class="number">1573375724</span> <span class="number">1573375724</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">8</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">655369</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375828</span> <span class="number">1573375724</span> <span class="number">1573375724</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">6</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">655367</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375830</span> <span class="number">1573375724</span> <span class="number">1573375724</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">13</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">655374</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375832</span> <span class="number">1573375724</span> <span class="number">1573375724</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">10</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">655371</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375829</span> <span class="number">1573375724</span> <span class="number">1573375724</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">9992</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">665353</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375829</span> <span class="number">1573375737</span> <span class="number">1573375737</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">9991</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">665352</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375833</span> <span class="number">1573375737</span> <span class="number">1573375737</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">9993</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">665354</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375828</span> <span class="number">1573375737</span> <span class="number">1573375737</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">9994</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">665355</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375832</span> <span class="number">1573375737</span> <span class="number">1573375737</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">9995</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">665356</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375834</span> <span class="number">1573375737</span> <span class="number">1573375737</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">10000</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">665361</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375831</span> <span class="number">1573375737</span> <span class="number">1573375737</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">9996</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">665357</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375828</span> <span class="number">1573375737</span> <span class="number">1573375737</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">9997</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">665358</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375830</span> <span class="number">1573375737</span> <span class="number">1573375737</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">9998</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">665359</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375831</span> <span class="number">1573375737</span> <span class="number">1573375737</span> <span class="number">4096</span></span><br><span class="line">/opt/write/<span class="number">9999</span> <span class="number">97792</span> <span class="number">192</span> <span class="number">81</span>a4 <span class="number">0</span> <span class="number">0</span> fd05 <span class="number">665360</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1573375838</span> <span class="number">1573375737</span> <span class="number">1573375737</span> <span class="number">4096</span></span><br><span class="line"></span><br><span class="line">需求：/opt/write/数字，根据数字排序</span><br><span class="line">命令：</span><br><span class="line">sort -t <span class="string">"/"</span> -n -k4 stat.log</span><br><span class="line">注：以/为分隔，按数字进行排序，指定的排序列是<span class="number">4</span></span><br><span class="line"></span><br><span class="line">sort：</span><br><span class="line"><span class="number">1.</span>-t   指定文本分隔符 </span><br><span class="line"><span class="number">2.</span>-k  指定排序列 </span><br><span class="line"><span class="number">3.</span>-n  按数字进行排序 </span><br><span class="line"><span class="number">4.</span>-r   翻转排序结果 </span><br><span class="line"><span class="number">5.</span>-g  科学记数法方式比较</span><br><span class="line"><span class="number">6.</span>-o  设置输出文件，与“&gt;”相比可以设置输出到原文件，“&gt;”会清空原文件</span><br><span class="line"><span class="number">7.</span>-u   删除相同行</span><br></pre></td></tr></table></figure>



<h2 id="map：键值"><a href="#map：键值" class="headerlink" title="map：键值"></a>map：键值</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">读文件放到map中：</span><br><span class="line">https://blog.csdn.net/weixin_42651205/article/details/83624574</span><br><span class="line">cat test.txt</span><br><span class="line">000000000007a16000000088:0</span><br><span class="line">000000000007a16000000089:0</span><br><span class="line">000000000007a16300000087:0</span><br><span class="line">000000000007a16800000088:0</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------</span><br><span class="line"><span class="meta">#!/bin/bash  </span></span><br><span class="line">str=(`cat ./test.txt | awk -F <span class="string">' '</span> <span class="string">'&#123;print $1&#125;'</span>`)</span><br><span class="line"><span class="built_in">declare</span> -A mymap;	<span class="comment">#定义</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;!str[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">eval</span> $(<span class="built_in">echo</span> <span class="variable">$&#123;str[i]&#125;</span> | awk <span class="string">'&#123;split($0, filearray, ":");print "mymap["filearray[1]"]="filearray[2]&#125;'</span>)</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#输出所有key值</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;!mymap[@]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#输出所有value值</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;mymap[@]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#遍历</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="variable">$&#123;!mymap[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;mymap[$key]&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查找和删除</span></span><br><span class="line">findkey=<span class="string">"keyx"</span></span><br><span class="line">value=<span class="string">"valuex"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;mymap[$findkey]&#125;</span></span><br><span class="line"><span class="comment">#查找插入和删除，找到就删掉，没找到就插入</span></span><br><span class="line"><span class="keyword">if</span> [ ! -n <span class="string">"<span class="variable">$&#123;mymap[$key]&#125;</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	mymap[<span class="variable">$findkey</span>]=<span class="variable">$value</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"find value"</span></span><br><span class="line">	<span class="built_in">unset</span> mymap[<span class="variable">$findkey</span>]</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">map详解：</span><br><span class="line">https://www.cnblogs.com/yy3b2007com/p/11267237.html</span><br><span class="line">在使用map时，需要先声明，否则结果可能与预期不同，array可以不声明</span><br><span class="line">方式1：</span><br><span class="line">[root@host102442549 Master]<span class="comment"># cat 11.sh </span></span><br><span class="line"><span class="built_in">declare</span> -A myMap</span><br><span class="line">myMap[<span class="string">"my03"</span>]=<span class="string">"03"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;myMap[my03]&#125;</span></span><br><span class="line">[root@host102442549 Master]<span class="comment"># sh 11.sh </span></span><br><span class="line">03</span><br><span class="line"></span><br><span class="line">方式2：</span><br><span class="line">[root@host102442549 Master]<span class="comment"># cat 22.sh </span></span><br><span class="line"><span class="built_in">declare</span> -A myMap=([<span class="string">"my01"</span>]=<span class="string">"01"</span> [<span class="string">"my02"</span>]=<span class="string">"02"</span>)</span><br><span class="line">myMap[<span class="string">"my03"</span>]=<span class="string">"03"</span></span><br><span class="line">myMap[<span class="string">"my04"</span>]=<span class="string">"04"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;myMap[my01]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;myMap[my02]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;myMap[my03]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;myMap[my04]&#125;</span></span><br><span class="line">[root@host102442549 Master]<span class="comment"># sh 22.sh </span></span><br><span class="line">01</span><br><span class="line">02</span><br><span class="line">03</span><br><span class="line">04</span><br><span class="line"></span><br><span class="line">输出Map所有的key、value、长度：</span><br><span class="line"><span class="comment"># 1）输出所有的key</span></span><br><span class="line"><span class="comment">#若未使用declare声明map，则此处将输出0，与预期输出不符，此处输出语句格式比arry多了一个！</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;!myMap[@]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2）输出所有value</span></span><br><span class="line"><span class="comment">#与array输出格式相同</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;myMap[@]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3）输出map长度</span></span><br><span class="line"><span class="comment">#与array输出格式相同</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#myMap[@]&#125;</span></span><br><span class="line"></span><br><span class="line">Map遍历：</span><br><span class="line"><span class="comment">#1)遍历，根据key找到对应的value</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="variable">$&#123;!myMap[*]&#125;</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$key</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$&#123;myMap[$key]&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#2)遍历所有的key</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="variable">$&#123;!myMap[@]&#125;</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$key</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$&#123;myMap[$key]&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#3)遍历所有的value</span></span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> <span class="variable">$&#123;myMap[@]&#125;</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$val</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">测试：</span><br><span class="line">[root@cdh-143 shell-test]<span class="comment"># more map-test.sh</span></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"一、定义Map:declare -A myMap=([\"myMap00\"]=\"00\" [\"myMap01\"]=\"01\")"</span></span><br><span class="line"><span class="built_in">declare</span> -A myMap=([<span class="string">"my00"</span>]=<span class="string">"00"</span> [<span class="string">"my01"</span>]=<span class="string">"01"</span>)</span><br><span class="line">myMap[<span class="string">"my02"</span>]=<span class="string">"02"</span></span><br><span class="line">myMap[<span class="string">"my03"</span>]=<span class="string">"03"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"二、输出所有的key:"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;!myMap[@]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"三、输出所有value:"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;myMap[@]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"四、输出map的长度:"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#myMap[@]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"五、遍历，根据key找到对应的value:"</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="variable">$&#123;!myMap[*]&#125;</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"key:"</span><span class="variable">$key</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"value:"</span><span class="variable">$&#123;myMap[$key]&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"六、遍历所有的key:"</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="variable">$&#123;!myMap[@]&#125;</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"key:"</span><span class="variable">$key</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"value:"</span><span class="variable">$&#123;myMap[$key]&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"七、遍历所有value:"</span></span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> <span class="variable">$&#123;myMap[@]&#125;</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"value:"</span><span class="variable">$val</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h1 id="002-磁盘管理"><a href="#002-磁盘管理" class="headerlink" title="002-磁盘管理"></a>002-磁盘管理</h1><h2 id="查看磁盘分区UUID的四种方法"><a href="#查看磁盘分区UUID的四种方法" class="headerlink" title="查看磁盘分区UUID的四种方法"></a>查看磁盘分区UUID的四种方法</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1、使用/dev/disk/by-uuid目录</span><br><span class="line">[root@server ~]# ls -l /dev/disk/by-uuid</span><br><span class="line">总用量 0</span><br><span class="line">lrwxrwxrwx. 1 root root 10 8月 19 00:45 bec50c5d-090c-47ad-83d5-25328b4ab7ec -&gt; <span class="built_in">..</span>/<span class="built_in">..</span>/sda1</span><br><span class="line"></span><br><span class="line">2、使用blkid命令</span><br><span class="line">[root@<span class="built_in"> server </span>~]# blkid -s UUID /dev/sda1</span><br><span class="line">/dev/sda1: <span class="attribute">UUID</span>=<span class="string">"bec50c5d-090c-47ad-83d5-25328b4ab7ec"</span></span><br><span class="line"></span><br><span class="line">3、使用tune2fs命令</span><br><span class="line">[root@<span class="built_in"> server </span>~]# tune2fs -l /dev/sda1 |grep <span class="string">'UUID'</span></span><br><span class="line">Filesystem UUID: bec50c5d-090c-47ad-83d5-25328b4ab7ec</span><br><span class="line"></span><br><span class="line">4、使用dumpe2fs命令</span><br><span class="line">[root@<span class="built_in"> server </span>~]# dumpe2fs /dev/sda1 |grep <span class="string">'UUID'</span></span><br><span class="line">dumpe2fs 1.41.12 (17-May-2010)</span><br><span class="line">Filesystem UUID: bec50c5d-090c-47ad-83d5-25328b4ab7ec</span><br></pre></td></tr></table></figure>



<h2 id="如何关闭硬盘写缓存（Write-Cache）"><a href="#如何关闭硬盘写缓存（Write-Cache）" class="headerlink" title="如何关闭硬盘写缓存（Write Cache）"></a>如何关闭硬盘写缓存（Write Cache）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">http://ilinuxkernel.com/?p=897</span><br><span class="line">如何关闭硬盘写缓存（Write <span class="keyword">Cache</span>）</span><br><span class="line">AUG17</span><br><span class="line"><span class="number">2011</span> <span class="number">1</span> <span class="keyword">COMMENT</span> WRITTEN <span class="keyword">BY</span> CHEN</span><br><span class="line">在Linux中，有时我们希望打开或关闭硬盘写缓存（Write <span class="keyword">Cache</span>），此时可以用hdparm命令来实现。</span><br><span class="line"></span><br><span class="line">建议下载最新hdparm版本，网址为：</span><br><span class="line"><span class="keyword">http</span>://sourceforge.net/projects/hdparm/</span><br><span class="line"></span><br><span class="line">查看当前硬盘写<span class="keyword">Cache</span>状态</span><br><span class="line">root@ubuntu:~/hdparm<span class="number">-9.37</span><span class="comment"># hdparm -W  /dev/sda</span></span><br><span class="line"></span><br><span class="line">关闭硬盘的写<span class="keyword">Cache</span></span><br><span class="line">root@ubuntu:~/hdparm<span class="number">-9.37</span><span class="comment"># hdparm -W  0 /dev/sda</span></span><br><span class="line"></span><br><span class="line">打开硬盘的写<span class="keyword">Cache</span></span><br><span class="line">root@ubuntu:~/hdparm<span class="number">-9.37</span><span class="comment"># hdparm -W  1 /dev/sda</span></span><br><span class="line"></span><br><span class="line">hdparm其他参数详细说明如下：</span><br><span class="line">root@ubuntu:~/hdparm<span class="number">-9.37</span><span class="comment"># ./hdparm -h</span></span><br><span class="line">hdparm – <span class="keyword">get</span>/<span class="keyword">set</span> hard disk <span class="keyword">parameters</span> – <span class="keyword">version</span> v9<span class="number">.37</span>, <span class="keyword">by</span> Mark Lord.</span><br><span class="line"><span class="keyword">Usage</span>:  hdparm  [options] [device …]</span><br><span class="line">Options:</span><br><span class="line"> -a   <span class="keyword">Get</span>/<span class="keyword">set</span> fs readahead</span><br><span class="line"> -A   <span class="keyword">Get</span>/<span class="keyword">set</span> the drive look-ahead flag (<span class="number">0</span>/<span class="number">1</span>)</span><br><span class="line"> -b   <span class="keyword">Get</span>/<span class="keyword">set</span> bus state (<span class="number">0</span> == <span class="keyword">off</span>, <span class="number">1</span> == <span class="keyword">on</span>, <span class="number">2</span> == tristate)</span><br><span class="line"> -B   <span class="keyword">Set</span> <span class="keyword">Advanced</span> <span class="keyword">Power</span> <span class="keyword">Management</span> setting (<span class="number">1</span><span class="number">-255</span>)</span><br><span class="line"> -c   <span class="keyword">Get</span>/<span class="keyword">set</span> IDE <span class="number">32</span>-<span class="built_in">bit</span> IO setting</span><br><span class="line"> -C   <span class="keyword">Check</span> drive <span class="keyword">power</span> <span class="keyword">mode</span> <span class="keyword">status</span></span><br><span class="line"> -d   <span class="keyword">Get</span>/<span class="keyword">set</span> using_dma flag</span><br><span class="line"> -D   <span class="keyword">Enable</span>/<span class="keyword">disable</span> drive defect <span class="keyword">management</span></span><br><span class="line"> -E   <span class="keyword">Set</span> cd/dvd drive speed</span><br><span class="line"> -f   <span class="keyword">Flush</span> buffer <span class="keyword">cache</span> <span class="keyword">for</span> device <span class="keyword">on</span> <span class="keyword">exit</span></span><br><span class="line"> -F   <span class="keyword">Flush</span> drive write <span class="keyword">cache</span></span><br><span class="line"> -g   Display drive geometry</span><br><span class="line"> -h   Display terse <span class="keyword">usage</span> information</span><br><span class="line"> -H   <span class="keyword">Read</span> temperature <span class="keyword">from</span> drive (Hitachi <span class="keyword">only</span>)</span><br><span class="line"> -i   Display drive identification</span><br><span class="line"> -I   Detailed/<span class="keyword">current</span> information directly <span class="keyword">from</span> drive</span><br><span class="line"> -k   <span class="keyword">Get</span>/<span class="keyword">set</span> keep_settings_over_reset flag (<span class="number">0</span>/<span class="number">1</span>)</span><br><span class="line"> -K   <span class="keyword">Set</span> drive keep_features_over_reset flag (<span class="number">0</span>/<span class="number">1</span>)</span><br><span class="line"> -L   <span class="keyword">Set</span> drive doorlock (<span class="number">0</span>/<span class="number">1</span>) (removable harddisks <span class="keyword">only</span>)</span><br><span class="line"> -m   <span class="keyword">Get</span>/<span class="keyword">set</span> multiple sector <span class="keyword">count</span></span><br><span class="line"> -M   <span class="keyword">Get</span>/<span class="keyword">set</span> acoustic <span class="keyword">management</span> (<span class="number">0</span><span class="number">-254</span>, <span class="number">128</span>: quiet, <span class="number">254</span>: <span class="keyword">fast</span>)</span><br><span class="line"> -n   <span class="keyword">Get</span>/<span class="keyword">set</span> <span class="keyword">ignore</span>-write-<span class="keyword">errors</span> flag (<span class="number">0</span>/<span class="number">1</span>)</span><br><span class="line"> -N   <span class="keyword">Get</span>/<span class="keyword">set</span> <span class="keyword">max</span> <span class="keyword">visible</span> <span class="built_in">number</span> <span class="keyword">of</span> sectors (HPA) (VERY DANGEROUS)</span><br><span class="line"> -p   <span class="keyword">Set</span> PIO <span class="keyword">mode</span> <span class="keyword">on</span> IDE <span class="keyword">interface</span> chipset (<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,…)</span><br><span class="line"> -P   <span class="keyword">Set</span> drive prefetch <span class="keyword">count</span></span><br><span class="line"> -q   <span class="keyword">Change</span> <span class="keyword">next</span> setting quietly</span><br><span class="line"> -Q   <span class="keyword">Get</span>/<span class="keyword">set</span> DMA queue_depth (<span class="keyword">if</span> supported)</span><br><span class="line"> -r   <span class="keyword">Get</span>/<span class="keyword">set</span> device readonly flag (DANGEROUS <span class="keyword">to</span> <span class="keyword">set</span>)</span><br><span class="line"> -R   Obsolete</span><br><span class="line"> -s   <span class="keyword">Set</span> <span class="keyword">power</span>-up <span class="keyword">in</span> <span class="keyword">standby</span> flag (<span class="number">0</span>/<span class="number">1</span>) (DANGEROUS)</span><br><span class="line"> -S   <span class="keyword">Set</span> <span class="keyword">standby</span> (spindown) <span class="keyword">timeout</span></span><br><span class="line"> -t   Perform device <span class="keyword">read</span> timings</span><br><span class="line"> -T   Perform <span class="keyword">cache</span> <span class="keyword">read</span> timings</span><br><span class="line"> -u   <span class="keyword">Get</span>/<span class="keyword">set</span> unmaskirq flag (<span class="number">0</span>/<span class="number">1</span>)</span><br><span class="line"> -U   Obsolete</span><br><span class="line"> -v   <span class="keyword">Use</span> <span class="keyword">defaults</span>; same as -acdgkmur for IDE drives</span><br><span class="line"> -V   Display program version and exit immediately</span><br><span class="line"> -w   Perform device <span class="keyword">reset</span> (DANGEROUS)</span><br><span class="line"> -W   <span class="keyword">Get</span>/<span class="keyword">set</span> drive write-<span class="keyword">caching</span> flag (<span class="number">0</span>/<span class="number">1</span>)</span><br><span class="line"> -x   Obsolete</span><br><span class="line"> -X   <span class="keyword">Set</span> IDE xfer <span class="keyword">mode</span> (DANGEROUS)</span><br><span class="line"> -y   Put drive <span class="keyword">in</span> <span class="keyword">standby</span> <span class="keyword">mode</span></span><br><span class="line"> -Y   Put drive <span class="keyword">to</span> <span class="keyword">sleep</span></span><br><span class="line"> -z   Re-<span class="keyword">read</span> <span class="keyword">partition</span> <span class="keyword">table</span></span><br><span class="line"> -Z   <span class="keyword">Disable</span> Seagate <span class="keyword">auto</span>-powersaving <span class="keyword">mode</span></span><br><span class="line"> –dco-freeze      Freeze/<span class="keyword">lock</span> <span class="keyword">current</span> device configuration <span class="keyword">until</span> <span class="keyword">next</span> <span class="keyword">power</span> <span class="keyword">cycle</span></span><br><span class="line"> –dco-identify    <span class="keyword">Read</span>/dump device configuration identify <span class="keyword">data</span></span><br><span class="line"> –dco-<span class="keyword">restore</span>     <span class="keyword">Reset</span> device configuration back <span class="keyword">to</span> factory <span class="keyword">defaults</span></span><br><span class="line"> –direct          <span class="keyword">Use</span> O_DIRECT <span class="keyword">to</span> bypass page <span class="keyword">cache</span> <span class="keyword">for</span> timings</span><br><span class="line"> –drq-hsm-<span class="keyword">error</span>   Crash <span class="keyword">system</span> <span class="keyword">with</span> a “stuck DRQ” <span class="keyword">error</span> (VERY DANGEROUS)</span><br><span class="line"> –fallocate       <span class="keyword">Create</span> a <span class="keyword">file</span> <span class="keyword">without</span> writing <span class="keyword">data</span> <span class="keyword">to</span> disk</span><br><span class="line"> –fibmap          <span class="keyword">Show</span> device extents (<span class="keyword">and</span> fragmentation) <span class="keyword">for</span> a <span class="keyword">file</span></span><br><span class="line"> –fwdownload            Download firmware <span class="keyword">file</span> <span class="keyword">to</span> drive (EXTREMELY DANGEROUS)</span><br><span class="line"> –fwdownload-mode3      Download firmware <span class="keyword">using</span> <span class="keyword">min</span>-<span class="keyword">size</span> segments (EXTREMELY DANGEROUS)</span><br><span class="line"> –fwdownload-mode3-<span class="keyword">max</span>  Download firmware <span class="keyword">using</span> <span class="keyword">max</span>-<span class="keyword">size</span> segments (EXTREMELY DANGEROUS)</span><br><span class="line"> –fwdownload-mode7      Download firmware <span class="keyword">using</span> a single <span class="keyword">segment</span> (EXTREMELY DANGEROUS)</span><br><span class="line"> –idle-<span class="keyword">immediate</span>  Idle drive immediately</span><br><span class="line"> –idle-unload     Idle immediately <span class="keyword">and</span> unload heads</span><br><span class="line"> –Istdin          <span class="keyword">Read</span> identify <span class="keyword">data</span> <span class="keyword">from</span> stdin <span class="keyword">as</span> <span class="keyword">ASCII</span> <span class="keyword">hex</span></span><br><span class="line"> –Istdout         Write identify <span class="keyword">data</span> <span class="keyword">to</span> stdout <span class="keyword">as</span> <span class="keyword">ASCII</span> <span class="keyword">hex</span></span><br><span class="line"> –make-bad-sector Deliberately corrupt a sector directly <span class="keyword">on</span> the media (VERY DANGEROUS)</span><br><span class="line"> –<span class="keyword">offset</span>          <span class="keyword">use</span> <span class="keyword">with</span> -t, <span class="keyword">to</span> <span class="keyword">begin</span> timings <span class="keyword">at</span> given <span class="keyword">offset</span> (<span class="keyword">in</span> GiB) <span class="keyword">from</span> <span class="keyword">start</span> <span class="keyword">of</span> drive</span><br><span class="line"> –prefer-ata12    <span class="keyword">Use</span> <span class="number">12</span>-<span class="keyword">byte</span> (instead <span class="keyword">of</span> <span class="number">16</span>-<span class="keyword">byte</span>) SAT commands <span class="keyword">when</span> possible</span><br><span class="line"> –<span class="keyword">read</span>-sector     <span class="keyword">Read</span> <span class="keyword">and</span> dump (<span class="keyword">in</span> <span class="keyword">hex</span>) a sector directly <span class="keyword">from</span> the media</span><br><span class="line"> –<span class="keyword">security</span>-<span class="keyword">help</span>   Display <span class="keyword">help</span> <span class="keyword">for</span> ATA <span class="keyword">security</span> commands</span><br><span class="line"> –<span class="keyword">trim</span>-sector-ranges        Tell SSD firmware <span class="keyword">to</span> discard unneeded <span class="keyword">data</span> sectors: lba:<span class="keyword">count</span> ..</span><br><span class="line"> –<span class="keyword">trim</span>-sector-ranges-stdin  Same <span class="keyword">as</span> above, but <span class="keyword">reads</span> lba:<span class="keyword">count</span> pairs <span class="keyword">from</span> stdin</span><br><span class="line"> –verbose         Display extra <span class="keyword">diagnostics</span> <span class="keyword">from</span> <span class="keyword">some</span> commands</span><br><span class="line"> –write-sector    <span class="keyword">Repair</span>/overwrite a (possibly bad) sector directly <span class="keyword">on</span> the media (VERY DANGEROUS)</span><br><span class="line"></span><br><span class="line">root@ubuntu:~/hdparm<span class="number">-9.37</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>



<h2 id="Linux创建虚拟块设备并格式化为文件系统"><a href="#Linux创建虚拟块设备并格式化为文件系统" class="headerlink" title="Linux创建虚拟块设备并格式化为文件系统"></a>Linux创建虚拟块设备并格式化为文件系统</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span><span class="comment">//blog.csdn.net/q1449516487/article/details/100518520</span></span><br><span class="line">dd一个文件映射成一个盘</span><br><span class="line"><span class="symbol">https:</span><span class="comment">//blog.csdn.net/q1449516487/article/details/100518520</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//www.cnblogs.com/xuyaowen/archive/2019/07/10/lustre-loop-device.html</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//www.cnblogs.com/MrVolleyball/p/9993137.html</span></span><br><span class="line">环境</span><br><span class="line">    为了方便学习文件系统的原理和原始数据的分析，需要创建虚拟块设备并格式化为ext4文件系统；</span><br><span class="line">Linux创建虚拟块设备</span><br><span class="line">    losetup命令</span><br><span class="line">    -a 显示所有已经使用的回环设备状态</span><br><span class="line">    -d 卸除回环设备</span><br><span class="line">    -f 寻找第一个未使用的回环设备</span><br><span class="line">    -e <span class="params">&lt;加密选项&gt;</span> 启动加密编码</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>制作块文件 <span class="number">3</span> 个</span><br><span class="line">[root@localhost yaoxu]<span class="meta"># dd <span class="meta-keyword">if</span>=/dev/zero of=loop.img bs=10M count=10000</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>创建回环设备</span><br><span class="line">[root@localhost yaoxu]<span class="meta"># losetup /dev/loop1 /home/yaoxu/loop.img</span></span><br><span class="line">或者</span><br><span class="line">[root@localhost yaoxu]<span class="meta">#losetup -f /home/yaoxu/loop.img</span></span><br><span class="line"></span><br><span class="line">[root@localhost yaoxu]<span class="meta"># ls /dev/loo*</span></span><br><span class="line"><span class="meta-keyword">/dev/</span>loop0  <span class="meta-keyword">/dev/</span>loop1  <span class="meta-keyword">/dev/</span>loop-control</span><br><span class="line">[root@localhost yaoxu]<span class="meta"># losetup -a</span></span><br><span class="line"><span class="meta-keyword">/dev/</span>loop1: [<span class="number">64770</span>]:<span class="number">3558</span> (<span class="meta-keyword">/home/</span>yaoxu/loop.img)</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 创建lustre文件系统，并挂载</span><br></pre></td></tr></table></figure>

<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">关于回环设备是什么可以参考如下解释：</span><br><span class="line">回环设备（ <span class="string">'loopback device'</span>）允许用户以一个普通磁盘文件虚拟一个块设备。设想一个磁盘设备，对它的所有读写操作都将被重定向到读写一个名为 disk-<span class="keyword">image</span> 的普通文件而非操作实际磁盘或分区的轨道和扇区。（当然，disk-<span class="keyword">image</span> 必须存在于一个实际的磁盘上，而这个磁盘必须比虚拟的磁盘容量更大。）回环设备允许你这样使用一个普通文件。</span><br><span class="line"></span><br><span class="line">回环设备以 /dev/loop0、/dev/loop1 等命名。每个设备可虚拟一个块设备。注意只有超级用户才有权限设置回环设备。</span><br><span class="line"></span><br><span class="line">回环设备的使用与其它任何块设备相同。特别是，你可以在这个设备上创建文件系统并像普通的磁盘一样将它挂载在系统中。这样的一个将全部内容保存在一个普通文件中的文件系统，被称为虚拟文件系统（virtual <span class="keyword">file</span> <span class="keyword">system</span>）（译者注：这个用法并不常见。VFS 通常另有所指，如指代 Linux 内核中有关文件系统抽象的代码层次等）。</span><br></pre></td></tr></table></figure>

<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 什么是<span class="keyword">loop</span>设备？</span><br><span class="line"></span><br><span class="line"><span class="keyword">loop</span>设备是一种伪设备，是使用文件来模拟块设备的一种技术，文件模拟成块设备后, 就像一个磁盘或光盘一样使用。在使用之前，一个 <span class="keyword">loop</span> 设备必须要和一个文件进行连接。这种结合方式给用户提供了一个替代块特殊文件的接口。因此，如果这个文件包含有一个完整的文件系统，那么这个文件就可以像一个磁盘设备一样被 mount 起来。之所以叫<span class="keyword">loop</span>设备（回环），其实是从文件系统这一层来考虑的，因为这种被 mount 起来的镜像文件它本身也包含有文件系统，通过<span class="keyword">loop</span>设备把它mount起来，它就像是文件系统之上再绕了一圈的文件系统，所以称为 <span class="keyword">loop</span>。</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> <span class="keyword">loop</span>设备的使用</span><br><span class="line"></span><br><span class="line">一般在linux中会有<span class="number">8</span>个<span class="keyword">loop</span>设备，一般是/dev/loop0~loop7，可用通过losetup <span class="params">-a</span>查看所有的<span class="keyword">loop</span>设备，如果命令没有输出就说明所有的<span class="keyword">loop</span>设备都没有被占用，你可以按照以下步骤创建自己的<span class="keyword">loop</span>设备。</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>）创建一个文件</span><br><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/<span class="built_in">var</span>/<span class="keyword">loop</span>.img bs=<span class="number">1</span>M count=<span class="number">10240</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）使用losetup将文件转化为块设备</span><br><span class="line">losetup /dev/loop0 /<span class="built_in">var</span>/<span class="keyword">loop</span>.img</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>）通过lsblk查看刚刚创建的块设备</span><br><span class="line">lsblk |grep loop0</span><br><span class="line">losetup <span class="params">-a</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span>）当然，你也可以将这个块设备格式化并创建其他的文件系统，然后再mount到某个目录，有点多余啊，一般人不这么干。</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>）要删除这个<span class="keyword">loop</span>设备可以执行以下命令</span><br><span class="line">losetup <span class="params">-d</span> /dev/loop0</span><br><span class="line">也能参考如下链接：</span><br><span class="line">https:<span class="comment">//blog.csdn.net/baimafujinji/article/details/78810042</span></span><br><span class="line">https:<span class="comment">//cocos.iteye.com/blog/1068619</span></span><br><span class="line">https:<span class="comment">//blog.csdn.net/scaleqiao/article/details/46777811</span></span><br><span class="line">https:<span class="comment">//www.cnblogs.com/zhanghaiyublog/p/3611507.html</span></span><br></pre></td></tr></table></figure>



<h2 id="lvm"><a href="#lvm" class="headerlink" title="lvm"></a>lvm</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">raid卡是提高性能的</span><br><span class="line">lvm是增加容量的</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">磁盘</span><br><span class="line">[<span class="symbol">root@</span>block-storage14 home]# vgs</span><br><span class="line">  VG       #PV #LV #SN Attr   VSize  VFree</span><br><span class="line">  datavg     <span class="number">1</span>   <span class="number">1</span>   <span class="number">0</span> wz--n-  <span class="number">1.34</span>t <span class="number">1.24</span>t</span><br><span class="line">  systemvg   <span class="number">1</span>   <span class="number">7</span>   <span class="number">0</span> wz--n- <span class="number">74.51</span>g <span class="number">4.00</span>m</span><br><span class="line"> 注释：datavg是数据盘 systemvg是系统盘</span><br><span class="line"> </span><br><span class="line">lvcreate -L <span class="number">80</span>G -n metadatalv datavg</span><br><span class="line"></span><br><span class="line">lvremove /dev/datavg/data-metadatalv</span><br><span class="line"></span><br><span class="line">格式化：mkfs -t ext4 /dev/mapper/datavg-metadatalv</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//blog.csdn.net/qq_27721925/article/details/52403912</span></span><br><span class="line">LVM ——Logical Volume Manager (逻辑卷管理)</span><br><span class="line">逻辑卷管理是Linux环境下对磁盘分区进行管理的一种机制，LVM是建立在硬盘和分区之上的一个逻辑层，用来提高磁盘分区管理的灵活性。</span><br><span class="line"></span><br><span class="line">一、优点</span><br><span class="line">磁盘空间的动态划分和管理 </span><br><span class="line">实现分区的动态拉伸和回缩</span><br><span class="line"></span><br><span class="line">二、逻辑卷管理的组成</span><br><span class="line"><span class="number">1</span>、物理卷(PV——Pvcreate Volume) </span><br><span class="line">物理卷在逻辑卷管理中处于最底层，它可以是实际物理硬盘上的分区，也可以是整个物理硬盘。</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、卷组(VG——Vgcreate Group) </span><br><span class="line">卷组建立在物理卷之上，一个卷组中至少要包括一个物理卷，在卷组建立之后可动态添加物理卷到卷组中。一个逻辑卷管理系统中可以只有一个卷组，也可以拥有多个卷组。</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、逻辑卷(LV——Lvcreate Volume) </span><br><span class="line">逻辑卷建立在卷组之上，卷中的未分配空间可以用于建立新的逻辑卷，逻辑卷建立后可以动态地扩展和缩小空间。系统中的多个逻辑卷可以属于同一个卷组，也可以属于不同的多个卷组。</span><br><span class="line"></span><br><span class="line">三、LV的创建步骤</span><br><span class="line">LV的创建过程其实是一个先整合、再划分的过程 </span><br><span class="line">（<span class="number">1</span>）添加硬盘或者创建分区，通知内核 </span><br><span class="line">（<span class="number">2</span>）创建物理卷 </span><br><span class="line">（<span class="number">3</span>）创建卷组 </span><br><span class="line">（<span class="number">4</span>）创建逻辑卷 </span><br><span class="line">（<span class="number">5</span>）创建文件系统(mkfs.ext4) </span><br><span class="line">（<span class="number">6</span>）挂载使用(mkdir；mount)</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、创建分区 划分<span class="number">3</span>个分区，每个<span class="number">2</span>G</span><br></pre></td></tr></table></figure>

<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">linux环境下，假设有一个磁盘<span class="string">/dev/vdb</span>（ssd磁盘可能是sda或者sdb)，一共200G， 要将其分为3个逻辑分区，分别挂载在<span class="string">/mysql</span>, <span class="string">/binlog</span>, <span class="string">/bak</span>三个目录下</span><br><span class="line">环境：CentOS 7.3</span><br><span class="line">一、创建磁盘分区</span><br><span class="line"><span class="comment"># 查看/dev/vdb信息</span></span><br><span class="line">fdisk -l <span class="string">/dev/vdb</span></span><br><span class="line"><span class="comment"># 初始化磁盘</span></span><br><span class="line">pvcreate <span class="string">/dev/vdb</span></span><br><span class="line"><span class="comment"># 查看物理磁盘卷</span></span><br><span class="line">pvs</span><br><span class="line"><span class="comment"># 创建一个LVM卷组datavg</span></span><br><span class="line">vgcreate datavg <span class="string">/dev/vdb</span></span><br><span class="line"><span class="comment"># 查看LVM卷组信息</span></span><br><span class="line">vgs</span><br><span class="line"><span class="comment"># 创建逻辑分区</span></span><br><span class="line">lvcreate -y -n datalv -L 50G datavg</span><br><span class="line">lvcreate -y -n binloglv -L 50G datavg</span><br><span class="line">lvcreate -y -n baklv -L 99G datavg</span><br><span class="line"><span class="comment"># 查看逻辑分区信息</span></span><br><span class="line">lvs</span><br><span class="line"><span class="comment"># 格式化磁盘分区</span></span><br><span class="line">mkfs.xfs  <span class="string">/dev/datavg/datalv</span></span><br><span class="line">mkfs.xfs <span class="string">/dev/datavg/baklv</span></span><br><span class="line">mkfs.xfs <span class="string">/dev/datavg/binloglv</span></span><br><span class="line"><span class="comment"># 挂载分区</span></span><br><span class="line">mount <span class="string">/dev/datavg/datalv</span> <span class="string">/mysql</span></span><br><span class="line">mount <span class="string">/dev/datavg/binloglv</span> <span class="string">/binlog</span></span><br><span class="line">mount <span class="string">/dev/datavg/baklv</span> <span class="string">/bak</span></span><br><span class="line"><span class="comment"># 磁盘分区创建完成，查看磁盘分区信息</span></span><br><span class="line">df -h -T</span><br><span class="line"></span><br><span class="line">二、删除磁盘分区</span><br><span class="line"><span class="comment"># 卸载分区</span></span><br><span class="line">umount <span class="string">/mysql</span></span><br><span class="line">umount <span class="string">/binlog</span></span><br><span class="line">umount <span class="string">/bak</span></span><br><span class="line"><span class="comment"># 确认分区已卸载</span></span><br><span class="line">df -h -T</span><br><span class="line"><span class="comment"># 查看逻辑分区</span></span><br><span class="line">lvs</span><br><span class="line"><span class="comment"># 移除逻辑分区</span></span><br><span class="line">lvremove -y <span class="string">/dev/datavg/datalv</span></span><br><span class="line">lvremove -y <span class="string">/dev/datavg/binloglv</span></span><br><span class="line">lvremove -y <span class="string">/dev/datavg/baklv</span></span><br><span class="line"><span class="comment"># 移除LVM卷组</span></span><br><span class="line">vgremove datavg</span><br><span class="line"><span class="comment"># 移除物理磁盘卷</span></span><br><span class="line">pvremove <span class="string">/dev/vdb</span></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">linux磁盘分区创建与删除会对磁盘上已有的数据造成损坏，谨慎操作。以上命令的详细信息请参考帮助文档，这里不再赘述。</span><br></pre></td></tr></table></figure>

<h2 id="part"><a href="#part" class="headerlink" title="part"></a>part</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">https://blog.csdn.net/qq_32863631/article/details/76047133</span></span><br><span class="line"><span class="string">https://www.cnblogs.com/kreo/p/11406217.html</span></span><br><span class="line"><span class="string">https://blog.csdn.net/sfdst/article/details/81167080</span></span><br><span class="line"><span class="string">https://blog.csdn.net/qq_32863631/article/details/76047133</span></span><br><span class="line"></span><br><span class="line"><span class="string">创建分区：</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">~]#</span> <span class="string">parted</span> <span class="string">/dev/sdb</span>   </span><br><span class="line"><span class="string">GNU</span> <span class="string">Parted</span> <span class="number">1.8</span><span class="number">.1</span> <span class="string">Using</span> <span class="string">/dev/sdb</span> <span class="string">Welcome</span> <span class="string">to</span> <span class="string">GNU</span> <span class="string">Parted!</span> <span class="string">Type</span> <span class="string">‘help’</span> <span class="string">to</span> <span class="string">view</span> <span class="string">a</span> <span class="string">list</span> <span class="string">of</span> <span class="string">commands.</span></span><br><span class="line"><span class="string">(parted)</span> <span class="string">mklabel</span> <span class="string">gpt</span>           <span class="comment"># 将MBR磁盘格式化为GPT</span></span><br><span class="line"><span class="string">(parted)</span> <span class="string">print</span>                       <span class="comment">#打印当前分区</span></span><br><span class="line"><span class="string">(parted)</span> <span class="string">mkpart</span> <span class="string">primary</span> <span class="number">0</span> <span class="number">4.</span><span class="string">5TB</span>                <span class="comment"># 分一个4.5T的主分区</span></span><br><span class="line"><span class="string">(parted)</span> <span class="string">mkpart</span> <span class="string">primary</span> <span class="number">4.</span><span class="string">5TB</span> <span class="string">12TB</span>      <span class="comment"># 分一个7.5T的主分区</span></span><br><span class="line"><span class="string">(parted)</span> <span class="string">print</span>                         <span class="comment">#打印当前分区</span></span><br><span class="line"><span class="string">(parted)</span> <span class="string">quit</span> <span class="string">退出</span></span><br><span class="line"></span><br><span class="line"><span class="string">或者</span></span><br><span class="line"><span class="string">GNU</span> <span class="string">Parted</span> <span class="number">1.8</span><span class="number">.1</span> <span class="string">Using</span> <span class="string">/dev/sdb</span> <span class="string">Welcome</span> <span class="string">to</span> <span class="string">GNU</span> <span class="string">Parted!</span> <span class="string">Type</span> <span class="string">‘help’</span> <span class="string">to</span> <span class="string">view</span> <span class="string">a</span> <span class="string">list</span> <span class="string">of</span> <span class="string">commands.</span></span><br><span class="line"><span class="string">(parted)</span> <span class="string">mklabel</span> <span class="string">gpt</span>           <span class="comment"># 将MBR磁盘格式化为GPT</span></span><br><span class="line"><span class="string">(parted)</span> <span class="string">mkpart</span> <span class="string">primary</span> <span class="number">1</span> <span class="number">3072</span>            <span class="comment">#默认单位是M                                                                                     </span></span><br><span class="line"><span class="string">(parted)</span> <span class="string">mkpart</span> <span class="string">primary</span> <span class="number">3072</span> <span class="number">6144</span></span><br><span class="line"><span class="string">(parted)</span> <span class="string">mkpart</span> <span class="string">primary</span> <span class="number">6144</span> <span class="number">9216</span></span><br><span class="line"><span class="string">(parted)</span> <span class="string">mkpart</span> <span class="string">primary</span> <span class="number">9216</span> <span class="number">12288</span>                                   </span><br><span class="line"><span class="string">(parted)</span> <span class="string">mkpart</span> <span class="string">primary</span> <span class="number">12288</span> <span class="number">15360</span></span><br><span class="line"><span class="string">(parted)</span> <span class="string">mkpart</span> <span class="string">primary</span> <span class="number">15360</span> <span class="number">18432</span>                                 </span><br><span class="line"><span class="string">(parted)</span> <span class="string">mkpart</span> <span class="string">primary</span> <span class="number">18432</span> <span class="number">21504</span>                                 </span><br><span class="line"><span class="string">(parted)</span> <span class="string">mkpart</span> <span class="string">primary</span> <span class="number">21504</span> <span class="number">24577</span></span><br><span class="line"><span class="string">(parted)</span> <span class="string">quit</span></span><br><span class="line"></span><br><span class="line"><span class="string">mklabel</span> <span class="string">gpt</span></span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">1</span> <span class="number">3072</span>     </span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">3072</span> <span class="number">6144</span></span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">6144</span> <span class="number">9216</span></span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">9216</span> <span class="number">12288</span> </span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">12288</span> <span class="number">15360</span></span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">15360</span> <span class="number">18432</span></span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">18432</span> <span class="number">21504</span></span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">21504</span> <span class="number">24577</span></span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">24577</span> <span class="number">434177</span></span><br><span class="line"></span><br><span class="line"><span class="string">disk=`lsblk|grep</span> <span class="number">2.9</span><span class="string">|sed</span> <span class="string">'s/├─//g'</span><span class="string">|awk</span> <span class="string">'&#123;print $1&#125;'</span><span class="string">|head</span> <span class="number">-1</span><span class="string">|sed</span> <span class="string">'s/[1-9]//g'</span><span class="string">`;parted</span> <span class="string">/dev/$&#123;disk&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="string">rm</span> <span class="number">1</span></span><br><span class="line"><span class="string">rm</span> <span class="number">2</span></span><br><span class="line"><span class="string">rm</span> <span class="number">3</span></span><br><span class="line"><span class="string">rm</span> <span class="number">4</span></span><br><span class="line"><span class="string">rm</span> <span class="number">5</span></span><br><span class="line"><span class="string">rm</span> <span class="number">6</span></span><br><span class="line"><span class="string">rm</span> <span class="number">7</span></span><br><span class="line"><span class="string">rm</span> <span class="number">8</span></span><br><span class="line"><span class="string">rm</span> <span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="string">磁盘开始的位置和磁盘结束的位置，默认单位是M，可以使用unit</span> <span class="string">GB改变默认单位GB</span></span><br><span class="line"><span class="string">for</span> <span class="string">i</span> <span class="string">in</span> <span class="string">`seq</span> <span class="number">1</span> <span class="number">8</span><span class="string">`;do</span> <span class="string">/home/snbs/ChunkServer/server</span> <span class="string">format</span> <span class="string">-dev=sda$&#123;i&#125;</span> <span class="string">-purpose=wcache;done</span></span><br><span class="line"></span><br><span class="line"><span class="string">全闪环境：</span></span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">1</span> <span class="number">3072</span>     </span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">3072</span> <span class="number">6144</span></span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">6144</span> <span class="number">9216</span></span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">9216</span> <span class="number">12288</span> </span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">12288</span> <span class="number">15360</span></span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">15360</span> <span class="number">18432</span></span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">18432</span> <span class="number">21504</span></span><br><span class="line"><span class="string">mkpart</span> <span class="string">primary</span> <span class="number">21504</span> <span class="number">763084</span></span><br><span class="line"></span><br><span class="line"><span class="string">删除分区：</span></span><br><span class="line"><span class="string">(parted)</span> <span class="string">p</span>                                                                </span><br><span class="line"><span class="attr">Model:</span> <span class="string">AVAGO</span> <span class="string">AVAGO</span> <span class="string">(scsi)</span></span><br><span class="line"><span class="attr">Disk /dev/sdb:</span> <span class="number">18.</span><span class="string">0TB</span></span><br><span class="line"><span class="string">Sector</span> <span class="string">size</span> <span class="string">(logical/physical):</span> <span class="string">512B/4096B</span></span><br><span class="line"><span class="attr">Partition Table:</span> <span class="string">gpt</span></span><br><span class="line"><span class="attr">Disk Flags:</span> </span><br><span class="line"></span><br><span class="line"><span class="string">Number</span>  <span class="string">Start</span>   <span class="string">End</span>     <span class="string">Size</span>    <span class="string">File</span> <span class="string">system</span>  <span class="string">Name</span>     <span class="string">Flags</span></span><br><span class="line"> <span class="number">1</span>      <span class="number">17.</span><span class="string">4kB</span>  <span class="string">4096GB</span>  <span class="string">4096GB</span>               <span class="string">primary</span></span><br><span class="line"></span><br><span class="line"><span class="string">(parted)</span> <span class="string">rm</span> <span class="number">1</span>                                                             </span><br><span class="line"><span class="string">(parted)</span> <span class="string">p</span>                                                                </span><br><span class="line"><span class="attr">Model:</span> <span class="string">AVAGO</span> <span class="string">AVAGO</span> <span class="string">(scsi)</span></span><br><span class="line"><span class="attr">Disk /dev/sdb:</span> <span class="number">18.</span><span class="string">0TB</span></span><br><span class="line"><span class="string">Sector</span> <span class="string">size</span> <span class="string">(logical/physical):</span> <span class="string">512B/4096B</span></span><br><span class="line"><span class="attr">Partition Table:</span> <span class="string">gpt</span></span><br><span class="line"><span class="attr">Disk Flags:</span> </span><br><span class="line"></span><br><span class="line"><span class="string">Number</span>  <span class="string">Start</span>  <span class="string">End</span>  <span class="string">Size</span>  <span class="string">File</span> <span class="string">system</span>  <span class="string">Name</span>  <span class="string">Flags</span></span><br><span class="line"></span><br><span class="line"><span class="string">(parted)</span></span><br></pre></td></tr></table></figure>

<h2 id="fdisk"><a href="#fdisk" class="headerlink" title="fdisk"></a>fdisk</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@host102442553 ~]# fdisk /dev/sdc</span><br><span class="line"></span><br><span class="line">The device presents a logical sector size that <span class="keyword">is</span> smaller than</span><br><span class="line">the physical sector size. Aligning <span class="keyword">to</span> a physical sector (<span class="keyword">or</span> optimal</span><br><span class="line">I/O) size boundary <span class="keyword">is</span> recommended, <span class="keyword">or</span> performance may be impacted.</span><br><span class="line">Welcome <span class="keyword">to</span> fdisk (util-linux <span class="number">2.23</span><span class="number">.2</span>).</span><br><span class="line"></span><br><span class="line">Changes will remain <span class="keyword">in</span> memory <span class="keyword">only</span>, <span class="keyword">until</span> you decide <span class="keyword">to</span> <span class="keyword">write</span> them.</span><br><span class="line">Be careful <span class="keyword">before</span> <span class="keyword">using</span> the <span class="keyword">write</span> command.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> help): d</span><br><span class="line"><span class="keyword">Partition</span> number (<span class="number">1</span>,<span class="number">2</span>, <span class="keyword">default</span> <span class="number">2</span>): <span class="number">1</span></span><br><span class="line"><span class="keyword">Partition</span> <span class="number">1</span> <span class="keyword">is</span> deleted</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> help): w</span><br><span class="line">The <span class="keyword">partition</span> <span class="keyword">table</span> has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() <span class="keyword">to</span> re-<span class="keyword">read</span> <span class="keyword">partition</span> <span class="keyword">table</span>.</span><br><span class="line"></span><br><span class="line"><span class="built_in">WARNING</span>: Re-reading the <span class="keyword">partition</span> <span class="keyword">table</span> failed <span class="keyword">with</span> error <span class="number">16</span>: Device <span class="keyword">or</span> resource busy.</span><br><span class="line">The kernel still uses the <span class="built_in">old</span> <span class="keyword">table</span>. The <span class="built_in">new</span> <span class="keyword">table</span> will be used at</span><br><span class="line">the next reboot <span class="keyword">or</span> <span class="keyword">after</span> you run partprobe(<span class="number">8</span>) <span class="keyword">or</span> kpartx(<span class="number">8</span>)</span><br><span class="line">Syncing disks.</span><br><span class="line"></span><br><span class="line">解决：操作完，执行partprobe（#.为了不reboot就能生效，强制内核重新读取分区表）</span><br><span class="line">http://blog.itpub.net/<span class="number">22907091</span>/viewspace<span class="number">-748118</span>/</span><br><span class="line">https://www.cnblogs.com/zsychanpin/p/<span class="number">6784655.</span>html</span><br><span class="line"> partprobe包括在parted的rpm软件包中。partprobe能够改动kernel中分区表。使kernel又一次读取分区表。 因此。使用该命令就行创建分区而且在不又一次启动机器的情况下系统可以识别这些分区。</span><br></pre></td></tr></table></figure>

<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span><span class="comment">//www.cnblogs.com/zishengY/p/7137671.html</span></span><br><span class="line">一.  创建分区</span><br><span class="line">先查看下是否有磁盘没有分区</span><br></pre></td></tr></table></figure>

<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584950864092-1585551848364.png" alt="1584950864092"></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入<span class="selector-tag">p</span> 查看当前硬盘分区，目前没有分区</span><br></pre></td></tr></table></figure>

<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584950877483-1585551867171.png" alt="1584950877483"></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入n新建一个分区，输入p 建立分区，输入分区编号 <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584950901855-1585551881417.png" alt="1584950901855"></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">然后会让你设置开始扇区,我填的是开始扇区<span class="number">2048</span>，结束，<span class="number">20480</span></span><br></pre></td></tr></table></figure>

<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584950916178-1585551894581.png" alt="1584950916178"></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">可以填“+<span class="number">100</span>G”</span><br><span class="line">最后输入w,回车保存</span><br></pre></td></tr></table></figure>

<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584950933865-1585551912922.png" alt="1584950933865"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">其实这个时候，建立好的分区还不能用，还需要挂载才可以用。但是挂载之前，必须要格式化，才行。。。</span></span><br><span class="line"></span><br><span class="line"><span class="string">三.</span> <span class="string">格式化分区</span></span><br><span class="line"><span class="string">mkfs.ext4</span>   <span class="string">/dev/vdb</span></span><br><span class="line"></span><br><span class="line"><span class="string">四.</span> <span class="string">挂载</span></span><br><span class="line"><span class="number">4.1</span><span class="string">挂载分区</span></span><br><span class="line"><span class="number">4.1</span><span class="number">.1</span> <span class="string">先创建挂载目录</span></span><br><span class="line"><span class="string">mkdir</span> <span class="string">/lutong</span></span><br><span class="line"><span class="number">4.1</span><span class="number">.2</span> <span class="string">通知系统内核分区表的变化，不然内核不知道分区（或重启系统）</span></span><br><span class="line"><span class="string">partprobe</span> <span class="string">/dev/vdb</span></span><br><span class="line"><span class="number">4.1</span><span class="number">.3</span> <span class="string">然后再挂载分区</span></span><br><span class="line"><span class="string">mount</span> <span class="string">/dev/vdb</span> <span class="string">/lutong</span></span><br><span class="line"><span class="number">4.1</span><span class="number">.4</span> <span class="string">最后查看挂载是否成功</span></span><br><span class="line"><span class="string">df</span> <span class="string">-h</span></span><br><span class="line"><span class="string">补充：</span></span><br><span class="line"><span class="string">使用工具partprobe让kernel读取分区信息</span></span><br><span class="line"><span class="string">[root@db2</span> <span class="string">~]#</span> <span class="string">partprobe</span></span><br><span class="line"><span class="string">使用fdisk工具只是将分区信息写到磁盘，如果需要mkfs磁盘分区则需要重启系统，</span></span><br><span class="line"><span class="string">而使用partprobe则可以使kernel重新读取分区</span> <span class="string">信息，从而避免重启系统。</span></span><br><span class="line"></span><br><span class="line"><span class="number">4.2</span> <span class="string">设置开机自动挂载</span></span><br><span class="line"><span class="string">vim</span> <span class="string">/etc/fstab</span></span><br><span class="line"><span class="string">mount</span> <span class="string">-a</span></span><br><span class="line"></span><br><span class="line"><span class="string">五.</span> <span class="string">卸载及删除分区</span></span><br><span class="line"><span class="number">5.1</span> <span class="string">卸载</span></span><br><span class="line"><span class="string">umount</span> <span class="string">/dev/vdb</span></span><br><span class="line"></span><br><span class="line"><span class="number">5.2</span> <span class="string">删除分区</span></span><br><span class="line"><span class="string">fdisk</span> <span class="string">/dev/sdc</span></span><br><span class="line"><span class="string">m</span></span><br><span class="line"><span class="string">d</span></span><br><span class="line"><span class="number">1</span>   </span><br><span class="line"><span class="string">d</span>   <span class="comment">#删除</span></span><br><span class="line"><span class="string">w</span>   <span class="comment">#输入 w  保存，这个时候分区以及删除了，可以重新创建了</span></span><br></pre></td></tr></table></figure>

<h2 id="MBR和GPT"><a href="#MBR和GPT" class="headerlink" title="MBR和GPT"></a>MBR和GPT</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">模拟磁盘损坏：</span><br><span class="line">https:<span class="comment">//blog.51cto.com/jk6627/1957816</span></span><br><span class="line">https:<span class="comment">//www.cnblogs.com/jenqz/p/3613829.html</span></span><br><span class="line"></span><br><span class="line">目前对于硬盘的分区方式有两种：MBR和GPT。</span><br><span class="line">【MBR的备份和恢复】</span><br><span class="line">采用MBR分区的硬盘中一共有四个分区：扩展分区最多有一个，如果不需要再分逻辑分区，可以没有扩展分区。</span><br><span class="line"></span><br><span class="line">我们都知道磁盘上有一个个的磁道，每个磁道上有很多的扇区，从磁盘的外围向内，从<span class="number">0</span>开始逐渐增加磁道编号，每次磁道中的扇区也是从<span class="number">0</span>开始进行编号，而MBR这个数据块就位于<span class="number">0</span>磁道<span class="number">0</span>扇区。</span><br><span class="line"></span><br><span class="line">每个扇区的大小为<span class="number">512</span>字节，所以磁盘上的MBR的大小就为<span class="number">512</span>字节，而这<span class="number">512</span>字节又分为：</span><br><span class="line">*主引导程序（偏移地址<span class="number">0000</span>H-<span class="number">-0088</span>H），它负责从活动分 区中装载，并运行系统引导程序。</span><br><span class="line">*出错信息数据区（偏移地址<span class="number">0089</span>H-<span class="number">-00E1</span>H为出错信息， <span class="number">00E2</span>H-<span class="number">-01</span>BDH全为<span class="number">0</span>字节。）</span><br><span class="line">*分区表（DPT,Disk Partition Table）含<span class="number">4</span>个分区项，偏移地址<span class="number">01</span>BEH-<span class="number">-01</span>FDH,每个分区表项长<span class="number">16</span>个字节，共<span class="number">64</span>字节为 分区项<span class="number">1</span>、分区项<span class="number">2</span>、分区项<span class="number">3</span>、分区项<span class="number">4</span> v</span><br><span class="line">*结束标志字，偏移地址<span class="number">01</span>FE-<span class="number">-01</span>FF的<span class="number">2</span>个字节值为结束标志 <span class="number">55</span>AA</span><br><span class="line"></span><br><span class="line">所以MBR存储的信息很重要，前<span class="number">446</span>字节的启动引导信息，是当系统启动时由BIOS自举，进行首先查找的地方，根据启动引导中的内容到指定的位置进行加载西东启动文件，所以如果MBR损坏，则系统就启动不起来了。如果启动引导后面的<span class="number">64</span>字节分区表位损坏了，则系统就不能正常识别磁盘中的分区，系统就会认为该磁盘没有分区，也不能正常加载分区，每<span class="number">16</span>位字节标识一个分区，所以一个采用MBR分区方式的硬盘只能分四个分区（除逻辑分区），最后的两位结束为也是很重要的，如果没有结束为，系统就不认为这是一个MBR，就会认为这是一个空盘，结束位标志着分区表的结束，也是一个MBR数据区的结束。</span><br><span class="line"></span><br><span class="line">在生产的过程中，我们需要对磁盘的MBR区进行一个备份，以备当MBR区损坏时能够恢复。</span><br><span class="line">而且这个备份的文件是不能还放在这个硬盘下的，一定要备份到远程主机上。</span><br><span class="line"></span><br><span class="line">我们在开始试验之前需要了解两个东西：</span><br><span class="line">/dev/zero文件：这个是一个特殊的字符文件，会不断产生返回值<span class="number">0</span>,</span><br><span class="line">dd 这个命令：这个命令可以对块设备进行读写操作。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">我们先来查看一下磁盘的MBR区数据，前<span class="number">512</span>字节（我们以sda磁盘为例）</span><br><span class="line">    hexdump -C -n <span class="number">512</span> /dev/sda</span><br><span class="line"></span><br><span class="line">对磁盘上的MBR区进行备份：（我们以sda盘为例）</span><br><span class="line">    dd <span class="keyword">if</span>=/dev/sda of=/app/mbr bs=<span class="number">1</span> count=<span class="number">512</span></span><br><span class="line"></span><br><span class="line">这条命令将sda盘中的前<span class="number">512</span>字节的数据读入到/app/mbr这个文件中了，即使没有这个文件，通过这条命令也会自动生成一个该文件，bs后面默认的是以字节为单位，我们也可以跟上单位自定义大小，count是表示有多少块该大小的数据。</span><br><span class="line">备份完之后我们来查看一下是否备份成功，进入/app下进行查看是否生成了备份文件：</span><br><span class="line"></span><br><span class="line">当然，这个备份的文件不能放到当前这个磁盘下，如果我们的MBR区域坏了，系统就启动不起来，而且磁盘就进不去，我们的备份文件就根本找不到。所以通常备份文件都是放到远程主机上的，我们将mbr文件远程拷贝到我的另一台Linux上：</span><br><span class="line"></span><br><span class="line">好了，既然已经备份好了，我们就可以直接进行mbr的破坏了，同样我们通过dd 命令写入数据，将sda磁盘中的mbr区的数据给破坏掉：dd <span class="keyword">if</span>=/dev/zero of=/dev/sda bs=<span class="number">1</span> count=<span class="number">512</span></span><br><span class="line">我们之前也提到过了，/dev/zero是一个特殊的字符设备，不断的产生<span class="number">0</span>值，我们将sda前<span class="number">512</span>字节全部重置为<span class="number">0.</span></span><br><span class="line"></span><br><span class="line">通过hexdump -C -n <span class="number">512</span> /dev/sda 查看sda前面<span class="number">512</span>都变成了<span class="number">0</span></span><br><span class="line"></span><br><span class="line">现在，我们的系统就不能正常的加载启动了，我们需要把这块破坏的硬盘安装到另一台主机上，通过另一台主机进行修复。</span><br><span class="line">在挂载之前我们要先查看一下我们用来添加磁盘的系统中的磁盘，以确定最后我们是否知道我们添加的是那一块磁盘。</span><br><span class="line"></span><br><span class="line">首先，我们要知道被破坏的磁盘的磁盘名，否则我们怎么知道我们要把那一个磁盘安装到另一个主机上。打开虚拟机编辑，找到磁盘对应的磁盘文件名。这是为了方便我们接下来在虚拟机文件中找到这个磁盘文件。</span><br><span class="line"></span><br><span class="line">按照步骤来：</span><br><span class="line">    设备进行添加完成之后，我们进行入系统中查看有没有将此硬盘添加进来：</span><br><span class="line"></span><br><span class="line">    通过查看，我们发现，虽然我们将磁盘进行了物理的添加，但是系统中，并没有真正的识别，所以我们需要运行echo <span class="string">'- - -'</span> &gt; /sys/<span class="keyword">class</span>/<span class="symbol">scsi_host0</span>/<span class="symbol">scan</span> 这条命令进行系统的识别，有些时候需要向<span class="symbol">scsi_host2</span>中添加。之后我们在来查看会发现多出来一个<span class="symbol">sde</span>磁盘，这个磁盘的大小正是我们添加的那块磁盘的大小，所以确定这个就是我们需要修复的那一块磁盘。</span><br><span class="line"></span><br><span class="line">   为了进一步的确认这就是我们需要恢复的磁盘，我们再来查看一次。下图中，我们发现磁盘的前<span class="symbol">512</span>自己全部为<span class="symbol">0</span>了。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 接下来我们将我们备份的文件，同样的使用<span class="symbol">dd</span>命令将备份文件写入到被破坏的磁盘中，小编演示如下：</span><br><span class="line"></span><br><span class="line">    恢复数据之后要进行查看确认，以确保万无一失。</span><br><span class="line">这个时候我们进行查看磁盘分区情况，看是否会有所改变：</span><br><span class="line"></span><br><span class="line">    恢复过<span class="symbol">MBR</span>分区后，<span class="symbol">sde</span>中的分区信息就显示出来了。说明我们恢复成功了。我们将磁盘卸载掉，重新挂回原来的系统上，测试一下看是否能够开机成功。</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    小编这里显示已经成功的开机了！你那边怎么样了？</span><br><span class="line">    一般当我们恢复过之后，其中的分区信息能够显示出来就表明恢复已经成功，我们这个实验是在虚拟机上进行的，现实中的磁盘跟我们的操作思想是一样的。只不过是我们要把磁盘拔下来，插到另一个主机上进行恢复，其思想是完全一样的。</span><br><span class="line">    有时候我们没有备份磁盘的<span class="symbol">MBR</span>区，但是只要我们有相同分区类型的磁盘（注意：是完全相同的分区类型，其中的数据可以不一样，我们需要的是恢复启动引导和分区表位以及结束位。）也是可以同过这个方法来恢复的。把小编上面演示中的备份文件换成完好的磁盘设备就可以了。</span><br></pre></td></tr></table></figure>



<h2 id="惰性初始化"><a href="#惰性初始化" class="headerlink" title="惰性初始化"></a>惰性初始化</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">mount的时候：</span><br><span class="line">测试一：惰性初始化</span><br><span class="line">$ time mke2fs -t ext4 <span class="regexp">/dev/</span>sdm1      <span class="regexp">//</span>惰性初始化（默认）</span><br><span class="line">测试二：关闭惰性初始化</span><br><span class="line">$ time mke2fs -t ext4 -E lazy_itable_init=<span class="number">0</span>,lazy_journal_init=<span class="number">0</span> <span class="regexp">/dev/</span>sdm1  <span class="regexp">//</span>关闭惰性初始化</span><br><span class="line">惰性初始化的好处就是能迅速的创建文件系统，尽量把初始化的工作推迟到挂载后进行。 </span><br><span class="line">不建议在benchmark的时候打开该选项，尤其是与其他文件系统做性能测试对比时，会影响测试结果的公允性。 </span><br><span class="line"></span><br><span class="line">惰性格式化磁盘：</span><br><span class="line">mke2fs -t ext4 -E lazy_itable_init=<span class="number">0</span> <span class="regexp">/dev/</span>vdb</span><br><span class="line"></span><br><span class="line">块设备磁盘挂载报：wrong fs type,bad option,bad supe</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line">fsck -y <span class="regexp">/dev/</span>sdxxxx     最终执行的是这个修复命令</span><br><span class="line"></span><br><span class="line">ext4系统调优：</span><br><span class="line">mke2fs -t ext4 -m <span class="number">0</span> -b <span class="number">4096</span> -O bigalloc,dir_index,extent,extra_isize,flex_bg -E stride=<span class="number">4096</span>,stripe-width=<span class="number">4096</span> <span class="regexp">/dev/</span>sde</span><br><span class="line">mount -t ext4 -o max_batch_time=<span class="number">0</span>,discard,data=writeback,stripe=<span class="number">4096</span>,commit=<span class="number">1</span>,journal_async_commit,noatime,nodiratime,inode_readahead_blks=<span class="number">1024</span> <span class="regexp">/dev/</span>sde <span class="regexp">/mnt/</span>test</span><br><span class="line">echo <span class="number">256</span> &gt; <span class="regexp">/sys/</span>block<span class="regexp">/sde/</span>queue<span class="regexp">/iosched/</span>fifo_batch</span><br><span class="line">echo <span class="number">400</span> &gt; <span class="regexp">/sys/</span>block<span class="regexp">/sde/</span>queue<span class="regexp">/iosched/</span>read_expire</span><br><span class="line">echo <span class="number">800</span> &gt; <span class="regexp">/sys/</span>block<span class="regexp">/sde/</span>queue<span class="regexp">/iosched/</span>write_expire</span><br><span class="line"></span><br><span class="line">echo <span class="number">10</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/vm/</span>swappiness</span><br><span class="line">echo <span class="number">60</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/vm/</span>dirty_ratio</span><br><span class="line">echo <span class="number">500</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/vm/</span>dirty_expire_centisecs</span><br><span class="line">echo <span class="number">20</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/vm/</span>dirty_background_ratio</span><br><span class="line">echo <span class="number">300</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/vm/</span>dirty_writeback_centisecs</span><br><span class="line">浪潮EXT4下流量波动的说明 及调优的情况，@全体成员 ，看下参数调整是否可以用于实际应用</span><br></pre></td></tr></table></figure>



<h2 id="raid卡"><a href="#raid卡" class="headerlink" title="raid卡"></a>raid卡</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参考博客：</span><br><span class="line"><span class="symbol">https:</span><span class="comment">//www.cnblogs.com/luxiaodai/p/9878747.html</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//www.cnblogs.com/liuxing0007/p/10912444.html</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">raid卡是提高性能的</span><br><span class="line">lvm是增加容量的</span><br></pre></td></tr></table></figure>

<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">查看是否带raid卡：udevadm test-builtin blkid "$device" <span class="number">2</span>&gt;/dev/<span class="keyword">null</span> | grep -q "^ID_FS_USAGE=raid"</span><br><span class="line"></span><br><span class="line">关于buffer，<span class="keyword">cache</span>，wb，wt，clean，inv，flush，以及其他</span><br><span class="line"><span class="number">1.</span> 有时候需要区分buffer和<span class="keyword">cache</span>：buffer解决CPU写的问题，比如将多次写操作buffer起来一次性更新；<span class="keyword">cache</span>解决CPU读的问题，将数据<span class="keyword">cache</span>起来在下次读的时候快速取用。</span><br><span class="line"><span class="number">2.</span> <span class="keyword">cache</span>有两种更新策略：write back和write through。writeback是将待写入memory的数据先放在<span class="keyword">cache</span>中，直到<span class="keyword">cache</span>位置将被替换时writeback到memory；write through是将数据同时写入<span class="keyword">cache</span>和memory。</span><br><span class="line"><span class="number">3.</span> invalidate：将<span class="keyword">cache</span>数据设置为无效（即discard <span class="keyword">cache</span>中的数据），不会将<span class="keyword">cache</span>数据写入memory；clean（write back）：将<span class="keyword">cache</span>数据写进memory；flush：clean and invalidate。</span><br><span class="line"><span class="number">4.</span> 对于DMA <span class="keyword">From</span> Device <span class="keyword">to</span> Memory来说，invalidate range未必对其到<span class="keyword">cache</span> line，这时需要首先将非对齐部分clean到memory，然后invalidate <span class="keyword">cache</span>。</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line">/opt/zabbix/lldscripts/MegaRAID/MegaCli/MegaCli64 -AdpAllInfo -a0|grep Policy</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、查看某个盘是否是write through还是write back：【Raid设置直通还是非直通】</span><br><span class="line">cat /sys/block/sdm/device/scsi_disk/<span class="number">0</span>\:<span class="number">2</span>\:<span class="number">0</span>\:<span class="number">0</span>/cache_type</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、lsscsi -s命令可以看出是否是直通模式：【查看系统设置直通还是非直通】</span><br><span class="line">直通模式：原因：[<span class="number">0</span>:<span class="number">0</span>:<span class="number">30</span>:<span class="number">0</span>]是<span class="number">0</span>:<span class="number">0</span>:x:x开头的</span><br><span class="line">[<span class="number">0</span>:<span class="number">0</span>:<span class="number">30</span>:<span class="number">0</span>]   disk    ATA      INTEL SSDSC2KB96 <span class="number">0100</span>  /dev/sda    <span class="number">960</span>GB</span><br><span class="line">[<span class="number">0</span>:<span class="number">0</span>:<span class="number">31</span>:<span class="number">0</span>]   disk    ATA      INTEL SSDSC2KB96 <span class="number">0100</span>  /dev/sdb    <span class="number">960</span>GB</span><br><span class="line">[<span class="number">0</span>:<span class="number">0</span>:<span class="number">32</span>:<span class="number">0</span>]   disk    ATA      ST4000NM0035<span class="number">-1</span>V4 TN05  /dev/sdc   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">0</span>:<span class="number">33</span>:<span class="number">0</span>]   disk    ATA      ST4000NM0035<span class="number">-1</span>V4 TN05  /dev/sdd   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">0</span>:<span class="number">34</span>:<span class="number">0</span>]   disk    ATA      ST4000NM0035<span class="number">-1</span>V4 TN05  /dev/sde   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">0</span>:<span class="number">35</span>:<span class="number">0</span>]   disk    ATA      ST4000NM0035<span class="number">-1</span>V4 TN05  /dev/sdf   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">0</span>:<span class="number">36</span>:<span class="number">0</span>]   disk    ATA      ST4000NM0035<span class="number">-1</span>V4 TN05  /dev/sdg   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">0</span>:<span class="number">37</span>:<span class="number">0</span>]   disk    ATA      ST4000NM0035<span class="number">-1</span>V4 TN05  /dev/sdh   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">0</span>:<span class="number">38</span>:<span class="number">0</span>]   disk    ATA      ST4000NM0035<span class="number">-1</span>V4 TN05  /dev/sdi   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">0</span>:<span class="number">39</span>:<span class="number">0</span>]   disk    ATA      ST4000NM0035<span class="number">-1</span>V4 TN05  /dev/sdj   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">0</span>:<span class="number">40</span>:<span class="number">0</span>]   disk    ATA      ST4000NM0035<span class="number">-1</span>V4 TN05  /dev/sdk   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">0</span>:<span class="number">41</span>:<span class="number">0</span>]   disk    ATA      ST4000NM0035<span class="number">-1</span>V4 TN05  /dev/sdl   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">2</span>:<span class="number">0</span>:<span class="number">0</span>]    disk    AVAGO    MR-SAS3316       <span class="number">4.74</span>  /dev/sdm   <span class="number">53.6</span>GB</span><br><span class="line">[<span class="number">0</span>:<span class="number">2</span>:<span class="number">1</span>:<span class="number">0</span>]    disk    AVAGO    MR-SAS3316       <span class="number">4.74</span>  /dev/sdn    <span class="number">545</span>GB</span><br><span class="line"></span><br><span class="line">非直通模式：原因：[<span class="number">0</span>:<span class="number">2</span>:<span class="number">0</span>:<span class="number">0</span>]是<span class="number">0</span>:<span class="number">2</span>:x:x开头的</span><br><span class="line">[<span class="symbol">root@</span>host102442549 ~]# lsscsi -s</span><br><span class="line">[<span class="number">0</span>:<span class="number">0</span>:<span class="number">8</span>:<span class="number">0</span>]    enclosu PMCSIERA SXP <span class="number">24</span>Sx12G      RevB  -               -</span><br><span class="line">[<span class="number">0</span>:<span class="number">2</span>:<span class="number">0</span>:<span class="number">0</span>]    disk    AVAGO    INSPUR           <span class="number">4.67</span>  /dev/sda   <span class="number">53.6</span>GB</span><br><span class="line">[<span class="number">0</span>:<span class="number">2</span>:<span class="number">1</span>:<span class="number">0</span>]    disk    AVAGO    INSPUR           <span class="number">4.67</span>  /dev/sdb    <span class="number">245</span>GB</span><br><span class="line">[<span class="number">0</span>:<span class="number">2</span>:<span class="number">2</span>:<span class="number">0</span>]    disk    AVAGO    INSPUR           <span class="number">4.67</span>  /dev/sdc    <span class="number">959</span>GB</span><br><span class="line">[<span class="number">0</span>:<span class="number">2</span>:<span class="number">3</span>:<span class="number">0</span>]    disk    AVAGO    INSPUR           <span class="number">4.67</span>  /dev/sdd   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">2</span>:<span class="number">4</span>:<span class="number">0</span>]    disk    AVAGO    INSPUR           <span class="number">4.67</span>  /dev/sde   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">2</span>:<span class="number">5</span>:<span class="number">0</span>]    disk    AVAGO    INSPUR           <span class="number">4.67</span>  /dev/sdf   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">2</span>:<span class="number">6</span>:<span class="number">0</span>]    disk    AVAGO    INSPUR           <span class="number">4.67</span>  /dev/sdg   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">2</span>:<span class="number">7</span>:<span class="number">0</span>]    disk    AVAGO    INSPUR           <span class="number">4.67</span>  /dev/sdh   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">2</span>:<span class="number">8</span>:<span class="number">0</span>]    disk    AVAGO    INSPUR           <span class="number">4.67</span>  /dev/sdi   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">2</span>:<span class="number">9</span>:<span class="number">0</span>]    disk    AVAGO    INSPUR           <span class="number">4.67</span>  /dev/sdj   <span class="number">4.00</span>TB</span><br><span class="line">[<span class="number">0</span>:<span class="number">2</span>:<span class="number">10</span>:<span class="number">0</span>]   disk    AVAGO    INSPUR           <span class="number">4.67</span>  /dev/sdk   <span class="number">4.00</span>TB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、单盘的wt/wb模式：</span><br><span class="line">这个应该是单盘raid0，wt/wb要用raid卡命令看：</span><br><span class="line">/opt/MegaRAID/storcli/storcli64 /c0 show</span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>host10242491 ~]# /opt/MegaRAID/storcli/storcli64 /c0 show</span><br><span class="line">Generating detailed summary of the adapter, it may take a <span class="keyword">while</span> to complete.</span><br><span class="line"></span><br><span class="line">Controller = <span class="number">0</span></span><br><span class="line">Status = Success</span><br><span class="line">Description = None</span><br><span class="line"></span><br><span class="line">Product Name = INSPUR <span class="number">3108</span>MR<span class="number">-2</span>GB</span><br><span class="line">Serial Number = RAH516GV0274A30</span><br><span class="line">SAS Address =  <span class="number">56</span>c92bf000697634</span><br><span class="line">PCI Address = <span class="number">00</span>:<span class="number">04</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">System Time = <span class="number">09</span>/<span class="number">25</span>/<span class="number">2019</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">19</span></span><br><span class="line">Mfg. Date = <span class="number">12</span>/<span class="number">01</span>/<span class="number">17</span></span><br><span class="line">Controller Time = <span class="number">09</span>/<span class="number">25</span>/<span class="number">2019</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">17</span></span><br><span class="line">FW Package Build = <span class="number">24.12</span><span class="number">.0</span><span class="number">-0025</span></span><br><span class="line">BIOS Version = <span class="number">6.30</span><span class="number">.03</span><span class="number">.0</span>_4<span class="number">.17</span><span class="number">.08</span><span class="number">.00</span>_0x06130200</span><br><span class="line">FW Version = <span class="number">4.620</span><span class="number">.00</span><span class="number">-6101</span></span><br><span class="line">Driver Name = megaraid_sas</span><br><span class="line">Driver Version = <span class="number">06.803</span><span class="number">.01</span><span class="number">.00</span>-rh1</span><br><span class="line">Vendor Id = <span class="number">0x1000</span></span><br><span class="line">Device Id = <span class="number">0x5D</span></span><br><span class="line">SubVendor Id = <span class="number">0x1BD4</span></span><br><span class="line">SubDevice Id = <span class="number">0x14</span></span><br><span class="line">Host Interface = PCI-E</span><br><span class="line">Device Interface = SAS<span class="number">-12</span>G</span><br><span class="line">Bus Number = <span class="number">4</span></span><br><span class="line">Device Number = <span class="number">0</span></span><br><span class="line">Function Number = <span class="number">0</span></span><br><span class="line">Drive Groups = <span class="number">12</span></span><br><span class="line"></span><br><span class="line">TOPOLOGY :</span><br><span class="line">========</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">DG Arr Row EID:Slot DID Type  State BT       Size PDC  PI SED DS3  FSpace TR</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line"><span class="number">0</span> -   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">0</span> <span class="number">0</span>   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">0</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">45</span>:<span class="number">0</span>     <span class="number">46</span>  DRIVE Onln  N    <span class="number">3.637</span> TB enbl N  N   dflt -      N  </span><br><span class="line"><span class="number">1</span> -   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">1</span> <span class="number">0</span>   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">1</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">45</span>:<span class="number">1</span>     <span class="number">54</span>  DRIVE Onln  N    <span class="number">3.637</span> TB enbl N  N   dflt -      N  </span><br><span class="line"><span class="number">2</span> -   -   -        -   RAID0 Optl  N  <span class="number">446.625</span> GB dflt N  N   dflt N      N  </span><br><span class="line"><span class="number">2</span> <span class="number">0</span>   -   -        -   RAID0 Optl  N  <span class="number">446.625</span> GB dflt N  N   dflt N      N  </span><br><span class="line"><span class="number">2</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">45</span>:<span class="number">2</span>     <span class="number">47</span>  DRIVE Onln  N  <span class="number">446.625</span> GB dflt N  N   dflt -      N  </span><br><span class="line"><span class="number">3</span> -   -   -        -   RAID0 Optl  N  <span class="number">446.625</span> GB dflt N  N   dflt N      N  </span><br><span class="line"><span class="number">3</span> <span class="number">0</span>   -   -        -   RAID0 Optl  N  <span class="number">446.625</span> GB dflt N  N   dflt N      N  </span><br><span class="line"><span class="number">3</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">45</span>:<span class="number">3</span>     <span class="number">56</span>  DRIVE Onln  N  <span class="number">446.625</span> GB dflt N  N   dflt -      N  </span><br><span class="line"><span class="number">4</span> -   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">4</span> <span class="number">0</span>   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">4</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">45</span>:<span class="number">4</span>     <span class="number">48</span>  DRIVE Onln  N    <span class="number">3.637</span> TB enbl N  N   dflt -      N  </span><br><span class="line"><span class="number">5</span> -   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">5</span> <span class="number">0</span>   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">5</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">45</span>:<span class="number">5</span>     <span class="number">55</span>  DRIVE Onln  N    <span class="number">3.637</span> TB enbl N  N   dflt -      N  </span><br><span class="line"><span class="number">6</span> -   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">6</span> <span class="number">0</span>   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">6</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">45</span>:<span class="number">6</span>     <span class="number">49</span>  DRIVE Onln  N    <span class="number">3.637</span> TB enbl N  N   dflt -      N  </span><br><span class="line"><span class="number">7</span> -   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">7</span> <span class="number">0</span>   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">7</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">45</span>:<span class="number">7</span>     <span class="number">52</span>  DRIVE Onln  N    <span class="number">3.637</span> TB enbl N  N   dflt -      N  </span><br><span class="line"><span class="number">8</span> -   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">8</span> <span class="number">0</span>   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">8</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">45</span>:<span class="number">8</span>     <span class="number">50</span>  DRIVE Onln  N    <span class="number">3.637</span> TB enbl N  N   dflt -      N  </span><br><span class="line"><span class="number">9</span> -   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">9</span> <span class="number">0</span>   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">9</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">45</span>:<span class="number">9</span>     <span class="number">57</span>  DRIVE Onln  N    <span class="number">3.637</span> TB enbl N  N   dflt -      N  </span><br><span class="line"><span class="number">10</span> -   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">10</span> <span class="number">0</span>   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">10</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">45</span>:<span class="number">10</span>    <span class="number">53</span>  DRIVE Onln  N    <span class="number">3.637</span> TB enbl N  N   dflt -      N  </span><br><span class="line"><span class="number">11</span> -   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">11</span> <span class="number">0</span>   -   -        -   RAID0 Optl  N    <span class="number">3.637</span> TB enbl N  N   dflt N      N  </span><br><span class="line"><span class="number">11</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">45</span>:<span class="number">11</span>    <span class="number">51</span>  DRIVE Onln  N    <span class="number">3.637</span> TB enbl N  N   dflt -      N  </span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">DG=Disk Group Index|Arr=Array Index|Row=Row Index|EID=Enclosure Device ID</span><br><span class="line">DID=Device ID|Type=Drive Type|Onln=Online|Rbld=Rebuild|Dgrd=Degraded</span><br><span class="line">Pdgd=Partially degraded|Offln=Offline|BT=Background Task Active</span><br><span class="line">PDC=PD Cache|PI=Protection Info|SED=Self Encrypting Drive|Frgn=Foreign</span><br><span class="line">DS3=Dimmer Switch <span class="number">3</span>|dflt=Default|Msng=Missing|FSpace=Free Space Present</span><br><span class="line">TR=Transport Ready</span><br><span class="line"></span><br><span class="line">Virtual Drives = <span class="number">12</span></span><br><span class="line"></span><br><span class="line">VD LIST :</span><br><span class="line">=======</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------</span><br><span class="line">DG/VD TYPE  State Access Consist Cache Cac sCC       Size Name</span><br><span class="line">---------------------------------------------------------------</span><br><span class="line"><span class="number">0</span>/<span class="number">0</span>   RAID0 Optl  RW     Yes     RAWBC -   ON    <span class="number">3.637</span> TB      </span><br><span class="line"><span class="number">1</span>/<span class="number">1</span>   RAID0 Optl  RW     Yes     RAWBC -   ON    <span class="number">3.637</span> TB      </span><br><span class="line"><span class="number">2</span>/<span class="number">2</span>   RAID0 Optl  RW     Yes     RAWBC -   ON  <span class="number">446.625</span> GB      </span><br><span class="line"><span class="number">3</span>/<span class="number">3</span>   RAID0 Optl  RW     Yes     RAWBD -   ON  <span class="number">446.625</span> GB      </span><br><span class="line"><span class="number">4</span>/<span class="number">4</span>   RAID0 Optl  RW     Yes     RAWBC -   ON    <span class="number">3.637</span> TB      </span><br><span class="line"><span class="number">5</span>/<span class="number">5</span>   RAID0 Optl  RW     Yes     RAWBC -   ON    <span class="number">3.637</span> TB      </span><br><span class="line"><span class="number">6</span>/<span class="number">6</span>   RAID0 Optl  RW     Yes     RAWBC -   ON    <span class="number">3.637</span> TB      </span><br><span class="line"><span class="number">7</span>/<span class="number">7</span>   RAID0 Optl  RW     Yes     RAWBC -   ON    <span class="number">3.637</span> TB      </span><br><span class="line"><span class="number">8</span>/<span class="number">8</span>   RAID0 Optl  RW     Yes     RAWBC -   ON    <span class="number">3.637</span> TB      </span><br><span class="line"><span class="number">9</span>/<span class="number">9</span>   RAID0 Optl  RW     Yes     RAWBC -   ON    <span class="number">3.637</span> TB      </span><br><span class="line"><span class="number">10</span>/<span class="number">10</span> RAID0 Optl  RW     Yes     RAWBC -   ON    <span class="number">3.637</span> TB      </span><br><span class="line"><span class="number">11</span>/<span class="number">11</span> RAID0 Optl  RW     Yes     RAWBC -   ON    <span class="number">3.637</span> TB      </span><br><span class="line">---------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Cac=CacheCade|Rec=Recovery|OfLn=OffLine|Pdgd=Partially Degraded|Dgrd=Degraded</span><br><span class="line">Optl=Optimal|RO=Read Only|RW=Read Write|HD=Hidden|TRANS=TransportReady|B=Blocked|</span><br><span class="line">Consist=Consistent|R=Read Ahead Always|NR=No Read Ahead|WB=WriteBack|</span><br><span class="line">AWB=Always WriteBack|WT=WriteThrough|C=Cached IO|D=Direct IO|sCC=Scheduled</span><br><span class="line">Check Consistency</span><br><span class="line"></span><br><span class="line">#表示raid 是wb模式</span><br><span class="line"></span><br><span class="line">Physical Drives = <span class="number">12</span></span><br><span class="line"></span><br><span class="line">PD LIST :</span><br><span class="line">=======</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------------------</span><br><span class="line">EID:Slt DID State DG       Size Intf Med SED PI SeSz Model               Sp Type</span><br><span class="line">---------------------------------------------------------------------------------</span><br><span class="line"><span class="number">45</span>:<span class="number">0</span>     <span class="number">46</span> Onln   <span class="number">0</span>   <span class="number">3.637</span> TB SATA HDD N   N  <span class="number">512</span>B ST4000NM0035<span class="number">-1</span>V4107 U  -    </span><br><span class="line"><span class="number">45</span>:<span class="number">1</span>     <span class="number">54</span> Onln   <span class="number">1</span>   <span class="number">3.637</span> TB SATA HDD N   N  <span class="number">512</span>B ST4000NM0035<span class="number">-1</span>V4107 U  -    </span><br><span class="line"><span class="number">45</span>:<span class="number">2</span>     <span class="number">47</span> Onln   <span class="number">2</span> <span class="number">446.625</span> GB SATA SSD N   N  <span class="number">512</span>B INTEL SSDSC2BB480G6 U  -    </span><br><span class="line"><span class="number">45</span>:<span class="number">3</span>     <span class="number">56</span> Onln   <span class="number">3</span> <span class="number">446.625</span> GB SATA SSD N   N  <span class="number">512</span>B INTEL SSDSC2BB480G6 U  -    </span><br><span class="line"><span class="number">45</span>:<span class="number">4</span>     <span class="number">48</span> Onln   <span class="number">4</span>   <span class="number">3.637</span> TB SATA HDD N   N  <span class="number">512</span>B ST4000NM0035<span class="number">-1</span>V4107 U  -    </span><br><span class="line"><span class="number">45</span>:<span class="number">5</span>     <span class="number">55</span> Onln   <span class="number">5</span>   <span class="number">3.637</span> TB SATA HDD N   N  <span class="number">512</span>B ST4000NM0035<span class="number">-1</span>V4107 U  -    </span><br><span class="line"><span class="number">45</span>:<span class="number">6</span>     <span class="number">49</span> Onln   <span class="number">6</span>   <span class="number">3.637</span> TB SATA HDD N   N  <span class="number">512</span>B ST4000NM0035<span class="number">-1</span>V4107 U  -    </span><br><span class="line"><span class="number">45</span>:<span class="number">7</span>     <span class="number">52</span> Onln   <span class="number">7</span>   <span class="number">3.637</span> TB SATA HDD N   N  <span class="number">512</span>B ST4000NM0035<span class="number">-1</span>V4107 U  -    </span><br><span class="line"><span class="number">45</span>:<span class="number">8</span>     <span class="number">50</span> Onln   <span class="number">8</span>   <span class="number">3.637</span> TB SATA HDD N   N  <span class="number">512</span>B ST4000NM0035<span class="number">-1</span>V4107 U  -    </span><br><span class="line"><span class="number">45</span>:<span class="number">9</span>     <span class="number">57</span> Onln   <span class="number">9</span>   <span class="number">3.637</span> TB SATA HDD N   N  <span class="number">512</span>B ST4000NM0035<span class="number">-1</span>V4107 U  -    </span><br><span class="line"><span class="number">45</span>:<span class="number">10</span>    <span class="number">53</span> Onln  <span class="number">10</span>   <span class="number">3.637</span> TB SATA HDD N   N  <span class="number">512</span>B ST4000NM0035<span class="number">-1</span>V4107 U  -    </span><br><span class="line"><span class="number">45</span>:<span class="number">11</span>    <span class="number">51</span> Onln  <span class="number">11</span>   <span class="number">3.637</span> TB SATA HDD N   N  <span class="number">512</span>B ST4000NM0035<span class="number">-1</span>V4107 U  -    </span><br><span class="line">---------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">EID-Enclosure Device ID|Slt-Slot No.|DID-Device ID|DG-DriveGroup</span><br><span class="line">DHS-Dedicated Hot Spare|UGood-Unconfigured Good|GHS-Global Hotspare</span><br><span class="line">UBad-Unconfigured Bad|Onln-Online|Offln-Offline|Intf-Interface</span><br><span class="line">Med-Media Type|SED-Self Encryptive Drive|PI-Protection Info</span><br><span class="line">SeSz-Sector Size|Sp-Spun|U-Up|D-Down|T-Transition|F-Foreign</span><br><span class="line">UGUnsp-Unsupported|UGShld-UnConfigured shielded|HSPShld-Hotspare shielded</span><br><span class="line">CFShld-Configured shielded|Cpybck-CopyBack|CBShld-Copyback Shielded</span><br><span class="line"></span><br><span class="line">http:<span class="comment">//ilinuxkernel.com/?p=897</span></span><br><span class="line">如何关闭硬盘写缓存（Write Cache）</span><br></pre></td></tr></table></figure>

<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584948682984-1585553407634.png" alt="1584948682984"></p>
<p> 应该是内核开的，我记得以前默认都是关闭的，<br>厂家回复：</p>
<h2 id="storcli64"><a href="#storcli64" class="headerlink" title="storcli64"></a>storcli64</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">、简介（软件见附件）</span></span><br><span class="line"><span class="string">MegaCli</span> <span class="string">是LSI公司官方提供的SCSI卡管理工具，由于LSI被收购变成了现在的Broadcom，所以现在想下载MegaCli，</span></span><br><span class="line"><span class="string">需要去Broadcom官网查找Legacy产品支持，搜索MegaRAID即可。</span></span><br><span class="line"> </span><br><span class="line"><span class="string">现在官方有storcli，storcli已经基本代替了megacli，整合了LSI和3ware所有产品。</span></span><br><span class="line"> </span><br><span class="line"><span class="string">安装方面比较简单，megacli还要Lib_Utils的支持，而storcli只用一个rpm包就可以下载，</span></span><br><span class="line"><span class="string">去Broadcom官网去找就行了：https://www.broadcom.com/site-search?q=storcli</span>  <span class="string">【附件有】</span></span><br><span class="line"> </span><br><span class="line"><span class="string">storcli支持json格式输出，信息解析更加方便。</span></span><br><span class="line"> </span><br><span class="line"><span class="string">我个人推荐使用这个软件，因为megacli</span> <span class="string">工具需要安装额外的软件包，有些服务器客户不允许安装其他的软件包，所以比较麻烦。</span></span><br><span class="line"><span class="string">这个工具直接安装了之后就可以用。</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="number">1.1</span><span class="string">服务器信息：</span></span><br><span class="line"><span class="string">[root@xgto01n010244025044</span> <span class="string">v1]#</span> <span class="string">dmidecode</span> <span class="string">-t</span> <span class="number">1</span></span><br><span class="line"><span class="comment"># dmidecode 3.0</span></span><br><span class="line"><span class="string">Getting</span> <span class="string">SMBIOS</span> <span class="string">data</span> <span class="string">from</span> <span class="string">sysfs.</span></span><br><span class="line"><span class="string">SMBIOS</span> <span class="number">3.0</span> <span class="string">present.</span></span><br><span class="line"></span><br><span class="line"><span class="string">Handle</span> <span class="number">0x0001</span><span class="string">,</span> <span class="string">DMI</span> <span class="string">type</span> <span class="number">1</span><span class="string">,</span> <span class="number">27</span> <span class="string">bytes</span></span><br><span class="line"><span class="string">System</span> <span class="string">Information</span></span><br><span class="line">	<span class="attr">Manufacturer:</span> <span class="string">Sugon</span></span><br><span class="line">	<span class="attr">Product Name:</span> <span class="string">I620-G20</span></span><br><span class="line">	<span class="attr">Version:</span> <span class="string">Grantley-EP</span></span><br><span class="line">	<span class="attr">Serial Number:</span> <span class="number">6100655700926742</span></span><br><span class="line">	<span class="attr">UUID:</span> <span class="string">B409F860-C021-11D3-991D-107B44B05C08</span></span><br><span class="line">	<span class="attr">Wake-up Type:</span> <span class="string">Power</span> <span class="string">Switch</span></span><br><span class="line">	<span class="attr">SKU Number:</span>  </span><br><span class="line">	<span class="attr">Family:</span> <span class="string">Rack</span></span><br><span class="line">	</span><br><span class="line"><span class="number">1.2</span><span class="string">系统信息：</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">storcli]#</span> <span class="string">cat</span> <span class="string">/etc/redhat-release</span></span><br><span class="line"><span class="string">Red</span> <span class="string">Hat</span> <span class="string">Enterprise</span> <span class="string">Linux</span> <span class="string">Server</span> <span class="string">release</span> <span class="number">6.4</span> <span class="string">(Santiago)</span></span><br><span class="line"> </span><br><span class="line"><span class="number">1.3</span> <span class="string">安装storcli</span></span><br><span class="line"><span class="string">rpm</span> <span class="string">-ivh</span>  <span class="string">storcli-1.03.11-1.noarch.rpm</span></span><br><span class="line"><span class="string">目录：</span> <span class="string">/opt/Mega/storcli</span></span><br><span class="line"><span class="string">注意版本问题</span></span><br><span class="line"><span class="string">我这台服务器是DELL</span>  <span class="string">R720xd，2012年上线的，所以我用的是storcli.1.03.11版本。</span></span><br><span class="line"><span class="string">我用的新版本安装之后，执行命令没有输出，所以这一点需要注意。</span></span><br><span class="line"> </span><br><span class="line"><span class="number">1.4</span><span class="string">一些参数定义：</span></span><br><span class="line"><span class="string">/cx</span> <span class="string">=</span> <span class="string">Controller</span> <span class="string">ID</span></span><br><span class="line"><span class="string">/vx</span> <span class="string">=</span> <span class="string">Virtual</span> <span class="string">Drive</span> <span class="string">Number.</span></span><br><span class="line"><span class="string">/ex</span> <span class="string">=</span> <span class="string">Enclosure</span> <span class="string">ID</span></span><br><span class="line"><span class="string">/sx</span> <span class="string">=</span> <span class="string">Slot</span> <span class="string">ID</span></span><br><span class="line"> </span><br><span class="line"><span class="number">1.5</span><span class="string">为了管理方便，建立软连接</span></span><br><span class="line"><span class="string">ln</span> <span class="string">-s</span> <span class="string">/opt/MegaRAID/storcli/storcli64</span> <span class="string">/bin/storcli</span></span><br><span class="line"><span class="string">ln</span> <span class="string">-s</span> <span class="string">/opt/MegaRAID/storcli/storcli64</span>    <span class="string">/sbin/storcli</span></span><br><span class="line"> </span><br><span class="line"><span class="string">如果不想建立软连接，就在/opt/MegaRAID/storcli</span> <span class="string">目录下</span> <span class="string">执行./storcli64</span> <span class="string">指令</span></span><br><span class="line"> </span><br><span class="line"><span class="number">2</span><span class="string">、查看当前设备raid控制器相关信息</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">storcli]#</span> <span class="string">./storcli64</span> <span class="string">show</span> <span class="string">all</span>    <span class="string">可以看到只有一个控制器</span></span><br><span class="line"><span class="string">Status</span> <span class="string">Code</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="string">Status</span> <span class="string">=</span> <span class="string">Success</span></span><br><span class="line"><span class="string">Description</span> <span class="string">=</span> <span class="string">None</span></span><br><span class="line"> </span><br><span class="line"><span class="string">Number</span> <span class="string">of</span> <span class="string">Controllers</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="string">Host</span> <span class="string">Name</span> <span class="string">=</span> <span class="string">localhost.localdomain</span></span><br><span class="line"><span class="string">Operating</span> <span class="string">System</span>  <span class="string">=</span> <span class="string">Linux2.6.32-358.el6.x86_64</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">System Overview :</span></span><br><span class="line"><span class="string">===============</span></span><br><span class="line"> </span><br><span class="line"><span class="string">------------------------------------------------------------</span></span><br><span class="line"><span class="string">Ctl</span> <span class="string">Model</span> <span class="string">Ports</span> <span class="string">PDs</span> <span class="string">DGs</span> <span class="string">DNOpt</span> <span class="string">VDs</span> <span class="string">VNOpt</span> <span class="string">BBU</span> <span class="string">sPR</span> <span class="string">DS</span> <span class="string">EHS</span> <span class="string">ASOs</span></span><br><span class="line"><span class="string">------------------------------------------------------------</span></span><br><span class="line">  <span class="number">0</span> <span class="string">Mini</span>      <span class="number">8</span>  <span class="number">14</span>   <span class="number">3</span>     <span class="number">0</span>   <span class="number">3</span>     <span class="number">0</span> <span class="string">Opt</span> <span class="string">On</span>  <span class="number">3</span>  <span class="string">N</span>      <span class="number">0</span>      <span class="string">【只看到一个控制器】</span></span><br><span class="line"><span class="string">------------------------------------------------------------</span></span><br><span class="line"> </span><br><span class="line"><span class="string">Ctl=Controller</span> <span class="string">Index|DGs=Drive</span> <span class="string">groups|VDs=Virtual</span> <span class="string">drives|Fld=Failed</span></span><br><span class="line"><span class="string">PDs=Physical</span> <span class="string">drives|DNOpt=DG</span> <span class="string">NotOptimal|VNOpt=VD</span> <span class="string">NotOptimal|Opt=Optimal</span></span><br><span class="line"><span class="string">Msng=Missing|Dgd=Degraded|NdAtn=Need</span> <span class="string">Attention|Unkwn=Unknown</span></span><br><span class="line"><span class="string">sPR=Scheduled</span> <span class="string">Patrol</span> <span class="string">Read|DS=DimmerSwitch|EHS=Emergency</span> <span class="string">Hot</span> <span class="string">Spare</span></span><br><span class="line"><span class="string">Y=Yes|N=No|ASOs=Advanced</span> <span class="string">Software</span> <span class="string">Options|BBU=Battery</span> <span class="string">backup</span> <span class="string">unit</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">ASO :</span></span><br><span class="line"><span class="string">===</span></span><br><span class="line"></span><br><span class="line"><span class="string">----</span></span><br><span class="line"><span class="string">Ctl</span></span><br><span class="line"><span class="string">----</span></span><br><span class="line">  <span class="number">0</span></span><br><span class="line"><span class="string">----</span></span><br><span class="line"> </span><br><span class="line"><span class="string">Cl=Cluster|MD=Max</span> <span class="string">Disks|WC=Wide</span> <span class="string">Cache|SS=Safe</span> <span class="string">Store|FP=Fast</span> <span class="string">Path|Re=Recovery</span></span><br><span class="line"><span class="string">CR=CacheCade(Read)|RF=Reduced</span> <span class="string">Feature</span> <span class="string">Set|CO=Cache</span> <span class="string">Offload</span></span><br><span class="line"><span class="string">CW=CacheCade(Read/Write)|X=Not</span> <span class="string">Available/Not</span> <span class="string">Installed|U=Unlimited|T=Trial</span></span><br><span class="line"> </span><br><span class="line"><span class="number">3</span><span class="string">、查看控制器c0的相关信息</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">storcli]#</span> <span class="string">./storcli64</span>  <span class="string">/c0</span> <span class="string">show</span></span><br><span class="line"><span class="string">Controller</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="string">Status</span> <span class="string">=</span> <span class="string">Success</span></span><br><span class="line"><span class="string">Description</span> <span class="string">=</span> <span class="string">None</span></span><br><span class="line"> </span><br><span class="line"><span class="string">Product</span> <span class="string">Name</span> <span class="string">=</span> <span class="string">PERC</span> <span class="string">H710P</span> <span class="string">Mini【控制器型号】</span></span><br><span class="line"><span class="string">Serial</span> <span class="string">Number</span> <span class="string">=</span> <span class="string">26300UP</span></span><br><span class="line"><span class="string">SAS</span> <span class="string">Address</span> <span class="string">=</span>  <span class="string">5d4ae520a6bcbc00</span></span><br><span class="line"><span class="string">Mfg.</span> <span class="string">Date</span> <span class="string">=</span> <span class="number">06</span><span class="string">/04/12</span></span><br><span class="line"><span class="string">System</span> <span class="string">Time</span> <span class="string">=</span> <span class="number">05</span><span class="string">/22/2019</span> <span class="number">16</span><span class="string">:22:28</span></span><br><span class="line"><span class="string">Controller</span> <span class="string">Time</span> <span class="string">=</span> <span class="number">05</span><span class="string">/22/2019</span> <span class="number">08</span><span class="string">:22:28</span></span><br><span class="line"><span class="string">FW</span> <span class="string">Package</span> <span class="string">Build</span> <span class="string">=</span> <span class="number">21.0</span><span class="number">.2</span><span class="number">-0001</span></span><br><span class="line"><span class="string">BIOS</span> <span class="string">Version</span> <span class="string">=</span> <span class="number">5.30</span><span class="string">.00_4.12.05.00_0x05110000</span></span><br><span class="line"><span class="string">FW</span> <span class="string">Version</span> <span class="string">=</span> <span class="number">3.130</span><span class="number">.05</span><span class="number">-1587</span></span><br><span class="line"><span class="string">Driver</span> <span class="string">Name</span> <span class="string">=</span> <span class="string">megaraid_sas</span></span><br><span class="line"><span class="string">Driver</span> <span class="string">Version</span> <span class="string">=</span> <span class="number">06.504</span><span class="number">.01</span><span class="number">.00</span><span class="string">-rh1</span></span><br><span class="line"><span class="string">Controller</span> <span class="string">Bus</span> <span class="string">Type</span> <span class="string">=</span> <span class="string">N/A</span></span><br><span class="line"><span class="string">PCI</span> <span class="string">Slot</span> <span class="string">=</span> <span class="string">N/A</span></span><br><span class="line"><span class="string">PCI</span> <span class="string">Bus</span> <span class="string">Number</span> <span class="string">=</span> <span class="number">2</span></span><br><span class="line"><span class="string">PCI</span> <span class="string">Device</span> <span class="string">Number</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="string">PCI</span> <span class="string">Function</span> <span class="string">Number</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="string">Drive</span> <span class="string">Groups</span> <span class="string">=</span> <span class="number">3</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">TOPOLOGY :</span></span><br><span class="line"><span class="string">========</span></span><br><span class="line"> </span><br><span class="line"><span class="string">--------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">DG</span> <span class="string">Arr</span> <span class="string">Row</span> <span class="string">EID:Slot</span> <span class="string">DID</span> <span class="string">Type</span>  <span class="string">State</span> <span class="string">BT</span>       <span class="string">Size</span> <span class="string">PDC</span>  <span class="string">PI</span> <span class="string">SED</span> <span class="string">DS3</span>  <span class="string">FSpace</span></span><br><span class="line"><span class="string">--------------------------------------------------------------------------</span></span><br><span class="line"><span class="number">0</span> <span class="string">-</span>   <span class="string">-</span>   <span class="string">-</span>        <span class="string">-</span>   <span class="string">RAID1</span> <span class="string">Optl</span>  <span class="string">N</span>  <span class="number">278.875</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">N</span>      </span><br><span class="line"><span class="number">0</span> <span class="number">0</span>   <span class="string">-</span>   <span class="string">-</span>        <span class="string">-</span>   <span class="string">RAID1</span> <span class="string">Optl</span>  <span class="string">N</span>  <span class="number">278.875</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">N</span>      </span><br><span class="line"><span class="number">0</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">32</span><span class="string">:24</span>    <span class="number">24</span>  <span class="string">DRIVE</span> <span class="string">Onln</span>  <span class="string">N</span>  <span class="number">278.875</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">-</span>      </span><br><span class="line"><span class="number">0</span> <span class="number">0</span>   <span class="number">1</span>   <span class="number">32</span><span class="string">:25</span>    <span class="number">25</span>  <span class="string">DRIVE</span> <span class="string">Onln</span>  <span class="string">N</span>  <span class="number">278.875</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">-</span>      </span><br><span class="line"><span class="number">1</span> <span class="string">-</span>   <span class="string">-</span>   <span class="string">-</span>        <span class="string">-</span>   <span class="string">RAID5</span> <span class="string">Optl</span>  <span class="string">N</span>    <span class="number">4.089</span> <span class="string">TB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">N</span>      </span><br><span class="line"><span class="number">1</span> <span class="number">0</span>   <span class="string">-</span>   <span class="string">-</span>        <span class="string">-</span>   <span class="string">RAID5</span> <span class="string">Optl</span>  <span class="string">N</span>    <span class="number">4.089</span> <span class="string">TB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">N</span>      </span><br><span class="line"><span class="number">1</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">32</span><span class="string">:0</span>     <span class="number">0</span>   <span class="string">DRIVE</span> <span class="string">Onln</span>  <span class="string">N</span>   <span class="number">837.75</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">-</span>      </span><br><span class="line"><span class="number">1</span> <span class="number">0</span>   <span class="number">1</span>   <span class="number">32</span><span class="string">:1</span>     <span class="number">1</span>   <span class="string">DRIVE</span> <span class="string">Onln</span>  <span class="string">N</span>   <span class="number">837.75</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">-</span>      </span><br><span class="line"><span class="number">1</span> <span class="number">0</span>   <span class="number">2</span>   <span class="number">32</span><span class="string">:2</span>     <span class="number">2</span>   <span class="string">DRIVE</span> <span class="string">Onln</span>  <span class="string">N</span>   <span class="number">837.75</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">-</span>      </span><br><span class="line"><span class="number">1</span> <span class="number">0</span>   <span class="number">3</span>   <span class="number">32</span><span class="string">:3</span>     <span class="number">3</span>   <span class="string">DRIVE</span> <span class="string">Onln</span>  <span class="string">N</span>   <span class="number">837.75</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">-</span>      </span><br><span class="line"><span class="number">1</span> <span class="number">0</span>   <span class="number">4</span>   <span class="number">32</span><span class="string">:4</span>     <span class="number">4</span>   <span class="string">DRIVE</span> <span class="string">Onln</span>  <span class="string">N</span>   <span class="number">837.75</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">-</span>      </span><br><span class="line"><span class="number">1</span> <span class="number">0</span>   <span class="number">5</span>   <span class="number">32</span><span class="string">:5</span>     <span class="number">5</span>   <span class="string">DRIVE</span> <span class="string">Onln</span>  <span class="string">N</span>   <span class="number">837.75</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">-</span>      </span><br><span class="line"><span class="number">2</span> <span class="string">-</span>   <span class="string">-</span>   <span class="string">-</span>        <span class="string">-</span>   <span class="string">RAID5</span> <span class="string">Optl</span>  <span class="string">N</span>    <span class="number">4.089</span> <span class="string">TB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">N</span>      </span><br><span class="line"><span class="number">2</span> <span class="number">0</span>   <span class="string">-</span>   <span class="string">-</span>        <span class="string">-</span>   <span class="string">RAID5</span> <span class="string">Optl</span>  <span class="string">N</span>    <span class="number">4.089</span> <span class="string">TB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">N</span>      </span><br><span class="line"><span class="number">2</span> <span class="number">0</span>   <span class="number">0</span>   <span class="number">32</span><span class="string">:6</span>     <span class="number">6</span>   <span class="string">DRIVE</span> <span class="string">Onln</span>  <span class="string">N</span>   <span class="number">837.75</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">-</span>      </span><br><span class="line"><span class="number">2</span> <span class="number">0</span>   <span class="number">1</span>   <span class="number">32</span><span class="string">:7</span>     <span class="number">7</span>   <span class="string">DRIVE</span> <span class="string">Onln</span>  <span class="string">N</span>   <span class="number">837.75</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">-</span>      </span><br><span class="line"><span class="number">2</span> <span class="number">0</span>   <span class="number">2</span>   <span class="number">32</span><span class="string">:8</span>     <span class="number">8</span>   <span class="string">DRIVE</span> <span class="string">Onln</span>  <span class="string">N</span>   <span class="number">837.75</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">-</span>      </span><br><span class="line"><span class="number">2</span> <span class="number">0</span>   <span class="number">3</span>   <span class="number">32</span><span class="string">:9</span>     <span class="number">9</span>   <span class="string">DRIVE</span> <span class="string">Onln</span>  <span class="string">N</span>   <span class="number">837.75</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">-</span>      </span><br><span class="line"><span class="number">2</span> <span class="number">0</span>   <span class="number">4</span>   <span class="number">32</span><span class="string">:10</span>    <span class="number">10</span>  <span class="string">DRIVE</span> <span class="string">Onln</span>  <span class="string">N</span>   <span class="number">837.75</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">-</span>      </span><br><span class="line"><span class="number">2</span> <span class="number">0</span>   <span class="number">5</span>   <span class="number">32</span><span class="string">:11</span>    <span class="number">11</span>  <span class="string">DRIVE</span> <span class="string">Onln</span>  <span class="string">N</span>   <span class="number">837.75</span> <span class="string">GB</span> <span class="string">dflt</span> <span class="string">N</span>  <span class="string">N</span>   <span class="string">dflt</span> <span class="string">-</span>      <span class="string">【可以看到服务器有几个RAID，每个RAID的级别和成员盘】</span></span><br><span class="line"><span class="string">--------------------------------------------------------------------------</span></span><br><span class="line"> </span><br><span class="line"><span class="string">DG=Disk</span> <span class="string">Group</span> <span class="string">Index|Arr=Array</span> <span class="string">Index|Row=Row</span> <span class="string">Index|EID=Enclosure</span> <span class="string">Device</span> <span class="string">ID</span></span><br><span class="line"><span class="string">DID=Device</span> <span class="string">ID|Type=Drive</span> <span class="string">Type|Onln=Online|Rbld=Rebuild|Dgrd=Degraded</span></span><br><span class="line"><span class="string">Pdgd=Partially</span> <span class="string">degraded|Offln=Offline|BT=Background</span> <span class="string">Task</span> <span class="string">Active</span></span><br><span class="line"><span class="string">PDC=PD</span> <span class="string">Cache|PI=Protection</span> <span class="string">Info|SED=Self</span> <span class="string">Encrypting</span> <span class="string">Drive|Frgn=Foreign</span></span><br><span class="line"><span class="string">DS3=Dimmer</span> <span class="string">Switch</span> <span class="number">3</span><span class="string">|dflt=Default|Msng=Missing|FSpace=Free</span> <span class="string">Space</span> <span class="string">Present</span></span><br><span class="line"> </span><br><span class="line"><span class="string">Virtual</span> <span class="string">Drives</span> <span class="string">=</span> <span class="number">3</span><span class="string">【服务器有三个RAID，两个RAID5一个RAID1】</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">VD LIST :</span></span><br><span class="line"><span class="string">=======</span></span><br><span class="line"> </span><br><span class="line"><span class="string">---------------------------------------------------------------</span></span><br><span class="line"><span class="string">DG/VD</span> <span class="string">TYPE</span>  <span class="string">State</span> <span class="string">Access</span> <span class="string">Consist</span> <span class="string">Cache</span> <span class="string">Cac</span> <span class="string">sCC</span>       <span class="string">Size</span> <span class="string">Name</span></span><br><span class="line"><span class="string">---------------------------------------------------------------</span></span><br><span class="line"><span class="number">0</span><span class="string">/0</span>   <span class="string">RAID1</span> <span class="string">Optl</span>  <span class="string">RW</span>     <span class="literal">Yes</span>     <span class="string">RaWBD</span> <span class="string">R</span>   <span class="string">OFF</span> <span class="number">278.875</span> <span class="string">GB</span>      </span><br><span class="line"><span class="number">1</span><span class="string">/1</span>   <span class="string">RAID5</span> <span class="string">Optl</span>  <span class="string">RW</span>     <span class="literal">Yes</span>     <span class="string">RaWBD</span> <span class="string">R</span>   <span class="string">OFF</span>   <span class="number">4.089</span> <span class="string">TB</span>      </span><br><span class="line"><span class="number">2</span><span class="string">/2</span>   <span class="string">RAID5</span> <span class="string">Optl</span>  <span class="string">RW</span>     <span class="literal">Yes</span>     <span class="string">RaWBD</span> <span class="string">R</span>   <span class="string">OFF</span>   <span class="number">4.089</span> <span class="string">TB</span>      </span><br><span class="line"><span class="string">---------------------------------------------------------------</span></span><br><span class="line"> </span><br><span class="line"><span class="string">Cac=CacheCade|Rec=Recovery|OfLn=OffLine|Pdgd=Partially</span> <span class="string">Degraded|dgrd=Degraded</span></span><br><span class="line"><span class="string">Optl=Optimal|RO=Read</span> <span class="string">Only|RW=Read</span> <span class="string">Write|B=Blocked|Consist=Consistent|</span></span><br><span class="line"><span class="string">Ra=Read</span> <span class="string">Ahead</span> <span class="string">Adaptive|R=Read</span> <span class="string">Ahead</span> <span class="string">Always|NR=No</span> <span class="string">Read</span> <span class="string">Ahead|WB=WriteBack|</span></span><br><span class="line"><span class="string">AWB=Always</span> <span class="string">WriteBack|WT=WriteThrough|C=Cached</span> <span class="string">IO|D=Direct</span> <span class="string">IO|sCC=Scheduled</span></span><br><span class="line"><span class="string">Check</span> <span class="string">Consistency</span></span><br><span class="line"> </span><br><span class="line"><span class="string">Physical</span> <span class="string">Drives</span> <span class="string">=</span> <span class="number">14</span><span class="string">【十四个物理磁盘】</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">PD LIST :</span></span><br><span class="line"><span class="string">=======</span></span><br><span class="line"> </span><br><span class="line"><span class="string">-------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">EID:Slt</span> <span class="string">DID</span> <span class="string">State</span> <span class="string">DG</span>       <span class="string">Size</span> <span class="string">Intf</span> <span class="string">Med</span> <span class="string">SED</span> <span class="string">PI</span> <span class="string">SeSz</span> <span class="string">Model</span>            <span class="string">Sp</span></span><br><span class="line"><span class="string">-------------------------------------------------------------------------</span></span><br><span class="line"><span class="number">32</span><span class="string">:0</span>      <span class="number">0</span> <span class="string">Onln</span>   <span class="number">1</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:1</span>      <span class="number">1</span> <span class="string">Onln</span>   <span class="number">1</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:2</span>      <span class="number">2</span> <span class="string">Onln</span>   <span class="number">1</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:3</span>      <span class="number">3</span> <span class="string">Onln</span>   <span class="number">1</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:4</span>      <span class="number">4</span> <span class="string">Onln</span>   <span class="number">1</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:5</span>      <span class="number">5</span> <span class="string">Onln</span>   <span class="number">1</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:6</span>      <span class="number">6</span> <span class="string">Onln</span>   <span class="number">2</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:7</span>      <span class="number">7</span> <span class="string">Onln</span>   <span class="number">2</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:8</span>      <span class="number">8</span> <span class="string">Onln</span>   <span class="number">2</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:9</span>      <span class="number">9</span> <span class="string">Onln</span>   <span class="number">2</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:10</span>    <span class="number">10</span> <span class="string">Onln</span>   <span class="number">2</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:11</span>    <span class="number">11</span> <span class="string">Onln</span>   <span class="number">2</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:24</span>    <span class="number">24</span> <span class="string">Onln</span>   <span class="number">0</span> <span class="number">278.875</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">ST9300603SS</span>      <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:25</span>    <span class="number">25</span> <span class="string">Onln</span>   <span class="number">0</span> <span class="number">278.875</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">ST9300605SS</span>      <span class="string">U</span>  </span><br><span class="line"><span class="string">-------------------------------------------------------------------------</span></span><br><span class="line"> </span><br><span class="line"><span class="string">EID-Enclosure</span> <span class="string">Device</span> <span class="string">ID|Slt-Slot</span> <span class="literal">No</span>.<span class="string">|DID-Device</span> <span class="string">ID|DG-DriveGroup</span></span><br><span class="line"><span class="string">DHS-Dedicated</span> <span class="string">Hot</span> <span class="string">Spare|UGood-Unconfigured</span> <span class="string">Good|GHS-Global</span> <span class="string">Hotspare</span></span><br><span class="line"><span class="string">UBad-Unconfigured</span> <span class="string">Bad|Onln-Online|Offln-Offline|Intf-Interface</span></span><br><span class="line"><span class="string">Med-Media</span> <span class="string">Type|SED-Self</span> <span class="string">Encryptive</span> <span class="string">Drive|PI-Protection</span> <span class="string">Info</span></span><br><span class="line"><span class="string">SeSz-Sector</span> <span class="string">Size|Sp-Spun|U-Up|D-Down|T-Transition|F-Foreign</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">BBU_Info :</span></span><br><span class="line"><span class="string">========</span></span><br><span class="line"> </span><br><span class="line"><span class="string">------------------------------------------------------------</span></span><br><span class="line"><span class="string">Model</span> <span class="string">State</span>   <span class="string">RetentionTime</span> <span class="string">Temp</span> <span class="string">Mode</span> <span class="string">MfgDate</span>    <span class="string">Next</span> <span class="string">Learn</span></span><br><span class="line"><span class="string">------------------------------------------------------------</span></span><br><span class="line"><span class="string">BBU</span>   <span class="string">Optimal</span> <span class="number">0</span> <span class="string">hour(s)</span>     <span class="string">30C</span>  <span class="number">0</span>    <span class="number">2011</span><span class="string">/07/18</span> <span class="string">None</span>       </span><br><span class="line"><span class="string">------------------------------------------------------------</span></span><br><span class="line"> </span><br><span class="line"><span class="number">4</span><span class="string">、获取enclosure信息</span></span><br><span class="line"><span class="string">硬盘大多是附在enclosure上不是直接附在controller上。</span></span><br><span class="line"> </span><br><span class="line"><span class="string">显示所有的enclosure信息，但是系统中只有一个enclosure</span> <span class="string">，EID:32.</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">storcli]#</span> <span class="string">./storcli64</span> <span class="string">/c0/eall</span> <span class="string">show</span>   </span><br><span class="line"><span class="string">Controller</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="string">Status</span> <span class="string">=</span> <span class="string">Success</span></span><br><span class="line"><span class="string">Description</span> <span class="string">=</span> <span class="string">None</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="attr">Properties :</span></span><br><span class="line"><span class="string">==========</span></span><br><span class="line"> </span><br><span class="line"><span class="string">-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">EID</span> <span class="string">State</span> <span class="string">Slots</span> <span class="string">PD</span> <span class="string">PS</span> <span class="string">Fans</span> <span class="string">TSs</span> <span class="string">Alms</span> <span class="string">SIM</span> <span class="string">Port#</span>       <span class="string">ProdID</span>    <span class="string">VendorSpecific</span></span><br><span class="line"><span class="string">-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="number">32</span> <span class="string">OK</span>       <span class="number">26</span> <span class="number">14</span>  <span class="number">0</span>    <span class="number">0</span>   <span class="number">0</span>    <span class="number">0</span>   <span class="number">0</span> <span class="string">Unavailable</span> <span class="string">BP12G+EXP</span>                </span><br><span class="line"><span class="string">-----------------------------------------------------------------------------</span></span><br><span class="line"> </span><br><span class="line"><span class="string">EID-Enclosure</span> <span class="string">Device</span> <span class="string">ID</span> <span class="string">|PD-Physical</span> <span class="string">drive</span> <span class="string">count</span> <span class="string">|PS-Power</span> <span class="string">Supply</span> <span class="string">count|</span></span><br><span class="line"><span class="string">TSs-Temperature</span> <span class="string">sensor</span> <span class="string">count</span> <span class="string">|Alms-Alarm</span> <span class="string">count</span> <span class="string">|SIM-SIM</span> <span class="string">Count</span></span><br><span class="line"> </span><br><span class="line"><span class="string">获取单个enclosure</span>  <span class="string">,e32详细信息</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">storcli]#</span> <span class="string">./storcli64</span> <span class="string">/c0/e32</span> <span class="string">show</span> <span class="string">all</span></span><br><span class="line"><span class="string">Controller</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="string">Status</span> <span class="string">=</span> <span class="string">Success</span></span><br><span class="line"><span class="string">Description</span> <span class="string">=</span> <span class="string">None</span></span><br><span class="line"> </span><br><span class="line"><span class="string">Enclosure</span> <span class="string">/c0/e32</span>  <span class="string">:</span></span><br><span class="line"><span class="string">==================</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">Information :</span></span><br><span class="line"><span class="string">===========</span></span><br><span class="line"><span class="string">Device</span> <span class="string">ID</span> <span class="string">=</span> <span class="number">32</span></span><br><span class="line"><span class="string">Position</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="string">Connector</span> <span class="string">Name</span> <span class="string">=</span> <span class="string">Unavailable</span></span><br><span class="line"><span class="string">Enclosure</span> <span class="string">Type</span> <span class="string">=</span> <span class="string">SES</span></span><br><span class="line"><span class="string">Status</span> <span class="string">=</span> <span class="string">OK</span></span><br><span class="line"><span class="string">FRU</span> <span class="string">Part</span> <span class="string">Number</span> <span class="string">=</span> <span class="string">N/A</span></span><br><span class="line"><span class="string">Enclosure</span> <span class="string">Serial</span> <span class="string">Number</span> <span class="string">=</span> <span class="string">N/A</span></span><br><span class="line"><span class="string">ESM</span> <span class="string">Serial</span> <span class="string">Number</span> <span class="string">=</span> <span class="string">N/A</span></span><br><span class="line"><span class="string">Enclosure</span> <span class="string">Zoning</span> <span class="string">Mode</span> <span class="string">=</span> <span class="string">N/A</span></span><br><span class="line"><span class="string">Partner</span> <span class="string">Device</span> <span class="string">ID</span> <span class="string">=</span> <span class="number">65535</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="attr">Inquiry Data :</span></span><br><span class="line"><span class="string">============</span></span><br><span class="line"><span class="string">Vendor</span> <span class="string">Identification</span> <span class="string">=</span> <span class="string">DP</span></span><br><span class="line"><span class="string">Product</span> <span class="string">Identification</span> <span class="string">=</span> <span class="string">BP12G+EXP</span></span><br><span class="line"><span class="string">Product</span> <span class="string">Revision</span> <span class="string">Level</span> <span class="string">=</span> <span class="number">1.07</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="attr">Properties :</span></span><br><span class="line"><span class="string">==========</span></span><br><span class="line"> </span><br><span class="line"><span class="string">-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">EID</span> <span class="string">State</span> <span class="string">Slots</span> <span class="string">PD</span> <span class="string">PS</span> <span class="string">Fans</span> <span class="string">TSs</span> <span class="string">Alms</span> <span class="string">SIM</span> <span class="string">Port#</span>       <span class="string">ProdID</span>    <span class="string">VendorSpecific</span></span><br><span class="line"><span class="string">-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="number">32</span> <span class="string">OK</span>       <span class="number">26</span> <span class="number">14</span>  <span class="number">0</span>    <span class="number">0</span>   <span class="number">0</span>    <span class="number">0</span>   <span class="number">0</span> <span class="string">Unavailable</span> <span class="string">BP12G+EXP</span>                </span><br><span class="line"><span class="string">-----------------------------------------------------------------------------</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="string">EID-Enclosure</span> <span class="string">Device</span> <span class="string">ID</span> <span class="string">|PD-Physical</span> <span class="string">drive</span> <span class="string">count</span> <span class="string">|PS-Power</span> <span class="string">Supply</span> <span class="string">count|</span></span><br><span class="line"><span class="string">TSs-Temperature</span> <span class="string">sensor</span> <span class="string">count</span> <span class="string">|Alms-Alarm</span> <span class="string">count</span> <span class="string">|SIM-SIM</span> <span class="string">Count</span></span><br><span class="line"> </span><br><span class="line"><span class="number">5</span><span class="string">、显示物理磁盘信息</span></span><br><span class="line"><span class="string">语法：storcli64</span>  <span class="string">/cx/eall/sall</span> <span class="string">show</span>　　<span class="string">显示所有物理磁盘信息</span></span><br><span class="line"> </span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">storcli]#</span> <span class="string">./storcli64</span> <span class="string">/c0/e32/sall</span>   <span class="string">show</span> <span class="string">【显示e32上的所有物理硬盘】</span> </span><br><span class="line"> </span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">storcli]#</span> <span class="string">./storcli64</span> <span class="string">/c0/eall/sall</span> <span class="string">show【显示所有enclosure下的所有物理硬盘】</span></span><br><span class="line"><span class="string">Controller</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="string">Status</span> <span class="string">=</span> <span class="string">Success</span></span><br><span class="line"><span class="string">Description</span> <span class="string">=</span> <span class="string">Show</span> <span class="string">Drive</span> <span class="string">Information</span> <span class="string">Succeeded.</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="attr">Drive Information :</span></span><br><span class="line"><span class="string">=================</span></span><br><span class="line"> </span><br><span class="line"><span class="string">-------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">EID:Slt</span> <span class="string">DID</span> <span class="string">State</span> <span class="string">DG</span>       <span class="string">Size</span> <span class="string">Intf</span> <span class="string">Med</span> <span class="string">SED</span> <span class="string">PI</span> <span class="string">SeSz</span> <span class="string">Model</span>            <span class="string">Sp</span></span><br><span class="line"><span class="string">-------------------------------------------------------------------------</span></span><br><span class="line"><span class="number">32</span><span class="string">:0</span>      <span class="number">0</span> <span class="string">Onln</span>   <span class="number">1</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:1</span>      <span class="number">1</span> <span class="string">Onln</span>   <span class="number">1</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:2</span>      <span class="number">2</span> <span class="string">Onln</span>   <span class="number">1</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:3</span>      <span class="number">3</span> <span class="string">Onln</span>   <span class="number">1</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:4</span>      <span class="number">4</span> <span class="string">Onln</span>   <span class="number">1</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:5</span>      <span class="number">5</span> <span class="string">Onln</span>   <span class="number">1</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:6</span>      <span class="number">6</span> <span class="string">Onln</span>   <span class="number">2</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:7</span>      <span class="number">7</span> <span class="string">Onln</span>   <span class="number">2</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:8</span>      <span class="number">8</span> <span class="string">Onln</span>   <span class="number">2</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:9</span>      <span class="number">9</span> <span class="string">Onln</span>   <span class="number">2</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:10</span>    <span class="number">10</span> <span class="string">Onln</span>   <span class="number">2</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:11</span>    <span class="number">11</span> <span class="string">Onln</span>   <span class="number">2</span>  <span class="number">837.75</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">WD9001BKHG</span>       <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:24</span>    <span class="number">24</span> <span class="string">Onln</span>   <span class="number">0</span> <span class="number">278.875</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">ST9300603SS</span>      <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:25</span>    <span class="number">25</span> <span class="string">Onln</span>   <span class="number">0</span> <span class="number">278.875</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">ST9300605SS</span>      <span class="string">U</span>  </span><br><span class="line"><span class="string">-------------------------------------------------------------------------</span></span><br><span class="line"> </span><br><span class="line"><span class="string">EID-Enclosure</span> <span class="string">Device</span> <span class="string">ID|Slt-Slot</span> <span class="literal">No</span>.<span class="string">|DID-Device</span> <span class="string">ID|DG-DriveGroup</span></span><br><span class="line"><span class="string">DHS-Dedicated</span> <span class="string">Hot</span> <span class="string">Spare|UGood-Unconfigured</span> <span class="string">Good|GHS-Global</span> <span class="string">Hotspare【表示有热备盘，DHS专有热备，GHS全局热备】</span></span><br><span class="line"><span class="string">UBad-Unconfigured</span> <span class="string">Bad|Onln-Online|Offln-Offline|Intf-Interface</span></span><br><span class="line"><span class="string">Med-Media</span> <span class="string">Type|SED-Self</span> <span class="string">Encryptive</span> <span class="string">Drive|PI-Protection</span> <span class="string">Info</span></span><br><span class="line"><span class="string">SeSz-Sector</span> <span class="string">Size|Sp-Spun|U-Up|D-Down|T-Transition|F-Foreign</span></span><br><span class="line"> </span><br><span class="line"><span class="string">从上面信息，可以看出：</span></span><br><span class="line"></span><br><span class="line"><span class="string">只有一个控制器，id</span> <span class="string">为</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="string">EID，Enclosure</span> <span class="string">Device</span> <span class="string">ID</span> <span class="string">：32</span></span><br><span class="line"></span><br><span class="line"><span class="string">Slot</span> <span class="string">Number，能看到</span> <span class="number">0</span><span class="string">,1,2,3,4,5,6,7,8,9,10,11,24,25</span></span><br><span class="line"></span><br><span class="line"><span class="string">DG：disk</span> <span class="string">group，0,1,2</span></span><br><span class="line"></span><br><span class="line"><span class="string">size：容量，磁盘容量</span></span><br><span class="line"></span><br><span class="line"><span class="string">intf：接口，SAS</span></span><br><span class="line"></span><br><span class="line"><span class="string">Med：介质，ssd</span> <span class="string">或</span> <span class="string">hdd</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="number">6</span><span class="string">、查看raid组详细信息</span></span><br><span class="line"> </span><br><span class="line"><span class="string">查看系统里面有几个raid组：</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">storcli]#</span> <span class="string">./storcli64</span> <span class="string">/c0/vall</span>  <span class="string">show</span> <span class="string">【查看c0控制下的所有RAID信息】</span></span><br><span class="line"><span class="string">Controller</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="string">Status</span> <span class="string">=</span> <span class="string">Success</span></span><br><span class="line"><span class="string">Description</span> <span class="string">=</span> <span class="string">None</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="attr">Virtual Drives :</span></span><br><span class="line"><span class="string">==============</span></span><br><span class="line"> </span><br><span class="line"><span class="string">---------------------------------------------------------------</span></span><br><span class="line"><span class="string">DG/VD</span> <span class="string">TYPE</span>  <span class="string">State</span> <span class="string">Access</span> <span class="string">Consist</span> <span class="string">Cache</span> <span class="string">Cac</span> <span class="string">sCC</span>       <span class="string">Size</span> <span class="string">Name</span></span><br><span class="line"><span class="string">---------------------------------------------------------------</span></span><br><span class="line"><span class="number">0</span><span class="string">/0</span>   <span class="string">RAID1</span> <span class="string">Optl</span>  <span class="string">RW</span>     <span class="literal">Yes</span>     <span class="string">RaWBD</span> <span class="string">R</span>   <span class="string">OFF</span> <span class="number">278.875</span> <span class="string">GB</span>      </span><br><span class="line"><span class="number">1</span><span class="string">/1</span>   <span class="string">RAID5</span> <span class="string">Optl</span>  <span class="string">RW</span>     <span class="literal">Yes</span>     <span class="string">RaWBD</span> <span class="string">R</span>   <span class="string">OFF</span>   <span class="number">4.089</span> <span class="string">TB</span>      </span><br><span class="line"><span class="number">2</span><span class="string">/2</span>   <span class="string">RAID5</span> <span class="string">Optl</span>  <span class="string">RW</span>     <span class="literal">Yes</span>     <span class="string">RaWBD</span> <span class="string">R</span>   <span class="string">OFF</span>   <span class="number">4.089</span> <span class="string">TB</span>      <span class="string">【显示系统有三个raid组】</span></span><br><span class="line"><span class="string">---------------------------------------------------------------</span></span><br><span class="line"> </span><br><span class="line"><span class="string">Cac=CacheCade|Rec=Recovery|OfLn=OffLine|Pdgd=Partially</span> <span class="string">Degraded|dgrd=Degraded</span></span><br><span class="line"><span class="string">Optl=Optimal|RO=Read</span> <span class="string">Only|RW=Read</span> <span class="string">Write|B=Blocked|Consist=Consistent|</span></span><br><span class="line"><span class="string">Ra=Read</span> <span class="string">Ahead</span> <span class="string">Adaptive|R=Read</span> <span class="string">Ahead</span> <span class="string">Always|NR=No</span> <span class="string">Read</span> <span class="string">Ahead|WB=WriteBack|</span></span><br><span class="line"><span class="string">AWB=Always</span> <span class="string">WriteBack|WT=WriteThrough|C=Cached</span> <span class="string">IO|D=Direct</span> <span class="string">IO|sCC=Scheduled</span></span><br><span class="line"><span class="string">Check</span> <span class="string">Consistency</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="string">查看V0</span>  <span class="string">（虚拟磁盘0）</span> <span class="string">raid的详细信息</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">storcli]#</span> <span class="string">./storcli64</span> <span class="string">/c0/v0</span> <span class="string">show</span> <span class="string">all</span></span><br><span class="line"><span class="string">Controller</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="string">Status</span> <span class="string">=</span> <span class="string">Success</span></span><br><span class="line"><span class="string">Description</span> <span class="string">=</span> <span class="string">None</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="string">/c0/v0</span> <span class="string">:</span></span><br><span class="line"><span class="string">======</span></span><br><span class="line"> </span><br><span class="line"><span class="string">---------------------------------------------------------------</span></span><br><span class="line"><span class="string">DG/VD</span> <span class="string">TYPE</span>  <span class="string">State</span> <span class="string">Access</span> <span class="string">Consist</span> <span class="string">Cache</span> <span class="string">Cac</span> <span class="string">sCC</span>       <span class="string">Size</span> <span class="string">Name</span></span><br><span class="line"><span class="string">---------------------------------------------------------------</span></span><br><span class="line"><span class="number">0</span><span class="string">/0</span>   <span class="string">RAID1</span> <span class="string">Optl</span>  <span class="string">RW</span>     <span class="literal">Yes</span>     <span class="string">RaWBD</span> <span class="string">R</span>   <span class="string">OFF</span> <span class="number">278.875</span> <span class="string">GB</span>      <span class="string">【V0为RAID1】</span></span><br><span class="line"><span class="string">---------------------------------------------------------------</span></span><br><span class="line"> </span><br><span class="line"><span class="string">Cac=CacheCade|Rec=Recovery|OfLn=OffLine|Pdgd=Partially</span> <span class="string">Degraded|dgrd=Degraded</span></span><br><span class="line"><span class="string">Optl=Optimal|RO=Read</span> <span class="string">Only|RW=Read</span> <span class="string">Write|B=Blocked|Consist=Consistent|</span></span><br><span class="line"><span class="string">Ra=Read</span> <span class="string">Ahead</span> <span class="string">Adaptive|R=Read</span> <span class="string">Ahead</span> <span class="string">Always|NR=No</span> <span class="string">Read</span> <span class="string">Ahead|WB=WriteBack|</span></span><br><span class="line"><span class="string">AWB=Always</span> <span class="string">WriteBack|WT=WriteThrough|C=Cached</span> <span class="string">IO|D=Direct</span> <span class="string">IO|sCC=Scheduled</span></span><br><span class="line"><span class="string">Check</span> <span class="string">Consistency</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="attr">PDs for VD 0 :</span></span><br><span class="line"><span class="string">============</span></span><br><span class="line"> </span><br><span class="line"><span class="string">-------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">EID:Slt</span> <span class="string">DID</span> <span class="string">State</span> <span class="string">DG</span>       <span class="string">Size</span> <span class="string">Intf</span> <span class="string">Med</span> <span class="string">SED</span> <span class="string">PI</span> <span class="string">SeSz</span> <span class="string">Model</span>            <span class="string">Sp</span></span><br><span class="line"><span class="string">-------------------------------------------------------------------------</span></span><br><span class="line"><span class="number">32</span><span class="string">:24</span>    <span class="number">24</span> <span class="string">Onln</span>   <span class="number">0</span> <span class="number">278.875</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">ST9300603SS</span>      <span class="string">U</span>  </span><br><span class="line"><span class="number">32</span><span class="string">:25</span>    <span class="number">25</span> <span class="string">Onln</span>   <span class="number">0</span> <span class="number">278.875</span> <span class="string">GB</span> <span class="string">SAS</span>  <span class="string">HDD</span> <span class="string">N</span>   <span class="string">N</span>  <span class="string">512B</span> <span class="string">ST9300605SS</span>      <span class="string">U</span>  <span class="string">【可以看到24号和25号盘组成了raid1】</span></span><br><span class="line"><span class="string">-------------------------------------------------------------------------</span></span><br><span class="line"> </span><br><span class="line"><span class="string">EID-Enclosure</span> <span class="string">Device</span> <span class="string">ID|Slt-Slot</span> <span class="literal">No</span>.<span class="string">|DID-Device</span> <span class="string">ID|DG-DriveGroup</span></span><br><span class="line"><span class="string">DHS-Dedicated</span> <span class="string">Hot</span> <span class="string">Spare|UGood-Unconfigured</span> <span class="string">Good|GHS-Global</span> <span class="string">Hotspare</span></span><br><span class="line"><span class="string">UBad-Unconfigured</span> <span class="string">Bad|Onln-Online|Offln-Offline|Intf-Interface</span></span><br><span class="line"><span class="string">Med-Media</span> <span class="string">Type|SED-Self</span> <span class="string">Encryptive</span> <span class="string">Drive|PI-Protection</span> <span class="string">Info</span></span><br><span class="line"><span class="string">SeSz-Sector</span> <span class="string">Size|Sp-Spun|U-Up|D-Down|T-Transition|F-Foreign</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="attr">VD0 Properties :</span></span><br><span class="line"><span class="string">==============</span></span><br><span class="line"><span class="string">Strip</span> <span class="string">Size</span> <span class="string">=</span> <span class="number">64</span> <span class="string">KB</span></span><br><span class="line"><span class="string">Span</span> <span class="string">Depth</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="string">Number</span> <span class="string">of</span> <span class="string">Drives</span> <span class="string">Per</span> <span class="string">Span</span> <span class="string">=</span> <span class="number">2</span></span><br><span class="line"><span class="string">Disk</span> <span class="string">Cache</span> <span class="string">Policy</span> <span class="string">=</span> <span class="string">Disk's</span> <span class="string">Default</span></span><br><span class="line"><span class="string">Encryption</span> <span class="string">=</span> <span class="string">None</span></span><br><span class="line"><span class="string">Data</span> <span class="string">Protection</span> <span class="string">=</span> <span class="string">None</span></span><br><span class="line"><span class="string">Active</span> <span class="string">Operations</span> <span class="string">=</span> <span class="string">None</span></span><br><span class="line"><span class="string">Exposed</span> <span class="string">to</span> <span class="string">OS</span> <span class="string">=</span> <span class="literal">Yes</span></span><br><span class="line"><span class="string">Creation</span> <span class="string">Date</span> <span class="string">=</span> <span class="number">05</span><span class="number">-09</span><span class="number">-2012</span></span><br><span class="line"><span class="string">Creation</span> <span class="string">Time</span> <span class="string">=</span> <span class="number">01</span><span class="string">:38:23</span> <span class="string">PM</span></span><br><span class="line"><span class="string">Emulation</span> <span class="string">type</span> <span class="string">=</span> <span class="string">None</span></span><br><span class="line"> </span><br><span class="line"><span class="number">7</span><span class="string">、磁盘状态设置</span></span><br><span class="line"><span class="string">storcli64</span>    <span class="string">/cx/ex/sx</span>    <span class="string">set</span>    <span class="string">good/offline/online/missing</span>　　<span class="string">设置某块磁盘的状态</span></span><br><span class="line"><span class="string">good</span>　　　　　 　　<span class="string">空闲</span></span><br><span class="line"><span class="string">online/offline</span>　　     <span class="string">成员盘上下线</span></span><br><span class="line"><span class="string">missing</span>　　　　        <span class="string">设置磁盘为missing状态</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="string">磁盘热备</span></span><br><span class="line"><span class="string">storcli64</span> <span class="string">/cx/ex/sx</span> <span class="string">add</span> <span class="string">hotsparedrive</span> <span class="string">dgs=x</span>　　<span class="string">设置模块磁盘为diskgroup</span> <span class="string">x</span> <span class="string">的热备盘</span></span><br><span class="line"><span class="string">storcli64</span> <span class="string">/cx/ex/sx</span> <span class="string">add</span> <span class="string">hotsparedrive</span>           <span class="string">设置全局热备</span></span><br><span class="line"><span class="string">storcli64</span> <span class="string">/cx/ex/sx</span> <span class="string">delete</span> <span class="string">hotsparedrive</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="string">磁盘rebuild</span></span><br><span class="line"><span class="string">storcli64</span> <span class="string">/cx/ex/sx</span> <span class="string">show</span> <span class="string">rebuild</span>　　<span class="string">查看rebild</span></span><br><span class="line"><span class="string">storcli64</span> <span class="string">/cx/ex/sx</span> <span class="string">start</span> <span class="string">rebuild</span></span><br><span class="line"><span class="string">storcli64</span> <span class="string">/cx/ex/sx</span> <span class="string">stop</span> <span class="string">rebuild</span></span><br><span class="line"> </span><br><span class="line"><span class="string">磁盘点灯</span></span><br><span class="line"><span class="string">storcli64</span> <span class="string">/cx/ex/sx</span> <span class="string">start</span> <span class="string">locate</span></span><br><span class="line"><span class="string">storcli64</span> <span class="string">/cx/ex/sx</span> <span class="string">stop</span> <span class="string">locate</span></span><br><span class="line"> </span><br><span class="line"><span class="string">磁盘擦除</span></span><br><span class="line"><span class="string">快速擦除：</span></span><br><span class="line"><span class="string">storcli64</span> <span class="string">/cx/ex/sx</span> <span class="string">set</span> <span class="string">good</span></span><br><span class="line"><span class="string">storcli64</span> <span class="string">/cx/fall</span> <span class="string">del|delete</span> <span class="string">[securityKey</span> <span class="string">=</span> <span class="string">xxx]</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="string">完全擦除：</span></span><br><span class="line"><span class="string">storcli</span> <span class="string">/cx[/ex]/sx</span> <span class="string">secureerase</span> <span class="string">[force]</span></span><br><span class="line"><span class="string">storcli</span> <span class="string">/cx[/ex]/sx</span> <span class="string">start</span> <span class="string">erase</span> <span class="string">[simple|</span> <span class="string">normal|</span> <span class="string">thorough</span> <span class="string">|</span> <span class="string">standard|</span> <span class="string">threepass</span> <span class="string">|</span> <span class="string">crypto]</span></span><br><span class="line"><span class="string">storcli</span> <span class="string">/cx[/ex]/sx</span> <span class="string">stop</span> <span class="string">erase</span></span><br><span class="line"><span class="string">storcli</span> <span class="string">/cx[/ex]/sx</span> <span class="string">show</span> <span class="string">erase</span></span><br><span class="line"> </span><br><span class="line"><span class="number">8</span><span class="string">、获取rebuild速率</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">storcli]#</span> <span class="string">./storcli64</span>  <span class="string">/c0</span> <span class="string">show</span> <span class="string">rebuildrate</span></span><br><span class="line"><span class="string">Controller</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="string">Status</span> <span class="string">=</span> <span class="string">Success</span></span><br><span class="line"><span class="string">Description</span> <span class="string">=</span> <span class="string">None</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">Controller Properties :</span></span><br><span class="line"><span class="string">=====================</span></span><br><span class="line"></span><br><span class="line"><span class="string">------------------</span></span><br><span class="line"><span class="string">Ctrl_Prop</span>   <span class="string">Value</span></span><br><span class="line"><span class="string">------------------</span></span><br><span class="line"><span class="string">Rebuildrate</span> <span class="number">30</span><span class="string">%</span>   </span><br><span class="line"><span class="string">------------------</span></span><br><span class="line"> </span><br><span class="line"><span class="string">storcli64</span>   <span class="string">/c0</span>  <span class="string">set</span>  <span class="string">rebuildrate=60</span>　　<span class="string">设置rebuild速率</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="number">9</span><span class="string">、清除缓存</span></span><br><span class="line"><span class="string">清除raid卡，物理磁盘cache</span></span><br><span class="line"><span class="string">storcli64</span>   <span class="string">/c0</span>    <span class="string">flushcache</span></span><br><span class="line"><span class="string">苦难并非乐事，但能者等闲视之，人生本来就是苦中作乐，切莫长吁短叹，虚度年华。</span></span><br></pre></td></tr></table></figure>

<h2 id="MegaCli"><a href="#MegaCli" class="headerlink" title="MegaCli"></a>MegaCli</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">MegaCli使用参考文档(版本包见附件)</span></span><br><span class="line"><span class="string">安装megacli</span></span><br><span class="line"><span class="string">下载megacli时，同时包含了一个依赖包。安装megacli时需要安装该包。</span></span><br><span class="line"></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">~]#</span> <span class="string">rpm</span> <span class="string">-ivh</span> <span class="string">Lib_Utils-1.00-08.noarch.rpm</span> </span><br><span class="line"><span class="string">Preparing...</span>                <span class="comment">########################################### [100%]</span></span><br><span class="line"><span class="string">Installing....</span></span><br><span class="line">   <span class="number">1</span><span class="string">:Lib_Utils</span>              <span class="comment">########################################### [100%]</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">~]#</span> <span class="string">cd</span> <span class="string">/</span></span><br><span class="line"> <span class="string">[root@localhost</span> <span class="string">/]#</span> <span class="string">rpm</span> <span class="string">-ivh</span> <span class="string">MegaCli-8.00.23-1.i386.rpm</span> </span><br><span class="line"><span class="string">Preparing...</span>                <span class="comment">########################################### [100%]</span></span><br><span class="line">   <span class="number">1</span><span class="string">:MegaCli</span>                <span class="comment">########################################### [100%]</span></span><br><span class="line"><span class="string">注：开机自检时，使用ctrl+y也可直接进入命令行配置界面。</span></span><br><span class="line"><span class="string">megacli使用</span></span><br><span class="line"><span class="string">安装megacli后，megacli程序自动安装到/opt/MegaRAID/MegaCli目录下。</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">MegaCli]#</span> <span class="string">pwd</span></span><br><span class="line"><span class="string">/opt/MegaRAID/MegaCli</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">MegaCli]#</span> <span class="string">ls</span></span><br><span class="line"><span class="string">install.log</span>  <span class="string">MegaCli64</span></span><br><span class="line"><span class="string">查看MegaCli64是一个可以执行的程序，如不可以，使用chmod添加权限即可（chmod</span> <span class="number">755</span> <span class="string">Megacli64）。</span></span><br><span class="line"><span class="string">注意,，ctrl|+y进入命令行后需要区分大小写，系统下megacli不需要区分大小写。</span></span><br><span class="line"></span><br><span class="line"><span class="string">使用./MegaCli64</span> <span class="string">–help或者./Megacli64</span> <span class="string">–h查看命令帮助。</span></span><br><span class="line"><span class="string">查看硬盘列表</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">MegaCli]#</span> <span class="string">./MegaCli64</span> <span class="string">-PDList</span> <span class="string">-aALL</span></span><br><span class="line"> <span class="string">Adapter</span> <span class="comment">#0</span></span><br><span class="line"><span class="attr">Enclosure Device ID:</span> <span class="number">252</span><span class="string">----背板</span></span><br><span class="line"><span class="attr">Slot Number:</span> <span class="number">0</span><span class="string">-----硬盘位置</span></span><br><span class="line"><span class="attr">Device Id:</span> <span class="number">176</span></span><br><span class="line"><span class="attr">Sequence Number:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">Media Error Count:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Other Error Count:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Predictive Failure Count:</span> <span class="number">0</span><span class="string">----上面三行查看硬盘是否有坏道以及smart报错。</span></span><br><span class="line"><span class="attr">Last Predictive Failure Event Seq Number:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">PD Type:</span> <span class="string">SATA</span></span><br><span class="line"><span class="attr">Raw Size:</span> <span class="number">931.512</span> <span class="string">GB</span> <span class="string">[0x74706db0</span> <span class="string">Sectors]</span></span><br><span class="line"><span class="attr">Non Coerced Size:</span> <span class="number">931.012</span> <span class="string">GB</span> <span class="string">[0x74606db0</span> <span class="string">Sectors]</span></span><br><span class="line"><span class="attr">Coerced Size:</span> <span class="number">930.390</span> <span class="string">GB</span> <span class="string">[0x744c8000</span> <span class="string">Sectors]</span></span><br><span class="line"><span class="attr">Firmware state:</span> <span class="string">Unconfigured(good),</span> <span class="string">Spun</span> <span class="string">Up---显示硬盘状态，单独硬盘还是raid中，Firmware</span> <span class="attr">state:</span> <span class="string">Online,</span> <span class="string">Spun</span> <span class="string">Up（raid中）</span></span><br><span class="line"><span class="string">SAS</span> <span class="string">Address(0):</span> <span class="number">0x9281c06686c5355</span></span><br><span class="line"><span class="attr">Connected Port Number:</span> <span class="number">0</span><span class="string">(path0)</span> </span><br><span class="line"><span class="attr">Inquiry Data:</span>             <span class="string">9WK0CC10ST31000524NS</span>                            <span class="string">SN11</span>    </span><br><span class="line"><span class="attr">FDE Capable:</span> <span class="string">Not</span> <span class="string">Capable</span></span><br><span class="line"><span class="attr">FDE Enable:</span> <span class="string">Disable</span></span><br><span class="line"><span class="attr">Secured:</span> <span class="string">Unsecured</span></span><br><span class="line"><span class="attr">Locked:</span> <span class="string">Unlocked</span></span><br><span class="line"><span class="attr">Needs EKM Attention:</span> <span class="literal">No</span></span><br><span class="line"><span class="attr">Foreign State:</span> <span class="string">None</span> </span><br><span class="line"><span class="attr">Device Speed:</span> <span class="number">3.</span><span class="string">0Gb/s</span> </span><br><span class="line"><span class="attr">Link Speed:</span> <span class="number">3.</span><span class="string">0Gb/s</span> </span><br><span class="line"><span class="attr">Media Type:</span> <span class="string">Hard</span> <span class="string">Disk</span> <span class="string">Device</span></span><br><span class="line"></span><br><span class="line"><span class="string">创建raid</span></span><br><span class="line"><span class="string">./MegaCli</span> <span class="string">-CfgLdAdd</span> <span class="string">-rX[E0:S0,E1:S1,...]</span> <span class="string">[WT|WB]</span> <span class="string">[NORA|RA|ADRA]</span> <span class="string">[Direct|Cached]</span></span><br><span class="line">        <span class="string">[CachedBadBBU|NoCachedBadBBU]</span> <span class="string">[-szXXX</span> <span class="string">[-szYYY</span> <span class="string">...]]</span></span><br><span class="line">        <span class="string">[-strpszM]</span> <span class="string">[-Hsp[E0:S0,...]]</span> <span class="string">[-AfterLdX]</span> <span class="string">[-Force]|[FDE|CtrlBased]</span> <span class="string">–aN</span></span><br><span class="line"><span class="string">非红色部分，如果不填写则使用默认配置，如背板显示不出来，则使用空格代替即可。</span></span><br><span class="line"><span class="string">[-szXXX</span> <span class="string">[-szYYY</span> <span class="string">...]]</span>  <span class="string">直接写数字即可，后面省略M，本身代表M。</span></span><br><span class="line"></span><br><span class="line"><span class="string">例如使用四块硬盘创建一个raid5</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">MegaCli]#</span> <span class="string">./MegaCli64</span>  <span class="string">-CfgLdadd</span> <span class="string">-r5[252:0,252:1,252:2,</span> <span class="number">252</span><span class="string">:3]</span> <span class="string">-a0</span></span><br><span class="line">                                     </span><br><span class="line"><span class="attr">Adapter 0:</span> <span class="string">Created</span> <span class="string">VD</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Adapter 0:</span> <span class="string">Configured</span> <span class="string">the</span> <span class="string">Adapter!!</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Exit Code:</span> <span class="number">0x00</span></span><br><span class="line"><span class="string">查看raid状态</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">MegaCli]#</span> <span class="string">./MegaCli64</span>  <span class="string">-ldinfo</span> <span class="string">-lall</span> <span class="string">-a0</span></span><br><span class="line">                                     </span><br><span class="line"><span class="attr">Adapter 0 -- Virtual Drive Information:</span></span><br><span class="line"><span class="attr">Virtual Drive:</span> <span class="number">0</span> <span class="string">(Target</span> <span class="attr">Id:</span> <span class="number">0</span><span class="string">)</span></span><br><span class="line"><span class="attr">Name                :</span></span><br><span class="line"><span class="attr">RAID Level          :</span> <span class="string">Primary-5,</span> <span class="string">Secondary-0,</span> <span class="string">RAID</span> <span class="string">Level</span> <span class="string">Qualifier-3</span></span><br><span class="line"><span class="attr">Size                :</span> <span class="number">2.725</span> <span class="string">TB</span></span><br><span class="line"><span class="attr">State               :</span> <span class="string">Optimal</span></span><br><span class="line"><span class="attr">Stripe Size         :</span> <span class="number">64</span> <span class="string">KB</span></span><br><span class="line"><span class="attr">Number Of Drives    :</span> <span class="number">4</span></span><br><span class="line"><span class="attr">Span Depth          :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">Default Cache Policy:</span> <span class="string">WriteBack,</span> <span class="string">ReadAheadNone,</span> <span class="string">Direct,</span> <span class="literal">No</span> <span class="string">Write</span> <span class="string">Cache</span> <span class="string">if</span> <span class="string">Bad</span> <span class="string">BBU</span></span><br><span class="line"><span class="attr">Current Cache Policy:</span> <span class="string">WriteThrough,</span> <span class="string">ReadAheadNone,</span> <span class="string">Direct,</span> <span class="literal">No</span> <span class="string">Write</span> <span class="string">Cache</span> <span class="string">if</span> <span class="string">Bad</span> <span class="string">BBU</span></span><br><span class="line"><span class="attr">Access Policy       :</span> <span class="string">Read/Write</span></span><br><span class="line"><span class="attr">Disk Cache Policy   :</span> <span class="string">Disk's</span> <span class="string">Default</span></span><br><span class="line"><span class="attr">Encryption Type     :</span> <span class="string">None</span></span><br><span class="line"><span class="attr">Exit Code:</span> <span class="number">0x00</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">MegaCli]#</span> <span class="string">./MegaCli64</span>  <span class="string">-ldinfo</span> <span class="string">-l0</span> <span class="string">-a0</span></span><br><span class="line">                                     </span><br><span class="line"><span class="attr">Adapter 0 -- Virtual Drive Information:</span></span><br><span class="line"><span class="attr">Virtual Drive:</span> <span class="number">0</span> <span class="string">(Target</span> <span class="attr">Id:</span> <span class="number">0</span><span class="string">)</span></span><br><span class="line"><span class="attr">Name                :</span></span><br><span class="line"><span class="attr">RAID Level          :</span> <span class="string">Primary-1,</span> <span class="string">Secondary-0,</span> <span class="string">RAID</span> <span class="string">Level</span> <span class="string">Qualifier-0</span></span><br><span class="line"><span class="attr">Size                :</span> <span class="number">930.390</span> <span class="string">GB</span></span><br><span class="line"><span class="attr">State               :</span> <span class="string">Optimal</span></span><br><span class="line"><span class="attr">Stripe Size         :</span> <span class="number">64</span> <span class="string">KB</span></span><br><span class="line"><span class="attr">Number Of Drives    :</span> <span class="number">2</span></span><br><span class="line"><span class="attr">Span Depth          :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">Default Cache Policy:</span> <span class="string">WriteBack,</span> <span class="string">ReadAheadNone,</span> <span class="string">Direct,</span> <span class="literal">No</span> <span class="string">Write</span> <span class="string">Cache</span> <span class="string">if</span> <span class="string">Bad</span> <span class="string">BBU</span></span><br><span class="line"><span class="attr">Current Cache Policy:</span> <span class="string">WriteThrough,</span> <span class="string">ReadAheadNone,</span> <span class="string">Direct,</span> <span class="literal">No</span> <span class="string">Write</span> <span class="string">Cache</span> <span class="string">if</span> <span class="string">Bad</span> <span class="string">BBU</span></span><br><span class="line"><span class="attr">Access Policy       :</span> <span class="string">Read/Write</span></span><br><span class="line"><span class="attr">Disk Cache Policy   :</span> <span class="string">Disk's</span> <span class="string">Default</span></span><br><span class="line"><span class="attr">Encryption Type     :</span> <span class="string">None</span></span><br><span class="line"></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">MegaCli]#</span> <span class="string">./MegaCli64</span>  <span class="string">-ldinfo</span> <span class="string">-l0</span> <span class="string">-a0</span></span><br><span class="line">                                     </span><br><span class="line"></span><br><span class="line"><span class="attr">Adapter 0 -- Virtual Drive Information:</span></span><br><span class="line"><span class="attr">Virtual Drive:</span> <span class="number">0</span> <span class="string">(Target</span> <span class="attr">Id:</span> <span class="number">0</span><span class="string">)</span></span><br><span class="line"><span class="attr">Name                :</span></span><br><span class="line"><span class="attr">RAID Level          :</span> <span class="string">Primary-0,</span> <span class="string">Secondary-0,</span> <span class="string">RAID</span> <span class="string">Level</span> <span class="string">Qualifier-0</span></span><br><span class="line"><span class="attr">Size                :</span> <span class="number">1.816</span> <span class="string">TB</span></span><br><span class="line"><span class="attr">State               :</span> <span class="string">Optimal</span></span><br><span class="line"><span class="attr">Stripe Size         :</span> <span class="number">64</span> <span class="string">KB</span></span><br><span class="line"><span class="attr">Number Of Drives    :</span> <span class="number">2</span></span><br><span class="line"><span class="attr">Span Depth          :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">Default Cache Policy:</span> <span class="string">WriteBack,</span> <span class="string">ReadAheadNone,</span> <span class="string">Direct,</span> <span class="literal">No</span> <span class="string">Write</span> <span class="string">Cache</span> <span class="string">if</span> <span class="string">Bad</span> <span class="string">BBU</span></span><br><span class="line"><span class="attr">Current Cache Policy:</span> <span class="string">WriteThrough,</span> <span class="string">ReadAheadNone,</span> <span class="string">Direct,</span> <span class="literal">No</span> <span class="string">Write</span> <span class="string">Cache</span> <span class="string">if</span> <span class="string">Bad</span> <span class="string">BBU</span></span><br><span class="line"><span class="attr">Access Policy       :</span> <span class="string">Read/Write</span></span><br><span class="line"><span class="attr">Disk Cache Policy   :</span> <span class="string">Disk's</span> <span class="string">Default</span></span><br><span class="line"><span class="attr">Encryption Type     :</span> <span class="string">None</span></span><br><span class="line"></span><br><span class="line"><span class="string">Raid状态以及raid中包含哪些硬盘</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">MegaCli]#</span> <span class="string">./MegaCli64</span>  <span class="string">-ldpdinfo</span>  <span class="string">-a0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">删除raid</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">MegaCli]#</span> <span class="string">./MegaCli64</span>  <span class="string">-cfglddel</span> <span class="string">-l0</span> <span class="string">-a0</span></span><br><span class="line">                                     </span><br><span class="line"><span class="attr">Adapter 0:</span> <span class="string">Deleted</span> <span class="string">Virtual</span> <span class="string">Drive-0(target</span> <span class="string">id-0)</span></span><br><span class="line"><span class="attr">Exit Code:</span> <span class="number">0x00</span></span><br><span class="line"><span class="string">做热备</span></span><br><span class="line"><span class="string">【root@localhost</span> <span class="string">MegaCli]#</span> <span class="string">./MegaCli64</span>  <span class="string">-pdhsp</span> <span class="string">-set</span> <span class="string">-physdrv[252:3]</span> <span class="string">-a0</span></span><br><span class="line">                                     </span><br><span class="line"><span class="attr">Adapter: 0:</span> <span class="string">Set</span> <span class="string">Physical</span> <span class="string">Drive</span> <span class="string">at</span> <span class="string">EnclId-252</span> <span class="string">SlotId-3</span> <span class="string">as</span> <span class="string">Hot</span> <span class="string">Spare</span> <span class="string">Success.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Exit Code:</span> <span class="number">0x00</span></span><br><span class="line"><span class="string">查看热备盘状态：Firmware</span> <span class="attr">state:</span> <span class="string">Hotspare,</span> <span class="string">Spun</span> <span class="string">Up</span></span><br><span class="line"><span class="string">热备盘删除</span></span><br><span class="line"><span class="string">./MegaCli64</span> <span class="string">-PDHSP</span> <span class="string">-Rmv</span>  <span class="string">-PhysDrv[Ex：Sx]</span> <span class="string">–aALL</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span><span class="string">、uncfgure</span> <span class="string">bad硬盘改成uncfgure</span> <span class="string">good硬盘</span></span><br><span class="line"><span class="string">MegaCli</span> <span class="string">-PDMakeGood</span> <span class="string">-PhysDrv[E0:S0,E1:S1,...]</span> <span class="string">|</span> <span class="string">[-Force]</span> <span class="string">-aN|-a0,1,2|-aALL</span></span><br><span class="line"><span class="string">Uncfgure</span> <span class="string">bad状态硬盘，无法对其进行操作。</span></span><br><span class="line"></span><br><span class="line"><span class="number">6</span><span class="string">、删除foreign信息</span></span><br><span class="line"><span class="string">MegaCli</span> <span class="string">-CfgForeign</span> <span class="string">-Scan</span> <span class="string">|</span> <span class="string">[-SecurityKey</span> <span class="string">sssssssssss]</span> <span class="string">-aN|-a0,1,2|-aALL</span>    </span><br><span class="line"><span class="string">MegaCli</span> <span class="string">-CfgForeign</span> <span class="string">-Clear</span> <span class="string">[x]|[-SecurityKey</span> <span class="string">sssssssssss]</span> <span class="string">-aN|-a0,1,2|-aALL</span>    </span><br><span class="line">        <span class="string">x</span> <span class="bullet">-</span> <span class="string">index</span> <span class="string">of</span> <span class="string">foreign</span> <span class="string">configurations.</span> <span class="string">Optional.</span> <span class="string">All</span> <span class="string">by</span> <span class="string">default.</span></span><br><span class="line"><span class="number">7</span><span class="string">、如何做rebuild</span></span><br><span class="line"><span class="string">如有热备盘，硬盘掉线后，热备盘会自动rebuild。</span></span><br><span class="line"><span class="string">热备盘自动rebuid</span></span><br><span class="line"><span class="attr">Enclosure Device ID:</span> <span class="number">252</span></span><br><span class="line"><span class="attr">Slot Number:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">Device Id:</span> <span class="number">178</span></span><br><span class="line"><span class="attr">Sequence Number:</span> <span class="number">6</span></span><br><span class="line"><span class="attr">Media Error Count:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Other Error Count:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Predictive Failure Count:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Last Predictive Failure Event Seq Number:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">PD Type:</span> <span class="string">SATA</span></span><br><span class="line"><span class="attr">Raw Size:</span> <span class="number">931.512</span> <span class="string">GB</span> <span class="string">[0x74706db0</span> <span class="string">Sectors]</span></span><br><span class="line"><span class="attr">Non Coerced Size:</span> <span class="number">931.012</span> <span class="string">GB</span> <span class="string">[0x74606db0</span> <span class="string">Sectors]</span></span><br><span class="line"><span class="attr">Coerced Size:</span> <span class="number">930.390</span> <span class="string">GB</span> <span class="string">[0x744c8000</span> <span class="string">Sectors]</span></span><br><span class="line"><span class="attr">Firmware state:</span> <span class="string">Rebuild</span></span><br><span class="line"><span class="string">SAS</span> <span class="string">Address(0):</span> <span class="number">0x9281c0667817c71</span></span><br><span class="line"><span class="attr">Connected Port Number:</span> <span class="number">2</span><span class="string">(path0)</span> </span><br><span class="line"><span class="attr">Inquiry Data:</span>             <span class="string">9WK0BXZLST31000524NS</span>                            <span class="string">SN11</span>    </span><br><span class="line"><span class="attr">FDE Capable:</span> <span class="string">Not</span> <span class="string">Capable</span></span><br><span class="line"><span class="attr">FDE Enable:</span> <span class="string">Disable</span></span><br><span class="line"><span class="attr">Secured:</span> <span class="string">Unsecured</span></span><br><span class="line"><span class="attr">Locked:</span> <span class="string">Unlocked</span></span><br><span class="line"><span class="attr">Needs EKM Attention:</span> <span class="literal">No</span></span><br><span class="line"><span class="attr">Foreign State:</span> <span class="string">None</span> </span><br><span class="line"><span class="attr">Device Speed:</span> <span class="number">3.</span><span class="string">0Gb/s</span> </span><br><span class="line"><span class="attr">Link Speed:</span> <span class="number">3.</span><span class="string">0Gb/s</span> </span><br><span class="line"><span class="attr">Media Type:</span> <span class="string">Hard</span> <span class="string">Disk</span> <span class="string">Device</span></span><br><span class="line"><span class="string">使用MegaCli</span> <span class="string">-PDRbld</span> <span class="string">-ShowProg</span> <span class="string">-PhysDrv</span> <span class="string">[E0:S0,E1:S1,...]</span> <span class="string">-aN|-a0,1,2|-aALL来查看硬盘rebuild进程。</span></span><br><span class="line"><span class="string">Rebuid结束后，掉线槽位硬盘更换后，自动从热备拷回数据，原热备盘再次变成热备盘，</span></span><br><span class="line"><span class="attr">Enclosure Device ID:</span> <span class="number">252</span></span><br><span class="line"><span class="attr">Slot Number:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">Device Id:</span> <span class="number">179</span></span><br><span class="line"><span class="attr">Sequence Number:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">Media Error Count:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Other Error Count:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Predictive Failure Count:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Last Predictive Failure Event Seq Number:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">PD Type:</span> <span class="string">SATA</span></span><br><span class="line"><span class="attr">Raw Size:</span> <span class="number">931.512</span> <span class="string">GB</span> <span class="string">[0x74706db0</span> <span class="string">Sectors]</span></span><br><span class="line"><span class="attr">Non Coerced Size:</span> <span class="number">931.012</span> <span class="string">GB</span> <span class="string">[0x74606db0</span> <span class="string">Sectors]</span></span><br><span class="line"><span class="attr">Coerced Size:</span> <span class="number">930.390</span> <span class="string">GB</span> <span class="string">[0x744c8000</span> <span class="string">Sectors]</span></span><br><span class="line"><span class="attr">Firmware state:</span> <span class="string">Copyback</span></span><br><span class="line"><span class="string">SAS</span> <span class="string">Address(0):</span> <span class="number">0x9281c06595f6f7c</span></span><br><span class="line"><span class="attr">Connected Port Number:</span> <span class="number">1</span><span class="string">(path0)</span> </span><br><span class="line"><span class="attr">Inquiry Data:</span>             <span class="string">9WK046MWST31000524NS</span>                            <span class="string">SN11</span>    </span><br><span class="line"><span class="attr">FDE Capable:</span> <span class="string">Not</span> <span class="string">Capable</span></span><br><span class="line"><span class="attr">FDE Enable:</span> <span class="string">Disable</span></span><br><span class="line"><span class="attr">Secured:</span> <span class="string">Unsecured</span></span><br><span class="line"><span class="attr">Locked:</span> <span class="string">Unlocked</span></span><br><span class="line"><span class="attr">Needs EKM Attention:</span> <span class="literal">No</span></span><br><span class="line"><span class="attr">Foreign State:</span> <span class="string">None</span> </span><br><span class="line"><span class="attr">Device Speed:</span> <span class="number">3.</span><span class="string">0Gb/s</span> </span><br><span class="line"><span class="attr">Link Speed:</span> <span class="number">3.</span><span class="string">0Gb/s</span> </span><br><span class="line"><span class="attr">Media Type:</span> <span class="string">Hard</span> <span class="string">Disk</span> <span class="string">Device</span></span><br><span class="line"></span><br><span class="line"><span class="string">热备盘在rebuid过程中，更换掉线槽位硬盘，查看该硬盘是否有media</span> <span class="string">error即可，确认硬盘为uncfgure</span> <span class="string">good状态，一般RAID卡都可以copyback,后续硬盘会自动从原热备盘拷回数据。</span></span><br><span class="line"><span class="string">但是考虑到存在无法copyback的情况，在热备盘rebuild完成后再更换硬盘。</span></span><br><span class="line"><span class="string">无热备盘情况，更换新硬盘，如果自动rebuild，则正常结束即可，如不自动rebuild，可以配置成热备盘。</span></span><br><span class="line"></span><br><span class="line"><span class="number">8</span><span class="string">、查看raid卡日志</span></span><br><span class="line"><span class="comment">#/opt/MegaRAID/MegaCli/MegaCli64 -FwTermLog -Dsply -aALL </span></span><br><span class="line"><span class="number">9</span><span class="string">、显示Raid卡型号，Raid设置，Disk相关信息</span></span><br><span class="line"><span class="comment">#/opt/MegaRAID/MegaCli/MegaCli64 -cfgdsply -aALL </span></span><br><span class="line"><span class="number">10</span><span class="string">、查看RAID阵列中掉线的盘</span></span><br><span class="line"><span class="string">/opt/MegaRAID/MegaCli/MegaCli64</span> <span class="string">-pdgetmissing</span> <span class="string">-a0</span></span><br></pre></td></tr></table></figure>



<h2 id="去除raid-0"><a href="#去除raid-0" class="headerlink" title="去除raid 0"></a>去除raid 0</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>BMC进入设备终端</span><br><span class="line"><span class="number">2.</span>执行reboot</span><br></pre></td></tr></table></figure>

<p>3.启动过程中执行：ctrl+r 进入raid模式</p>
<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584948967541-1585553611037.png" alt="1584948967541"></p>
<p>4.选中RAID 0，按F2，选中Delete Drive Group，按enter选择YES，确认删除</p>
<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584948981764-1585553611038.png" alt="1584948981764"></p>
<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584948995283-1585553611038.png" alt="1584948995283"></p>
<p>5.按Ctrl+N进入下一页，TAB选择到JBOD，按空格勾选（x），下图是没勾选，选择apply提交</p>
<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584949016403-1585553611038.png" alt="1584949016403"></p>
<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/E:%5C%E8%AE%B0%E5%BD%95%5CLinux%5C1584949025247-1585553611038.png" alt="1584949025247"></p>
<p>6.以及按Ctrl+p向前查看磁盘是否都做了jbod</p>
<h2 id="查看磁盘型号"><a href="#查看磁盘型号" class="headerlink" title="查看磁盘型号"></a>查看磁盘型号</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smartctl <span class="params">--all</span> <span class="string">/dev/sda</span></span><br></pre></td></tr></table></figure>

<h1 id="003-网络"><a href="#003-网络" class="headerlink" title="003-网络"></a>003-网络</h1><h2 id="时间同步及设置ip"><a href="#时间同步及设置ip" class="headerlink" title="时间同步及设置ip"></a>时间同步及设置ip</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">服务器时间同步:</span><br><span class="line">ntpdate 对应的ip</span><br><span class="line">添加定时任务：切换到root用户，crontab –e编辑定时任务，添加如下：</span><br><span class="line">*/5 * * * * /usr/sbin/sntp -P <span class="literal">no</span> -r 30.30.100.12;hwclock –w(加黑ip为时间标准服务器)</span><br><span class="line">有的时候平台zxuss会影响时间同步，需要先停掉平台：pkill -9 ZXUSS</span><br><span class="line">有几个服务器设置不成功用的以下方法:</span><br><span class="line">命令:yast:进设置,选择system&gt;DATA <span class="keyword">and</span> Time&gt;选择时区</span><br><span class="line"></span><br><span class="line">ip</span><br><span class="line">[root@halo network-scripts]# more ifcfg-eth0 </span><br><span class="line"><span class="attribute">DEVICE</span>=eth0</span><br><span class="line"><span class="attribute">HWADDR</span>=00:0C:29:B1:17:0F</span><br><span class="line"><span class="attribute">TYPE</span>=Ethernet</span><br><span class="line"><span class="attribute">UUID</span>=f109427a-2184-41f1-88e9-fc8e3143f80b</span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">NM_CONTROLLED</span>=<span class="literal">yes</span></span><br><span class="line">=none</span><br><span class="line"><span class="attribute">BOOTPROTO</span>=static</span><br><span class="line"><span class="attribute">IPADDR</span>=30.30.3.1</span><br><span class="line"><span class="attribute">NETMASK</span>=255.255.0.0</span><br><span class="line">[root@halo network-scripts]# pwd</span><br><span class="line">/etc/sysconfig/network-scripts</span><br><span class="line">2017-02-23 10:07:49*[马正园10125555]说:</span><br><span class="line">[root@halo sysconfig]# more network</span><br><span class="line"><span class="attribute">NETWORKING</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">HOSTNAME</span>=halo</span><br><span class="line"><span class="attribute">GATEWAY</span>=30.30.30.254</span><br><span class="line">[root@halo sysconfig]# pwd</span><br><span class="line">/etc/sysconfig</span><br><span class="line">vi /etc/sysconfig/network/ifcfg-eth0</span><br></pre></td></tr></table></figure>



<h2 id="centos关闭防火墙"><a href="#centos关闭防火墙" class="headerlink" title="centos关闭防火墙"></a>centos关闭防火墙</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CentOS7用firewall命令“替代”了iptables。</span><br><span class="line">        关闭firewall：</span><br><span class="line">        systemctl stop firewalld.service <span class="comment">#停止firewall</span></span><br><span class="line">        systemctl disable firewalld.service <span class="comment">#禁止firewall开机启动</span></span><br><span class="line">        firewall-<span class="keyword">cmd</span><span class="bash"> --state <span class="comment">#查看默认防火墙状态（关闭后显示notrunning，开启后显示running）</span></span></span><br></pre></td></tr></table></figure>



<h2 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">需要使用ping命令的-c参数和-s参数，其含义如下：</span><br><span class="line">-c 数目：在发送指定数目的包后停止。</span><br><span class="line">-s 字节数：指定发送的数据字节数，预设值是56，加上8字节的ICMP头，一共是64ICMP数据字节。</span><br><span class="line">用法示例：</span><br><span class="line">$<span class="built_in"> ping </span>-c 4 -s 1500 192.168.1.1</span><br></pre></td></tr></table></figure>

<h2 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">情景</span><br><span class="line">telnet命令是TELNET协议的用户接口，它支持两种模式：命令模式和会话模式。虽然telnet支持许多命令，但大部分情况下，我们只是使用它查看目标主机是否打开了某端口（默认是23）。</span><br><span class="line">其执行结果有两种：</span><br><span class="line">端口未打开</span><br><span class="line">$ telnet 101.199.97.65 62715</span><br><span class="line">Trying 101.199.97.65<span class="built_in">..</span>.</span><br><span class="line">telnet: connect <span class="keyword">to</span><span class="built_in"> address </span>101.199.97.65:<span class="built_in"> Connection </span>refused</span><br><span class="line">此时，命令已退出。</span><br><span class="line">端口已打开</span><br><span class="line">$ telnet 101.199.97.65 62715</span><br><span class="line">Trying 101.199.97.65<span class="built_in">..</span>.</span><br><span class="line">Connected <span class="keyword">to</span> 101.199.97.65.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">此时命令未退出。</span><br><span class="line">根据提示Escape character is <span class="string">'^]'</span>.可知退出字符为<span class="string">'^]'</span>（CTRL+]）。此时输入其它字符不能使其退出，CTRL+C都不行。输入CTRL+]后会自动执行，进入命令模式：</span><br><span class="line">^]</span><br><span class="line">telnet&gt;</span><br><span class="line">此时再运行quit才会真正退出。</span><br><span class="line">telnet&gt; quit</span><br><span class="line">Connection closed.</span><br><span class="line">其中，Escape character可以自定义，使用参数-e：</span><br><span class="line">$ telnet -e p 101.199.97.65 62715</span><br><span class="line">Telnet escape character is <span class="string">'p'</span>.</span><br><span class="line">Trying 101.199.97.65<span class="built_in">..</span>.</span><br><span class="line">Connected <span class="keyword">to</span> 101.199.97.65.</span><br><span class="line">Escape character is <span class="string">'p'</span>.</span><br><span class="line">p</span><br><span class="line">telnet&gt; quit</span><br><span class="line">Connection closed.</span><br><span class="line">即便如此，退出telnet还是麻烦。那么，更进一步，如果出现在脚本中应该如何（优雅地）退出telnet呢？</span><br><span class="line"></span><br><span class="line">方案</span><br><span class="line">其实可以这样：</span><br><span class="line">输出结果后立即退出</span><br><span class="line">$ echo <span class="string">""</span> | telnet 101.199.97.65 62715</span><br><span class="line">Trying 101.199.97.65<span class="built_in">..</span>.</span><br><span class="line">Connected <span class="keyword">to</span> 101.199.97.65.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">Connection closed by foreign host.</span><br><span class="line">$ echo <span class="string">""</span> | telnet 101.199.97.65 62715</span><br><span class="line">Trying 101.199.97.65<span class="built_in">..</span>.</span><br><span class="line">telnet: connect <span class="keyword">to</span><span class="built_in"> address </span>101.199.97.65:<span class="built_in"> Connection </span>refused</span><br><span class="line">输出结果后延迟退出</span><br><span class="line">sleep 2使得telnet输出结果后，停留2秒后退出命令模式。</span><br><span class="line">$ sleep 2 | telnet 101.199.97.65 62715</span><br><span class="line">Trying 101.199.97.65<span class="built_in">..</span>.</span><br><span class="line">Connected <span class="keyword">to</span> 101.199.97.65.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">Connection closed by foreign host.</span><br><span class="line">使用这种方式可以将标准输出和标准错误重定向到文件中，通过分析文件的内容来判断端口打开状态。</span><br></pre></td></tr></table></figure>

<h2 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vdbench免密拷机的时候，会无缘无故的退出，之后发现ssh超时，需要注释下面两行，重启sshd</span><br><span class="line">[root<span class="symbol">@sdfspstapp01</span> mnt]<span class="meta"># cat /etc/ssh/sshd_config |grep -E <span class="string">"ClientAliveInterval|ClientAliveCountMax"</span></span></span><br><span class="line"><span class="meta">#ClientAliveInterval 600</span></span><br><span class="line"><span class="meta">#ClientAliveCountMax 0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">增加ssh连接数：</span><br><span class="line"> 修改服务器上的这个文件：/etc/ssh/sshd_config，找到两行：</span><br><span class="line">MaxSessions：最大允许链接数，默认<span class="number">10.</span></span><br><span class="line">MaxStartups：最大允许保持多少个未认证链接（未输入登录密码），默认值是<span class="number">10.</span></span><br><span class="line">把他们的数字改大，例如改成</span><br><span class="line">MaxSessions <span class="number">1000</span></span><br><span class="line">MaxStartups <span class="number">1000</span></span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">远程到另外一台linux设备并执行命令：</span><br><span class="line">ssh <span class="symbol">root@</span><span class="number">10.244</span><span class="number">.25</span><span class="number">.11</span> <span class="string">"cd /home;touch 4.19"</span></span><br></pre></td></tr></table></figure>



<h2 id="sshpass"><a href="#sshpass" class="headerlink" title="sshpass"></a>sshpass</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># yum -y install sshpass</span><br><span class="line"></span><br><span class="line">实例<span class="number">1</span>：本地执行远程机器的命令：</span><br><span class="line">命令： sshpass -p xxx ssh <span class="symbol">root@</span><span class="number">192.168</span><span class="number">.11</span><span class="number">.11</span> <span class="string">"ethtool eth0"</span></span><br><span class="line"></span><br><span class="line">实例<span class="number">2</span>：远程连接指定ssh的端口：</span><br><span class="line">命令：sshpass -p <span class="number">123456</span> ssh -p <span class="number">1000</span> <span class="symbol">root@</span><span class="number">192.168</span><span class="number">.11</span><span class="number">.11</span>    </span><br><span class="line">(当远程主机不是默认的<span class="number">22</span>端口时候)</span><br><span class="line"></span><br><span class="line">实例<span class="number">3</span>：从密码文件读取文件内容作为密码去远程连接主机</span><br><span class="line">命令：sshpass -f xxx.txt  ssh <span class="symbol">root@</span><span class="number">192.168</span><span class="number">.11</span><span class="number">.11</span></span><br><span class="line"></span><br><span class="line">实例<span class="number">4</span>：从远程主机上拉取文件到本地</span><br><span class="line">命令： sshpass -p <span class="string">'123456'</span> scp <span class="symbol">root@</span>host_ip:/home/test/t ./tmp/</span><br></pre></td></tr></table></figure>



<h2 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">远程拷贝：scp -r -P PORT /home/setup root<span class="variable">@80</span>.<span class="number">80.45</span>.<span class="number">37</span><span class="symbol">:/home/setup</span>（-P PORT为指定端口）</span><br><span class="line">scp -r /home/zxcdn/*.tar.gz root<span class="variable">@10</span>.<span class="number">47.235</span>.<span class="number">167</span><span class="symbol">:/home/zxcdn/</span></span><br><span class="line">         这边为要拷贝的内容                        这边是目标地址（要拷到哪个目录下）</span><br></pre></td></tr></table></figure>



<h2 id="双网卡配置"><a href="#双网卡配置" class="headerlink" title="双网卡配置"></a>双网卡配置</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">9。双网卡配置：</span><br><span class="line">ifcfg-br0 </span><br><span class="line">ifcfg-br0:1 </span><br><span class="line">[root@ceph-osd2 ~]# cat /etc/sysconfig/network-scripts/ifcfg-br0:1</span><br><span class="line"><span class="attribute">DEVICE</span>=br0</span><br><span class="line"><span class="attribute">BOOTPROTO</span>=static</span><br><span class="line"><span class="attribute">NM_CONTROLLED</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">TYPE</span>=Bridge</span><br><span class="line"><span class="attribute">IPADDR</span>=10.37.2.203</span><br><span class="line"><span class="attribute">NETMASK</span>=255.255.255.0</span><br><span class="line">[root@ceph-osd2 ~]# cat /etc/sysconfig/network-scripts/ifcfg-br0</span><br><span class="line"><span class="attribute">DEVICE</span>=br0</span><br><span class="line"><span class="attribute">BOOTPROTO</span>=static</span><br><span class="line"><span class="attribute">NM_CONTROLLED</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">TYPE</span>=Bridge</span><br><span class="line"><span class="attribute">IPADDR</span>=10.37.2.17</span><br><span class="line"><span class="attribute">NETMASK</span>=255.255.255.0</span><br><span class="line"><span class="attribute">GATEWAY</span>=10.37.2.254</span><br><span class="line">然后重启网卡</span><br></pre></td></tr></table></figure>



<h2 id="设备重启后网口变了"><a href="#设备重启后网口变了" class="headerlink" title="设备重启后网口变了"></a>设备重启后网口变了</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">压测环境：</span><br><span class="line">eth1 千兆</span><br><span class="line">eth2 万兆</span><br><span class="line">eth3 千兆</span><br><span class="line">eth4 万兆</span><br><span class="line"></span><br><span class="line">问题：</span><br><span class="line">eth2 eth4原来是万兆做的bond 1，重启设备后发现eth1变成了万兆eth2变成了千兆</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line"></span><br><span class="line">1.修改/etc/udev/rules.d/70-persistent-net.rules【没有的话创建一个就行】放入下面内容</span><br><span class="line"></span><br><span class="line"><span class="attribute">SUBSYSTEM</span>=="net", <span class="attribute">ACTION</span>=="add", <span class="attribute">DRIVERS</span>=="?*", ATTR&#123;address&#125;==<span class="string">"2c:4d:54:47:c6:71"</span>, ATTR&#123;type&#125;==<span class="string">"1"</span>, <span class="attribute">KERNEL</span>=="eth*", <span class="attribute">NAME</span>=<span class="string">"eth0"</span></span><br><span class="line"><span class="attribute">SUBSYSTEM</span>=="net", <span class="attribute">ACTION</span>=="add", <span class="attribute">DRIVERS</span>=="?*", ATTR&#123;address&#125;==<span class="string">"2c:4d:54:47:c6:72"</span>, ATTR&#123;type&#125;==<span class="string">"1"</span>, <span class="attribute">KERNEL</span>=="eth*", <span class="attribute">NAME</span>=<span class="string">"eth1"</span></span><br><span class="line"><span class="attribute">SUBSYSTEM</span>=="net", <span class="attribute">ACTION</span>=="add", <span class="attribute">DRIVERS</span>=="?*", ATTR&#123;address&#125;==<span class="string">"90:e2:ba:ef:22:b4"</span>, ATTR&#123;type&#125;==<span class="string">"1"</span>, <span class="attribute">KERNEL</span>=="eth*", <span class="attribute">NAME</span>=<span class="string">"eth2"</span></span><br><span class="line"><span class="attribute">SUBSYSTEM</span>=="net", <span class="attribute">ACTION</span>=="add", <span class="attribute">DRIVERS</span>=="?*", ATTR&#123;address&#125;==<span class="string">"90:e2:ba:ef:22:b5"</span>, ATTR&#123;type&#125;==<span class="string">"1"</span>, <span class="attribute">KERNEL</span>=="eth*", <span class="attribute">NAME</span>=<span class="string">"eth3"</span></span><br><span class="line"></span><br><span class="line">2c:4d:54:47:c6:71 mac地址</span><br><span class="line">修改mac地址变成对应网卡的就行【ip a可以查询，如果做了bond，mac会重复，建议使用cat /proc/net/bonding/bond0 |grep -E <span class="string">"Slave Interface|Permanent HW addr"</span>】</span><br><span class="line"></span><br><span class="line">2.重启设备【reboot或者init 0】</span><br></pre></td></tr></table></figure>



<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">有的端口不是默认的</span><br><span class="line">windows下添加路由</span><br><span class="line">        我的电脑：小网网关：<span class="number">172.18</span><span class="number">.100</span><span class="number">.254</span></span><br><span class="line">                   大网网关：<span class="number">10.47</span><span class="number">.214</span><span class="number">.1</span></span><br><span class="line">        比如一个服务器的ip：<span class="number">30.30</span><span class="number">.3</span><span class="number">.4</span></span><br><span class="line">                route  add  <span class="number">30.30</span><span class="number">.0</span><span class="number">.0</span> mask <span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span> <span class="number">172.18</span><span class="number">.100</span><span class="number">.254</span></span><br><span class="line">linux下添加路由，内容下发，tomcat日志显示ftp不通</span><br><span class="line"><span class="number">10.47</span><span class="number">.231</span><span class="number">.43</span>（<span class="number">10</span>不与<span class="number">30</span>的通，<span class="number">10</span>的还有一个ip为<span class="number">80</span>的，所以加<span class="number">80</span>的网关）</span><br><span class="line">route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line"><span class="number">10.47</span><span class="number">.231</span><span class="number">.0</span>     <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>   U     <span class="number">0</span>      <span class="number">0</span>        <span class="number">0</span> eth1</span><br><span class="line"><span class="number">10.229</span><span class="number">.0</span><span class="number">.0</span>      <span class="number">80.80</span><span class="number">.80</span><span class="number">.254</span>    <span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span>     UG    <span class="number">0</span>      <span class="number">0</span>        <span class="number">0</span> eth0</span><br><span class="line"><span class="number">80.80</span><span class="number">.0</span><span class="number">.0</span>       <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span>     U     <span class="number">0</span>      <span class="number">0</span>        <span class="number">0</span> eth0</span><br><span class="line"><span class="number">169.254</span><span class="number">.0</span><span class="number">.0</span>     <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span>     U     <span class="number">0</span>      <span class="number">0</span>        <span class="number">0</span> eth1</span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">10.47</span><span class="number">.231</span><span class="number">.1</span>     <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         UG    <span class="number">0</span>      <span class="number">0</span>        <span class="number">0</span> eth1</span><br><span class="line">route add -net <span class="number">30.1</span><span class="number">.0</span><span class="number">.0</span> netmask <span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span> gw <span class="number">80.80</span><span class="number">.80</span><span class="number">.254</span> dev eth0</span><br><span class="line">route add –net <span class="number">30.1</span><span class="number">.170</span><span class="number">.130</span></span><br><span class="line">        linux添加永久路由</span><br><span class="line">cd /etc/sysconfig/network-scripts</span><br><span class="line">more route-eth0</span><br><span class="line">vi route-eth0</span><br><span class="line"><span class="number">10.229</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">16</span> via <span class="number">80.80</span><span class="number">.80</span><span class="number">.254</span></span><br><span class="line"><span class="number">70.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">8</span> via <span class="number">80.80</span><span class="number">.80</span><span class="number">.254</span></span><br><span class="line"><span class="number">172.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">8</span> via <span class="number">80.80</span><span class="number">.80</span><span class="number">.254</span></span><br><span class="line">~</span><br><span class="line">~</span><br><span class="line">~</span><br><span class="line">~</span><br><span class="line">/etc/init.d/network restart</span><br><span class="line">more ifcfg-eth0</span><br><span class="line">more ifcfg-eth1</span><br><span class="line"><span class="number">172.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">8</span>         via         <span class="number">80.80</span><span class="number">.80</span><span class="number">.254</span></span><br><span class="line">网段/子网掩码  via  网关</span><br><span class="line">问题：itool连接失败（rr：<span class="number">80.80</span><span class="number">.41</span><span class="number">.196</span>）</span><br><span class="line">网段：IPv4 地址: <span class="number">172.18</span><span class="number">.100</span><span class="number">.33</span></span><br><span class="line">IPv4 子网掩码: <span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="number">8</span>：代表子网掩码</span><br><span class="line">网关：route命令 查看<span class="number">80.80</span><span class="number">.41</span><span class="number">.196</span>的网关（Gateway）：<span class="number">80.80</span><span class="number">.80</span><span class="number">.254</span></span><br></pre></td></tr></table></figure>



<h1 id="004-调试命令"><a href="#004-调试命令" class="headerlink" title="004-调试命令"></a>004-调试命令</h1><h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">watch</span> <span class="string">"ls -lh snbs.bin"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">linux watch 命令使用；进行循环执行程序，并显示结果；https://www.cnblogs.com/xuyaowen/p/watch-<span class="keyword">proc</span>.html</span><br><span class="line"></span><br><span class="line">watch 能间歇地执行程序，并将输出结果以全屏的方式显示，默认时2s执行一次；</span><br><span class="line">watch -n 5<span class="title"> ping</span> -c 1<span class="title"> www.baidu.com</span> # 进行循环5秒钟，发送一次ping包；</span><br><span class="line">使用范例：</span><br><span class="line">To<span class="title"> watch</span> for<span class="title"> mail,</span> you<span class="title"> might</span> do</span><br><span class="line"></span><br><span class="line"><span class="title">              watch</span> -n 60<span class="title"> from</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">To</span> watch<span class="title"> the</span> contents<span class="title"> of</span> a<span class="title"> directory</span> change,<span class="title"> you</span> could<span class="title"> use</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title"></span> <span class="title">             watch</span> -d<span class="title"> ls</span> -l</span><br><span class="line"></span><br><span class="line">If<span class="title"> you're</span> only<span class="title"> interested</span> in<span class="title"> files</span> owned<span class="title"> by</span> user<span class="title"> joe,</span> you<span class="title"> might</span> use</span><br><span class="line"></span><br><span class="line"><span class="title">              watch</span> -d 'ls -l |<span class="title"> fgrep</span> joe'</span><br><span class="line"></span><br><span class="line">To<span class="title"> see</span> the<span class="title"> effects</span> of<span class="title"> quoting,</span> try<span class="title"> these</span> out</span><br><span class="line"></span><br><span class="line"><span class="title">              watch</span> echo $$</span><br><span class="line"><span class="title">              watch</span> echo '$$'</span><br><span class="line"><span class="title">              watch</span> echo "'"'$$'"'"</span><br></pre></td></tr></table></figure>

<h2 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">5.4 会话分离与恢复</span><br><span class="line">你可以不中断screen窗口中程序的运行而暂时断开（detach）screen会话，并在随后时间重新连接（attach）该会话，重新控制各窗口中运行的程序。例如，我们打开一个screen窗口编辑/tmp/david.txt文件：</span><br><span class="line">[root@TS-DEV ~]#<span class="built_in"> screen </span>vi /tmp/david.txt</span><br><span class="line">之后我们想暂时退出做点别的事情，比如出去散散步，那么在screen窗口键入C-a d，Screen会给出detached提示：</span><br><span class="line">暂时中断会话</span><br><span class="line">半个小时之后回来了，找到该screen会话：</span><br><span class="line">[root@TS-DEV ~]#<span class="built_in"> screen </span>-ls</span><br><span class="line"></span><br><span class="line">重新连接会话：</span><br><span class="line">[root@TS-DEV ~]#<span class="built_in"> screen </span>-r 12865</span><br><span class="line">一切都在。</span><br><span class="line">当然，如果你在另一台机器上没有分离一个Screen会话，就无从恢复会话了。</span><br><span class="line">这时可以使用下面命令强制将这个会话从它所在的终端分离，转移到新的终端上来：</span><br><span class="line"></span><br><span class="line">5.5 清除dead 会话</span><br><span class="line">如果由于某种原因其中一个会话死掉了（例如人为杀掉该会话），这时screen -list会显示该会话为dead状态。使用screen -wipe命令清除该会话：</span><br><span class="line"></span><br><span class="line">5.6 关闭或杀死窗口</span><br><span class="line">正常情况下，当你退出一个窗口中最后一个程序（通常是bash）后，这个窗口就关闭了。另一个关闭窗口的方法是使用C-a k，这个快捷键杀死当前的窗口，同时也将杀死这个窗口中正在运行的进程。</span><br><span class="line">如果一个Screen会话中最后一个窗口被关闭了，那么整个Screen会话也就退出了，screen进程会被终止。</span><br><span class="line">除了依次退出/杀死当前Screen会话中所有窗口这种方法之外，还可以使用快捷键C-a :，然后输入quit命令退出Screen会话。需要注意的是，这样退出会杀死所有窗口并退出其中运行的所有程序。其实C-a :这个快捷键允许用户直接输入的命令有很多，包括分屏可以输入split等，这也是实现Screen功能的一个途径，不过个人认为还是快捷键比较方便些。</span><br></pre></td></tr></table></figure>

<h2 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">shell</span><span class="bash">脚本curl命令，会出现有些链接，链接不上的问题：</span></span><br><span class="line">修改系统参数解决：</span><br><span class="line">sysctl -a  查看系统参数</span><br></pre></td></tr></table></figure>

<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">curl</span> 带-w <span class="string">"%&#123;http_code&#125;"</span>这个参数直接返回<span class="meta">code</span></span><br></pre></td></tr></table></figure>

<h2 id="dmesg"><a href="#dmesg" class="headerlink" title="dmesg"></a>dmesg</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">命令：dmesg</span><br></pre></td></tr></table></figure>

<h2 id="tc命令"><a href="#tc命令" class="headerlink" title="tc命令"></a>tc命令</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="string">模拟延迟传输简介</span></span><br><span class="line"><span class="string">netem</span> <span class="string">与</span> <span class="attr">tc:</span> <span class="string">netem</span> <span class="string">是</span> <span class="string">Linux</span> <span class="number">2.6</span> <span class="string">及以上内核版本提供的一个网络模拟功能模块。该功能模块可以用来在性能良好的局域网中,模拟出复杂的互联网传输性能,诸如低带宽、传输延迟、丢包等等情况。使用</span> <span class="string">Linux</span> <span class="number">2.6</span> <span class="string">(或以上)</span> <span class="string">版本内核的很多发行版</span> <span class="string">Linux</span> <span class="string">都开启了该内核功能,比如</span> <span class="string">Fedora、Ubuntu、Redhat、OpenSuse、CentOS、Debian</span> <span class="string">等等。</span> <span class="string">tc</span> <span class="string">是Linux</span> <span class="string">系统中的一个工具,全名为</span> <span class="string">traffic</span> <span class="string">control(流量控制)。tc</span> <span class="string">可以用来控制</span> <span class="string">netem</span> <span class="string">的工作模式,也就是说,如果想使用</span> <span class="string">netem</span> <span class="string">,需要至少两个条件,一个是内核中的</span> <span class="string">netem</span> <span class="string">功能被包含,另一个是要有</span> <span class="string">tc</span> <span class="string">。</span></span><br><span class="line"><span class="string">需要注意的是:本文介绍的流控只能控制发包动作,不能控制收包动作,同时,它直接对物理接口生效,如果控制了物理的</span> <span class="string">eth0,那么逻辑网卡(比如</span> <span class="string">eth0:1)也会受到影响,反之,如果您在逻辑网卡上做控制,该控制可能是无效的。(注:虚拟机中的多个网卡可以在虚拟机中视为多个物理网卡)。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tc qdisc add dev eth0 root netem delay 100ms</span></span><br><span class="line"><span class="string">该命令将</span> <span class="string">eth0</span> <span class="string">网卡的传输设置为延迟</span> <span class="number">100</span> <span class="string">毫秒发送。</span></span><br><span class="line"></span><br><span class="line"><span class="string">更真实的情况下,延迟值不会这么精确,会有一定的波动,我们可以用下面的情况来模拟出</span></span><br><span class="line"><span class="string">带有波动性的延迟值:</span></span><br><span class="line"><span class="comment"># tc qdisc add dev eth0 root netem delay 100ms 10ms</span></span><br><span class="line"><span class="string">该命令将</span> <span class="string">eth0</span> <span class="string">网卡的传输设置为延迟</span> <span class="string">100ms</span> <span class="string">±</span> <span class="string">10ms</span> <span class="string">(90</span> <span class="string">~</span> <span class="number">110</span> <span class="string">ms</span> <span class="string">之间的任意值)发送。</span></span><br><span class="line"><span class="string">还可以更进一步加强这种波动的随机性:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># tc qdisc add dev eth0 root netem delay 100ms 10ms 30%</span></span><br><span class="line"><span class="string">该命令将</span> <span class="string">eth0</span> <span class="string">网卡的传输设置为</span> <span class="string">100ms</span> <span class="string">,同时,大约有</span> <span class="number">30</span><span class="string">%</span> <span class="string">的包会延迟</span> <span class="string">±</span> <span class="string">10ms</span> <span class="string">发送。示例:现在</span> <span class="string">ping</span> <span class="string">一下</span> <span class="number">216</span> <span class="string">机器:</span></span><br><span class="line"><span class="string">易宝支付有限公司</span></span><br><span class="line"><span class="string">可以看出数据明显的波动性。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">3</span> <span class="string">模拟网络丢包:</span></span><br><span class="line"><span class="comment"># tc qdisc add dev eth0 root netem loss 1%</span></span><br><span class="line"><span class="string">该命令将</span> <span class="string">eth0</span> <span class="string">网卡的传输设置为随机丢掉</span> <span class="number">1</span><span class="string">%</span> <span class="string">的数据包。示例:在</span> <span class="number">216</span> <span class="string">上执行</span></span><br><span class="line"><span class="comment">#tc qdisc add dev eth0 root netem loss 10%</span></span><br><span class="line"><span class="string">显示</span> <span class="number">16</span> <span class="string">个包只有</span> <span class="number">13</span> <span class="string">个收到了。也可以设置丢包的成功率:</span></span><br><span class="line"><span class="comment"># tc qdisc add dev eth0 root netem loss 1% 30%</span></span><br><span class="line"><span class="string">该命令将</span> <span class="string">eth0</span> <span class="string">网卡的传输设置为随机丢掉</span> <span class="number">1</span><span class="string">%</span> <span class="string">的数据包,成功率为</span> <span class="number">30</span><span class="string">%</span> <span class="string">。</span></span><br><span class="line"><span class="number">4</span><span class="string">.删除网卡上面的相关配置:将之前命令中的</span> <span class="string">add</span> <span class="string">改为</span> <span class="string">del</span> <span class="string">即可删除配置:</span></span><br><span class="line"><span class="comment"># tc qdisc del dev eth0 XXXXXXXXXXX(自己加的配置)该命令将 删除 eth0 网卡的相关传输配置</span></span><br><span class="line"><span class="string">至此,我们已经可以通过</span> <span class="string">TC</span> <span class="string">在测试环境中模拟一定的网络延时和丢包的情况。下面是关于tc</span> <span class="string">更多的应用和介绍</span></span><br><span class="line"><span class="number">5</span> <span class="string">模拟包重复:</span></span><br><span class="line"><span class="comment"># tc qdisc add dev eth0 root netem duplicate 1%</span></span><br><span class="line"><span class="string">该命令将</span> <span class="string">eth0</span> <span class="string">网卡的传输设置为随机产生</span> <span class="number">1</span><span class="string">%</span> <span class="string">的重复数据包</span> <span class="string">。6</span> <span class="string">模拟数据包损坏:</span></span><br><span class="line"><span class="comment"># tc qdisc add dev eth0 root netem corrupt 0.2%</span></span><br><span class="line"><span class="string">该命令将</span> <span class="string">eth0</span> <span class="string">网卡的传输设置为随机产生</span> <span class="number">0.2</span><span class="string">%</span> <span class="string">的损坏的数据包</span> <span class="string">。</span> <span class="string">(内核版本需在</span> <span class="number">2.6</span><span class="number">.16</span> <span class="string">以上)</span></span><br><span class="line"><span class="number">7</span> <span class="string">模拟数据包乱序:</span></span><br><span class="line"><span class="comment"># tc qdisc change dev eth0 root netem delay 10ms reorder 25% 50%</span></span><br><span class="line"><span class="string">该命令将</span> <span class="string">eth0</span> <span class="string">网卡的传输设置为:有</span> <span class="number">25</span><span class="string">%</span> <span class="string">的数据包(50%相关)会被立即发送,其他的延迟10</span> <span class="string">秒。</span></span><br><span class="line"><span class="string">新版本中,如下命令也会在一定程度上打乱发包的次序:#</span> <span class="string">tc</span> <span class="string">qdisc</span> <span class="string">add</span> <span class="string">dev</span> <span class="string">eth0</span> <span class="string">root</span> <span class="string">netem</span> <span class="string">delay</span> <span class="string">100ms</span> <span class="string">10ms</span></span><br><span class="line"><span class="number">8</span> <span class="string">查看已经配置的网络条件:#</span> <span class="string">tc</span> <span class="string">qdisc</span> <span class="string">show</span> <span class="string">dev</span> <span class="string">eth0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">查看：</span></span><br><span class="line"><span class="string">tc</span> <span class="string">qdisc</span> <span class="string">ls</span> <span class="string">dev</span> <span class="string">eth0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">、限制eth0网卡的带宽为50kbit：</span></span><br><span class="line"><span class="string">/sbin/tc</span> <span class="string">qdisc</span> <span class="string">add</span> <span class="string">dev</span> <span class="string">eth0</span> <span class="string">root</span> <span class="string">tbf</span> <span class="string">rate</span> <span class="string">50kbit</span> <span class="string">latency</span> <span class="string">50ms</span> <span class="string">burst</span> <span class="number">1000</span> </span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="string">、限制带宽为50kbit后，在百兆局域网中wget下载一个大文件：</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">~]#</span> <span class="string">wget</span> <span class="string">http://192.168.1.7/test.zip</span> </span><br><span class="line"><span class="string">--19:40:27--</span>  <span class="string">http://192.168.1.7/test.zip</span></span><br><span class="line"><span class="string">Connecting</span> <span class="string">to</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.7</span><span class="string">:80...</span> <span class="string">connected.</span></span><br><span class="line"><span class="string">HTTP</span> <span class="string">request</span> <span class="string">sent,</span> <span class="string">awaiting</span> <span class="string">response...</span> <span class="number">200</span> <span class="string">OK</span></span><br><span class="line"><span class="attr">Length:</span> <span class="number">23862312</span> <span class="string">(23M)</span> <span class="string">[application/zip]</span></span><br><span class="line"><span class="attr">Saving to:</span> <span class="string">`test.zip'</span></span><br><span class="line"></span><br><span class="line"><span class="number">37</span><span class="string">%</span> <span class="string">[=======&gt;</span>   <span class="string">]</span> <span class="number">8</span><span class="string">,994,816</span>     <span class="string">457K/s</span>   <span class="string">eta</span> <span class="string">27s</span> </span><br><span class="line"><span class="string">下载速度为457K/s，限制效果达到。</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span><span class="string">、解除eth0网卡的带宽限制：</span></span><br><span class="line"><span class="string">/sbin/tc</span> <span class="string">qdisc</span> <span class="string">del</span> <span class="string">dev</span> <span class="string">eth0</span> <span class="string">root</span> <span class="string">tbf</span> </span><br><span class="line"></span><br><span class="line"><span class="number">5</span><span class="string">、对比：未作带宽限制情况下，在百兆局域网中wget下载一个大文件：</span></span><br><span class="line"><span class="string">[root@localhost</span> <span class="string">~]#</span> <span class="string">wget</span> <span class="string">http://192.168.1.7/test.zip</span>    </span><br><span class="line"><span class="string">--19:44:33--</span>  <span class="string">http://192.168.1.7/test.zip</span></span><br><span class="line"><span class="string">Connecting</span> <span class="string">to</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.7</span><span class="string">:80...</span> <span class="string">connected.</span></span><br><span class="line"><span class="string">HTTP</span> <span class="string">request</span> <span class="string">sent,</span> <span class="string">awaiting</span> <span class="string">response...</span> <span class="number">200</span> <span class="string">OK</span></span><br><span class="line"><span class="attr">Length:</span> <span class="number">23862312</span> <span class="string">(23M)</span> <span class="string">[application/zip]</span></span><br><span class="line"><span class="attr">Saving to:</span> <span class="string">`test.zip'</span></span><br><span class="line"></span><br><span class="line"><span class="number">100</span><span class="string">%[==========&gt;]</span> <span class="number">23</span><span class="string">,862,312</span>   <span class="number">6.</span><span class="string">14M/s</span>   <span class="string">in</span> <span class="number">3.</span><span class="string">7s</span>   </span><br><span class="line"></span><br><span class="line"><span class="number">19</span><span class="string">:44:36</span> <span class="string">(6.16</span> <span class="string">MB/s)</span> <span class="bullet">-</span> <span class="string">`test.zip'</span> <span class="string">saved</span> <span class="string">[23862312/23862312]</span> </span><br><span class="line"><span class="string">下载速度为6.16MB/s。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">from</span> <span class="string">blog.s135.com</span> <span class="string">张宴</span></span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Linux 中模拟延时和丢包的实现</span><br><span class="line">使用ifconfig命令查看网卡</span><br><span class="line">Linux 中使用 tc 进行流量管理。具体命令的使用参考 tc 的 man 手册，这里简单记录一下使用 tc 模拟延时和丢包的命令。</span><br><span class="line">ping出来的最小单位为<span class="number">1</span>毫秒，在执行压测之前，最好用压力机ping一下服务器，如果延迟很高，就没必要测了，因为请求还没发出去都已经有一段时间的消耗了</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="number">1.</span> 延时</span><br><span class="line">（<span class="number">1</span>）设置延时：给 eth0 设备发包时添加 <span class="number">30</span>ms 的延时（从网卡）。tc qdisc add dev eth0 root netem delay <span class="number">30</span>ms</span><br><span class="line">（<span class="number">2</span>）显示延时的设置：tc qdisc show</span><br><span class="line">ping一下，看结果</span><br><span class="line">（<span class="number">3</span>） 修改延时：tc qdisc change dev eth0 root netem delay <span class="number">40</span>ms</span><br><span class="line">（<span class="number">4</span>） 删除延时的配置：tc qdisc del dev eth0 root netem delay <span class="number">40</span>ms</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 丢包</span><br><span class="line">设置丢包命令如下：tc qdisc add dev eth0 root netem loss <span class="number">10</span>%（丢<span class="number">10</span>%的包，这里可以按实际情况设置）</span><br><span class="line">ping一下，每过一段时间就会有一次请求超时，出现概率就是上面设置的概率</span><br><span class="line">如果是通过 SSH 登录设备进行配置丢包的话，配置完这条命令就会感觉到机器访问时有点一卡一卡的。这说明，设备已经开始丢包了，可以通过具体抓包查看。 </span><br><span class="line">其他诸如修改、查看、删除的命令，都可以参考上面延时的设置。</span><br><span class="line"> </span><br><span class="line">不用了一定要删除设置，要不然会一直存在</span><br></pre></td></tr></table></figure>



<h2 id="长短链接"><a href="#长短链接" class="headerlink" title="长短链接"></a>长短链接</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、长短链接</span><br><span class="line">以后要是推测长短连接的问题，可以直接netstat 看端口变化频率就好了，不用费这么大劲抓包。。。傻愣愣的抓了半个下午。。。-_-||</span><br><span class="line">分域测试报<span class="number">500</span></span><br><span class="line"></span><br><span class="line">ps：如何查看是否是长短链接？？</span><br><span class="line">比如查看volume的链接：</span><br><span class="line">netstat -anpl|grep <span class="string">"10.244.76.84:8080"</span></span><br><span class="line">下图中的红框子里面的端口如果是短链接，变化会很快；如果是长连接，可能<span class="number">30</span>秒才变一次</span><br><span class="line">注释：curl命令走的就是短链接</span><br></pre></td></tr></table></figure>

<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/2008-01-02-linux-draft%5Cimage-20210629222344217.png" alt></p>
<h2 id="内存泄露"><a href="#内存泄露" class="headerlink" title="内存泄露"></a>内存泄露</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>sdosspststorage10 my]# ps -ef|grep fuse|grep -v grep</span><br><span class="line">root     <span class="number">10223</span>     <span class="number">1</span>  <span class="number">8</span> <span class="number">09</span>:<span class="number">04</span> ?        <span class="number">00</span>:<span class="number">53</span>:<span class="number">40</span> /mnt/data2/ossfuse/sdoss/weed -v=<span class="number">4</span> -http=<span class="literal">true</span> -log_dir=/mnt/data2/ossfuse/log ossfuse -bucket=fusebucket -mountpoint=/mnt/data2/ossfuse/test -ossendpoint=osspstxg.cnsuning.com</span><br><span class="line">[<span class="symbol">root@</span>sdosspststorage10 my]# top -p <span class="number">10223</span></span><br><span class="line">top - <span class="number">19</span>:<span class="number">28</span>:<span class="number">09</span> up <span class="number">178</span> days, <span class="number">23</span>:<span class="number">46</span>, <span class="number">10</span> users,  load average: <span class="number">1.37</span>, <span class="number">1.23</span>, <span class="number">1.18</span></span><br><span class="line">Tasks:   <span class="number">1</span> total,   <span class="number">0</span> running,   <span class="number">1</span> sleeping,   <span class="number">0</span> stopped,   <span class="number">0</span> zombie</span><br><span class="line">Cpu(s):  <span class="number">0.9</span>%us,  <span class="number">6.1</span>%sy,  <span class="number">0.0</span>%ni, <span class="number">92.9</span>%id,  <span class="number">0.0</span>%wa,  <span class="number">0.0</span>%hi,  <span class="number">0.0</span>%si,  <span class="number">0.1</span>%st</span><br><span class="line">Mem:  <span class="number">16334344</span>k total, <span class="number">15974360</span>k used,   <span class="number">359984</span>k free,    <span class="number">59644</span>k buffers</span><br><span class="line">Swap: <span class="number">10485752</span>k total,  <span class="number">5624620</span>k used,  <span class="number">4861132</span>k free,  <span class="number">3207248</span>k cached</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                                                                                                                                </span><br><span class="line"><span class="number">10223</span> root      <span class="number">20</span>   <span class="number">0</span> <span class="number">3031</span>m <span class="number">456</span>m <span class="number">3564</span> S  <span class="number">0.0</span>  <span class="number">2.9</span>  <span class="number">53</span>:<span class="number">40.33</span> weed </span><br><span class="line"></span><br><span class="line">RES值：应该变化不是太大，如果有增长，之后还是会降下来的，不降就是内存泄露</span><br></pre></td></tr></table></figure>



<h1 id="005-字符串"><a href="#005-字符串" class="headerlink" title="005-字符串"></a>005-字符串</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span>是没有opone的</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"sadnasjn"</span>  &gt;&gt; 1.txt</span><br></pre></td></tr></table></figure>

<h2 id="字符串大小写转换"><a href="#字符串大小写转换" class="headerlink" title="字符串大小写转换"></a>字符串大小写转换</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/loveyouyou616/p/10416507.html</span><br><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"><span class="comment"># 注意:脚本第一行一定要注明脚本解释器是bash.不能是sh,或dash</span></span><br><span class="line"><span class="comment"># 因为sh软连接有可能指向的是dash</span></span><br><span class="line">var=<span class="string">"Hello,Word"</span></span><br><span class="line"><span class="comment"># 把变量中的第一个字符换成大写 </span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var^&#125;</span> </span><br><span class="line"><span class="comment"># 把变量中的所有小写字母，全部替换为大写</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var^^&#125;</span>   </span><br><span class="line"><span class="comment"># 把变量中的第一个字符换成小写</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var,&#125;</span></span><br><span class="line"><span class="comment"># 把变量中的所有大写字母，全部替换为小写</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var,,&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="shuf命令-1"><a href="#shuf命令-1" class="headerlink" title="shuf命令"></a>shuf命令</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">shuf命令把输入行按随机顺序输出到标准输出。</span><br><span class="line"></span><br><span class="line">用法</span><br><span class="line">shuf [选项]... [文件]</span><br><span class="line">或者</span><br><span class="line">shuf -e [选项]... [参数]...</span><br><span class="line">又或者</span><br><span class="line">shuf -i LO-HI [选项]...</span><br><span class="line"></span><br><span class="line">常用参数</span><br><span class="line">-e, --echo</span><br><span class="line">将每个参数视为输入行</span><br><span class="line">-i, --input-range=LO-HI</span><br><span class="line">将LO 到HI 的每个数字视为输入行</span><br><span class="line">-n, --head-count=行数</span><br><span class="line">最多输出指定的行数</span><br><span class="line">-o, --output=文件</span><br><span class="line">将结果输出到指定文件而非标准输出</span><br><span class="line">--random-source=文件</span><br><span class="line">从指定文件获得随机比特</span><br><span class="line">-z, --zero-terminated</span><br><span class="line">以<span class="number">0</span> 结束行而非新行</span><br><span class="line">--help</span><br><span class="line">显示此帮助信息并退出</span><br><span class="line">--version</span><br><span class="line">显示版本信息并退出</span><br><span class="line">如果没有指定文件，或者文件为<span class="string">"-"</span>，则从标准输入读取。</span><br><span class="line"></span><br><span class="line">我有一个名为 ostechnix.txt 的文件，内容如下：</span><br><span class="line">$ cat ostechnix.txt</span><br><span class="line">line1</span><br><span class="line">line2</span><br><span class="line">line3</span><br><span class="line">line4</span><br><span class="line">line5</span><br><span class="line">line6</span><br><span class="line">line7</span><br><span class="line">line8</span><br><span class="line">line9</span><br><span class="line">line10</span><br><span class="line">现在让我们以随机顺序显示上面的行。为此，请运行：</span><br><span class="line">$ shuf ostechnix.txt</span><br><span class="line">line2</span><br><span class="line">line8</span><br><span class="line">line5</span><br><span class="line">line10</span><br><span class="line">line7</span><br><span class="line">line1</span><br><span class="line">line4</span><br><span class="line">line6</span><br><span class="line">line9</span><br><span class="line">line3</span><br><span class="line">看到了吗？上面的命令将名为 ostechnix.txt 中的行随机排列并输出了结果。</span><br><span class="line"></span><br><span class="line">你可能想将输出写入另一个文件。例如，我想将输出保存到 output.txt 中。为此，请先创建 output.txt：</span><br><span class="line">$ <span class="section">touch</span> output.txt</span><br><span class="line">然后，像下面使用 -o 标志将输出写入该文件：</span><br><span class="line">$ shuf ostechnix.txt -o output.txt</span><br><span class="line">上面的命令将随机随机打乱 ostechnix.txt 的内容并将输出写入 output.txt。你可以使用命令查看 output.txt 的内容：</span><br><span class="line">$ cat output.txt</span><br><span class="line">line2</span><br><span class="line">line8</span><br><span class="line">line9</span><br><span class="line">line10</span><br><span class="line">line1</span><br><span class="line">line3</span><br><span class="line">line7</span><br><span class="line">line6</span><br><span class="line">line4</span><br><span class="line">line5</span><br><span class="line">我只想显示文件中的任意一行。我该怎么做？很简单！</span><br><span class="line">$ shuf -n <span class="number">1</span> ostechnix.txt</span><br><span class="line">line6</span><br><span class="line">同样，我们可以选择前 “n” 个随机条目。以下命令将只显示前五个随机条目：</span><br><span class="line">$ shuf -n <span class="number">5</span> ostechnix.txt</span><br><span class="line">line10</span><br><span class="line">line4</span><br><span class="line">line5</span><br><span class="line">line9</span><br><span class="line">line3</span><br><span class="line">如下所示，我们可以直接使用 -e 标志传入输入，而不是从文件中读取行：</span><br><span class="line">$ shuf -e line1 line2 line3 line4 line5</span><br><span class="line">line1</span><br><span class="line">line3</span><br><span class="line">line5</span><br><span class="line">line4</span><br><span class="line">line2</span><br><span class="line">你也可以传入数字：</span><br><span class="line">$ shuf -e <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">要快速在给定范围选择一个，请改用此命令：</span><br><span class="line">$ shuf -n <span class="number">1</span> -e <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></span><br><span class="line">或者，选择下面的任意三个随机数字：</span><br><span class="line">$ shuf -n <span class="number">3</span> -e <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">我们也可以在特定范围内生成随机数。例如，要显示 <span class="number">1</span> 到 <span class="number">10</span> 之间的随机数，只需使用：</span><br><span class="line">$ shuf -i <span class="number">1</span><span class="number">-10</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>



<h2 id="Linux-的字符串截取"><a href="#Linux-的字符串截取" class="headerlink" title="Linux 的字符串截取"></a>Linux 的字符串截取</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/shizhijie/p/8297840.html</span><br><span class="line">假设有变量 var=http://www.aaa.com/123.htm</span><br><span class="line"></span><br><span class="line">1. <span class="comment"># 号截取，删除左边字符，保留右边字符。</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var#*//&#125;</span></span><br><span class="line">其中 var 是变量名，<span class="comment"># 号是运算符，*// 表示从左边开始删除第一个 // 号及左边的所有字符</span></span><br><span class="line">即删除 http://</span><br><span class="line">结果是 ：www.aaa.com/123.htm</span><br><span class="line"></span><br><span class="line">2. <span class="comment">## 号截取，删除左边字符，保留右边字符。</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var##*/&#125;</span></span><br><span class="line"><span class="comment">##*/ 表示从左边开始删除最后（最右边）一个 / 号及左边的所有字符</span></span><br><span class="line">即删除 http://www.aaa.com/</span><br><span class="line">结果是 123.htm</span><br><span class="line"></span><br><span class="line">3. %号截取，删除右边字符，保留左边字符</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var%/*&#125;</span></span><br><span class="line">%/* 表示从右边开始，删除第一个 / 号及右边的字符</span><br><span class="line">结果是：http://www.aaa.com</span><br><span class="line"></span><br><span class="line">4. %% 号截取，删除右边字符，保留左边字符</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var%%/*&#125;</span></span><br><span class="line">%%/* 表示从右边开始，删除最后（最左边）一个 / 号及右边的字符</span><br><span class="line">结果是：http:</span><br><span class="line"></span><br><span class="line">5. 从左边第几个字符开始，及字符的个数</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var:0:5&#125;</span></span><br><span class="line">其中的 0 表示左边第一个字符开始，5 表示字符的总个数。</span><br><span class="line">结果是：http:</span><br><span class="line"></span><br><span class="line">6. 从左边第几个字符开始，一直到结束。</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var:7&#125;</span></span><br><span class="line">其中的 7 表示左边第8个字符开始，一直到结束。</span><br><span class="line">结果是 ：www.aaa.com/123.htm</span><br><span class="line"></span><br><span class="line">7. 从右边第几个字符开始，及字符的个数</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var:0-7:3&#125;</span></span><br><span class="line">其中的 0-7 表示右边算起第七个字符开始，3 表示字符的个数。</span><br><span class="line">结果是：123</span><br><span class="line"></span><br><span class="line">8. 从右边第几个字符开始，一直到结束。</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var:0-7&#125;</span></span><br><span class="line">表示从右边第七个字符开始，一直到结束。</span><br><span class="line">结果是：123.htm</span><br><span class="line"></span><br><span class="line">注：（左边的第一个字符是用 0 表示，右边的第一个字符用 0-1 表示）</span><br><span class="line"></span><br><span class="line">su226</span><br><span class="line">   su226</span><br><span class="line"></span><br><span class="line">  136***1939@qq.com</span><br><span class="line"></span><br><span class="line">   参考地址</span><br><span class="line"></span><br><span class="line">9个月前 (04-23)</span><br><span class="line">   wenxin667</span><br><span class="line"></span><br><span class="line">  140***2918@qq.com</span><br><span class="line"></span><br><span class="line">@su226</span><br><span class="line"></span><br><span class="line">描述的有点儿不容易懂，看了好久才勉强明白 <span class="comment"># ## % %%。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#、## 表示从左边开始删除。一个 # 表示从左边删除到第一个指定的字符；两个 # 表示从左边删除到最后一个指定的字符。</span></span><br><span class="line"></span><br><span class="line">%、%% 表示从右边开始删除。一个 % 表示从右边删除到第一个指定的字符；两个 % 表示从左边删除到最后一个指定的字符。</span><br><span class="line"></span><br><span class="line">删除包括了指定的字符本身。</span><br><span class="line"></span><br><span class="line">wenxin667</span><br><span class="line">   wenxin667</span><br><span class="line"></span><br><span class="line">  140***2918@qq.com</span><br><span class="line"></span><br><span class="line">5个月前 (08-24)</span><br><span class="line">   amau</span><br><span class="line"></span><br><span class="line">  1@1***t</span><br><span class="line"></span><br><span class="line"><span class="meta">#!bin/bash</span></span><br><span class="line"><span class="comment">#author:amau</span></span><br><span class="line"></span><br><span class="line">var=<span class="string">"http://www.runoob.com/linux/linux-shell-variable.html"</span></span><br><span class="line"></span><br><span class="line">s1=<span class="variable">$&#123;var%%t*&#125;</span></span><br><span class="line">s2=<span class="variable">$&#123;var%t*&#125;</span></span><br><span class="line">s3=<span class="variable">$&#123;var%%.*&#125;</span></span><br><span class="line">s4=<span class="variable">$&#123;var#*/&#125;</span></span><br><span class="line">s5=<span class="variable">$&#123;var##*/&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"关于字符串的截取%，#的使用方法"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"原字符串为："</span><span class="variable">$&#123;var&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"%%t*的效果："</span><span class="variable">$&#123;s1&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"%t*的效果："</span><span class="variable">$&#123;s2&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"%%.*的效果："</span><span class="variable">$&#123;s3&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"#*/的效果："</span><span class="variable">$&#123;s4&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"##*/的效果："</span><span class="variable">$&#123;s5&#125;</span></span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line"></span><br><span class="line">关于字符串的截取%，<span class="comment">#的使用方法</span></span><br><span class="line">原字符串为：http://www.runoob.com/linux/linux-shell-variable.html</span><br><span class="line">%%t*的效果：h</span><br><span class="line">%t*的效果：http://www.runoob.com/linux/linux-shell-variable.h</span><br><span class="line">%%.*的效果：http://www</span><br><span class="line"><span class="comment">#*/的效果：/www.runoob.com/linux/linux-shell-variable.html</span></span><br><span class="line"><span class="comment">##*/的效果：linux-shell-variable.html</span></span><br></pre></td></tr></table></figure>



<h1 id="006-数据库"><a href="#006-数据库" class="headerlink" title="006-数据库"></a>006-数据库</h1><h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> filemap <span class="keyword">limit</span> <span class="number">1</span>\G</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">8.show <span class="keyword">slave</span> <span class="keyword">status</span>命令可以显示主从同步的状态</span><br><span class="line">echo <span class="string">"show slave status\G"</span>|/home/mysql/<span class="keyword">bin</span>/mysql -uroot -p123321 -S /mysql/<span class="keyword">data</span>/mysql.sock|grep <span class="string">"Slave_SQL_Running_State"</span></span><br><span class="line">echo <span class="string">"show slave status\G"</span>|mysql -uroot -p123321|grep <span class="string">"Slave_SQL_Running_State"</span></span><br><span class="line">如何判断主从完全同步：</span><br><span class="line">Master_Log_File和Relay_Master_Log_File所指向的文件必须一致</span><br><span class="line">Relay_Log_Pos和Exec_Master_Log_Pos的为止也要一致才行</span><br><span class="line">Slave_SQL_Running_State：显示为<span class="keyword">wait</span> 意思是中继日志的<span class="keyword">sql</span>语句已经全部执行完毕</span><br></pre></td></tr></table></figure>

<figure class="highlight stan"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.如何判断mysql是否有延迟：</span><br><span class="line"><span class="built_in">tail</span> -f /mysql/<span class="title">data</span>/sdosspststorage10-slow.<span class="built_in">log</span></span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">查看mysql连接数：</span><br><span class="line"> 方法一：mysqladmin -uroot -p123321 status</span><br><span class="line"> Uptime: 4649444  Threads: 449（当前连接数） Questions: 166498580  Slow queries: 533  Opens: 3013585  Flush tables: 1  Open tables: 2048  Queries per second avg: 35.810</span><br><span class="line"> </span><br><span class="line">方法二：[root@sdosspststorage10 data]# mysql -uroot -p123321 -e <span class="string">'show status'</span> | grep -i  Threads </span><br><span class="line">mysql: [<span class="builtin-name">Warning</span>] Using a password on the command line<span class="built_in"> interface </span>can be insecure.</span><br><span class="line">Delayed_insert_threads	0</span><br><span class="line">Slow_launch_threads	0</span><br><span class="line">Threadpool_idle_threads	0</span><br><span class="line">Threadpool_threads	0</span><br><span class="line">Threads_cached	2</span><br><span class="line">Threads_connected	447</span><br><span class="line">Threads_created	12559</span><br><span class="line">Threads_running	2	##（当前连接数）</span><br><span class="line"></span><br><span class="line">33.查看最大连接数</span><br><span class="line">mysql -uroot -p123321 -e <span class="string">'show variables'</span> | grep max_connections</span><br><span class="line">[root@sdosspststorage10 data]# mysql -uroot -p123321 -e <span class="string">'show variables'</span> | grep max_connections</span><br><span class="line">mysql: [<span class="builtin-name">Warning</span>] Using a password on the command line<span class="built_in"> interface </span>can be insecure.</span><br><span class="line">extra_max_connections	1</span><br><span class="line">max_connections	1000</span><br></pre></td></tr></table></figure>

<p>mysql倒序：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> measure_ottcache_error_5minutes_data <span class="keyword">order</span> <span class="keyword">by</span> stattime <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>



<h2 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5.</span>redis密码：</span><br><span class="line">cat /etc/redis/<span class="number">6381.</span>conf |grep requirepass</span><br><span class="line"><span class="number">6.</span>redis登录方式：</span><br><span class="line">/usr/local/bin/redis-cli -h <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -p <span class="number">6381</span> -a go-redis</span><br><span class="line"><span class="number">7.</span>shell页面直接查看reids</span><br><span class="line">echo <span class="string">"keys *"</span>|/usr/local/bin/redis-cli -h <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -p <span class="number">6381</span> -a go-redis |grep wxt</span><br><span class="line"><span class="number">16.</span>redis配置文件目录：/etc/redis</span><br><span class="line">redis内存上限：如</span><br><span class="line">cat <span class="number">6381.</span>conf|grep <span class="string">"maxmemory"</span></span><br><span class="line"><span class="number">17.</span>redis重启</span><br><span class="line">redis-server /etc/redis/<span class="number">6379.</span>conf</span><br></pre></td></tr></table></figure>



<h1 id="007-系统"><a href="#007-系统" class="headerlink" title="007-系统"></a>007-系统</h1><h2 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmd</span><span class="bash">计算器：calc</span></span><br><span class="line">tasklist</span><br><span class="line">taskkill /pid <span class="number">69595</span> /f</span><br><span class="line">window+R  mstsc</span><br></pre></td></tr></table></figure>



<h2 id="last"><a href="#last" class="headerlink" title="last"></a>last</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">last 命令介绍</span><br><span class="line">　　功能说明：列出目前与过去登入系统的用户相关信息。</span><br><span class="line">　　语　　法：last [-adRx][-f &lt;记录文件&gt;][-n &lt;显示列数&gt;][帐号名称...][终端机编号...]</span><br><span class="line">　　补充说明：单独执行last指令，它会读取位于/var/log目录下，名称为wtmp的文件，并把该给文件的内容记录的登入系统的用户名单全部显示出来。</span><br><span class="line"></span><br><span class="line">　　参　　数：</span><br><span class="line">　　-a 　把从何处登入系统的主机名称或IP地址，显示在最后一行。</span><br><span class="line">　　-d 　将IP地址转换成主机名称。</span><br><span class="line">　　-f &lt;记录文件&gt; 　指定记录文件。</span><br><span class="line">　　-n &lt;显示列数&gt;或-&lt;显示列数&gt; 　设置列出名单的显示列数。</span><br><span class="line">　　-R 　不显示登入系统的主机名称或IP地址。</span><br><span class="line">　　-x 　显示系统关机，重新开机，以及执行等级的改变等信息。</span><br><span class="line"></span><br><span class="line">last 命令：</span><br><span class="line">功能说明：列出目前与过去登入系统的用户相关信息。</span><br><span class="line">＝＝＝＝＝＝＝＝测试环境： Fedora Core <span class="number">6.0</span>；内核：<span class="number">2.6</span><span class="number">.18</span>＝＝＝＝＝＝＝＝</span><br><span class="line"></span><br><span class="line">#last用了显示用户登录情况。以下是直接显示固定行数的记录。kkk是新建的用户。</span><br><span class="line">[<span class="symbol">kkk@</span>localhost ~]$ last <span class="number">-6</span></span><br><span class="line">kkk     pts/<span class="number">2</span>        :<span class="number">0.0</span>             Thu Jul <span class="number">26</span> <span class="number">20</span>:<span class="number">48</span>   still logged <span class="keyword">in</span>   </span><br><span class="line">kkk     pts/<span class="number">2</span>        :<span class="number">0.0</span>             Thu Jul <span class="number">26</span> <span class="number">20</span>:<span class="number">21</span> - <span class="number">20</span>:<span class="number">21</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">kkk     :<span class="number">0</span>                            Thu Jul <span class="number">26</span> <span class="number">20</span>:<span class="number">21</span>   still logged <span class="keyword">in</span>   </span><br><span class="line">reboot   system boot <span class="number">2.6</span><span class="number">.18</span><span class="number">-1.2798</span>.fc Thu Jul <span class="number">26</span> <span class="number">20</span>:<span class="number">20</span>          (<span class="number">00</span>:<span class="number">41</span>)    </span><br><span class="line">kkk     pts/<span class="number">2</span>        :<span class="number">0.0</span>             Thu Jul <span class="number">26</span> <span class="number">11</span>:<span class="number">16</span> - <span class="number">11</span>:<span class="number">46</span> (<span class="number">00</span>:<span class="number">30</span>)    </span><br><span class="line">kkk     pts/<span class="number">2</span>        :<span class="number">0.0</span>             Thu Jul <span class="number">26</span> <span class="number">10</span>:<span class="number">18</span> - <span class="number">10</span>:<span class="number">18</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line"></span><br><span class="line">wtmp begins Sun Jul <span class="number">1</span> <span class="number">15</span>:<span class="number">17</span>:<span class="number">08</span> <span class="number">2007</span></span><br><span class="line"></span><br><span class="line">#默认是显示wtmp的记录，btmp能显示的更详细，可以显示远程登录，例如ssh登录。</span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# last -n <span class="number">15</span> -f /var/log/btmp</span><br><span class="line">kkk     :<span class="number">0</span>                            Thu Jul <span class="number">26</span> <span class="number">20</span>:<span class="number">21</span>   still logged <span class="keyword">in</span>   </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">27</span>    gone - no logout </span><br><span class="line">np962e76 tty1                          Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">26</span> - <span class="number">22</span>:<span class="number">27</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">26</span> - <span class="number">22</span>:<span class="number">26</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">root     :<span class="number">0</span>                            Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">22</span> - <span class="number">20</span>:<span class="number">21</span> (<span class="number">5</span>+<span class="number">21</span>:<span class="number">58</span>)   </span><br><span class="line">klot     :<span class="number">0</span>                            Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">22</span> - <span class="number">22</span>:<span class="number">22</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">root     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">58</span> - <span class="number">22</span>:<span class="number">26</span> (<span class="number">01</span>:<span class="number">28</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">58</span> - <span class="number">20</span>:<span class="number">58</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">58</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">reboot   tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">55</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">02</span>)    </span><br><span class="line">root     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">54</span> - <span class="number">20</span>:<span class="number">55</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">root     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">54</span> - <span class="number">20</span>:<span class="number">54</span> (<span class="number">00</span>:<span class="number">00</span>) </span><br><span class="line">btmp begins Mon Apr <span class="number">30</span> <span class="number">22</span>:<span class="number">05</span>:<span class="number">54</span> <span class="number">2007</span></span><br><span class="line">#显示特定tty口的登录，<span class="number">1</span>是tty1的登录情况，看的很清楚的。 np962e76 和 lkdjflkj 和klot其实都没有登</span><br><span class="line">#录成功，我是把密码忘记了。前面两个用户，是根本不存在的，但是也有记录。</span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# last -n <span class="number">15</span> -f /var/log/btmp <span class="number">1</span></span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">27</span>    gone - no logout </span><br><span class="line">np962e76 tty1                          Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">26</span> - <span class="number">22</span>:<span class="number">27</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">26</span> - <span class="number">22</span>:<span class="number">26</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">root     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">58</span> - <span class="number">22</span>:<span class="number">26</span> (<span class="number">01</span>:<span class="number">28</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">58</span> - <span class="number">20</span>:<span class="number">58</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">58</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">reboot   tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">55</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">02</span>)    </span><br><span class="line">root     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">54</span> - <span class="number">20</span>:<span class="number">55</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">root     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">54</span> - <span class="number">20</span>:<span class="number">54</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">root     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">54</span> - <span class="number">20</span>:<span class="number">54</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">lkdjflkj tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">54</span> - <span class="number">20</span>:<span class="number">54</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">53</span> - <span class="number">20</span>:<span class="number">54</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line"></span><br><span class="line">btmp begins Mon Apr <span class="number">30</span> <span class="number">22</span>:<span class="number">05</span>:<span class="number">54</span> <span class="number">2007</span></span><br><span class="line">#显示特定用户的登录情况。</span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# last -n <span class="number">15</span> -f /var/log/btmp klot</span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">27</span>    gone - no logout </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">26</span> - <span class="number">22</span>:<span class="number">26</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     :<span class="number">0</span>                            Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">22</span> - <span class="number">22</span>:<span class="number">22</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">58</span> - <span class="number">20</span>:<span class="number">58</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">58</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">53</span> - <span class="number">20</span>:<span class="number">54</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">53</span> - <span class="number">20</span>:<span class="number">53</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">53</span> - <span class="number">20</span>:<span class="number">53</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">53</span> - <span class="number">20</span>:<span class="number">53</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">52</span> - <span class="number">20</span>:<span class="number">53</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">52</span> - <span class="number">20</span>:<span class="number">52</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">52</span> - <span class="number">20</span>:<span class="number">52</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line"></span><br><span class="line">btmp begins Mon Apr <span class="number">30</span> <span class="number">22</span>:<span class="number">05</span>:<span class="number">54</span> <span class="number">2007</span></span><br><span class="line">#显示登录登出的记录，-x。</span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# last -n <span class="number">15</span> -f /var/log/btmp klot -x</span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">27</span>    gone - no logout </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">26</span> - <span class="number">22</span>:<span class="number">26</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     :<span class="number">0</span>                            Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">22</span> - <span class="number">22</span>:<span class="number">22</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">58</span> - <span class="number">20</span>:<span class="number">58</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">58</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">53</span> - <span class="number">20</span>:<span class="number">54</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">53</span> - <span class="number">20</span>:<span class="number">53</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">53</span> - <span class="number">20</span>:<span class="number">53</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">53</span> - <span class="number">20</span>:<span class="number">53</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">52</span> - <span class="number">20</span>:<span class="number">53</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">52</span> - <span class="number">20</span>:<span class="number">52</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1                          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">52</span> - <span class="number">20</span>:<span class="number">52</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line"></span><br><span class="line">btmp begins Mon Apr <span class="number">30</span> <span class="number">22</span>:<span class="number">05</span>:<span class="number">54</span> <span class="number">2007</span></span><br><span class="line">#-i显示特定ip登录的情况。跟踪用。</span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# last -n <span class="number">15</span> -i <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -f /var/log/btmp klot</span><br><span class="line">klot     tty1         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">27</span>    gone - no logout </span><br><span class="line">klot     tty1         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">26</span> - <span class="number">22</span>:<span class="number">26</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     :<span class="number">0</span>           <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">22</span>:<span class="number">22</span> - <span class="number">22</span>:<span class="number">22</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">58</span> - <span class="number">20</span>:<span class="number">58</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">58</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">57</span> - <span class="number">20</span>:<span class="number">57</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">53</span> - <span class="number">20</span>:<span class="number">54</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">53</span> - <span class="number">20</span>:<span class="number">53</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">53</span> - <span class="number">20</span>:<span class="number">53</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">53</span> - <span class="number">20</span>:<span class="number">53</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">52</span> - <span class="number">20</span>:<span class="number">53</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">52</span> - <span class="number">20</span>:<span class="number">52</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line">klot     tty1         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>          Fri Jul <span class="number">20</span> <span class="number">20</span>:<span class="number">52</span> - <span class="number">20</span>:<span class="number">52</span> (<span class="number">00</span>:<span class="number">00</span>)    </span><br><span class="line"></span><br><span class="line">btmp begins Mon Apr <span class="number">30</span> <span class="number">22</span>:<span class="number">05</span>:<span class="number">54</span> <span class="number">2007</span></span><br></pre></td></tr></table></figure>



<h2 id="时间同步"><a href="#时间同步" class="headerlink" title="时间同步"></a>时间同步</h2><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">chrond</span></span><br></pre></td></tr></table></figure>



<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ntpdate</span></span><br></pre></td></tr></table></figure>



<h2 id="自定义linux命令"><a href="#自定义linux命令" class="headerlink" title="自定义linux命令"></a>自定义linux命令</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">6</span>、linux命令：</span><br><span class="line">将脚本放到 <span class="regexp">/usr/</span>local<span class="regexp">/sbin/</span>目录下可以作为命令使用</span><br></pre></td></tr></table></figure>

<h2 id="关闭swap"><a href="#关闭swap" class="headerlink" title="关闭swap"></a>关闭swap</h2><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>关闭<span class="keyword">swap</span>：</span><br><span class="line">可以执行命令刷新一次<span class="keyword">SWAP</span>（将<span class="keyword">SWAP</span>里的数据转储回内存，并清空<span class="keyword">SWAP</span>里的数据）</span><br><span class="line">swapoff -a</span><br><span class="line">sysctl -p  (执行这个使其生效，不用重启)</span><br></pre></td></tr></table></figure>

<h2 id="etc-rc-local：开机执行"><a href="#etc-rc-local：开机执行" class="headerlink" title="/etc/rc.local：开机执行"></a>/etc/rc.local：开机执行</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将脚本执行命令：/etc/rc.<span class="keyword">local</span>里，开机自动执行</span><br></pre></td></tr></table></figure>



<h2 id="系统配置"><a href="#系统配置" class="headerlink" title="系统配置"></a>系统配置</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">一些常识背景：</span><br><span class="line"><span class="meta"># 总核数 = 物理CPU个数 X 每颗物理CPU的核数 </span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 总逻辑CPU数 = 物理CPU个数 X 每颗物理CPU的核数 X 超线程数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 查看物理CPU个数</span></span><br><span class="line">cat <span class="meta-keyword">/proc/</span>cpuinfo| grep <span class="string">"physical id"</span>| sort| uniq| wc -l</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 查看每个物理CPU中core的个数(即核数)</span></span><br><span class="line">cat <span class="meta-keyword">/proc/</span>cpuinfo| grep <span class="string">"cpu cores"</span>| uniq</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 查看逻辑CPU的个数</span></span><br><span class="line"></span><br><span class="line">cat <span class="meta-keyword">/proc/</span>cpuinfo| grep <span class="string">"processor"</span>| wc -l</span><br><span class="line"> 查看CPU信息（型号）</span><br><span class="line">cat <span class="meta-keyword">/proc/</span>cpuinfo | grep name | cut -f2 -d: | uniq -c</span><br><span class="line"></span><br><span class="line"><span class="number">2.1</span> 查看内存总数</span><br><span class="line"><span class="meta">#cat /proc/meminfo | grep MemTotal</span></span><br><span class="line"><span class="symbol">MemTotal:</span> <span class="number">32941268</span> kB <span class="comment">//内存32G</span></span><br><span class="line"></span><br><span class="line">uname -a <span class="meta"># 查看内核/操作系统/CPU信息的linux系统信息  </span></span><br><span class="line">head -n l <span class="meta-keyword">/etc/</span>issue <span class="meta"># 查看操作系统版本  </span></span><br><span class="line">cat <span class="meta-keyword">/proc/</span>cpuinfo <span class="meta"># 查看CPU信息  </span></span><br><span class="line">hostname <span class="meta"># 查看计算机名的linux系统信息命令  </span></span><br><span class="line">lspci -tv <span class="meta"># 列出所有PCI设备   </span></span><br><span class="line">lsusb -tv <span class="meta"># 列出所有USB设备的linux系统信息命令  </span></span><br><span class="line">lsmod <span class="meta"># 列出加载的内核模块   </span></span><br><span class="line">env <span class="meta"># 查看环境变量资源  </span></span><br><span class="line">free -m <span class="meta"># 查看内存使用量和交换区使用量   </span></span><br><span class="line">df -h <span class="meta"># 查看各分区使用情况  </span></span><br><span class="line">du -sh <span class="meta"># 查看指定目录的大小   </span></span><br><span class="line">grep MemTotal <span class="meta-keyword">/proc/</span>meminfo <span class="meta"># 查看内存总量  </span></span><br><span class="line">grep MemFree <span class="meta-keyword">/proc/</span>meminfo <span class="meta"># 查看空闲内存量   </span></span><br><span class="line">uptime <span class="meta"># 查看系统运行时间、用户数、负载  </span></span><br><span class="line">cat <span class="meta-keyword">/proc/</span>loadavg <span class="meta"># 查看系统负载磁盘和分区   </span></span><br><span class="line">mount | column -t <span class="meta"># 查看挂接的分区状态  </span></span><br><span class="line">fdisk -l <span class="meta"># 查看所有分区   </span></span><br><span class="line">swapon -s <span class="meta"># 查看所有交换分区  </span></span><br><span class="line">hdparm -i <span class="meta-keyword">/dev/</span>hda <span class="meta"># 查看磁盘参数(仅适用于IDE设备)   </span></span><br><span class="line">dmesg | grep IDE <span class="meta"># 查看启动时IDE设备检测状况网络  </span></span><br><span class="line">ifconfig <span class="meta"># 查看所有网络接口的属性   </span></span><br><span class="line">iptables -L <span class="meta"># 查看防火墙设置  </span></span><br><span class="line">route -n <span class="meta"># 查看路由表   </span></span><br><span class="line">netstat -lntp <span class="meta"># 查看所有监听端口  </span></span><br><span class="line">netstat -antp <span class="meta"># 查看所有已经建立的连接   </span></span><br><span class="line">netstat -s <span class="meta"># 查看网络统计信息进程  </span></span><br><span class="line">ps -ef <span class="meta"># 查看所有进程   </span></span><br><span class="line">top <span class="meta"># 实时显示进程状态用户  </span></span><br><span class="line">w <span class="meta"># 查看活动用户   </span></span><br><span class="line">id <span class="meta"># 查看指定用户信息  </span></span><br><span class="line">last <span class="meta"># 查看用户登录日志   </span></span><br><span class="line">cut -d: -f1 <span class="meta-keyword">/etc/</span>passwd <span class="meta"># 查看系统所有用户  </span></span><br><span class="line">cut -d: -f1 <span class="meta-keyword">/etc/</span>group <span class="meta"># 查看系统所有组   </span></span><br><span class="line">crontab -l <span class="meta"># 查看当前用户的计划任务服务  </span></span><br><span class="line">chkconfig –list <span class="meta"># 列出所有系统服务   </span></span><br><span class="line">chkconfig –list | grep on <span class="meta"># 列出所有启动的系统服务程序  </span></span><br><span class="line">rpm -qa <span class="meta"># 查看所有安装的软件包   </span></span><br><span class="line">cat <span class="meta-keyword">/proc/</span>cpuinfo ：查看CPU相关参数的linux系统命令  </span><br><span class="line">cat <span class="meta-keyword">/proc/</span>partitions ：查看linux硬盘和分区信息的系统信息命令   </span><br><span class="line">cat <span class="meta-keyword">/proc/</span>meminfo ：查看linux系统内存信息的linux系统命令  </span><br><span class="line">cat <span class="meta-keyword">/proc/</span>version ：查看版本，类似uname -r   </span><br><span class="line">cat <span class="meta-keyword">/proc/</span>ioports ：查看设备io端口  </span><br><span class="line">cat <span class="meta-keyword">/proc/</span>interrupts ：查看中断   </span><br><span class="line">cat <span class="meta-keyword">/proc/</span>pci ：查看pci设备的信息  </span><br><span class="line">cat <span class="meta-keyword">/proc/</span>swaps ：查看所有swap分区的信息</span><br></pre></td></tr></table></figure>



<h2 id="系统参数"><a href="#系统参数" class="headerlink" title="系统参数"></a>系统参数</h2><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph1 limits.d]<span class="comment"># cat /etc/security/limits.d/20-nproc.conf</span></span><br><span class="line"></span><br><span class="line">*  soft  nofile  <span class="number">51200</span></span><br><span class="line">*  hard  nofile  <span class="number">51200</span></span><br><span class="line">*  soft  nproc   <span class="number">11000</span></span><br><span class="line">root  soft   nproc   unlimited</span><br><span class="line"></span><br><span class="line">附件：</span><br><span class="line">cd /etc/security/limits.d/</span><br><span class="line">可能是<span class="number">20</span>-nproc.conf等，直接改就是了，下面拿<span class="number">90</span>举例</span><br><span class="line">nprocfile=/etc/security/limits.d/<span class="number">20</span>-nproc.conf</span><br><span class="line">echo <span class="string">""</span> &gt;  <span class="variable">$nproc</span>.conf</span><br><span class="line">echo <span class="string">"*  soft  nofile  51200"</span> &gt;&gt; <span class="variable">$nproc</span>.conf</span><br><span class="line">echo <span class="string">"*  hard  nofile  51200"</span> &gt;&gt; <span class="variable">$nproc</span>.conf</span><br><span class="line">echo <span class="string">"*  soft  nproc   11000"</span> &gt;&gt; <span class="variable">$nproc</span>.conf</span><br><span class="line">echo <span class="string">"root  soft   nproc   unlimited"</span> &gt;&gt; <span class="variable">$nproc</span>.conf</span><br><span class="line"></span><br><span class="line">soft nproc: 可打开的文件描述符的最大数(软限制)</span><br><span class="line">hard nproc： 可打开的文件描述符的最大数(硬限制)</span><br><span class="line">soft nofile：单个用户可用的最大进程数量(软限制)</span><br><span class="line">hard nofile：单个用户可用的最大进程数量(硬限制)</span><br><span class="line"></span><br><span class="line">参数：</span><br><span class="line">-a：显示目前资源限制的设定；</span><br><span class="line"></span><br><span class="line">-c <span class="variable">&lt;core文件上限&gt;</span>：设定core文件的最大值，单位为区块；</span><br><span class="line">-</span><br><span class="line">-d <span class="variable">&lt;数据节区大小&gt;</span>：程序数据节区的最大值，单位为KB；</span><br><span class="line">-</span><br><span class="line">-f <span class="variable">&lt;文件大小&gt;</span>：shell所能建立的最大文件，单位为区块；</span><br><span class="line">-</span><br><span class="line">-H：设定资源的硬性限制，也就是管理员所设下的限制；</span><br><span class="line">-</span><br><span class="line">-m <span class="variable">&lt;内存大小&gt;</span>：指定可使用内存的上限，单位为KB；</span><br><span class="line">-</span><br><span class="line">-n <span class="variable">&lt;文件数目&gt;</span>：指定同一时间最多可开启的文件数；</span><br><span class="line">-</span><br><span class="line">-p <span class="variable">&lt;缓冲区大小&gt;</span>：指定管道缓冲区的大小，单位<span class="number">512</span>字节；</span><br><span class="line">-</span><br><span class="line">-s <span class="variable">&lt;堆叠大小&gt;</span>：指定堆叠的上限，单位为KB；</span><br><span class="line">-</span><br><span class="line">-S：设定资源的弹性限制；</span><br><span class="line">-</span><br><span class="line">-t <span class="variable">&lt;CPU时间&gt;</span>：指定CPU使用时间的上限，单位为秒；</span><br><span class="line">-</span><br><span class="line">-u <span class="variable">&lt;程序数目&gt;</span>：用户最多可开启的程序数目；</span><br><span class="line">-</span><br><span class="line">-v <span class="variable">&lt;虚拟内存大小&gt;</span>：指定可使用的虚拟内存上限，单位为KB。</span><br><span class="line"></span><br><span class="line">查看方式：</span><br><span class="line">[root@localhost ~]<span class="comment"># ulimit -a</span></span><br><span class="line"></span><br><span class="line">core file size          (blocks, -c) <span class="number">0</span>           <span class="comment">#core文件的最大值为100 blocks。</span></span><br><span class="line">d</span><br><span class="line">data seg size           (kbytes, -d) unlimited   <span class="comment">#进程的数据段可以任意大。</span></span><br><span class="line">s</span><br><span class="line">scheduling priority             (-e) <span class="number">0</span></span><br><span class="line">f</span><br><span class="line">file size               (blocks, -f) unlimited   <span class="comment">#文件可以任意大。</span></span><br><span class="line">p</span><br><span class="line">pending signals                 (-i) <span class="number">98304</span>       <span class="comment">#最多有98304个待处理的信号。</span></span><br><span class="line">m</span><br><span class="line"><span class="keyword">max</span> locked memory       (kbytes, -l) <span class="number">32</span>          <span class="comment">#一个任务锁住的物理内存的最大值为32KB。</span></span><br><span class="line">m</span><br><span class="line"><span class="keyword">max</span> memory size         (kbytes, -m) unlimited   <span class="comment">#一个任务的常驻物理内存的最大值。</span></span><br><span class="line">o</span><br><span class="line">open files                      (-n) <span class="number">1024</span>        <span class="comment">#一个任务最多可以同时打开1024的文件。</span></span><br><span class="line">p</span><br><span class="line">pipe size            (<span class="number">512</span> bytes, -p) <span class="number">8</span>           <span class="comment">#管道的最大空间为4096字节。</span></span><br><span class="line">P</span><br><span class="line">POSIX message queues     (bytes, -q) <span class="number">819200</span>      <span class="comment">#POSIX的消息队列的最大值为819200字节。</span></span><br><span class="line">r</span><br><span class="line">real-time priority              (-r) <span class="number">0</span></span><br><span class="line">s</span><br><span class="line">stack size              (kbytes, -s) <span class="number">10240</span>       <span class="comment">#进程的栈的最大值为10240字节。</span></span><br><span class="line">c</span><br><span class="line">cpu time               (seconds, -t) unlimited   <span class="comment">#进程使用的CPU时间。</span></span><br><span class="line">m</span><br><span class="line"><span class="keyword">max</span> <span class="keyword">user</span> processes              (-u) <span class="number">98304</span>       <span class="comment">#当前用户同时打开的进程（包括线程）的最大个数为98304。</span></span><br><span class="line">v</span><br><span class="line">virtual memory          (kbytes, -v) unlimited   <span class="comment">#没有限制进程的最大地址空间。</span></span><br><span class="line">f</span><br><span class="line">file locks                      (-x) unlimited   <span class="comment">#所能锁住的文件的最大个数没有限制。</span></span><br></pre></td></tr></table></figure>



<h2 id="dsa免密"><a href="#dsa免密" class="headerlink" title="dsa免密"></a>dsa免密</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">使用dsa方式免密能解决：</span><br><span class="line">在每台设备执行：</span><br><span class="line">[root<span class="variable">@sam</span> ~]<span class="comment"># rm -rf ~/.ssh</span></span><br><span class="line">[root<span class="variable">@sam</span> ~]<span class="comment"># mkdir ~/.ssh</span></span><br><span class="line">[root<span class="variable">@sam</span> ~]<span class="comment"># chmod 755 ~/.ssh</span></span><br><span class="line">[root<span class="variable">@sam</span> .ssh]<span class="comment"># /usr/bin/ssh-keygen -t dsa</span></span><br><span class="line"></span><br><span class="line">将每个主机上的公共密钥文件id_dsa.pub的内容复制到~<span class="regexp">/.ssh/authorized</span>_keys文件中。并把这个文件分别放到所有机器中。注意，当您第一次使用ssh访问远程主机时，其RSA密钥是未知的，所以提示确认一下，确认完毕后SSH将记录远程主机的RSA密钥，以后连接该主机就不用密码了。</span><br><span class="line">[root<span class="variable">@sam</span> .ssh]<span class="comment"># cat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys</span></span><br><span class="line">将各个设备上的authorized_keys复制到其他设备上</span><br></pre></td></tr></table></figure>

<h2 id="免密登录脚本"><a href="#免密登录脚本" class="headerlink" title="免密登录脚本"></a>免密登录脚本</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">serverlist.txt文件写具体的ip地址</span><br><span class="line"></span><br><span class="line"><span class="attribute">current</span>=`pwd`</span><br><span class="line"><span class="attribute">serverlist</span>=`cat <span class="variable">$current</span>/serverlist.txt`</span><br><span class="line">mkdir -p /root/.ssh</span><br><span class="line">ssh-keygen -t rsa -P <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span><span class="built_in"> ip </span><span class="keyword">in</span> <span class="variable">$serverlist</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    echo <span class="string">"#<span class="variable">$ip</span> no password."</span></span><br><span class="line">    ssh root@<span class="variable">$ip</span> <span class="string">'mkdir -p /root/.ssh 2&gt;/dev/null'</span></span><br><span class="line">    cat /root/.ssh/id_rsa.pub | ssh root@<span class="variable">$ip</span> <span class="string">'cat &gt;&gt; /root/.ssh/authorized_keys &amp;&amp; chmod 600 /root/.ssh/authorized_keys'</span></span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h2 id="rsa免密登录"><a href="#rsa免密登录" class="headerlink" title="rsa免密登录"></a>rsa免密登录</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line">ssh-copy-id root@10.238.161.1</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#ssh-keygen -t rsa   </span></span><br><span class="line"><span class="comment">#echo "按enter键3次即可"</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">current</span>=`pwd`</span><br><span class="line"><span class="attribute">serverlist</span>=`cat <span class="variable">$current</span>/serverlist.txt`</span><br><span class="line"><span class="attribute">PASSWORD</span>=cloud@123   #需要配置的主机登录密码</span><br><span class="line">auto_ssh_copy_id()&#123;</span><br><span class="line">        expect -c <span class="string">"set timeout -1;</span></span><br><span class="line"><span class="string">        spawn ssh-copy-id <span class="variable">$1</span>;                                </span></span><br><span class="line"><span class="string">        expect &#123;</span></span><br><span class="line"><span class="string">                *(yes/no)* &#123;send -- yes\r;exp_continue;&#125;</span></span><br><span class="line"><span class="string">                *password:* &#123;send -- <span class="variable">$2</span>\r;exp_continue;&#125;  </span></span><br><span class="line"><span class="string">                eof        &#123;exit 0;&#125;</span></span><br><span class="line"><span class="string">        &#125;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ssh_copy_id_to_all()&#123;</span><br><span class="line">        <span class="keyword">for</span><span class="built_in"> SERVER </span><span class="keyword">in</span>  <span class="variable">$serverlist</span> #遍历要发送到各个主机的ip</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                auto_ssh_copy_id <span class="variable">$SERVER</span> <span class="variable">$PASSWORD</span></span><br><span class="line">        done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ssh_copy_id_to_all</span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">serverlist.txt文件写具体的ip地址</span><br><span class="line"><span class="attribute">current</span>=`pwd`</span><br><span class="line"><span class="attribute">serverlist</span>=`cat <span class="variable">$current</span>/serverlist.txt`</span><br><span class="line">mkdir -p /root/.ssh</span><br><span class="line">ssh-keygen -t rsa -P <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span><span class="built_in"> ip </span><span class="keyword">in</span> <span class="variable">$serverlist</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    echo <span class="string">"#<span class="variable">$ip</span> no password."</span></span><br><span class="line">    ssh root@<span class="variable">$ip</span> <span class="string">'mkdir -p /root/.ssh 2&gt;/dev/null'</span></span><br><span class="line">    cat /root/.ssh/id_rsa.pub | ssh root@<span class="variable">$ip</span> <span class="string">'cat &gt;&gt; /root/.ssh/authorized_keys &amp;&amp; chmod  600 /root/.ssh/authorized_keys'</span></span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">1.配置各个安装主机的ssh免密码登陆</span><br><span class="line">①在每台设备上操作</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">②在每台设备上操作</span><br><span class="line">在设备上操作：</span><br><span class="line">ssh-copy-id root@10.224.25.11serverlist.txt文件写具体的ip地址</span><br><span class="line"></span><br><span class="line"><span class="attribute">current</span>=`pwd`</span><br><span class="line"><span class="attribute">serverlist</span>=`cat <span class="variable">$current</span>/serverlist.txt`</span><br><span class="line">mkdir -p /root/.ssh</span><br><span class="line">ssh-keygen -t rsa -P <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span><span class="built_in"> ip </span><span class="keyword">in</span> <span class="variable">$serverlist</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    echo <span class="string">"#<span class="variable">$ip</span> no password."</span></span><br><span class="line">    ssh root@<span class="variable">$ip</span> <span class="string">'mkdir -p /root/.ssh 2&gt;/dev/null'</span></span><br><span class="line">    cat /root/.ssh/id_rsa.pub | ssh root@<span class="variable">$ip</span> <span class="string">'cat &gt;&gt; /root/.ssh/authorized_keys &amp;&amp; chmod  600 /root/.ssh/authorized_keys'</span></span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">serverlist.txt文件写具体的ip地址</span><br><span class="line"></span><br><span class="line"><span class="attribute">current</span>=`pwd`</span><br><span class="line"><span class="attribute">serverlist</span>=`cat <span class="variable">$current</span>/serverlist.txt`</span><br><span class="line">mkdir -p /root/.ssh</span><br><span class="line">ssh-keygen -t rsa -P <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span><span class="built_in"> ip </span><span class="keyword">in</span> <span class="variable">$serverlist</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    echo <span class="string">"#<span class="variable">$ip</span> no password."</span></span><br><span class="line">    ssh root@<span class="variable">$ip</span> <span class="string">'mkdir -p /root/.ssh 2&gt;/dev/null'</span></span><br><span class="line">    cat /root/.ssh/id_rsa.pub | ssh root@<span class="variable">$ip</span> <span class="string">'cat &gt;&gt; /root/.ssh/authorized_keys &amp;&amp; chmod  600 /root/.ssh/authorized_keys'</span></span><br><span class="line">done</span><br></pre></td></tr></table></figure>



<h2 id="查看系统版本"><a href="#查看系统版本" class="headerlink" title="查看系统版本"></a>查看系统版本</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cat</span> <span class="string">/etc/redhat-release</span></span><br><span class="line"><span class="attr">uname</span> <span class="string">-a</span></span><br><span class="line"><span class="attr">lsb_release</span> <span class="string">-a</span></span><br><span class="line"><span class="attr">cat</span> <span class="string">/etc/issue</span></span><br><span class="line"><span class="attr">cat</span> <span class="string">/proc/version</span></span><br></pre></td></tr></table></figure>



<h2 id="虚机卡执行"><a href="#虚机卡执行" class="headerlink" title="虚机卡执行"></a>虚机卡执行</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="number">204800</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/vm/mi</span>n_free_kbytes</span><br></pre></td></tr></table></figure>



<h2 id="fuser"><a href="#fuser" class="headerlink" title="fuser"></a>fuser</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看哪个进程在写文件</span><br><span class="line">fuser <span class="regexp">/mnt/</span>sdfs<span class="regexp">/</span></span><br></pre></td></tr></table></figure>



<h2 id="isof"><a href="#isof" class="headerlink" title="isof"></a>isof</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">isof：</span><br><span class="line">lsof 是 <span class="keyword">list</span> <span class="keyword">open</span> <span class="keyword">files</span> 的缩写，功能是列出当前系统打开文件的工具</span><br><span class="line">查看进程状态时用<span class="keyword">ps</span>命令，常用<span class="keyword">ps</span> -elf或者<span class="keyword">ps</span> aux；查看系统打开的文件时用lsof命令，这里的“文件”包括/proc文件、磁盘文件、网络IO等。</span><br><span class="line"></span><br><span class="line">lsof -i 用以显示符合条件的进程情况，lsof(<span class="keyword">list</span> <span class="keyword">open</span> <span class="keyword">files</span>)是一个列出当前系统打开文件的工具。</span><br><span class="line">加端口号，查看端口被谁占用</span><br><span class="line">lsof -i:端口号</span><br><span class="line"></span><br><span class="line">查看谁正在使用某个文件，也就是说查找某个文件相关的进程</span><br><span class="line">[root@localhost omc]# lsof /var/<span class="built_in">log</span>/<span class="keyword">messages</span></span><br></pre></td></tr></table></figure>

<h2 id="ulimit"><a href="#ulimit" class="headerlink" title="ulimit"></a>ulimit</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -c</span><br><span class="line"><span class="built_in">ulimit</span> -c unlimited</span><br><span class="line">生成core文件</span><br></pre></td></tr></table></figure>

<h2 id="date"><a href="#date" class="headerlink" title="date"></a>date</h2><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">获取前<span class="number">7</span>天的日期：<span class="keyword">date</span> +%Y%m%d --<span class="keyword">date</span>=<span class="string">"-7 day"</span></span><br></pre></td></tr></table></figure>

<h2 id="ntp"><a href="#ntp" class="headerlink" title="ntp"></a>ntp</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ntp：[<span class="symbol">root@</span>ceph2 tool]# crontab -l</span><br><span class="line"><span class="number">30</span> * * * * /usr/sbin/ntpdate  <span class="number">10.27</span><span class="number">.126</span><span class="number">.249</span></span><br></pre></td></tr></table></figure>

<h2 id="logrotate"><a href="#logrotate" class="headerlink" title="logrotate"></a>logrotate</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line">1、关于日志切割</span><br><span class="line">　　日志文件包含了关于系统中发生的事件的有用信息，在排障过程中或者系统性能分析时经常被用到。对于忙碌的服务器，日志文件大小会增长极快，服务器会很快消耗磁盘空间，这成了个问题。除此之外，处理一个单个的庞大日志文件也常常是件十分棘手的事。</span><br><span class="line">　　logrotate是个十分有用的工具，它可以自动对日志进行截断（或轮循）、压缩以及删除旧的日志文件。例如，你可以设置logrotate，让<span class="string">/var/log/foo</span>日志文件每30天轮循，并删除超过6个月的日志。配置完后，logrotate的运作完全自动化，不必进行任何进一步的人为干预。</span><br><span class="line"></span><br><span class="line">2、安装logrotate</span><br><span class="line">系统版本说明</span><br><span class="line">[root@clsn6 ~]<span class="comment"># cat /etc/redhat-release </span></span><br><span class="line">CentOS release 6.9 <span class="params">(Final)</span></span><br><span class="line">[root@clsn6 ~]<span class="comment"># uname -r </span></span><br><span class="line">2.6.32-696.el6.x86_64</span><br><span class="line"></span><br><span class="line">默认centos系统安装自带logrotate，安装方法如下</span><br><span class="line">yum -y install logrotate crontabs </span><br><span class="line"></span><br><span class="line">软件包信息说明</span><br><span class="line">[root@clsn6 ~]<span class="comment"># rpm -ql  logrotate</span></span><br><span class="line"><span class="string">/etc/cron.daily/logrotate</span></span><br><span class="line"><span class="string">/etc/logrotate.conf</span>  <span class="comment"># 主配置文件</span></span><br><span class="line"><span class="string">/etc/logrotate.d</span>   <span class="comment"># 配置目录</span></span><br><span class="line">　　logrotate的配置文件是<span class="string">/etc/logrotate.conf</span>，通常不需要对它进行修改。日志文件的轮循设置在独立的配置文件中，它（们）放在<span class="string">/etc/logrotate.d/</span>目录下。</span><br><span class="line"></span><br><span class="line">3、实践配置logrotate</span><br><span class="line">3.1 测试logrotate如何管理日志</span><br><span class="line">　　这里我们将创建一个10MB的日志文件<span class="string">/var/log/log-file</span>。我们将展示怎样使用logrotate来管理该日志文件。</span><br><span class="line"></span><br><span class="line">我们从创建一个日志文件开始吧，然后在其中填入一个10MB的随机比特流数据文件。</span><br><span class="line">[root@clsn6 ~]<span class="comment"># touch /var/log/log-file</span></span><br><span class="line">[root@clsn6 ~]<span class="comment"># head -c 10M &lt; /dev/urandom &gt; /var/log/log-file </span></span><br><span class="line"></span><br><span class="line">　　由于现在日志文件已经准备好，我们将配置logrotate来轮循该日志文件。让我们为该文件创建一个配置文件。</span><br><span class="line">[root@clsn6 ~]<span class="comment"># vim /etc/logrotate.d/log-file </span></span><br><span class="line"><span class="string">/var/log/log-file</span> &#123;</span><br><span class="line">    monthly</span><br><span class="line">    rotate 5</span><br><span class="line">    compress</span><br><span class="line">    delaycompress</span><br><span class="line">    missingok</span><br><span class="line">    notifempty</span><br><span class="line">    create 644 root root</span><br><span class="line">    postrotate</span><br><span class="line">        <span class="string">/usr/bin/killall</span> -HUP rsyslogd</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br><span class="line">　　上面的模板是通用的，而配置参数则根据你的需求进行调整，不是所有的参数都是必要的。也可以通过man手册中的例子进行配置。</span><br><span class="line">　　</span><br><span class="line">3.2配置文件说明</span><br><span class="line">配置参数</span><br><span class="line"></span><br><span class="line">说明</span><br><span class="line">monthly		日志文件将按月轮循。其它可用值为'daily'，'weekly'或者'yearly'。</span><br><span class="line">rotate 5	一次将存储5个归档日志。对于第六个归档，时间最久的归档将被删除。</span><br><span class="line">compress	在轮循任务完成后，已轮循的归档将使用gzip进行压缩。</span><br><span class="line">delaycompress 总是与compress选项一起用，delaycompress选项指示logrotate不要将最近的归档压缩，压缩将在下一次轮循周期进行。这在你或任何软件仍然需要读取最新归档时很有用。</span><br><span class="line">missingok	在日志轮循期间，任何错误将被忽略，例如“文件无法找到”之类的错误。</span><br><span class="line">notifempty	如果日志文件为空，轮循不会进行。</span><br><span class="line">create 644 root root 以指定的权限创建全新的日志文件，同时logrotate也会重命名原始日志文件。</span><br><span class="line">postrotate/endscript 在所有其它指令完成后，postrotate和endscript里面指定的命令将被执行。在这种情况下，rsyslogd 进程将立即再次读取其配置并继续运行。</span><br><span class="line"></span><br><span class="line">3.3手动运行logrotate</span><br><span class="line">　　logrotate可以在任何时候从命令行手动调用。要调用为<span class="string">/etc/lograte.d/</span>下配置的所有日志调用logrotate：</span><br><span class="line"></span><br><span class="line">[root@clsn6 ~]<span class="comment"># logrotate /etc/logrotate.conf</span></span><br><span class="line">要为某个特定的配置调用logrotate,执行一次切割任务测试</span><br><span class="line"></span><br><span class="line">[root@clsn6 ~]<span class="comment"># ll /var/log/log-file </span></span><br><span class="line">-rw-r<span class="params">--r--</span> 1 root root 10485760 Feb  7 18<span class="function">:50</span> <span class="string">/var/log/log-file</span></span><br><span class="line">[root@clsn6 ~]<span class="comment"># logrotate -vf /etc/logrotate.d/log-file </span></span><br><span class="line">[root@clsn6 ~]<span class="comment"># ll /var/log/log-file* </span></span><br><span class="line">-rw-r<span class="params">--r--</span> 1 root root        0 Feb  7 19<span class="function">:17</span> <span class="string">/var/log/log-file</span></span><br><span class="line">-rw-r<span class="params">--r--</span> 1 root root 10485760 Feb  7 18<span class="function">:50</span> <span class="string">/var/log/log-file.1</span></span><br><span class="line">　　即使轮循条件没有满足，我们也可以通过使用‘-f’选项来强制logrotate轮循日志文件，‘-v’参数提供了详细的输出</span><br><span class="line"></span><br><span class="line">3.4Logrotate的记录日志</span><br><span class="line">　　logrotate自身的日志通常存放于<span class="string">/var/lib/logrotate/status</span>目录。如果处于排障目的，我们想要logrotate记录到任何指定的文件，我们可以指定像下面这样从命令行指定。</span><br><span class="line"></span><br><span class="line">[root@clsn6 ~]<span class="comment"># logrotate -vf -s /var/log/logrotate-status /etc/logrotate.d/log-file</span></span><br><span class="line">reading config file <span class="string">/etc/logrotate.d/log-file</span></span><br><span class="line">reading config info for <span class="string">/var/log/log-file</span> </span><br><span class="line"></span><br><span class="line">Handling 1 logs</span><br><span class="line"></span><br><span class="line">rotating pattern: <span class="string">/var/log/log-file</span>  forced from <span class="keyword">command</span> line <span class="params">(5 rotations)</span></span><br><span class="line">empty log files are not rotated, old logs are removed</span><br><span class="line">considering log <span class="string">/var/log/log-file</span></span><br><span class="line">  log does not need rotating</span><br><span class="line">not running postrotate script, since no logs were rotated</span><br><span class="line"></span><br><span class="line">3.5 Logrotate定时任务</span><br><span class="line">　　logrotate需要的cron任务应该在安装时就自动创建了，我把cron文件的内容贴出来，以供大家参考。</span><br><span class="line">[root@clsn6 ~]<span class="comment"># cat /etc/cron.daily/logrotate </span></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="string">/usr/sbin/logrotate</span> <span class="string">/etc/logrotate.conf</span></span><br><span class="line">EXITVALUE=$?</span><br><span class="line"><span class="keyword">if</span> [ $EXITVALUE != 0 ]; then</span><br><span class="line">    <span class="string">/usr/bin/logger</span> -t logrotate <span class="string">"ALERT exited abnormally with [$EXITVALUE]"</span></span><br><span class="line">fi</span><br><span class="line">exit 0</span><br><span class="line"></span><br><span class="line">4、logrotate生产应用</span><br><span class="line">4.1为nginx设置日志切割</span><br><span class="line">　　防止访问日志文件过大</span><br><span class="line"></span><br><span class="line">[root@clsn nginx]<span class="comment"># cat /etc/logrotate.d/nginx </span></span><br><span class="line"><span class="string">/var/log/nginx/</span>*<span class="string">.log</span> &#123;</span><br><span class="line">    daily</span><br><span class="line">    rotate 5</span><br><span class="line">    missingok</span><br><span class="line">    notifempty</span><br><span class="line">    create 644 www www</span><br><span class="line">    postrotate</span><br><span class="line">      <span class="keyword">if</span> [ -f <span class="string">/application/nginx/logs/nginx.pid</span> ]; then</span><br><span class="line">          kill -USR1 `cat <span class="string">/application/nginx/logs/nginx.pid</span>`</span><br><span class="line">      fi</span><br><span class="line">endscript</span><br><span class="line">&#125;</span><br><span class="line">　　logrotate工具对于防止因庞大的日志文件而耗尽存储空间是十分有用的。配置完毕后，进程是全自动的，可以长时间在不需要人为干预下运行。本教程重点关注几个使用logrotate的几个基本样例，你也可以定制它以满足你的需求。</span><br><span class="line"></span><br><span class="line">　　对于其他服务日志切割后续补充</span><br><span class="line"></span><br><span class="line">5、crontab</span><br><span class="line">Logrotate是基于CRON运行的，所以这个时间是由CRON控制的，具体可以查询CRON的配置文件<span class="string">/etc/anacrontab</span>（老版本的文件是<span class="string">/etc/crontab</span>）</span><br><span class="line">[root@test ~]<span class="comment"># cat /etc/anacrontab</span></span><br><span class="line"><span class="comment"># /etc/anacrontab: configuration file for anacron</span></span><br><span class="line"><span class="comment"># See anacron(8) and anacrontab(5) for details.</span></span><br><span class="line">SHELL=<span class="string">/bin/sh</span></span><br><span class="line">PATH=<span class="string">/sbin</span>:<span class="string">/bin</span>:<span class="string">/usr/sbin</span>:<span class="string">/usr/bin</span></span><br><span class="line">MAILTO=root</span><br><span class="line"><span class="comment"># the maximal random delay added to the base delay of the jobs</span></span><br><span class="line">RANDOM_DELAY=45                                           <span class="string">//</span>这个是随机的延迟时间，表示最大45分钟</span><br><span class="line"><span class="comment"># the jobs will be started during the following hours only</span></span><br><span class="line">START_HOURS_RANGE=3-22                                                     <span class="string">//</span>这个是开始时间</span><br><span class="line"><span class="comment">#period in days   delay in minutes   job-identifier   command</span></span><br><span class="line">1 5 cron.daily    nice run-parts <span class="string">/etc/cron.daily</span></span><br><span class="line">7 25  cron.weekly   nice run-parts <span class="string">/etc/cron.weekly</span></span><br><span class="line">@monthly 45 cron.monthly    nice run-parts <span class="string">/etc/cron.monthly</span></span><br><span class="line">第一个是 Recurrence period</span><br><span class="line">第二个是延迟时间 所以cron.daily会在3<span class="function">:22</span>+<span class="params">(5,45)</span>这个时间段执行，<span class="string">/etc/cron.daily</span>是个文件夹</span><br><span class="line"></span><br><span class="line">通过默认<span class="string">/etc/anacrontab</span>文件配置，会发现logrotate自动切割日志文件的默认时间是凌晨3点多。</span><br><span class="line"></span><br><span class="line"><span class="params">-----------------------------------------------------------------------------------</span></span><br><span class="line">现在需要将切割时间调整到每天的晚上12点，即每天切割的日志是前一天的0-24点之间的内容。</span><br><span class="line">操作如下：</span><br><span class="line">[root@kevin ~]<span class="comment"># mv /etc/anacrontab /etc/anacrontab.bak          //取消日志自动轮转的设置</span></span><br><span class="line">[root@G6-bs02 logrotate.d]<span class="comment"># cat nstc_nohup.out</span></span><br><span class="line"><span class="string">/data/nstc/nohup.out</span> &#123;</span><br><span class="line">rotate 30</span><br><span class="line">dateext</span><br><span class="line">daily</span><br><span class="line">copytruncate</span><br><span class="line">compress</span><br><span class="line">notifempty</span><br><span class="line">missingok</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@G6-bs02 logrotate.d]<span class="comment"># cat syslog</span></span><br><span class="line"><span class="string">/var/log/cron</span></span><br><span class="line"><span class="string">/var/log/maillog</span></span><br><span class="line"><span class="string">/var/log/messages</span></span><br><span class="line"><span class="string">/var/log/secure</span></span><br><span class="line"><span class="string">/var/log/history</span></span><br><span class="line">&#123;</span><br><span class="line">    sharedscripts</span><br><span class="line">    compress</span><br><span class="line">    rotate 30</span><br><span class="line">    daily</span><br><span class="line">    dateext</span><br><span class="line">    postrotate</span><br><span class="line">    <span class="string">/bin/kill</span> -HUP `cat <span class="string">/var/run/syslogd.pid</span> 2&gt; <span class="string">/dev/null</span>` 2&gt; <span class="string">/dev/null</span> || <span class="literal">true</span></span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结合crontab进行自定义的定时轮转操作</span><br><span class="line">[root@kevin ~]<span class="comment"># crontab -l</span></span><br><span class="line"><span class="comment">#log logrotate</span></span><br><span class="line">59 23 * * * <span class="string">/usr/sbin/logrotate</span> -f <span class="string">/etc/logrotate.d/syslog</span> &gt;<span class="string">/dev/null</span> 2&gt;&amp;1</span><br><span class="line">59 23 * * * <span class="string">/usr/sbin/logrotate</span> -f <span class="string">/etc/logrotate.d/nstc_nohup.out</span> &gt;<span class="string">/dev/null</span> 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">[root@G6-bs02 ~]<span class="comment"># ll /data/nstc/nohup.out*</span></span><br><span class="line">-rw<span class="params">-------</span> 1 app app 33218 1月  25 09<span class="function">:43</span> <span class="string">/data/nstc/nohup.out</span></span><br><span class="line">-rw<span class="params">-------</span> 1 app app 67678 1月  25 23<span class="function">:59</span> <span class="string">/data/nstc/nohup.out-20180125.gz</span></span><br><span class="line"></span><br><span class="line">举例：oss（redhat 6.3）</span><br><span class="line">30 02 * * * <span class="string">/usr/sbin/logrotate</span> -f <span class="string">/etc/logrotate.d/sdoss</span></span><br><span class="line">[root@uimgprestorage221 ~]<span class="comment"># cat /etc/logrotate.d/sdoss</span></span><br><span class="line"><span class="string">/opt/log/sdoss/</span>*<span class="string">/weed.</span>*HTTP <span class="string">/opt/log/sdoss/</span>*<span class="string">/weed.INFO</span> <span class="string">/opt/log/sdoss/</span>*<span class="string">/weed.WARNING</span> <span class="string">/opt/log/sdoss/</span>*<span class="string">/weed.ERROR</span> <span class="string">/opt/log/sdoss/</span>*<span class="string">/weed.FATAL</span> <span class="string">/opt/log/sdoss/</span>*<span class="string">/stackfile</span> <span class="string">/opt/log/sdoss/</span>*<span class="string">/core</span>* &#123;</span><br><span class="line">notifempty</span><br><span class="line">copytruncate</span><br><span class="line">daily</span><br><span class="line">rotate 7 <span class="comment">#rotate 7（3表示：7天删除日志）</span></span><br><span class="line">missingok</span><br><span class="line">dateext</span><br><span class="line">compress</span><br><span class="line">sharedscripts</span><br><span class="line">postrotate</span><br><span class="line">    pkill -USR1 weed</span><br><span class="line">endscript</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">6、附录</span><br><span class="line">6.1关于USR1信号解释</span><br><span class="line">　　摘自： http:<span class="string">//www.xuebuyuan.com/323422.html</span></span><br><span class="line"></span><br><span class="line">USR1亦通常被用来告知应用程序重载配置文件；例如，向Apache HTTP服务器发送一个USR1信号将导致以下步骤的发生：停止接受新的连接，等待当前连接停止，重新载入配置文件，重新打开日志文件，重启服务器，从而实现相对平滑的不关机的更改。内容摘自wiki：http:<span class="string">//zh.wikipedia.org/wiki/SIGUSR1</span>%E5%92%8CSIGUSR2　　</span><br><span class="line"></span><br><span class="line">　　对于USR1和2都可以用户自定义的，在POSIX兼容的平台上，SIGUSR1和SIGUSR2是发送给一个进程的信号，它表示了用户定义的情况。它们的符号常量在头文件signal.h中定义。在不同的平台上，信号的编号可能发生变化，因此需要使用符号名称。</span><br><span class="line"></span><br><span class="line">kill -HUP pid 或者 killall -HUP pName：</span><br><span class="line">　　其中pid是进程标识，pName是进程的名称。</span><br><span class="line">　　如果想要更改配置而不需停止并重新启动服务，可以使用上面两个命令。在对配置文件作必要的更改后，发出该命令以动态更新服务配置。根据约定，当你发送一个挂起信号<span class="params">(信号1或HUP)</span>时，大多数服务器进程<span class="params">(所有常用的进程)</span>都会进行复位操作并重新加载它们的配置文件。</span><br><span class="line">　　</span><br><span class="line">6.2常见配置参数小结</span><br><span class="line">配置参数</span><br><span class="line">说明</span><br><span class="line">compress                通过gzip压缩转储以后的日志</span><br><span class="line">nocompress              不压缩</span><br><span class="line">copytruncate            用于还在打开中的日志文件，把当前日志备份并截断</span><br><span class="line">nocopytruncate          备份日志文件但是不截断</span><br><span class="line">create mode owner group 转储文件，使用指定的文件模式创建新的日志文件</span><br><span class="line">nocreate                不建立新的日志文件</span><br><span class="line">delaycompress           和 compress 一起使用时，转储的日志文件到下一次转储时才压缩</span><br><span class="line">nodelaycompress         覆盖 delaycompress 选项，转储同时压缩。</span><br><span class="line">errors address          专储时的错误信息发送到指定的Email 地址</span><br><span class="line">ifempty                 即使是空文件也转储，这个是 logrotate 的缺省选项。</span><br><span class="line">notifempty              如果是空文件的话，不转储</span><br><span class="line">mail address             把转储的日志文件发送到指定的E-mail 地址</span><br><span class="line">nomail                  转储时不发送日志文件</span><br><span class="line">olddir directory         转储后的日志文件放入指定的目录，必须和当前日志文件在同一个文件系统</span><br><span class="line">noolddir                转储后的日志文件和当前日志文件放在同一个目录下</span><br><span class="line">prerotate/endscript     在转储以前需要执行的命令可以放入这个对，这两个关键字必须单独成行</span><br><span class="line">daily                   指定转储周期为每天</span><br><span class="line">weekly                  指定转储周期为每周</span><br><span class="line">monthly                 指定转储周期为每月</span><br><span class="line">rotate count            指定日志文件删除之前转储的次数，0 指没有备份，5 指保留5 个备份</span><br><span class="line">tabooext [+] list让logrotate不转储指定扩展名的文件，缺省的扩展名是：<span class="string">.rpm-orig</span>, <span class="string">.rpmsave</span>, v, 和 ~</span><br><span class="line">size size（如：size 20M）   当日志文件到达指定的大小时才转储，bytes<span class="params">(缺省)</span>及KB<span class="params">(sizek)</span>或MB<span class="params">(sizem)</span></span><br><span class="line">missingok				在日志轮循期间，任何错误将被忽略，例如“文件无法找到”之类的错误。</span><br></pre></td></tr></table></figure>



<h2 id="清理设备所有缓存"><a href="#清理设备所有缓存" class="headerlink" title="清理设备所有缓存"></a>清理设备所有缓存</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">清理所有缓存：echo <span class="number">3</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/vm/</span>drop_caches</span><br></pre></td></tr></table></figure>

<h2 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">执行yum install openjdk.x86_64 –y报错：</span><br><span class="line">[root@dev-51 home]# yum install openjdk.x86_64 –y</span><br><span class="line">Loaded plugins: product-id, security, subscription-manager</span><br><span class="line">Updating certificate-based repositories.</span><br><span class="line">Unable <span class="keyword">to</span> read consumer identity</span><br><span class="line">Setting up Install Process</span><br><span class="line"><span class="literal">No</span> package openjdk.x86_64 available.</span><br><span class="line">Error: <span class="literal">Nothing</span> <span class="keyword">to</span> <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line">①清理yum</span><br><span class="line">yum clean all</span><br><span class="line">②确认yum是好的</span><br><span class="line">yum makecache</span><br><span class="line">③</span><br><span class="line"></span><br><span class="line">yum list |grep jdk</span><br><span class="line">vi /etc/yum.repos.d/stom.repo</span><br><span class="line">stom.repo名字可以自定义</span><br><span class="line">[root@dev-50 yum.repos.d]# cat stom.repo </span><br><span class="line">[yum-cd]</span><br><span class="line"><span class="attribute">name</span>=cd rpm</span><br><span class="line"><span class="attribute">baseurl</span>=http://10.27.97.1/rh63/x86_64</span><br><span class="line"><span class="attribute">gpgcheck</span>=0</span><br><span class="line"><span class="attribute">enabled</span>=1</span><br><span class="line"></span><br><span class="line">[root@dev-21 yum.repos.d]# cat cd.repo   (这个yum源有xfs的包）</span><br><span class="line">[local]</span><br><span class="line"><span class="attribute">name</span>=local</span><br><span class="line"><span class="attribute">baseurl</span>=http://192.168.86.5/centos/6.5/os/x86_64/Packages/</span><br><span class="line"><span class="attribute">gpgcheck</span>=0</span><br><span class="line"></span><br><span class="line">10-1-3016</span><br><span class="line"></span><br><span class="line">④将vsftp的rpm包下载到本地</span><br><span class="line">yumdownloader vsftpd</span><br><span class="line"></span><br><span class="line">强制安装yum包</span><br><span class="line">yum install -y yum-downloadonly</span><br><span class="line">yum install qemu-img-y --downloadonly <span class="attribute">--downloaddir</span>=/opt</span><br><span class="line">rpm -ivh --force --nodeps qemu-img.xxxx.rpm</span><br></pre></td></tr></table></figure>



<h2 id="执行jar包"><a href="#执行jar包" class="headerlink" title="执行jar包"></a>执行jar包</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">storm</span> <span class="selector-tag">jar</span> <span class="selector-tag">stormkafka-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span> <span class="selector-tag">suning</span><span class="selector-class">.oss</span><span class="selector-class">.stat</span><span class="selector-class">.RollingNginxTopWords</span> 10<span class="selector-class">.27</span><span class="selector-class">.38</span><span class="selector-class">.33</span></span><br><span class="line"><span class="selector-tag">storm</span> <span class="selector-tag">jar</span> <span class="selector-tag">uimgStorm</span><span class="selector-class">.jar</span> <span class="selector-tag">com</span><span class="selector-class">.suning</span><span class="selector-class">.uimg</span><span class="selector-class">.storm</span><span class="selector-class">.StormKafkaConsumer</span> 10<span class="selector-class">.27</span><span class="selector-class">.38</span><span class="selector-class">.33</span></span><br><span class="line"><span class="selector-tag">storm</span> <span class="selector-tag">jar</span> <span class="selector-tag">ngStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span> <span class="selector-tag">suning</span><span class="selector-class">.oss</span><span class="selector-class">.stat</span><span class="selector-class">.NginxTop</span> 10<span class="selector-class">.27</span><span class="selector-class">.38</span><span class="selector-class">.33</span></span><br><span class="line"><span class="selector-tag">storm</span> <span class="selector-tag">jar</span> <span class="selector-tag">accountStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span> <span class="selector-tag">suning</span><span class="selector-class">.oss</span><span class="selector-class">.stat</span><span class="selector-class">.AccountTop</span> 10<span class="selector-class">.27</span><span class="selector-class">.38</span><span class="selector-class">.33</span></span><br><span class="line"><span class="selector-tag">storm</span> <span class="selector-tag">jar</span> <span class="selector-tag">bucketStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span> <span class="selector-tag">suning</span><span class="selector-class">.oss</span><span class="selector-class">.stat</span><span class="selector-class">.BucketTop</span> 10<span class="selector-class">.27</span><span class="selector-class">.38</span><span class="selector-class">.33</span></span><br><span class="line"><span class="selector-tag">storm</span> <span class="selector-tag">jar</span> <span class="selector-tag">filerStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span> <span class="selector-tag">suning</span><span class="selector-class">.oss</span><span class="selector-class">.stat</span><span class="selector-class">.FilerTop</span> 10<span class="selector-class">.27</span><span class="selector-class">.38</span><span class="selector-class">.33</span></span><br><span class="line"><span class="selector-tag">storm</span> <span class="selector-tag">jar</span> <span class="selector-tag">masterStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span> <span class="selector-tag">suning</span><span class="selector-class">.oss</span><span class="selector-class">.stat</span><span class="selector-class">.MasterTop</span> 10<span class="selector-class">.27</span><span class="selector-class">.38</span><span class="selector-class">.33</span></span><br><span class="line"><span class="selector-tag">storm</span> <span class="selector-tag">jar</span> <span class="selector-tag">partitionStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span> <span class="selector-tag">suning</span><span class="selector-class">.oss</span><span class="selector-class">.stat</span><span class="selector-class">.PartitionTop</span> 10<span class="selector-class">.27</span><span class="selector-class">.38</span><span class="selector-class">.33</span></span><br><span class="line"><span class="selector-tag">storm</span> <span class="selector-tag">jar</span> <span class="selector-tag">volumeStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span> <span class="selector-tag">suning</span><span class="selector-class">.oss</span><span class="selector-class">.stat</span><span class="selector-class">.VolumeTop</span> 10<span class="selector-class">.27</span><span class="selector-class">.38</span><span class="selector-class">.33</span></span><br><span class="line"><span class="selector-tag">storm</span> <span class="selector-tag">jar</span> <span class="selector-tag">newImgStorm</span><span class="selector-class">.jar</span>  <span class="selector-tag">suning</span><span class="selector-class">.oss</span><span class="selector-class">.stat</span><span class="selector-class">.VolumeTop</span> 10<span class="selector-class">.27</span><span class="selector-class">.38</span><span class="selector-class">.33</span></span><br><span class="line"></span><br><span class="line">2、解压<span class="selector-tag">jar</span>包，<span class="selector-tag">windows</span>可以本地7<span class="selector-tag">z</span>解压</span><br><span class="line"></span><br><span class="line">3、打包<span class="selector-tag">jar</span>包</span><br><span class="line">进入<span class="selector-tag">C</span>:\<span class="selector-tag">Program</span> <span class="selector-tag">Files</span>\<span class="selector-tag">Java</span>\<span class="selector-tag">jdk-10</span><span class="selector-class">.0</span><span class="selector-class">.1</span>\</span><br><span class="line"><span class="selector-tag">cmd</span> 之后执行</span><br><span class="line"><span class="selector-tag">jar</span> <span class="selector-tag">cvf</span>  <span class="selector-tag">D</span>:\谷歌浏览器下载\<span class="selector-tag">ngStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span> <span class="selector-tag">D</span>:\谷歌浏览器下载\<span class="selector-tag">ngStorm-0</span><span class="selector-class">.0</span>.</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">accountStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span>  <span class="selector-tag">filerStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span>   <span class="selector-tag">newImgStorm</span><span class="selector-class">.jar</span>    <span class="selector-tag">partitionStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span>  <span class="selector-tag">uimgStorm</span><span class="selector-class">.jar</span></span><br><span class="line"><span class="selector-tag">bucketStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span>   <span class="selector-tag">masterStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span>  <span class="selector-tag">ngStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span>  <span class="selector-tag">stormkafka-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span>      <span class="selector-tag">volumeStorm-0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.jar</span></span><br></pre></td></tr></table></figure>



<h2 id="重启nginx"><a href="#重启nginx" class="headerlink" title="重启nginx"></a>重启nginx</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/opt/</span>tengine<span class="regexp">/sbin/</span>nginx -s quit  停止nginx</span><br><span class="line"></span><br><span class="line">启动nginx：<span class="regexp">/opt/</span>tengine<span class="regexp">/sbin/</span>nginx -c <span class="regexp">/opt/</span>tengine<span class="regexp">/conf/</span>nginx.conf</span><br></pre></td></tr></table></figure>

<h2 id="jdk"><a href="#jdk" class="headerlink" title="jdk"></a>jdk</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/java/;tar -vzxf jdk-8u181-linux-x64.tar.gz -C /usr/local/java/</span><br><span class="line"></span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=/usr/local/java/jdk1.8.0_181</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$JAVA_HOME</span>/bin:$PATH</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">CLASSPATH</span>=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<h2 id="nmon"><a href="#nmon" class="headerlink" title="nmon"></a>nmon</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">参考网址：</span><br><span class="line">https:<span class="comment">//blog.csdn.net/liang_operations/article/details/81705266#4本地下载nmon-analyser</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     我们监控我们的操作系统的时候如果可以把各个硬件的监控信息生成形象化的分析报表图对于我们来说是件太好的事情了，而通过nom和nmon_analyser两者的结合完全可以实现我们的要求。首先对nmon和nmon_analyser做一个大概介绍。Nmon 是一个分析aix和linux性能的免费工具（其主要是ibm为自己的aix操作系统开发的，但是也可以应用在linux操作系统上），而nmon_analyser是nmon的一个工具可以把nmon生成的报告转化成excel报表的形式供我们查看。下面先让看下nmon_analyser生成的报表。</span><br><span class="line"></span><br><span class="line">数据采集</span><br><span class="line">         运行带 -f 标志的 nmon 命令。有关详细信息，请参阅 nmon -h。但是作为示例，可以尝试运行下面的 nmon 命令来，告知 nmon 创建文件，并每隔 <span class="number">10</span> 秒的时间进行一次数据收集，共采集 <span class="number">60</span> 次（共计 <span class="number">10</span> 分钟）：</span><br><span class="line">nmon -f -s <span class="number">10</span> -c <span class="number">60</span></span><br><span class="line">-f 表示生成的数据文件名中有时间；</span><br><span class="line">-s <span class="number">10</span> 表示每 <span class="number">10</span> 秒采集一次数据；</span><br><span class="line">-c <span class="number">60</span> 表示采集 <span class="number">60</span> 次，<span class="number">10</span>*<span class="number">60</span>=<span class="number">600</span> 秒，</span><br><span class="line">刚好是 <span class="number">10</span>分钟的数据，这样运行一次这个程序就会生成一个采集 <span class="number">10</span>分钟数据的文件。该行命令将在当前目录中创建输出文件，其名称为：&lt;hostname&gt;_date_time.nmon<span class="string">", hostname"</span> 是这台主机的主机名。</span><br><span class="line">例如</span><br><span class="line">[<span class="symbol">root@</span>localhost source]# hostname</span><br><span class="line">linux_test</span><br><span class="line">[<span class="symbol">root@</span>localhost source]# ./nmon -f -s <span class="number">5</span> -c <span class="number">60</span></span><br><span class="line">[<span class="symbol">root@</span>localhost source]# ps -ef | grep nmon</span><br><span class="line">root <span class="number">17815</span> <span class="number">1</span> <span class="number">0</span> <span class="number">08</span>:<span class="number">22</span> pts/<span class="number">1</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> ./nmon -f -s <span class="number">10</span> -c <span class="number">60</span></span><br><span class="line">root <span class="number">17888</span> <span class="number">6977</span> <span class="number">0</span> <span class="number">08</span>:<span class="number">22</span> pts/<span class="number">1</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep nmon</span><br><span class="line">[<span class="symbol">root@</span>localhost source]# ls linux_test_120724_0822.nmon</span><br><span class="line">linux_test_120724_0822.nmon</span><br><span class="line"></span><br><span class="line">./nmon -ft -s <span class="number">10</span> -c <span class="number">60</span> -m /root/nmon </span><br><span class="line"># 参数说明 </span><br><span class="line">-f   监控结果以文件形式输出，默认机器名+日期.nmon格式 </span><br><span class="line">-F   指定输出的文件名，比如test.nmon </span><br><span class="line">-s   指的是采样的频率，单位为秒 </span><br><span class="line">-c   指的是采样的次数，即以上面的采样频率采集多少次 </span><br><span class="line">-m   指定生成的文件目录</span><br><span class="line"></span><br><span class="line">本地下载nmon analyser：https:<span class="comment">//www.ibm.com/developerworks/community/wikis/home?lang=en#!/wiki/Power+Systems/page/nmon_analyser</span></span><br><span class="line"></span><br><span class="line"><span class="number">4.2</span>解压生成两个文件</span><br><span class="line">NA_UserGuide v55.docx</span><br><span class="line">nmon analyser v55.xlsm</span><br><span class="line"></span><br><span class="line"><span class="number">4.3</span>打开nmon analyser v52_1.xlsm</span><br><span class="line">报错： </span><br><span class="line">运行时错误 <span class="number">13</span> 类型不匹配”错误 </span><br><span class="line">解决： </span><br><span class="line">修改本地系统时间，然后重新打开文件</span><br></pre></td></tr></table></figure>

<h2 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a>ftp</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">1、yum install vsftpd</span><br><span class="line"></span><br><span class="line">4.创建用户</span><br><span class="line">（1）首先要启动服务</span><br><span class="line">service vsftpd start</span><br><span class="line">（2）创建用户</span><br><span class="line">adduser -s /bin/bash -d /mnt/xufx/ftp xufx</span><br><span class="line">passwd xufx</span><br><span class="line"></span><br><span class="line">5.vsftpd的配置</span><br><span class="line">安装完之后在/etc/vsftpd/路径下会存在三个配置文件。</span><br><span class="line">vsftpd.conf: 主配置文件</span><br><span class="line">ftpusers: 指定哪些用户不能访问FTP服务器,这里的用户包括root在内的一些重要用户。</span><br><span class="line">user_list: 指定的用户是否可以访问ftp服务器，通过vsftpd.conf文件中的userlist_deny的配置来决定配置中的用户是否可以访问，<span class="attribute">userlist_enable</span>=<span class="literal">YES</span> ，<span class="attribute">userlist_deny</span>=<span class="literal">YES</span> ，<span class="attribute">userlist_file</span>=/etc/vsftpd/user_list 这三个配置允许文件中的用户访问FTP。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(1)登录ftp后会发现，用户可以访问其他目录，并且具有mpsp组的权限，这样做是不允许的，我们需要将用户的访问范围控制在其主目录下。方法如下：</span><br><span class="line">a. vi /etc/vsftpd/vsftpd.conf进入ftp配置文件目录并编辑此文件,</span><br><span class="line"><span class="attribute">anonymous_enable</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attribute">chroot_list_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attribute">chroot_list_file</span>=/etc/vsftpd/chroot_list</span><br><span class="line"><span class="attribute">chroot_local_user</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attribute">userlist_enable</span>=<span class="literal">YES</span></span><br><span class="line"></span><br><span class="line">最后加上：</span><br><span class="line"><span class="attribute">userlist_deny</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attribute">userlist_file</span>=/etc/vsftpd/user_list</span><br><span class="line"></span><br><span class="line">（2）</span><br><span class="line">vi /etc/vsftpd/vsftpd.chroot_list </span><br><span class="line">[root@dev-21 vsftpd]# vi vsftpd.chroot_list</span><br><span class="line">xufx</span><br><span class="line"></span><br><span class="line">（3）</span><br><span class="line">vi /etc/vsftpd/user_list </span><br><span class="line">最后加入xufx</span><br><span class="line"></span><br><span class="line">（4）</span><br><span class="line">ftp的ip+端口的登录方式：ftp 10.244.76.84 811</span><br></pre></td></tr></table></figure>



<h2 id="lrzsz"><a href="#lrzsz" class="headerlink" title="lrzsz"></a>lrzsz</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">安装方法：</span><br><span class="line">解压文件</span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>localhost develop]# tar zxvf lrzsz<span class="number">-0.12</span><span class="number">.20</span>.tar.gz</span><br><span class="line"></span><br><span class="line">进入文件夹</span><br><span class="line">[<span class="symbol">root@</span>localhost develop]# cd lrzsz<span class="number">-0.12</span><span class="number">.20</span></span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>localhost lrzsz<span class="number">-0.12</span><span class="number">.20</span>]# ./configure --prefix=/usr/local/lrzsz</span><br><span class="line">[<span class="symbol">root@</span>localhost lrzsz<span class="number">-0.12</span><span class="number">.20</span>]# make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">建立软链接</span><br><span class="line">[<span class="symbol">root@</span>localhost lrzsz<span class="number">-0.12</span><span class="number">.20</span>]# cd /usr/bin/</span><br><span class="line">[<span class="symbol">root@</span>localhost bin]# ln -s /usr/local/lrzsz/bin/lrz rz; ln -s /usr/local/lrzsz/bin/lsz sz</span><br><span class="line"></span><br><span class="line">#<span class="comment">//如果文件存在则删除后在创建软连接</span></span><br><span class="line">#ln -s -f /usr/local/lrzsz/bin/xxx xx</span><br><span class="line">测试</span><br><span class="line"></span><br><span class="line">运行 rz 弹出SecureCRT上传窗口。</span><br></pre></td></tr></table></figure>

<h2 id="清屏"><a href="#清屏" class="headerlink" title="清屏"></a>清屏</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cls 清屏</span><br><span class="line">wmic <span class="keyword">cmd</span><span class="bash">窗口最大化：wmic最大化后quit退出就能最大化</span></span><br></pre></td></tr></table></figure>



<h1 id="008-性能"><a href="#008-性能" class="headerlink" title="008-性能"></a>008-性能</h1><h2 id="top"><a href="#top" class="headerlink" title="top"></a>top</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top -p <span class="number">4078</span> -n <span class="number">1</span> 只打印一次</span><br></pre></td></tr></table></figure>

<h2 id="iostat"><a href="#iostat" class="headerlink" title="iostat"></a>iostat</h2><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">io</span><br><span class="line">手动执行：<span class="keyword">iostat</span> -kx <span class="number">2</span></span><br><span class="line">脚本跑这条命令不准?</span><br><span class="line">原因：<span class="keyword">iostat</span>这类命令第一次打印不准，第二次才准确</span><br></pre></td></tr></table></figure>

<h2 id="查看当前占用最多的K个进程"><a href="#查看当前占用最多的K个进程" class="headerlink" title="查看当前占用最多的K个进程"></a>查看当前占用最多的K个进程</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.cnblogs.com/nulige/p/8439231.html</span></span><br><span class="line"></span><br><span class="line">一、可以使用以下命令查使用内存最多的K个进程</span><br><span class="line">ps -aux | sort -k4nr | head <span class="number">-10</span></span><br><span class="line">方法<span class="number">2</span>：top （然后按下M，注意大写）</span><br><span class="line"></span><br><span class="line">二、可以使用下面命令查使用CPU最多的K个进程</span><br><span class="line">ps -aux | sort -k3nr | head <span class="number">-10</span></span><br><span class="line">方法<span class="number">2</span>：top （然后按下P，注意大写）</span><br><span class="line">ps -T -p <span class="number">2568</span>    # 查看进程<span class="number">2568</span>内线程情况</span><br></pre></td></tr></table></figure>

<h2 id="vmstat-iostat"><a href="#vmstat-iostat" class="headerlink" title="vmstat+iostat"></a>vmstat+iostat</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">监控cpu和内存--vmstat <span class="number">2</span></span><br><span class="line">[<span class="symbol">root@</span>pptvtest244 ~]# vmstat <span class="number">2</span></span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----</span><br><span class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   <span class="keyword">in</span>   cs us sy id wa st</span><br><span class="line"> <span class="number">5</span>  <span class="number">0</span>      <span class="number">0</span> <span class="number">40344920</span> <span class="number">467976</span> <span class="number">15203748</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">17</span>    <span class="number">73</span>    <span class="number">0</span>    <span class="number">0</span>  <span class="number">7</span>  <span class="number">3</span> <span class="number">89</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">0</span>      <span class="number">0</span> <span class="number">40331148</span> <span class="number">467976</span> <span class="number">15203780</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>  <span class="number">1012</span> <span class="number">45812</span> <span class="number">68325</span> <span class="number">17</span>  <span class="number">5</span> <span class="number">78</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">0</span>      <span class="number">0</span> <span class="number">40333584</span> <span class="number">467976</span> <span class="number">15203780</span>    <span class="number">0</span>    <span class="number">0</span>   <span class="number">128</span>   <span class="number">961</span> <span class="number">37678</span> <span class="number">63153</span> <span class="number">10</span>  <span class="number">4</span> <span class="number">86</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Memory（内存）：</span><br><span class="line">free: 空闲物理内存大小。</span><br><span class="line"></span><br><span class="line">CPU（以百分比表示）</span><br><span class="line">us: 用户进程执行时间百分比(user time)    us的值比较高时，说明用户进程消耗的CPU时间多，但是如果长期超<span class="number">50</span>%的使用，那么我们就该考虑优化程序算法或者进行加速。</span><br><span class="line">sy: 内核系统进程执行时间百分比(system time)  sy的值高时，说明系统内核消耗的CPU资源多，这并不是良性表现，我们应该检查原因。</span><br><span class="line">id: 空闲时间百分比</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>dev<span class="number">-23</span> ~]# iostat -kx <span class="number">2</span></span><br><span class="line">Linux <span class="number">2.6</span><span class="number">.32</span><span class="number">-279.19</span><span class="number">.1</span>.el6_sn<span class="number">.11</span>.x86_64 (dev<span class="number">-23</span>)         <span class="number">08</span>/<span class="number">01</span>/<span class="number">2018</span>      _x86_64_        (<span class="number">2</span> CPU)</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           <span class="number">0.47</span>    <span class="number">0.00</span>    <span class="number">0.54</span>    <span class="number">0.01</span>    <span class="number">0.01</span>   <span class="number">98.96</span></span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await  svctm  %util</span><br><span class="line">vda               <span class="number">0.00</span>     <span class="number">0.06</span>    <span class="number">0.00</span>    <span class="number">0.17</span>     <span class="number">0.02</span>     <span class="number">0.80</span>     <span class="number">9.70</span>     <span class="number">0.00</span>    <span class="number">3.58</span>   <span class="number">1.46</span>   <span class="number">0.02</span></span><br><span class="line">vdb               <span class="number">0.00</span>     <span class="number">0.13</span>    <span class="number">0.00</span>    <span class="number">0.03</span>     <span class="number">0.00</span>     <span class="number">0.65</span>    <span class="number">38.44</span>     <span class="number">0.00</span>   <span class="number">86.46</span>   <span class="number">1.25</span>   <span class="number">0.00</span></span><br><span class="line">dm<span class="number">-0</span>              <span class="number">0.00</span>     <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>     <span class="number">0.00</span>     <span class="number">0.00</span>     <span class="number">8.00</span>     <span class="number">0.00</span>    <span class="number">0.32</span>   <span class="number">0.23</span>   <span class="number">0.00</span></span><br><span class="line">dm<span class="number">-1</span>              <span class="number">0.00</span>     <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.11</span>     <span class="number">0.01</span>     <span class="number">0.45</span>     <span class="number">8.09</span>     <span class="number">0.00</span>    <span class="number">2.87</span>   <span class="number">1.58</span>   <span class="number">0.02</span></span><br><span class="line">dm<span class="number">-2</span>              <span class="number">0.00</span>     <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>     <span class="number">0.00</span>     <span class="number">0.00</span>     <span class="number">7.85</span>     <span class="number">0.00</span>    <span class="number">1.31</span>   <span class="number">1.25</span>   <span class="number">0.00</span></span><br><span class="line">dm<span class="number">-3</span>              <span class="number">0.00</span>     <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.08</span>     <span class="number">0.00</span>     <span class="number">0.33</span>     <span class="number">7.92</span>     <span class="number">0.00</span>    <span class="number">7.73</span>   <span class="number">0.85</span>   <span class="number">0.01</span></span><br><span class="line">dm<span class="number">-4</span>              <span class="number">0.00</span>     <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>     <span class="number">0.00</span>     <span class="number">0.00</span>     <span class="number">7.98</span>     <span class="number">0.00</span>    <span class="number">8.13</span>   <span class="number">1.92</span>   <span class="number">0.00</span></span><br><span class="line">dm<span class="number">-5</span>              <span class="number">0.00</span>     <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>     <span class="number">0.00</span>     <span class="number">0.00</span>     <span class="number">7.85</span>     <span class="number">0.00</span>    <span class="number">1.66</span>   <span class="number">1.22</span>   <span class="number">0.00</span></span><br><span class="line">dm<span class="number">-6</span>              <span class="number">0.00</span>     <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>     <span class="number">0.01</span>     <span class="number">0.02</span>    <span class="number">10.90</span>     <span class="number">0.00</span>   <span class="number">16.02</span>   <span class="number">1.06</span>   <span class="number">0.00</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r/s  每秒完成的读I/O设备次数。</span><br><span class="line">w/s  每秒完成的写I/O设备次数。</span><br><span class="line">%util 一秒中有百分之多少的时间用于I/O操作，或者说一秒中有多少时间I/O队列是非空的。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="number">01</span>:<span class="number">10</span>:<span class="number">17</span> PM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s</span><br><span class="line"><span class="number">01</span>:<span class="number">10</span>:<span class="number">19</span> PM        lo      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></span><br><span class="line"><span class="number">01</span>:<span class="number">10</span>:<span class="number">19</span> PM      eth0   <span class="number">1298.39</span>    <span class="number">851.61</span>    <span class="number">374.60</span>    <span class="number">215.24</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rxpck/s：每秒钟接收的数据包</span><br><span class="line">txpck/s：每秒钟发送的数据包</span><br><span class="line">rxbyt/s：每秒钟接收的字节数</span><br><span class="line">txbyt/s：每秒钟发送的字节数</span><br><span class="line">rxcmp/s：每秒钟接收的压缩数据包</span><br><span class="line">txcmp/s：每秒钟发送的压缩数据包</span><br><span class="line">rxmcst/s：每秒钟接收的多播数据包</span><br></pre></td></tr></table></figure>



<h1 id="009-异常模拟"><a href="#009-异常模拟" class="headerlink" title="009-异常模拟"></a>009-异常模拟</h1><h2 id="cpu模拟"><a href="#cpu模拟" class="headerlink" title="cpu模拟"></a>cpu模拟</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[Linux运维]常用场景模拟</span> <span class="string">--</span> <span class="string">cpu使用率模拟</span></span><br><span class="line"><span class="string">from</span> <span class="string">http://www.cnblogs.com/zk47/p/4771105.html</span></span><br><span class="line"><span class="number">1</span> <span class="string">单个核</span> <span class="number">100</span><span class="string">%：</span></span><br><span class="line"><span class="string">代码</span> <span class="string">kill_cpu.c</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="string">int</span> <span class="string">main()&#123;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line">    <span class="string">while(1);</span></span><br><span class="line">    <span class="string">return</span> <span class="number">0</span><span class="string">;&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">运行</span></span><br><span class="line"><span class="string">$</span> <span class="string">gcc</span> <span class="string">-o</span> <span class="string">out</span> <span class="string">kill_cpu.c</span></span><br><span class="line"><span class="string">$</span>  <span class="string">./out</span></span><br><span class="line"><span class="string">看top的结果：</span></span><br><span class="line"><span class="string">$</span> <span class="string">top</span></span><br><span class="line"><span class="string">top</span> <span class="bullet">-</span> <span class="number">15</span><span class="string">:44:08</span> <span class="string">up</span> <span class="number">207</span> <span class="string">days,</span> <span class="number">21</span><span class="string">:29,</span>  <span class="number">2</span> <span class="string">users,</span>  <span class="attr">load average:</span> <span class="number">0.08</span><span class="string">,</span> <span class="number">0.13</span><span class="string">,</span> <span class="number">0.10</span></span><br><span class="line"><span class="attr">Tasks:</span> <span class="number">231</span> <span class="string">total,</span>   <span class="number">2</span> <span class="string">running,</span> <span class="number">229</span> <span class="string">sleeping,</span>   <span class="number">0</span> <span class="string">stopped,</span>   <span class="number">0</span> <span class="string">zombie</span></span><br><span class="line"><span class="attr">Cpu0  :</span>  <span class="number">1.0</span><span class="string">%us,</span>  <span class="number">1.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,</span> <span class="number">98.0</span><span class="string">%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">0.0</span><span class="string">%hi,</span>  <span class="number">0.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="string">Cpu1</span>  <span class="string">:100.0%us,</span>  <span class="number">0.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,</span>  <span class="number">0.0</span><span class="string">%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">0.0</span><span class="string">%hi,</span>  <span class="number">0.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="attr">Cpu2  :</span>  <span class="number">0.0</span><span class="string">%us,</span>  <span class="number">0.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,100.0%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">0.0</span><span class="string">%hi,</span>  <span class="number">0.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="attr">Cpu3  :</span>  <span class="number">1.0</span><span class="string">%us,</span>  <span class="number">1.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,</span> <span class="number">98.0</span><span class="string">%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">0.0</span><span class="string">%hi,</span>  <span class="number">0.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="string">看到某一个核的cpu已经达到了100%。这是由于这个进程被调度到了一个核上，没有使用多线程，所以自然就是一个核的cpu是100%。那么如何让所有的cpu都是100%呢。</span></span><br><span class="line"><span class="number">2</span> <span class="string">让所有的核都是100%</span></span><br><span class="line"><span class="string">$</span> <span class="string">for</span> <span class="string">i</span> <span class="string">in</span> <span class="string">`seq</span> <span class="number">1</span> <span class="string">$(cat</span> <span class="string">/proc/cpuinfo</span> <span class="string">|</span> <span class="string">grep</span> <span class="string">"physical id"</span> <span class="string">|</span> <span class="string">wc</span> <span class="string">-l)`;</span> <span class="string">do</span> <span class="string">./out</span> <span class="string">&amp;</span> <span class="string">done</span></span><br><span class="line"><span class="string">[1]</span> <span class="number">5992</span></span><br><span class="line"><span class="string">[2]</span> <span class="number">5993</span></span><br><span class="line"><span class="string">[3]</span> <span class="number">5994</span></span><br><span class="line"><span class="string">[4]</span> <span class="number">5995</span></span><br><span class="line"></span><br><span class="line"><span class="string">$</span></span><br><span class="line"><span class="string">$</span> <span class="string">top</span></span><br><span class="line"><span class="string">top</span> <span class="bullet">-</span> <span class="number">15</span><span class="string">:56:54</span> <span class="string">up</span> <span class="number">207</span> <span class="string">days,</span> <span class="number">21</span><span class="string">:42,</span>  <span class="number">2</span> <span class="string">users,</span>  <span class="attr">load average:</span> <span class="number">1.03</span><span class="string">,</span> <span class="number">0.35</span><span class="string">,</span> <span class="number">0.17</span></span><br><span class="line"><span class="attr">Tasks:</span> <span class="number">234</span> <span class="string">total,</span>   <span class="number">5</span> <span class="string">running,</span> <span class="number">229</span> <span class="string">sleeping,</span>   <span class="number">0</span> <span class="string">stopped,</span>   <span class="number">0</span> <span class="string">zombie</span></span><br><span class="line"><span class="attr">Cpu0  :</span> <span class="number">98.0</span><span class="string">%us,</span>  <span class="number">1.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,</span>  <span class="number">0.0</span><span class="string">%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">0.0</span><span class="string">%hi,</span>  <span class="number">1.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="string">Cpu1</span>  <span class="string">:100.0%us,</span>  <span class="number">0.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,</span>  <span class="number">0.0</span><span class="string">%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">0.0</span><span class="string">%hi,</span>  <span class="number">0.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="attr">Cpu2  :</span> <span class="number">99.0</span><span class="string">%us,</span>  <span class="number">1.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,</span>  <span class="number">0.0</span><span class="string">%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">0.0</span><span class="string">%hi,</span>  <span class="number">0.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="string">Cpu3</span>  <span class="string">:100.0%us,</span>  <span class="number">0.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,</span>  <span class="number">0.0</span><span class="string">%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">0.0</span><span class="string">%hi,</span>  <span class="number">0.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="string">我们看到所有的核都是100%，cat</span> <span class="string">/proc/cpuinfo</span> <span class="string">|</span> <span class="string">grep</span> <span class="string">"physical id"</span> <span class="string">|</span> <span class="string">wc</span> <span class="string">-l是获取到CPU的核数，逻辑核数。这样每一个cpu上都会调度到一个死循环的进程。</span></span><br><span class="line"><span class="string">批量kill进程</span></span><br><span class="line"><span class="string">$</span> <span class="string">ps</span> <span class="string">aux</span> <span class="string">|</span> <span class="string">grep</span> <span class="string">[.]/out</span> <span class="string">|</span> <span class="string">awk</span> <span class="string">'&#123;print $2&#125;'</span> <span class="string">|</span> <span class="string">xargs</span> <span class="string">sudo</span> <span class="string">kill</span> <span class="number">-9</span></span><br><span class="line"><span class="number">3</span> <span class="string">让某个核</span> <span class="number">100</span><span class="string">%</span></span><br><span class="line"><span class="string">$</span> <span class="string">top</span></span><br><span class="line"><span class="string">top</span> <span class="bullet">-</span> <span class="number">16</span><span class="string">:11:03</span> <span class="string">up</span> <span class="number">207</span> <span class="string">days,</span> <span class="number">21</span><span class="string">:56,</span>  <span class="number">2</span> <span class="string">users,</span>  <span class="attr">load average:</span> <span class="number">0.81</span><span class="string">,</span> <span class="number">0.47</span><span class="string">,</span> <span class="number">0.27</span></span><br><span class="line"><span class="attr">Tasks:</span> <span class="number">232</span> <span class="string">total,</span>   <span class="number">2</span> <span class="string">running,</span> <span class="number">230</span> <span class="string">sleeping,</span>   <span class="number">0</span> <span class="string">stopped,</span>   <span class="number">0</span> <span class="string">zombie</span></span><br><span class="line"><span class="attr">Cpu0  :</span>  <span class="number">1.0</span><span class="string">%us,</span>  <span class="number">2.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,</span> <span class="number">94.1</span><span class="string">%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">2.0</span><span class="string">%hi,</span>  <span class="number">1.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="attr">Cpu1  :</span>  <span class="number">0.0</span><span class="string">%us,</span>  <span class="number">0.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,100.0%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">0.0</span><span class="string">%hi,</span>  <span class="number">0.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="string">Cpu2</span>  <span class="string">:100.0%us,</span>  <span class="number">0.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,</span>  <span class="number">0.0</span><span class="string">%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">0.0</span><span class="string">%hi,</span>  <span class="number">0.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="attr">Cpu3  :</span>  <span class="number">0.0</span><span class="string">%us,</span>  <span class="number">0.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,100.0%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">0.0</span><span class="string">%hi,</span>  <span class="number">0.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="string">我们看到当前的进程在cpu2上，可以通过taskset</span> <span class="string">命令绑定cpu</span></span><br><span class="line"><span class="comment"># taskset -cp 0 7368</span></span><br><span class="line"><span class="string">pid</span> <span class="number">7368</span><span class="string">'s current affinity list: 0-3</span></span><br><span class="line"><span class="string">pid 7368'</span><span class="attr">s new affinity list:</span> <span class="number">0</span></span><br><span class="line"><span class="string">进程实际上四个核都是可以使用的，当时由于没有使用多线程，所以只调度到了一个核上。现在经过taskset设置后，现在我们再来看看top的输出：</span></span><br><span class="line"><span class="string">$</span> <span class="string">top</span></span><br><span class="line"><span class="string">top</span> <span class="bullet">-</span> <span class="number">16</span><span class="string">:14:09</span> <span class="string">up</span> <span class="number">207</span> <span class="string">days,</span> <span class="number">21</span><span class="string">:59,</span>  <span class="number">2</span> <span class="string">users,</span>  <span class="attr">load average:</span> <span class="number">0.99</span><span class="string">,</span> <span class="number">0.71</span><span class="string">,</span> <span class="number">0.39</span></span><br><span class="line"><span class="attr">Tasks:</span> <span class="number">230</span> <span class="string">total,</span>   <span class="number">3</span> <span class="string">running,</span> <span class="number">227</span> <span class="string">sleeping,</span>   <span class="number">0</span> <span class="string">stopped,</span>   <span class="number">0</span> <span class="string">zombie</span></span><br><span class="line"><span class="attr">Cpu0  :</span> <span class="number">98.0</span><span class="string">%us,</span>  <span class="number">0.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,</span>  <span class="number">0.0</span><span class="string">%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">1.0</span><span class="string">%hi,</span>  <span class="number">1.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="attr">Cpu1  :</span>  <span class="number">0.0</span><span class="string">%us,</span>  <span class="number">1.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,</span> <span class="number">99.0</span><span class="string">%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">0.0</span><span class="string">%hi,</span>  <span class="number">0.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="attr">Cpu2  :</span>  <span class="number">1.0</span><span class="string">%us,</span>  <span class="number">1.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,</span> <span class="number">98.0</span><span class="string">%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">0.0</span><span class="string">%hi,</span>  <span class="number">0.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="attr">Cpu3  :</span>  <span class="number">0.0</span><span class="string">%us,</span>  <span class="number">0.0</span><span class="string">%sy,</span>  <span class="number">0.0</span><span class="string">%ni,100.0%id,</span>  <span class="number">0.0</span><span class="string">%wa,</span>  <span class="number">0.0</span><span class="string">%hi,</span>  <span class="number">0.0</span><span class="string">%si,</span>  <span class="number">0.0</span><span class="string">%st</span></span><br><span class="line"><span class="string">现在跑到了cpu0上了。</span></span><br><span class="line"><span class="number">4</span> <span class="string">lookbusy</span></span><br><span class="line"><span class="string">$</span> <span class="string">lookbusy</span> <span class="string">-c</span> <span class="number">30</span></span><br><span class="line"><span class="string">让所有的cpu使用率都是30%</span></span><br><span class="line"><span class="string">$</span> <span class="string">lookbusy</span> <span class="string">-c</span> <span class="number">75</span> <span class="string">-n</span> <span class="number">2</span></span><br><span class="line"><span class="string">让两个cpu的使用率为30%</span></span><br><span class="line"><span class="string">$</span> <span class="string">lookbusy</span> <span class="string">--cpu-mode</span> <span class="string">curve</span> <span class="string">--cpu-curve-peak</span> <span class="string">14h</span> <span class="string">-c</span> <span class="number">20</span><span class="number">-80</span></span><br><span class="line"><span class="string">让cpu在20%-%80之间，周期为24H，在14点，即下午2点达到峰值</span></span><br><span class="line"><span class="string">$</span> <span class="string">lookbusy</span> <span class="string">-c</span> <span class="number">20</span><span class="number">-30</span> <span class="string">--cpu-mode</span> <span class="string">curve</span> <span class="string">--cpu-curve-period</span> <span class="string">60m</span> <span class="string">--cpu-curve-peak</span> <span class="string">30m</span></span><br><span class="line"><span class="string">让cpu以60分钟为周期，30分钟是峰值，使用率在20%</span> <span class="bullet">-</span> <span class="number">30</span><span class="string">%之间。</span></span><br></pre></td></tr></table></figure>



<h2 id="网络异常"><a href="#网络异常" class="headerlink" title="网络异常"></a>网络异常</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -s <span class="number">10.27</span><span class="number">.38</span><span class="number">.241</span> -j DROP</span><br><span class="line">这个是断网</span><br><span class="line"></span><br><span class="line">iptables -D INPUT -s <span class="number">10.27</span><span class="number">.38</span><span class="number">.241</span> -j DROP</span><br><span class="line">这个是恢复</span><br><span class="line"></span><br><span class="line">iptables -F</span><br><span class="line">清楚所有已有的条目</span><br></pre></td></tr></table></figure>

<h2 id="消耗内存"><a href="#消耗内存" class="headerlink" title="消耗内存"></a>消耗内存</h2><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph1 tool]<span class="comment"># cat eatMem.c </span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;  </span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;  </span></span><br><span class="line">void main()  </span><br><span class="line">&#123;  </span><br><span class="line">  <span class="keyword">int</span> * a;  </span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  char <span class="keyword">log</span>[<span class="number">256</span>] = <span class="string">&#123;0&#125;</span>;  </span><br><span class="line">  <span class="keyword">system</span>(<span class="string">"&gt; ./free.txt"</span>);  </span><br><span class="line">  <span class="keyword">system</span>(<span class="string">"date &gt;&gt; ./free.txt"</span>);  </span><br><span class="line">  <span class="keyword">system</span>(<span class="string">"free -m &gt;&gt; ./free.txt"</span>);  </span><br><span class="line">  pid_t pid;  </span><br><span class="line">  <span class="keyword">if</span> ((pid = <span class="keyword">fork</span>()) &lt; <span class="number">0</span> )  </span><br><span class="line">  &#123;  </span><br><span class="line">   <span class="keyword">printf</span>(<span class="string">"fork error"</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(pid == <span class="number">0</span>)  </span><br><span class="line">  &#123;  </span><br><span class="line">  <span class="keyword">while</span>(<span class="number">1</span>)  </span><br><span class="line">  &#123;  </span><br><span class="line">   i++;  </span><br><span class="line">   a = (<span class="keyword">int</span> *)malloc(<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">100</span>);     </span><br><span class="line">   <span class="keyword">printf</span>(<span class="string">"allocation=%ldM a=%d \n"</span>,i*<span class="number">100</span>,a);  </span><br><span class="line">  &#125;  </span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="keyword">else</span>  </span><br><span class="line">  &#123;  </span><br><span class="line">  <span class="keyword">while</span>(<span class="number">1</span>)  </span><br><span class="line">  &#123;  </span><br><span class="line">  <span class="keyword">sleep</span>(<span class="number">2</span>);  </span><br><span class="line">  <span class="keyword">system</span>(<span class="string">"date &gt;&gt; ./free.txt"</span>);  </span><br><span class="line">  <span class="keyword">system</span>(<span class="string">"free -m &gt;&gt; ./free.txt"</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">执行：</span><br><span class="line">编译<span class="comment">#  gcc   eatMem.c   -o   test_eatMem</span></span><br><span class="line">运行<span class="comment">#   ./test_eatMem</span></span><br><span class="line"></span><br><span class="line">linux 系统查看物理内存使用率的命令，以百分比形式输出：free -<span class="keyword">m</span> | sed -n <span class="string">'2p'</span> | awk <span class="string">'&#123;print "used mem is "$3"M,total mem is "$2"M,used percent is "$3/$2*100"%"&#125;'</span></span><br><span class="line"></span><br><span class="line">想监视系统内存？好像是没法直接得到现成的百分比的，自己取值计算一下吧</span><br><span class="line">totalmem=<span class="string">`free -m | grep 'Mem' | awk '&#123;print $3&#125;'`</span></span><br><span class="line">usedmem=<span class="string">`free -m | grep 'Mem' | awk '&#123;print $2&#125;'`</span></span><br><span class="line">usage=$(bc&lt;&lt;EOF </span><br><span class="line">scale=<span class="number">4</span></span><br><span class="line">($freemem/$totalmem)*<span class="number">100</span></span><br><span class="line">EOF)</span><br><span class="line">freeusage=<span class="string">`echo $free | awk -F. '&#123;print $1&#125;'`</span></span><br><span class="line">echo <span class="string">"Free Memory Usage = $freeusage%"</span></span><br><span class="line"><span class="string">以前Solaris里的改了改</span></span><br><span class="line"><span class="string">只是个片段，需要什么判断之类自己填充到脚本里 一点点加吧 呵呵 希望对你有帮助</span></span><br><span class="line"><span class="string">单要使用率的话二楼的更简练~~ 呵呵</span></span><br><span class="line"><span class="string">free -m | sed -n '2p' | awk '&#123;print "</span>used mem is <span class="string">"$3"</span>M,total mem is <span class="string">"$2"</span>M,used percent is <span class="string">"$3/$2*100"</span>%"&#125;<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@dev-22 sdfs-test]# free -m（使用率拿红色的比较）</span></span><br><span class="line"><span class="string">             total       used       free     shared    buffers     cached</span></span><br><span class="line"><span class="string">Mem:          3831       3528        302          0        475       1002</span></span><br><span class="line"><span class="string">-/+ buffers/cache:       2051       1779</span></span><br><span class="line"><span class="string">Swap:        10239         78      10161</span></span><br></pre></td></tr></table></figure>

<h2 id="模拟丢包"><a href="#模拟丢包" class="headerlink" title="模拟丢包"></a>模拟丢包</h2><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat /<span class="keyword">proc</span>/cpuinfo |grep "physical<span class="title"> id"</span> |<span class="title"> wc</span> -l 可以获得CPU的个数,　我们将其表示为N.</span><br><span class="line">seq 1<span class="title"> N</span> 用来生成１到Ｎ之间的数字</span><br><span class="line">for<span class="title"> i</span> in `seq 1<span class="title"> N`;</span> 就是循环执行命令,从１到Ｎ</span><br><span class="line"></span><br><span class="line">dd：用指定大小的块拷贝一个文件，并在拷贝的同时进行指定的转换。</span><br><span class="line"> /dev/zero主要的用处是用来创建一个指定长度用于初始化的空文件，就像临时交换文件</span><br><span class="line">把/dev/null看作"黑洞"， 它等价于一个只写文件，所有写入它的内容都会永远丢失.，而尝试从它那儿读取内容则什么也读不到。 </span><br><span class="line">/dev/null对命令行和脚本都非常的有用.</span><br><span class="line">dd<span class="title"> if=/dev/zero</span> of=/dev/null 执行dd命令,　输出到/dev/null, 实际上只占用CPU,　没有IO操作.</span><br><span class="line">由于连续执行Ｎ个(Ｎ是ＣＰＵ个数)的dd 命令, 且使用率为１００%,　这时调度器会调度每个dd命令在不同的CPU上处理.</span><br><span class="line">最终就实现所有ＣＰＵ占用率１００%</span><br><span class="line">linux限制网络带宽 ： http://blog.csdn.net/jacson_bai/article/details/46485725</span><br><span class="line">1、tc<span class="title"> qdisc</span> add<span class="title"> dev</span> eth0<span class="title"> root</span> netem<span class="title"> loss</span> 1% 模拟丢包命令</span><br><span class="line">2、通过其他机子ping修改后的机子</span><br><span class="line">3、tc<span class="title"> qdisc</span> del<span class="title"> dev</span> eth0<span class="title"> root</span>  删除丢包命令</span><br></pre></td></tr></table></figure>

<h2 id="ASM磁盘头信息损坏和修复-kfed-dd"><a href="#ASM磁盘头信息损坏和修复-kfed-dd" class="headerlink" title="ASM磁盘头信息损坏和修复(kfed/dd)"></a>ASM磁盘头信息损坏和修复(kfed/dd)</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">https://blog.csdn.net/zhengwei125/article/details/50836329</span></span><br><span class="line"></span><br><span class="line"><span class="string">KFED主要用来编辑和修复ASM</span> <span class="string">metadata,可以在DiskGroup没有mount的情况下使用;因此在ASM无法启动、DiskGroup无法mount的时候可以尝试使用这个神器来修复。</span></span><br><span class="line"></span><br><span class="line"><span class="string">kfed工具支持对于ASM信息的READ/WRITE/MERGE/NEW/</span> <span class="string">FORM/FIND/STRUCT等操作，11gR2之前需要手工编译.</span> </span><br><span class="line"></span><br><span class="line"><span class="string">一、编译kfed工具</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">.编译</span></span><br><span class="line"><span class="string">[oracle@node1</span> <span class="string">~]$</span> <span class="string">cd</span> <span class="string">$ORACLE_HOME/rdbms/lib</span></span><br><span class="line"><span class="string">[oracle@node1</span> <span class="string">lib]$</span> <span class="string">make</span> <span class="string">-f</span> <span class="string">ins_rdbms.mk</span> <span class="string">ikfed</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">.配置环境变量</span></span><br><span class="line"><span class="string">export</span> <span class="string">PATH=$ORACLE_HOME/bin:$ORACLE_HOME/rdbms/lib:$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="string">.查看帮助</span></span><br><span class="line"><span class="string">[oracle@node1</span> <span class="string">~]$</span> <span class="string">kfed</span> <span class="string">-help</span></span><br><span class="line"><span class="string">as/mlibASM</span> <span class="string">Library</span> <span class="string">[asmlib='lib']</span></span><br><span class="line"><span class="string">aun/umAU</span> <span class="string">number</span> <span class="string">to</span> <span class="string">examine</span> <span class="string">or</span> <span class="string">update</span> <span class="string">[AUNUM=number]</span></span><br><span class="line"><span class="string">aus/zAllocation</span> <span class="string">Unit</span> <span class="string">size</span> <span class="string">in</span> <span class="string">bytes</span> <span class="string">[AUSZ=number]</span></span><br><span class="line"><span class="string">blkn/umBlock</span> <span class="string">number</span> <span class="string">to</span> <span class="string">examine</span> <span class="string">or</span> <span class="string">update</span> <span class="string">[BLKNUM=number]</span></span><br><span class="line"><span class="string">blks/zMetadata</span> <span class="string">block</span> <span class="string">size</span> <span class="string">in</span> <span class="string">bytes</span> <span class="string">[BLKSZ=number]</span></span><br><span class="line"><span class="string">ch/ksumUpdate</span> <span class="string">checksum</span> <span class="string">before</span> <span class="string">each</span> <span class="string">write</span> <span class="string">[CHKSUM=YES/NO]</span></span><br><span class="line"><span class="string">cn/tCount</span> <span class="string">of</span> <span class="string">AUs</span> <span class="string">to</span> <span class="string">process</span> <span class="string">[CNT=number]</span></span><br><span class="line"><span class="string">de/vASM</span> <span class="string">device</span> <span class="string">to</span> <span class="string">examine</span> <span class="string">or</span> <span class="string">update</span> <span class="string">[DEV=string]</span></span><br><span class="line"><span class="string">dm/pallDon't</span> <span class="string">suppress</span> <span class="string">repeated</span> <span class="string">lines</span> <span class="string">when</span> <span class="string">dumping</span> <span class="string">corrupt</span> <span class="string">blocks</span> <span class="string">[DMPALL=YES/NO]</span></span><br><span class="line"><span class="string">o/p</span>    <span class="string">KFED</span> <span class="string">operation</span> <span class="string">type</span> <span class="string">[OP=READ/WRITE/MERGE/REPAIR/NEW/FORM/FIND/STRUCT]</span></span><br><span class="line"><span class="string">p/rovnmName</span> <span class="string">for</span> <span class="string">provisioning</span> <span class="string">purposes</span> <span class="string">[PROVNM=string]</span></span><br><span class="line"><span class="string">s/eekAU</span> <span class="string">number</span> <span class="string">to</span> <span class="string">seek</span> <span class="string">to</span> <span class="string">[SEEK=number]</span></span><br><span class="line"><span class="string">te/xtFile</span> <span class="string">name</span> <span class="string">for</span> <span class="string">translated</span> <span class="string">block</span> <span class="string">text</span> <span class="string">[TEXT=string]</span></span><br><span class="line"><span class="string">ty/peASM</span> <span class="string">metadata</span> <span class="string">block</span> <span class="string">type</span> <span class="string">number</span> <span class="string">[TYPE=number]</span></span><br><span class="line"></span><br><span class="line"><span class="string">asm的每个磁盘上有存放有asm的元数据，元数据一般大小为4k。disk</span> <span class="string">header一般在第0个au,第0个块上。</span> </span><br><span class="line"></span><br><span class="line"><span class="string">二、模拟损坏磁盘头信息</span></span><br><span class="line"> </span><br><span class="line"><span class="number">1</span><span class="string">.</span> <span class="string">备份磁盘头信息：</span></span><br><span class="line"></span><br><span class="line"><span class="string">[root@axj-rac1</span> <span class="string">backup]#dd</span> <span class="string">if=/dev/raw/raw5</span> <span class="string">of=/backup/raw5.bak</span> <span class="string">bs=1M</span> <span class="string">count=2</span></span><br><span class="line"><span class="string">[root@axj-rac1</span> <span class="string">backup]#dd</span> <span class="string">if=/dev/raw/raw6</span> <span class="string">of=/backup/raw6.bak</span> <span class="string">bs=1M</span> <span class="string">count=2</span></span><br><span class="line"><span class="string">[root@axj-rac1</span> <span class="string">backup]#dd</span> <span class="string">if=/dev/raw/raw7</span> <span class="string">of=/backup/raw7.bak</span> <span class="string">bs=1M</span> <span class="string">count=2</span></span><br><span class="line"></span><br><span class="line"><span class="string">备份成txt格式</span></span><br><span class="line"><span class="string">kfed</span> <span class="string">read</span> <span class="string">/dev/raw/raw6</span> <span class="string">text=/home/oracle/asmdisk_raw6.txt</span>  </span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">.</span> <span class="string">查看备份的磁盘头信息</span></span><br><span class="line"><span class="string">[root@axj-rac1</span> <span class="string">oracle]#</span> <span class="string">cat</span> <span class="string">asmdisk_raw6.txt</span> </span><br><span class="line"><span class="attr">kfbh.endian:</span>                          <span class="number">1</span> <span class="string">;</span> <span class="attr">0x000:</span> <span class="number">0x01</span></span><br><span class="line"><span class="attr">kfbh.hard:</span>                          <span class="number">130</span> <span class="string">;</span> <span class="attr">0x001:</span> <span class="number">0x82</span></span><br><span class="line"><span class="attr">kfbh.type:</span>                            <span class="number">1</span> <span class="string">;</span> <span class="attr">0x002:</span> <span class="string">KFBTYP_DISKHEAD</span></span><br><span class="line"><span class="attr">kfbh.datfmt:</span>                          <span class="number">1</span> <span class="string">;</span> <span class="attr">0x003:</span> <span class="number">0x01</span></span><br><span class="line"><span class="attr">kfbh.block.blk:</span>                       <span class="number">0</span> <span class="string">;</span> <span class="attr">0x004:</span> <span class="string">blk=0</span></span><br><span class="line"><span class="attr">kfbh.block.obj:</span>              <span class="number">2147483649</span> <span class="string">;</span> <span class="attr">0x008:</span> <span class="string">disk=1</span></span><br><span class="line"><span class="attr">kfbh.check:</span>                  <span class="number">3657275721</span> <span class="string">;</span> <span class="attr">0x00c:</span> <span class="number">0xd9fd9949</span></span><br><span class="line"><span class="attr">kfbh.fcn.base:</span>                        <span class="number">0</span> <span class="string">;</span> <span class="attr">0x010:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfbh.fcn.wrap:</span>                        <span class="number">0</span> <span class="string">;</span> <span class="attr">0x014:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfbh.spare1:</span>                          <span class="number">0</span> <span class="string">;</span> <span class="attr">0x018:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfbh.spare2:</span>                          <span class="number">0</span> <span class="string">;</span> <span class="attr">0x01c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.driver.provstr:</span>         <span class="string">ORCLDISK</span> <span class="string">;</span> <span class="attr">0x000:</span> <span class="string">length=8</span></span><br><span class="line"><span class="string">kfdhdb.driver.reserved[0]:</span>            <span class="number">0</span> <span class="string">;</span> <span class="attr">0x008:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.driver.reserved[1]:</span>            <span class="number">0</span> <span class="string">;</span> <span class="attr">0x00c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.driver.reserved[2]:</span>            <span class="number">0</span> <span class="string">;</span> <span class="attr">0x010:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.driver.reserved[3]:</span>            <span class="number">0</span> <span class="string">;</span> <span class="attr">0x014:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.driver.reserved[4]:</span>            <span class="number">0</span> <span class="string">;</span> <span class="attr">0x018:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.driver.reserved[5]:</span>            <span class="number">0</span> <span class="string">;</span> <span class="attr">0x01c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.compat:</span>                <span class="number">186646528</span> <span class="string">;</span> <span class="attr">0x020:</span> <span class="number">0x0b200000</span></span><br><span class="line"><span class="attr">kfdhdb.dsknum:</span>                        <span class="number">1</span> <span class="string">;</span> <span class="attr">0x024:</span> <span class="number">0x0001</span></span><br><span class="line"><span class="attr">kfdhdb.grptyp:</span>                        <span class="number">1</span> <span class="string">;</span> <span class="attr">0x026:</span> <span class="string">KFDGTP_EXTERNAL</span>  <span class="string">--磁盘组冗余方式</span></span><br><span class="line"><span class="string">kfdhdb.hdrsts:</span>                        <span class="number">3</span> <span class="string">;</span> <span class="attr">0x027:</span> <span class="string">KFDHDR_MEMBER</span>    <span class="string">--磁盘组状态，3是可用状态</span></span><br><span class="line"><span class="attr">kfdhdb.dskname:</span>           <span class="string">DATADG01_0001</span> <span class="string">;</span> <span class="attr">0x028:</span> <span class="string">length=13</span></span><br><span class="line"><span class="attr">kfdhdb.grpname:</span>                <span class="string">DATADG01</span> <span class="string">;</span> <span class="attr">0x048:</span> <span class="string">length=8</span>         <span class="string">--磁盘组名字</span></span><br><span class="line"><span class="attr">kfdhdb.fgname:</span>            <span class="string">DATADG01_0001</span> <span class="string">;</span> <span class="attr">0x068:</span> <span class="string">length=13</span></span><br><span class="line"><span class="attr">kfdhdb.capname:</span>                         <span class="string">;</span> <span class="attr">0x088:</span> <span class="string">length=0</span></span><br><span class="line"><span class="attr">kfdhdb.crestmp.hi:</span>             <span class="number">33026093</span> <span class="string">;</span> <span class="attr">0x0a8:</span> <span class="string">HOUR=0xd</span> <span class="string">DAYS=0x1</span> <span class="string">MNTH=0xc</span> <span class="string">YEAR=0x7df</span></span><br><span class="line"><span class="attr">kfdhdb.crestmp.lo:</span>           <span class="number">2356159488</span> <span class="string">;</span> <span class="attr">0x0ac:</span> <span class="string">USEC=0x0</span> <span class="string">MSEC=0x9</span> <span class="string">SECS=0x7</span> <span class="string">MINS=0x23</span></span><br><span class="line"><span class="attr">kfdhdb.mntstmp.hi:</span>             <span class="number">33032273</span> <span class="string">;</span> <span class="attr">0x0b0:</span> <span class="string">HOUR=0x11</span> <span class="string">DAYS=0x2</span> <span class="string">MNTH=0x2</span> <span class="string">YEAR=0x7e0</span></span><br><span class="line"><span class="attr">kfdhdb.mntstmp.lo:</span>           <span class="number">3209038848</span> <span class="string">;</span> <span class="attr">0x0b4:</span> <span class="string">USEC=0x0</span> <span class="string">MSEC=0x183</span> <span class="string">SECS=0x34</span> <span class="string">MINS=0x2f</span></span><br><span class="line"><span class="attr">kfdhdb.secsize:</span>                     <span class="number">512</span> <span class="string">;</span> <span class="attr">0x0b8:</span> <span class="number">0x0200</span></span><br><span class="line"><span class="attr">kfdhdb.blksize:</span>                    <span class="number">4096</span> <span class="string">;</span> <span class="attr">0x0ba:</span> <span class="number">0x1000</span></span><br><span class="line"><span class="attr">kfdhdb.ausize:</span>                  <span class="number">1048576</span> <span class="string">;</span> <span class="attr">0x0bc:</span> <span class="number">0x00100000</span>  <span class="string">--au的大小，单位是byte,大小是1M</span></span><br><span class="line"><span class="attr">kfdhdb.mfact:</span>                    <span class="number">113792</span> <span class="string">;</span> <span class="attr">0x0c0:</span> <span class="number">0x0001bc80</span></span><br><span class="line"><span class="attr">kfdhdb.dsksize:</span>                    <span class="number">4008</span> <span class="string">;</span> <span class="attr">0x0c4:</span> <span class="number">0x00000fa8</span>  <span class="string">--该disk的大小，单位是au，默认au是1m，所以大小为4008M</span></span><br><span class="line"><span class="attr">kfdhdb.pmcnt:</span>                         <span class="number">2</span> <span class="string">;</span> <span class="attr">0x0c8:</span> <span class="number">0x00000002</span></span><br><span class="line"><span class="attr">kfdhdb.fstlocn:</span>                       <span class="number">1</span> <span class="string">;</span> <span class="attr">0x0cc:</span> <span class="number">0x00000001</span></span><br><span class="line"><span class="attr">kfdhdb.altlocn:</span>                       <span class="number">2</span> <span class="string">;</span> <span class="attr">0x0d0:</span> <span class="number">0x00000002</span></span><br><span class="line"><span class="attr">kfdhdb.f1b1locn:</span>                      <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0d4:</span> <span class="number">0x00000000</span>  <span class="string">--file</span> <span class="string">directory所在的au位置</span></span><br><span class="line"><span class="string">kfdhdb.redomirrors[0]:</span>                <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0d8:</span> <span class="number">0x0000</span></span><br><span class="line"><span class="string">kfdhdb.redomirrors[1]:</span>                <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0da:</span> <span class="number">0x0000</span></span><br><span class="line"><span class="string">kfdhdb.redomirrors[2]:</span>                <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0dc:</span> <span class="number">0x0000</span></span><br><span class="line"><span class="string">kfdhdb.redomirrors[3]:</span>                <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0de:</span> <span class="number">0x0000</span></span><br><span class="line"><span class="attr">kfdhdb.dbcompat:</span>              <span class="number">168820736</span> <span class="string">;</span> <span class="attr">0x0e0:</span> <span class="number">0x0a100000</span></span><br><span class="line"><span class="attr">kfdhdb.grpstmp.hi:</span>             <span class="number">33024790</span> <span class="string">;</span> <span class="attr">0x0e4:</span> <span class="string">HOUR=0x16</span> <span class="string">DAYS=0x18</span> <span class="string">MNTH=0xa</span> <span class="string">YEAR=0x7df</span></span><br><span class="line"><span class="attr">kfdhdb.grpstmp.lo:</span>            <span class="number">258378752</span> <span class="string">;</span> <span class="attr">0x0e8:</span> <span class="string">USEC=0x0</span> <span class="string">MSEC=0x1a3</span> <span class="string">SECS=0x36</span> <span class="string">MINS=0x3</span></span><br><span class="line"><span class="attr">kfdhdb.vfstart:</span>                       <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0ec:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.vfend:</span>                         <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0f0:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.spfile:</span>                        <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0f4:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.spfflg:</span>                        <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0f8:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[0]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0fc:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[1]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x100:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[2]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x104:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[3]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x108:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[4]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x10c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[5]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x110:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[6]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x114:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[7]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x118:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[8]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x11c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[9]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x120:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[10]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x124:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[11]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x128:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[12]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x12c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[13]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x130:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[14]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x134:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[15]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x138:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[16]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x13c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[17]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x140:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[18]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x144:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[19]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x148:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[20]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x14c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[21]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x150:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[22]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x154:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[23]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x158:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[24]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x15c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[25]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x160:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[26]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x164:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[27]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x168:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[28]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x16c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[29]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x170:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[30]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x174:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[31]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x178:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[32]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x17c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[33]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x180:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[34]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x184:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[35]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x188:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[36]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x18c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[37]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x190:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[38]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x194:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[39]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x198:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[40]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x19c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[41]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1a0:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[42]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1a4:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[43]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1a8:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[44]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1ac:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[45]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1b0:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[46]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1b4:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[47]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1b8:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[48]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1bc:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[49]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1c0:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[50]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1c4:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[51]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1c8:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[52]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1cc:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[53]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1d0:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.acdb.aba.seq:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1d4:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.acdb.aba.blk:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1d8:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.acdb.ents:</span>                     <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1dc:</span> <span class="number">0x0000</span></span><br><span class="line"><span class="attr">kfdhdb.acdb.ub2spare:</span>                 <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1de:</span> <span class="number">0x0000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="string">.破坏磁盘头的元数据，这里我开始破坏了raw5,后来为达到效果又破坏了下面两个</span></span><br><span class="line"><span class="string">[root@axj-rac1</span> <span class="string">backup]#</span> <span class="string">dd</span> <span class="string">if=/dev/zero</span> <span class="string">of=/dev/raw/raw5</span> <span class="string">bs=4096</span> <span class="string">count=1</span> </span><br><span class="line"><span class="string">[root@axj-rac1</span> <span class="string">backup]#</span> <span class="string">dd</span> <span class="string">if=/dev/zero</span> <span class="string">of=/dev/raw/raw6</span> <span class="string">bs=4096</span> <span class="string">count=1</span> </span><br><span class="line"><span class="string">[root@axj-rac1</span> <span class="string">backup]#</span> <span class="string">dd</span> <span class="string">if=/dev/zero</span> <span class="string">of=/dev/raw/raw7</span> <span class="string">bs=4096</span> <span class="string">count=1</span> </span><br><span class="line"></span><br><span class="line"><span class="number">4</span><span class="string">.查看一下磁盘头的状态</span></span><br><span class="line"></span><br><span class="line"><span class="string">col</span> <span class="string">group_number</span> <span class="string">format</span> <span class="string">a30</span></span><br><span class="line"><span class="string">col</span> <span class="string">disk_number</span> <span class="string">format</span> <span class="string">a30</span> </span><br><span class="line"><span class="string">col</span> <span class="string">name</span> <span class="string">format</span> <span class="string">a30</span></span><br><span class="line"><span class="string">col</span> <span class="string">header_status</span> <span class="string">format</span> <span class="string">a30</span></span><br><span class="line"><span class="string">col</span> <span class="string">path</span> <span class="string">format</span> <span class="string">a30</span></span><br><span class="line"><span class="string">col</span> <span class="string">group_number</span> <span class="string">clear</span></span><br><span class="line"><span class="string">col</span> <span class="string">disk_number</span> <span class="string">clear</span></span><br><span class="line"><span class="string">set</span> <span class="string">linesize</span> <span class="number">200</span> <span class="string">pagesize</span> <span class="number">2000</span> </span><br><span class="line"><span class="string">SQL&gt;</span> <span class="string">select</span> <span class="string">group_number,disk_number,name,header_status,path</span> <span class="string">from</span> <span class="string">v$asm_disk;</span></span><br><span class="line"></span><br><span class="line"><span class="string">GROUP_NUMBER</span> <span class="string">DISK_NUMBER</span> <span class="string">NAMEHEADER_STATU</span> <span class="string">PATH</span></span><br><span class="line"><span class="string">----------------------</span> <span class="string">---------------------------</span></span><br><span class="line">   <span class="number">2</span>       <span class="number">0</span> <span class="string">OCR_VOTE_0000MEMBER</span>     <span class="string">/dev/raw/raw1</span></span><br><span class="line">   <span class="number">1</span>       <span class="number">1</span> <span class="string">DATADG01_0001MEMBER</span>     <span class="string">/dev/raw/raw6</span></span><br><span class="line">   <span class="number">2</span>       <span class="number">1</span> <span class="string">OCR_VOTE_0001MEMBER</span>     <span class="string">/dev/raw/raw2</span></span><br><span class="line">   <span class="number">2</span>       <span class="number">2</span> <span class="string">OCR_VOTE_0002MEMBER</span>     <span class="string">/dev/raw/raw3</span></span><br><span class="line">   <span class="number">1</span>       <span class="number">0</span> <span class="string">DATADG01_0000MEMBER</span>     <span class="string">/dev/raw/raw5</span></span><br><span class="line">   <span class="number">1</span>       <span class="number">2</span> <span class="string">DATADG01_0002MEMBER</span>     <span class="string">/dev/raw/raw7</span></span><br><span class="line"><span class="string">上面是正常的状态</span></span><br><span class="line">   </span><br><span class="line"><span class="string">SQL&gt;</span> <span class="string">select</span> <span class="string">group_number,disk_number,name,header_status,path</span> <span class="string">from</span> <span class="string">v$asm_disk;</span></span><br><span class="line"></span><br><span class="line"><span class="string">GROUP_NUMBER</span> <span class="string">DISK_NUMBER</span> <span class="string">NAMEHEADER_STATUS</span>       <span class="string">PATH</span></span><br><span class="line"><span class="string">------------</span> <span class="string">---------------------------------------</span></span><br><span class="line">   <span class="number">2</span>       <span class="number">0</span> <span class="string">OCR_VOTE_0000MEMBER</span>       <span class="string">/dev/raw/raw1</span></span><br><span class="line">   <span class="number">1</span>       <span class="number">1</span> <span class="string">DATADG01_0001MEMBER</span>       <span class="string">/dev/raw/raw6</span></span><br><span class="line">   <span class="number">2</span>       <span class="number">1</span> <span class="string">OCR_VOTE_0001MEMBER</span>       <span class="string">/dev/raw/raw2</span></span><br><span class="line">   <span class="number">2</span>       <span class="number">2</span> <span class="string">OCR_VOTE_0002MEMBER</span>       <span class="string">/dev/raw/raw3</span></span><br><span class="line">   <span class="number">1</span>       <span class="number">0</span> <span class="string">DATADG01_0000CANDIDATE</span>    <span class="string">/dev/raw/raw5</span></span><br><span class="line">   <span class="number">1</span>       <span class="number">2</span> <span class="string">DATADG01_0002MEMBER</span>       <span class="string">/dev/raw/raw7</span></span><br><span class="line"></span><br><span class="line"><span class="string">这里是破坏后的状态，raw状态为CANDIDATE</span>       </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line"><span class="number">5</span><span class="string">.破坏后查看用kfed查看raw5的磁盘头的信息</span></span><br><span class="line">  </span><br><span class="line"><span class="string">[root@axj-rac1</span> <span class="string">oracle]#</span>  <span class="string">kfed</span> <span class="string">read</span> <span class="string">/dev/raw/raw5</span> <span class="string">aun=0</span> <span class="string">blkn=0</span></span><br><span class="line"><span class="attr">kfbh.endian:</span>                          <span class="number">0</span> <span class="string">;</span> <span class="attr">0x000:</span> <span class="number">0x00</span></span><br><span class="line"><span class="attr">kfbh.hard:</span>                            <span class="number">0</span> <span class="string">;</span> <span class="attr">0x001:</span> <span class="number">0x00</span></span><br><span class="line"><span class="attr">kfbh.type:</span>                            <span class="number">0</span> <span class="string">;</span> <span class="attr">0x002:</span> <span class="string">KFBTYP_INVALID</span></span><br><span class="line"><span class="attr">kfbh.datfmt:</span>                          <span class="number">0</span> <span class="string">;</span> <span class="attr">0x003:</span> <span class="number">0x00</span></span><br><span class="line"><span class="attr">kfbh.block.blk:</span>                       <span class="number">0</span> <span class="string">;</span> <span class="attr">0x004:</span> <span class="string">blk=0</span></span><br><span class="line"><span class="attr">kfbh.block.obj:</span>                       <span class="number">0</span> <span class="string">;</span> <span class="attr">0x008:</span> <span class="string">file=0</span></span><br><span class="line"><span class="attr">kfbh.check:</span>                           <span class="number">0</span> <span class="string">;</span> <span class="attr">0x00c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfbh.fcn.base:</span>                        <span class="number">0</span> <span class="string">;</span> <span class="attr">0x010:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfbh.fcn.wrap:</span>                        <span class="number">0</span> <span class="string">;</span> <span class="attr">0x014:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfbh.spare1:</span>                          <span class="number">0</span> <span class="string">;</span> <span class="attr">0x018:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfbh.spare2:</span>                          <span class="number">0</span> <span class="string">;</span> <span class="attr">0x01c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">7F5595918400</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>  <span class="string">[................]</span></span><br><span class="line">  <span class="string">Repeat</span> <span class="number">255</span> <span class="string">times</span></span><br><span class="line"><span class="attr">KFED-00322: Invalid content encountered during block traversal:</span> <span class="string">[kfbtTraverseBlock][Invalid</span> <span class="string">OSM</span> <span class="string">block</span> <span class="string">type][][0]</span></span><br><span class="line"><span class="string">可以看到已经报错了，跟上面的不一样了。</span></span><br><span class="line"></span><br><span class="line"><span class="string">依次查看raw6和raw7的磁盘头信息</span></span><br><span class="line"><span class="string">kfed</span> <span class="string">read</span> <span class="string">/backup/raw6.bak</span> <span class="string">aun=1</span> <span class="string">blkn=254</span></span><br><span class="line"><span class="string">kfed</span> <span class="string">read</span> <span class="string">/backup/raw7.bak</span> <span class="string">aun=1</span> <span class="string">blkn=254</span>  </span><br><span class="line"> </span><br><span class="line"><span class="string">[root@axj-rac1</span> <span class="string">backup]#</span> <span class="string">kfed</span> <span class="string">read</span> <span class="string">/backup/raw5.bak</span> <span class="string">aun=1</span> <span class="string">blkn=254|grep</span>  <span class="string">kfbh.type</span></span><br><span class="line"><span class="attr">kfbh.type:</span>                            <span class="number">1</span> <span class="string">;</span> <span class="attr">0x002:</span> <span class="string">KFBTYP_DISKHEAD</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">从10.2.0.5开始之后的版本header信息是有额外保护和备份的，那么备份在哪个位置</span></span><br><span class="line"><span class="string">也是在disk的特定位置，这对au=1MB的dg，备份信息是在第510blkn的位置，我们可以看下位置510的信息：</span></span><br><span class="line"></span><br><span class="line"><span class="string">[root@axj-rac1</span> <span class="string">backup]#</span>  <span class="string">kfed</span> <span class="string">read</span> <span class="string">/dev/raw/raw5</span> <span class="string">aun=0</span> <span class="string">blkn=510</span> <span class="string">|</span> <span class="string">grep</span> <span class="string">kfbh.type</span></span><br><span class="line"><span class="attr">kfbh.type:</span>                            <span class="number">1</span> <span class="string">;</span> <span class="attr">0x002:</span> <span class="string">KFBTYP_DISKHEAD</span></span><br><span class="line"></span><br><span class="line"><span class="string">可以看到510确实也是HEAD信息把它读出来看看</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">[root@axj-rac1</span> <span class="string">backup]#</span> <span class="string">kfed</span> <span class="string">read</span> <span class="string">/dev/raw/raw5</span> <span class="string">blkn=510</span></span><br><span class="line"><span class="attr">kfbh.endian:</span>                          <span class="number">1</span> <span class="string">;</span> <span class="attr">0x000:</span> <span class="number">0x01</span></span><br><span class="line"><span class="attr">kfbh.hard:</span>                          <span class="number">130</span> <span class="string">;</span> <span class="attr">0x001:</span> <span class="number">0x82</span></span><br><span class="line"><span class="attr">kfbh.type:</span>                            <span class="number">1</span> <span class="string">;</span> <span class="attr">0x002:</span> <span class="string">KFBTYP_DISKHEAD</span></span><br><span class="line"><span class="attr">kfbh.datfmt:</span>                          <span class="number">1</span> <span class="string">;</span> <span class="attr">0x003:</span> <span class="number">0x01</span></span><br><span class="line"><span class="attr">kfbh.block.blk:</span>                     <span class="number">254</span> <span class="string">;</span> <span class="attr">0x004:</span> <span class="string">blk=254</span></span><br><span class="line"><span class="attr">kfbh.block.obj:</span>              <span class="number">2147483648</span> <span class="string">;</span> <span class="attr">0x008:</span> <span class="string">disk=0</span></span><br><span class="line"><span class="attr">kfbh.check:</span>                   <span class="number">323429756</span> <span class="string">;</span> <span class="attr">0x00c:</span> <span class="number">0x1347257c</span></span><br><span class="line"><span class="attr">kfbh.fcn.base:</span>                    <span class="number">16403</span> <span class="string">;</span> <span class="attr">0x010:</span> <span class="number">0x00004013</span></span><br><span class="line"><span class="attr">kfbh.fcn.wrap:</span>                        <span class="number">0</span> <span class="string">;</span> <span class="attr">0x014:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfbh.spare1:</span>                          <span class="number">0</span> <span class="string">;</span> <span class="attr">0x018:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfbh.spare2:</span>                          <span class="number">0</span> <span class="string">;</span> <span class="attr">0x01c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.driver.provstr:</span>         <span class="string">ORCLDISK</span> <span class="string">;</span> <span class="attr">0x000:</span> <span class="string">length=8</span></span><br><span class="line"><span class="string">kfdhdb.driver.reserved[0]:</span>            <span class="number">0</span> <span class="string">;</span> <span class="attr">0x008:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.driver.reserved[1]:</span>            <span class="number">0</span> <span class="string">;</span> <span class="attr">0x00c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.driver.reserved[2]:</span>            <span class="number">0</span> <span class="string">;</span> <span class="attr">0x010:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.driver.reserved[3]:</span>            <span class="number">0</span> <span class="string">;</span> <span class="attr">0x014:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.driver.reserved[4]:</span>            <span class="number">0</span> <span class="string">;</span> <span class="attr">0x018:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.driver.reserved[5]:</span>            <span class="number">0</span> <span class="string">;</span> <span class="attr">0x01c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.compat:</span>                <span class="number">186646528</span> <span class="string">;</span> <span class="attr">0x020:</span> <span class="number">0x0b200000</span></span><br><span class="line"><span class="attr">kfdhdb.dsknum:</span>                        <span class="number">0</span> <span class="string">;</span> <span class="attr">0x024:</span> <span class="number">0x0000</span></span><br><span class="line"><span class="attr">kfdhdb.grptyp:</span>                        <span class="number">1</span> <span class="string">;</span> <span class="attr">0x026:</span> <span class="string">KFDGTP_EXTERNAL</span></span><br><span class="line"><span class="attr">kfdhdb.hdrsts:</span>                        <span class="number">3</span> <span class="string">;</span> <span class="attr">0x027:</span> <span class="string">KFDHDR_MEMBER</span></span><br><span class="line"><span class="attr">kfdhdb.dskname:</span>           <span class="string">DATADG01_0000</span> <span class="string">;</span> <span class="attr">0x028:</span> <span class="string">length=13</span></span><br><span class="line"><span class="attr">kfdhdb.grpname:</span>                <span class="string">DATADG01</span> <span class="string">;</span> <span class="attr">0x048:</span> <span class="string">length=8</span></span><br><span class="line"><span class="attr">kfdhdb.fgname:</span>            <span class="string">DATADG01_0000</span> <span class="string">;</span> <span class="attr">0x068:</span> <span class="string">length=13</span></span><br><span class="line"><span class="attr">kfdhdb.capname:</span>                         <span class="string">;</span> <span class="attr">0x088:</span> <span class="string">length=0</span></span><br><span class="line"><span class="attr">kfdhdb.crestmp.hi:</span>             <span class="number">33024790</span> <span class="string">;</span> <span class="attr">0x0a8:</span> <span class="string">HOUR=0x16</span> <span class="string">DAYS=0x18</span> <span class="string">MNTH=0xa</span> <span class="string">YEAR=0x7df</span></span><br><span class="line"><span class="attr">kfdhdb.crestmp.lo:</span>            <span class="number">258502656</span> <span class="string">;</span> <span class="attr">0x0ac:</span> <span class="string">USEC=0x0</span> <span class="string">MSEC=0x21c</span> <span class="string">SECS=0x36</span> <span class="string">MINS=0x3</span></span><br><span class="line"><span class="attr">kfdhdb.mntstmp.hi:</span>             <span class="number">33032273</span> <span class="string">;</span> <span class="attr">0x0b0:</span> <span class="string">HOUR=0x11</span> <span class="string">DAYS=0x2</span> <span class="string">MNTH=0x2</span> <span class="string">YEAR=0x7e0</span></span><br><span class="line"><span class="attr">kfdhdb.mntstmp.lo:</span>           <span class="number">3209038848</span> <span class="string">;</span> <span class="attr">0x0b4:</span> <span class="string">USEC=0x0</span> <span class="string">MSEC=0x183</span> <span class="string">SECS=0x34</span> <span class="string">MINS=0x2f</span></span><br><span class="line"><span class="attr">kfdhdb.secsize:</span>                     <span class="number">512</span> <span class="string">;</span> <span class="attr">0x0b8:</span> <span class="number">0x0200</span></span><br><span class="line"><span class="attr">kfdhdb.blksize:</span>                    <span class="number">4096</span> <span class="string">;</span> <span class="attr">0x0ba:</span> <span class="number">0x1000</span></span><br><span class="line"><span class="attr">kfdhdb.ausize:</span>                  <span class="number">1048576</span> <span class="string">;</span> <span class="attr">0x0bc:</span> <span class="number">0x00100000</span></span><br><span class="line"><span class="attr">kfdhdb.mfact:</span>                    <span class="number">113792</span> <span class="string">;</span> <span class="attr">0x0c0:</span> <span class="number">0x0001bc80</span></span><br><span class="line"><span class="attr">kfdhdb.dsksize:</span>                    <span class="number">2008</span> <span class="string">;</span> <span class="attr">0x0c4:</span> <span class="number">0x000007d8</span></span><br><span class="line"><span class="attr">kfdhdb.pmcnt:</span>                         <span class="number">2</span> <span class="string">;</span> <span class="attr">0x0c8:</span> <span class="number">0x00000002</span></span><br><span class="line"><span class="attr">kfdhdb.fstlocn:</span>                       <span class="number">1</span> <span class="string">;</span> <span class="attr">0x0cc:</span> <span class="number">0x00000001</span></span><br><span class="line"><span class="attr">kfdhdb.altlocn:</span>                       <span class="number">2</span> <span class="string">;</span> <span class="attr">0x0d0:</span> <span class="number">0x00000002</span></span><br><span class="line"><span class="attr">kfdhdb.f1b1locn:</span>                      <span class="number">2</span> <span class="string">;</span> <span class="attr">0x0d4:</span> <span class="number">0x00000002</span></span><br><span class="line"><span class="string">kfdhdb.redomirrors[0]:</span>                <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0d8:</span> <span class="number">0x0000</span></span><br><span class="line"><span class="string">kfdhdb.redomirrors[1]:</span>            <span class="number">65535</span> <span class="string">;</span> <span class="attr">0x0da:</span> <span class="number">0xffff</span></span><br><span class="line"><span class="string">kfdhdb.redomirrors[2]:</span>            <span class="number">65535</span> <span class="string">;</span> <span class="attr">0x0dc:</span> <span class="number">0xffff</span></span><br><span class="line"><span class="string">kfdhdb.redomirrors[3]:</span>            <span class="number">65535</span> <span class="string">;</span> <span class="attr">0x0de:</span> <span class="number">0xffff</span></span><br><span class="line"><span class="attr">kfdhdb.dbcompat:</span>              <span class="number">168820736</span> <span class="string">;</span> <span class="attr">0x0e0:</span> <span class="number">0x0a100000</span></span><br><span class="line"><span class="attr">kfdhdb.grpstmp.hi:</span>             <span class="number">33024790</span> <span class="string">;</span> <span class="attr">0x0e4:</span> <span class="string">HOUR=0x16</span> <span class="string">DAYS=0x18</span> <span class="string">MNTH=0xa</span> <span class="string">YEAR=0x7df</span></span><br><span class="line"><span class="attr">kfdhdb.grpstmp.lo:</span>            <span class="number">258378752</span> <span class="string">;</span> <span class="attr">0x0e8:</span> <span class="string">USEC=0x0</span> <span class="string">MSEC=0x1a3</span> <span class="string">SECS=0x36</span> <span class="string">MINS=0x3</span></span><br><span class="line"><span class="attr">kfdhdb.vfstart:</span>                       <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0ec:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.vfend:</span>                         <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0f0:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.spfile:</span>                        <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0f4:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.spfflg:</span>                        <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0f8:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[0]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x0fc:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[1]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x100:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[2]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x104:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[3]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x108:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[4]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x10c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[5]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x110:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[6]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x114:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[7]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x118:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[8]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x11c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[9]:</span>                   <span class="number">0</span> <span class="string">;</span> <span class="attr">0x120:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[10]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x124:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[11]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x128:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[12]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x12c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[13]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x130:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[14]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x134:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[15]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x138:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[16]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x13c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[17]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x140:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[18]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x144:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[19]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x148:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[20]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x14c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[21]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x150:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[22]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x154:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[23]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x158:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[24]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x15c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[25]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x160:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[26]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x164:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[27]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x168:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[28]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x16c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[29]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x170:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[30]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x174:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[31]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x178:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[32]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x17c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[33]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x180:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[34]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x184:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[35]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x188:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[36]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x18c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[37]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x190:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[38]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x194:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[39]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x198:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[40]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x19c:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[41]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1a0:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[42]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1a4:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[43]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1a8:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[44]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1ac:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[45]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1b0:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[46]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1b4:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[47]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1b8:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[48]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1bc:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[49]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1c0:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[50]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1c4:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[51]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1c8:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[52]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1cc:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="string">kfdhdb.ub4spare[53]:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1d0:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.acdb.aba.seq:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1d4:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.acdb.aba.blk:</span>                  <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1d8:</span> <span class="number">0x00000000</span></span><br><span class="line"><span class="attr">kfdhdb.acdb.ents:</span>                     <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1dc:</span> <span class="number">0x0000</span></span><br><span class="line"><span class="attr">kfdhdb.acdb.ub2spare:</span>                 <span class="number">0</span> <span class="string">;</span> <span class="attr">0x1de:</span> <span class="number">0x0000</span></span><br><span class="line"></span><br><span class="line"><span class="string">通过对比我们可以发现与之前的raw5磁盘头的内容是一摸一样的。</span></span><br><span class="line"></span><br><span class="line"><span class="number">6</span><span class="string">.由于之前破坏掉了raw5磁盘头信息，看看有啥报错</span></span><br><span class="line"></span><br><span class="line"><span class="string">[oracle@axj-rac1</span> <span class="string">~]$</span> <span class="string">sqlplus</span> <span class="string">/</span> <span class="string">as</span> <span class="string">sysdba</span></span><br><span class="line"><span class="string">SQL*Plus:</span> <span class="string">Release</span> <span class="number">11.2</span><span class="number">.0</span><span class="number">.3</span><span class="number">.0</span> <span class="string">Production</span> <span class="string">on</span> <span class="string">Wed</span> <span class="string">Mar</span> <span class="number">9</span> <span class="number">15</span><span class="string">:09:17</span> <span class="number">2016</span></span><br><span class="line"><span class="string">Copyright</span> <span class="string">(c)</span> <span class="number">1982</span><span class="string">,</span> <span class="number">2011</span><span class="string">,</span> <span class="string">Oracle.</span>  <span class="string">All</span> <span class="string">rights</span> <span class="string">reserved.</span></span><br><span class="line"><span class="string">Connected</span> <span class="string">to</span> <span class="string">an</span> <span class="string">idle</span> <span class="string">instance.</span></span><br><span class="line"></span><br><span class="line"><span class="string">SQL&gt;</span> <span class="string">startup</span>  <span class="string">--重启数据库发现报错了</span></span><br><span class="line"><span class="attr">ORA-01078:</span> <span class="string">failure</span> <span class="string">in</span> <span class="string">processing</span> <span class="string">system</span> <span class="string">parameters</span></span><br><span class="line"><span class="attr">ORA-01565:</span> <span class="string">error</span> <span class="string">in</span> <span class="string">identifying</span> <span class="string">file</span> <span class="string">'+DATADG01/rac11g/spfilerac11g.ora'</span></span><br><span class="line"><span class="attr">ORA-17503:</span> <span class="string">ksfdopn:2</span> <span class="string">Failed</span> <span class="string">to</span> <span class="string">open</span> <span class="string">file</span> <span class="string">+DATADG01/rac11g/spfilerac11g.ora</span></span><br><span class="line"><span class="attr">ORA-15077:</span> <span class="string">could</span> <span class="string">not</span> <span class="string">locate</span> <span class="string">ASM</span> <span class="string">instance</span> <span class="string">serving</span> <span class="string">a</span> <span class="string">required</span> <span class="string">diskgroup</span></span><br><span class="line"></span><br><span class="line"><span class="string">看看asm日志</span></span><br><span class="line"></span><br><span class="line"><span class="string">SQL&gt;</span> <span class="string">ALTER</span> <span class="string">DISKGROUP</span> <span class="string">DATADG01</span> <span class="string">MOUNT</span>  <span class="string">/*</span> <span class="string">asm</span> <span class="string">agent</span> <span class="string">*//*</span> <span class="string">&#123;2:10674:2&#125;</span> <span class="string">*/</span></span><br><span class="line"><span class="attr">NOTE:</span> <span class="string">cache</span> <span class="string">registered</span> <span class="string">group</span> <span class="string">DATADG01</span> <span class="string">number=1</span> <span class="string">incarn=0xbec84ee5</span></span><br><span class="line"><span class="attr">NOTE:</span> <span class="string">cache</span> <span class="string">began</span> <span class="string">mount</span> <span class="string">(first)</span> <span class="string">of</span> <span class="string">group</span> <span class="string">DATADG01</span> <span class="string">number=1</span> <span class="string">incarn=0xbec84ee5</span></span><br><span class="line"><span class="string">Wed</span> <span class="string">Mar</span> <span class="number">09</span> <span class="number">15</span><span class="string">:10:28</span> <span class="number">2016</span></span><br><span class="line"><span class="attr">ERROR: no read quorum in group:</span> <span class="string">required</span> <span class="number">2</span><span class="string">,</span> <span class="string">found</span> <span class="number">0</span> <span class="string">disks</span></span><br><span class="line"><span class="attr">NOTE:</span> <span class="string">cache</span> <span class="string">dismounting</span> <span class="string">(clean)</span> <span class="string">group</span> <span class="number">1</span><span class="string">/0xBEC84EE5</span> <span class="string">(DATADG01)</span></span><br><span class="line"><span class="attr">NOTE: messaging CKPT to quiesce pins Unix process pid:</span> <span class="number">3711</span><span class="string">,</span> <span class="attr">image:</span> <span class="string">oracle@axj-rac1</span> <span class="string">(TNS</span> <span class="string">V1-V3)</span></span><br><span class="line"><span class="attr">NOTE:</span> <span class="string">dbwr</span> <span class="string">not</span> <span class="string">being</span> <span class="string">msg'd</span> <span class="string">to</span> <span class="string">dismount</span></span><br><span class="line"><span class="attr">NOTE:</span> <span class="string">lgwr</span> <span class="string">not</span> <span class="string">being</span> <span class="string">msg'd</span> <span class="string">to</span> <span class="string">dismount</span></span><br><span class="line"><span class="attr">NOTE:</span> <span class="string">cache</span> <span class="string">dismounted</span> <span class="string">group</span> <span class="number">1</span><span class="string">/0xBEC84EE5</span> <span class="string">(DATADG01)</span></span><br><span class="line"><span class="attr">NOTE:</span> <span class="string">cache</span> <span class="string">ending</span> <span class="string">mount</span> <span class="string">(fail)</span> <span class="string">of</span> <span class="string">group</span> <span class="string">DATADG01</span> <span class="string">number=1</span> <span class="string">incarn=0xbec84ee5</span></span><br><span class="line"><span class="attr">NOTE:</span> <span class="string">cache</span> <span class="string">deleting</span> <span class="string">context</span> <span class="string">for</span> <span class="string">group</span> <span class="string">DATADG01</span> <span class="number">1</span><span class="string">/0xbec84ee5</span></span><br><span class="line"><span class="string">GMON</span> <span class="string">dismounting</span> <span class="string">group</span> <span class="number">1</span> <span class="string">at</span> <span class="number">7</span> <span class="string">for</span> <span class="string">pid</span> <span class="number">29</span><span class="string">,</span> <span class="string">osid</span> <span class="number">3711</span></span><br><span class="line"><span class="attr">ERROR:</span> <span class="string">diskgroup</span> <span class="string">DATADG01</span> <span class="string">was</span> <span class="string">not</span> <span class="string">mounted</span></span><br><span class="line"><span class="attr">ORA-15032:</span> <span class="string">not</span> <span class="string">all</span> <span class="string">alterations</span> <span class="string">performed</span></span><br><span class="line"><span class="attr">ORA-15017:</span> <span class="string">diskgroup</span> <span class="string">"DATADG01"</span> <span class="string">cannot</span> <span class="string">be</span> <span class="string">mounted</span></span><br><span class="line"><span class="attr">ORA-15063:</span> <span class="string">ASM</span> <span class="string">discovered</span> <span class="string">an</span> <span class="string">insufficient</span> <span class="string">number</span> <span class="string">of</span> <span class="string">disks</span> <span class="string">for</span> <span class="string">diskgroup</span> <span class="string">"DATADG01"</span></span><br><span class="line"></span><br><span class="line"><span class="string">可以看到的是datadg01无法mount</span></span><br><span class="line"></span><br><span class="line"><span class="string">通过asmcmd查看,datadg01磁盘组都没了</span></span><br><span class="line"></span><br><span class="line"><span class="string">[grid@axj-rac1</span> <span class="string">trace]$</span> <span class="string">asmcmd</span></span><br><span class="line"><span class="string">ASMCMD&gt;</span> <span class="string">lsdg</span></span><br><span class="line"><span class="string">State</span>   <span class="string">Type</span>   <span class="string">Rebal</span> <span class="string">Sector</span> <span class="string">Block</span>    <span class="string">AU</span>  <span class="string">Total_MB</span> <span class="string">Free_MB</span> <span class="string">Req_mir_free_MB</span> <span class="string">Usable_file_MB</span>  <span class="string">Offline_disks</span> <span class="string">Voting_files</span>  <span class="string">Name</span></span><br><span class="line"><span class="string">MOUNTED</span> <span class="string">EXTERN</span>  <span class="string">N</span>       <span class="number">512</span>  <span class="number">4096</span>  <span class="number">1048576</span>   <span class="number">6024</span>    <span class="number">5623</span>             <span class="number">0</span>         <span class="number">5623</span>             <span class="number">0</span>           <span class="string">Y</span>   <span class="string">OCR_VOTE/</span></span><br><span class="line"></span><br><span class="line"><span class="string">三、修复磁盘头</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">方法一：kfed修复磁盘头</span></span><br><span class="line"><span class="string">[grid@s1-11g</span> <span class="string">dev]$</span> </span><br><span class="line"><span class="string">kfed</span> <span class="string">repair</span> <span class="string">/dev/raw/raw5</span> </span><br><span class="line"><span class="string">kfed</span> <span class="string">repair</span> <span class="string">/dev/raw/raw6</span>  </span><br><span class="line"><span class="string">kfed</span> <span class="string">repair</span> <span class="string">/dev/raw/raw7</span> </span><br><span class="line"></span><br><span class="line"><span class="string">方法二:</span> <span class="string">dd修复，用之前的备份</span></span><br><span class="line"><span class="string">[grid@s1-11g</span> <span class="string">dev]$</span></span><br><span class="line"><span class="string">dd</span> <span class="string">if=/backup/raw5</span> <span class="string">of=/dev/raw/raw5</span></span><br><span class="line"><span class="string">dd</span> <span class="string">if=/backup/raw6</span> <span class="string">of=/dev/raw/raw6</span></span><br><span class="line"><span class="string">dd</span> <span class="string">if=/backup/raw7</span> <span class="string">of=/dev/raw/raw7</span></span><br><span class="line"></span><br><span class="line"><span class="string">方法三：</span> <span class="string">利用oracle的kfed工具来备份,格式是文本格式，恢复时使用kfed</span> <span class="string">merge进去</span></span><br><span class="line"></span><br><span class="line"><span class="string">备份：</span></span><br><span class="line"><span class="string">kfed</span> <span class="string">read</span> <span class="string">/dev/raw/raw5</span>    <span class="string">aunum=0</span> <span class="string">blknum=0</span> <span class="string">text=/home/oracle/raw5.txt</span></span><br><span class="line"><span class="string">kfed</span> <span class="string">read</span> <span class="string">/dev/raw/raw6</span>    <span class="string">aunum=0</span> <span class="string">blknum=0</span> <span class="string">text=/home/oracle/raw6.txt</span></span><br><span class="line"><span class="string">kfed</span> <span class="string">read</span> <span class="string">/dev/raw/raw7</span>    <span class="string">aunum=0</span> <span class="string">blknum=0</span> <span class="string">text=/home/oracle/raw7.txt</span></span><br><span class="line"><span class="string">恢复：</span></span><br><span class="line"><span class="string">kfed</span> <span class="string">write</span> <span class="string">/dev/raw/raw5</span>    <span class="string">aunum=0</span> <span class="string">blknum=0</span> <span class="string">text=raw5.txt</span></span><br><span class="line"><span class="string">kfed</span> <span class="string">write</span> <span class="string">/dev/raw/raw6</span>    <span class="string">aunum=0</span> <span class="string">blknum=0</span> <span class="string">text=raw6.txt</span></span><br><span class="line"><span class="string">kfed</span> <span class="string">write</span> <span class="string">/dev/raw/raw7</span>    <span class="string">aunum=0</span> <span class="string">blknum=0</span> <span class="string">text=raw7.txt</span>   </span><br><span class="line"> </span><br><span class="line"><span class="string">这里我用的是方法一修复的</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">.恢复完成后查看磁盘头信息：</span></span><br><span class="line"> </span><br><span class="line"><span class="string">[root@axj-rac1</span> <span class="string">oracle]#</span> <span class="string">kfed</span> <span class="string">read</span> <span class="string">/dev/raw/raw5</span> <span class="string">aun=0</span> <span class="string">blkn=0|grep</span> <span class="string">kfbh.type</span></span><br><span class="line"><span class="attr">kfbh.type:</span>                            <span class="number">1</span> <span class="string">;</span> <span class="attr">0x002:</span> <span class="string">KFBTYP_DISKHEAD</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">.然后成功mount磁盘组</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="string">.查看dg状态可以看到是mounted状态</span></span><br><span class="line"><span class="string">ASMCMD&gt;</span> <span class="string">lsdg</span></span><br><span class="line"><span class="string">State</span>   <span class="string">Type</span>   <span class="string">Rebal</span> <span class="string">Sector</span> <span class="string">Block</span>     <span class="string">AU</span> <span class="string">Total_MB</span> <span class="string">Free_MB</span> <span class="string">Req_mir_free_MB</span> <span class="string">Usable_file_MB</span> <span class="string">Offline_disks</span> <span class="string">Voting_files</span>  <span class="string">Name</span></span><br><span class="line"><span class="string">MOUNTED</span> <span class="string">EXTERN</span> <span class="string">N</span>        <span class="number">512</span>  <span class="number">4096</span> <span class="number">1048576</span>   <span class="number">10024</span>    <span class="number">6581</span>              <span class="number">0</span>          <span class="number">6581</span>              <span class="number">0</span>         <span class="string">N</span>  <span class="string">DATADG01/</span></span><br><span class="line"><span class="string">MOUNTED</span> <span class="string">EXTERN</span> <span class="string">N</span>        <span class="number">512</span>  <span class="number">4096</span> <span class="number">1048576</span>    <span class="number">6024</span>    <span class="number">5623</span>              <span class="number">0</span>          <span class="number">5623</span>              <span class="number">0</span>         <span class="string">Y</span>  <span class="string">OCR_VOTE/</span></span><br><span class="line"><span class="string">可以看到datadg02已结mount了</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="string">.重新查询磁盘组以及磁盘信息</span></span><br><span class="line"><span class="string">col</span> <span class="string">group_number</span> <span class="string">format</span> <span class="string">a30</span></span><br><span class="line"><span class="string">col</span> <span class="string">disk_number</span> <span class="string">format</span> <span class="string">a30</span> </span><br><span class="line"><span class="string">col</span> <span class="string">name</span> <span class="string">format</span> <span class="string">a30</span></span><br><span class="line"><span class="string">col</span> <span class="string">header_status</span> <span class="string">format</span> <span class="string">a30</span></span><br><span class="line"><span class="string">col</span> <span class="string">path</span> <span class="string">format</span> <span class="string">a30</span></span><br><span class="line"><span class="string">col</span> <span class="string">group_number</span> <span class="string">clear</span></span><br><span class="line"><span class="string">col</span> <span class="string">disk_number</span> <span class="string">clear</span></span><br><span class="line"><span class="string">set</span> <span class="string">linesize</span> <span class="number">200</span> <span class="string">pagesize</span> <span class="number">2000</span> </span><br><span class="line"></span><br><span class="line"><span class="string">SQL&gt;select</span> <span class="string">group_number,disk_number,name,header_status,path</span> <span class="string">from</span> <span class="string">v$asm_disk;</span></span><br><span class="line"></span><br><span class="line"><span class="string">GROUP_NUMBER</span> <span class="string">DISK_NUMBER</span> <span class="string">NAMEHEADER_STATUS</span>       <span class="string">PATH</span></span><br><span class="line"><span class="string">------------</span> <span class="string">-----------</span> <span class="string">-----------------------------</span></span><br><span class="line">   <span class="number">1</span>       <span class="number">1</span> <span class="string">DATADG01_0001MEMBER</span>       <span class="string">/dev/raw/raw6</span></span><br><span class="line">   <span class="number">1</span>       <span class="number">0</span> <span class="string">DATADG01_0000MEMBER</span>       <span class="string">/dev/raw/raw5</span></span><br><span class="line">   <span class="number">2</span>       <span class="number">1</span> <span class="string">OCR_VOTE_0001MEMBER</span>       <span class="string">/dev/raw/raw2</span></span><br><span class="line">   <span class="number">2</span>       <span class="number">0</span> <span class="string">OCR_VOTE_0000MEMBER</span>       <span class="string">/dev/raw/raw1</span></span><br><span class="line">   <span class="number">1</span>       <span class="number">2</span> <span class="string">DATADG01_0002MEMBER</span>       <span class="string">/dev/raw/raw7</span></span><br><span class="line">   <span class="number">2</span>       <span class="number">2</span> <span class="string">OCR_VOTE_0002MEMBER</span>       <span class="string">/dev/raw/raw3</span></span><br><span class="line"></span><br><span class="line"><span class="string">可以看到所有状态已经正常,数据库也正常启动。</span></span><br></pre></td></tr></table></figure>



<h1 id="010-其他"><a href="#010-其他" class="headerlink" title="010-其他"></a>010-其他</h1><h2 id="rz命令安装"><a href="#rz命令安装" class="headerlink" title="rz命令安装"></a>rz命令安装</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">rpm</span> <span class="selector-tag">-ivh</span> <span class="selector-tag">rzsz-0</span><span class="selector-class">.12</span><span class="selector-class">.20-934</span><span class="selector-class">.22</span><span class="selector-class">.x86_64</span><span class="selector-class">.rpm</span></span><br></pre></td></tr></table></figure>



<h2 id="Wireshark"><a href="#Wireshark" class="headerlink" title="Wireshark"></a>Wireshark</h2><h3 id="001-庖丁解牛"><a href="#001-庖丁解牛" class="headerlink" title="001-庖丁解牛"></a>001-庖丁解牛</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i any host 80.80.46.76   -w  target.cap</span><br><span class="line">tcpdump -i any<span class="built_in"> port </span>8080   -w  target.cap</span><br><span class="line">tcpdump -i eth0 -s 80 -w tcpdump.cap </span><br><span class="line">只抓取eth0上每个包的前80字节，把结果存到tcpdum.cap中</span><br></pre></td></tr></table></figure>



<p>1.只抓包头:</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 -s <span class="number">80</span> -w tcpdump.cap </span><br><span class="line">Capture---&gt;<span class="keyword">Options</span></span><br><span class="line"><span class="string">"Limit each packet to"</span>正常设：<span class="number">80</span>bytes；TCP层、网络层和数据链路层的信息可以包含在内。</span><br></pre></td></tr></table></figure>

<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/image-20210623075924347.png" alt="image-20210623075924347"></p>
<p>2.只抓必要的包</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tcpdump</span> <span class="selector-tag">-i</span> <span class="selector-tag">eth0</span> <span class="selector-tag">host</span> 10<span class="selector-class">.32</span><span class="selector-class">.200</span><span class="selector-class">.131</span> <span class="selector-tag">-w</span> <span class="selector-tag">tcpdump</span><span class="selector-class">.cap</span></span><br><span class="line"><span class="selector-tag">Capture--</span>&gt;<span class="selector-tag">Options</span></span><br><span class="line">在<span class="selector-tag">Capture</span> <span class="selector-tag">Filter</span>输入“<span class="selector-tag">host</span> 10<span class="selector-class">.30</span><span class="selector-class">.200</span><span class="selector-class">.131</span>”</span><br></pre></td></tr></table></figure>

<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/image-20210623075933798.png" alt="image-20210623075933798"></p>
<p>3.过滤</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip.addr eq <span class="number">10.32</span><span class="number">.106</span><span class="number">.50</span> &amp;&amp; tcp.port eq <span class="number">8080</span></span><br><span class="line">        过滤出<span class="number">10.32</span><span class="number">.106</span><span class="number">.50</span>，TCP端口为<span class="number">8080</span>的包</span><br></pre></td></tr></table></figure>

<p><img src="/2008/01/02/linux/2008-01-02-linux-draft/image-20210623075945543.png" alt="image-20210623075945543"></p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">如果已知某个协议发生为题可以用协议名称过滤一下。</span><br><span class="line">        例如已知该域的验证协议<span class="type">Keberos</span></span><br><span class="line">        <span class="type">Filter</span>:<span class="type">Keberos</span></span><br><span class="line">  用协议过滤时务必考虑协议间的依赖性：</span><br><span class="line">         <span class="type">Filter</span>:portmap||mount。前提是要懂协议间的依赖</span><br><span class="line"><span class="type">IP</span>地址加<span class="keyword">port</span>号是最常用的过滤方式。</span><br><span class="line">        手工输入Filter：ip.addreq&lt;IP 地址&gt;&amp;&amp;tcp.porteq&lt;端口号&gt;</span><br><span class="line">        右击感兴趣的包，选择”Follow TCP/UDP Stream(选择<span class="type">TCP</span>还是<span class="type">UDP</span>根据传输协议而定）</span><br><span class="line">   <span class="type">Wireshark</span>是按照两端的<span class="type">IP</span>加port过滤出一个<span class="type">TCP</span>/<span class="type">UDP</span> <span class="type">Stream</span></span><br><span class="line">        <span class="type">Statistics</span><span class="comment">--&gt;Conversations再单击TCP或者UDP标签就可以看到所以Stream</span></span><br><span class="line">用鼠标帮助过滤</span><br><span class="line">右击感兴趣的包，<span class="type">Prepare</span> a <span class="type">Filter</span><span class="comment">--&gt;Selected自动在Filter中生成过滤表达式。还可以使用And、Or等选项</span></span><br><span class="line">       右击感兴趣的包，<span class="type">Apply</span> as <span class="type">Filter</span><span class="comment">--&gt;Selected表示式生成后还会自动执行</span></span><br></pre></td></tr></table></figure>



<p>4.让Wireshark自动分析</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">单击W<span class="function"><span class="title">ireshark</span>的Analyze--&gt;</span>Expert Info Composite在分析网络性能和连接问题时，借助此功能</span><br><span class="line">单击S<span class="function"><span class="title">tatistics</span>--&gt;</span>Service Response Time，再选定协议名称，可以得到响应时间的统计表</span><br><span class="line">单击S<span class="function"><span class="title">tatistics</span>--&gt;</span>TCP Stream Graph生成统计图</span><br><span class="line">S<span class="function"><span class="title">tatisecs</span>--&gt;</span>Summary,可以看到一些统计信息，比如平均流量等，有助于我们推测负载状况。</span><br></pre></td></tr></table></figure>



<p>5.搜索功能</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+F后选中“<span class="built_in">String</span>”单选按钮搜索关键字，在<span class="built_in">Filter</span>中输入例如：<span class="keyword">error</span></span><br></pre></td></tr></table></figure>



<h1 id="011-SHELL"><a href="#011-SHELL" class="headerlink" title="011-SHELL"></a>011-SHELL</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">break</span>（循环控制）</span><br><span class="line"><span class="keyword">continue</span>（循环控制）</span><br><span class="line"><span class="keyword">exit</span>（退出脚本）</span><br><span class="line">return（退出函数）</span><br></pre></td></tr></table></figure>



<h2 id="小数和整数比较"><a href="#小数和整数比较" class="headerlink" title="小数和整数比较"></a>小数和整数比较</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/shixun/p/6179642.html</span><br><span class="line">shell脚本小数和整数比较</span><br><span class="line">1.错误：</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$mya</span> -le 4 ]; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">"ok"</span>;<span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"fail"</span>; <span class="keyword">fi</span></span><br><span class="line">-bash: [: 5.7: <span class="built_in">integer</span> expression expecte</span><br><span class="line">2.正确：</span><br><span class="line"><span class="keyword">if</span> [ $(<span class="built_in">echo</span> <span class="string">"<span class="variable">$mya</span> &lt;= 4"</span>|bc) = 1 ]; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">"ok"</span>;<span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"fail"</span>;<span class="keyword">fi</span></span><br></pre></td></tr></table></figure>



<h2 id="read"><a href="#read" class="headerlink" title="read"></a>read</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">情景</span></span><br><span class="line"><span class="attr">我们知道，read命令可以读取文件内容，并把内容赋值给变量。</span></span><br><span class="line"><span class="attr">以如下的数据文件为例。</span></span><br><span class="line"><span class="meta">$</span> <span class="string">cat data.txt</span></span><br><span class="line"><span class="attr">1</span> <span class="string">201623210021 wangzhiguo 25</span></span><br><span class="line"><span class="attr">2</span> <span class="string">201623210022 yangjiangbo 26</span></span><br><span class="line"><span class="attr">3</span> <span class="string">201623210023 yangzhen 24</span></span><br><span class="line"><span class="attr">4</span> <span class="string">201623210024 wangdong 23</span></span><br><span class="line"><span class="attr">5</span> <span class="string">201623210025 songdong 25</span></span><br><span class="line"></span><br><span class="line"><span class="attr">以上文件的四列分别为序号（index）、学号（number）、姓名（name）、年龄（age）。用shell脚本读取该文件并输出每行的值：</span></span><br><span class="line"><span class="meta">$</span> <span class="string">cat read_data.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="attr">cat</span> <span class="string">data.txt | while read index number name age</span></span><br><span class="line"><span class="attr">do</span></span><br><span class="line">    <span class="attr">echo</span> <span class="string">"index:$&#123;index&#125;"</span></span><br><span class="line">    <span class="attr">echo</span> <span class="string">"number:$&#123;number&#125;"</span></span><br><span class="line">    <span class="attr">echo</span> <span class="string">"name:$&#123;name&#125;"</span></span><br><span class="line">    <span class="attr">echo</span> <span class="string">"age:$&#123;age&#125;"</span></span><br><span class="line">    <span class="attr">echo</span> <span class="string">" "</span></span><br><span class="line"><span class="attr">done</span></span><br><span class="line"><span class="attr">执行脚本，查看结果：</span></span><br><span class="line"><span class="meta">$</span> <span class="string">sh read_data.sh </span></span><br><span class="line"><span class="attr">index</span>:<span class="string">1</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210021</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">wangzhiguo</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">25</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">index</span>:<span class="string">2</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210022</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">yangjiangbo</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">26</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">index</span>:<span class="string">3</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210023</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">yangzhen</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">24</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">index</span>:<span class="string">4</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210024</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">wangdong</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">23</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">index</span>:<span class="string">5</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210025</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">songdong</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">25</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">不知你发现没有，这样的实现方式有着明显的弊端：</span></span><br><span class="line"><span class="meta">列名（read</span> <span class="string">index number name age）显式地在代码中指定，如果只是想弄清楚数据文件的每列含义，则需要阅读脚本；</span></span><br><span class="line"><span class="attr">该脚本中指明了每列的名称，如果希望修改各字段的英文名称（比如序号的英文名称希望改为NUMBER）则需要修改脚本，且修改多处；</span></span><br><span class="line"><span class="attr">该脚本按一定顺序读取数据文件，因此，如果数据文件中的列顺序发生了变化，则依然需要修改脚本；</span></span><br><span class="line"><span class="attr">如果有其他数据文件需要按此方式读取，则需要根据数据文件的实际情况再重写一个新脚本；</span></span><br><span class="line"><span class="attr">上述实现方式虽然看起来简单，但基于上述的弊端，我们还应对其进行优化。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">方案</span></span><br><span class="line"><span class="attr">解决的根本应该是写尽可能通用的脚本，不依赖数据文件本身的列数、列顺序、列名称（含义）等。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">可以将数据文件的各字段名称存于该数据文件的首行。当读取数据文件时，首先读取数据文件的首行，以获取各字段名称的列表；读取其它行时，将首行的值与非首行的值进行一一对应即可。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">数据文件：</span></span><br><span class="line"><span class="meta">$</span> <span class="string">cat new_data.txt </span></span><br><span class="line"><span class="attr">index</span> <span class="string">number name age</span></span><br><span class="line"><span class="attr">1</span> <span class="string">201623210021 wangzhiguo 25</span></span><br><span class="line"><span class="attr">2</span> <span class="string">201623210022 yangjiangbo 26</span></span><br><span class="line"><span class="attr">3</span> <span class="string">201623210023 yangzhen 24</span></span><br><span class="line"><span class="attr">4</span> <span class="string">201623210024 wangdong 23</span></span><br><span class="line"><span class="attr">5</span> <span class="string">201623210025 songdong 25</span></span><br><span class="line"><span class="attr">脚本</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> <span class="string">cat new_read_data.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取文件头行，存于一个数组中</span></span><br><span class="line"><span class="attr">tablehead</span>=<span class="string">(`head -n 1 new_data.txt`)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件第二行开始读取，按上述数组顺序读取各字段</span></span><br><span class="line"><span class="attr">tail</span> <span class="string">-n +2 new_data.txt | while read $&#123;tablehead[*]&#125;</span></span><br><span class="line"><span class="attr">do</span></span><br><span class="line"><span class="comment">    # 遍历数组的下标，获取tablehead数组的对应值，以及以该值命名的变量的值</span></span><br><span class="line">    <span class="attr">for</span> <span class="string">i in `seq 0 $(($&#123;#tablehead[@]&#125;-1))`</span></span><br><span class="line">    <span class="attr">do</span></span><br><span class="line">        <span class="attr">temp</span>=<span class="string">$&#123;tablehead[$i]&#125;</span></span><br><span class="line">        <span class="attr">echo</span> <span class="string">"$&#123;temp&#125;:$&#123;!temp&#125;"</span></span><br><span class="line">    <span class="attr">done</span></span><br><span class="line">    <span class="attr">echo</span> <span class="string">""</span></span><br><span class="line"><span class="attr">done</span></span><br><span class="line"><span class="attr">结果</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> <span class="string">sh new_read_data.sh </span></span><br><span class="line"><span class="attr">index</span>:<span class="string">1</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210021</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">wangzhiguo</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">25</span></span><br><span class="line"></span><br><span class="line"><span class="attr">index</span>:<span class="string">2</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210022</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">yangjiangbo</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">26</span></span><br><span class="line"></span><br><span class="line"><span class="attr">index</span>:<span class="string">3</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210023</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">yangzhen</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">index</span>:<span class="string">4</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210024</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">wangdong</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">23</span></span><br><span class="line"></span><br><span class="line"><span class="attr">index</span>:<span class="string">5</span></span><br><span class="line"><span class="attr">number</span>:<span class="string">201623210025</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">songdong</span></span><br><span class="line"><span class="attr">age</span>:<span class="string">25</span></span><br><span class="line"><span class="attr">要写出更通用的脚本，还可以做一些判断和处理，比如：数据文件作为参数传入、检查数据文件的行数、检查数据文件的列数，等等。</span></span><br></pre></td></tr></table></figure>



<h2 id="EOT、EOF"><a href="#EOT、EOF" class="headerlink" title="EOT、EOF"></a>EOT、EOF</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">EOT：EOT是“end of file”，表示文本结束符。即可避免使用多行echo命令的方式，并实现多行输出的结果。</span><br><span class="line">function usage ()</span><br><span class="line">&#123;</span><br><span class="line">  cat &lt;&lt;- EOT</span><br><span class="line">  Usage :  <span class="variable">$0</span> [options] -p package -s<span class="built_in"> script </span>file1 file2 file3 <span class="built_in">..</span></span><br><span class="line"></span><br><span class="line">  Options:</span><br><span class="line">  -h|help       Display this message</span><br><span class="line">  -p|package    The output package name</span><br><span class="line">  -j|jar file   The jar file</span><br><span class="line">EOT</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">usage</span><br><span class="line"></span><br><span class="line"><span class="comment">#EOT只是标识，不是固定的，可以写成EOF、HHH等</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">其它用法：</span><br><span class="line">在某些场合，可能我们需要在脚本中生成一个临时文件，然后把该文件作为最终文件放入目录中。（可参考ntop.spec文件）这样有几个好处，其中之一就是临时文件不是唯一的，可以通过变量赋值，也可根据不同的判断生成不同的最终文件等等。</span><br><span class="line"></span><br><span class="line">一、cat和EOF</span><br><span class="line">cat命令是linux下的一个文本输出命令，通常是用于观看某个文件的内容的；</span><br><span class="line">EOF是“end of file”，表示文本结束符。</span><br><span class="line">结合这两个标识，即可避免使用多行echo命令的方式，并实现多行输出的结果。</span><br><span class="line"></span><br><span class="line">二、使用</span><br><span class="line">看例子是最快的熟悉方法：</span><br><span class="line"><span class="comment"># cat &lt;&lt; EOF &gt; test.sh</span></span><br><span class="line">&gt; #!/bin/bash</span><br><span class="line">&gt; #you Shell<span class="built_in"> script </span>writes here.</span><br><span class="line">&gt; EOF</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">引用</span><br><span class="line">cat test.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#you Shell script writes here.。</span></span><br><span class="line"></span><br><span class="line">三、其他写法</span><br><span class="line">1、追加文件</span><br><span class="line"><span class="comment"># cat &lt;&lt; EOF &gt;&gt; test.sh</span></span><br><span class="line">2、换一种写法</span><br><span class="line"><span class="comment"># cat &gt; test.sh &lt;&lt; EOF</span></span><br><span class="line">3、非脚本中</span><br><span class="line">如果不是在脚本中，我们可以用Ctrl-D输出EOF的标识</span><br><span class="line"><span class="comment"># cat &gt; iii.txt</span></span><br><span class="line">skldjfklj</span><br><span class="line">sdkfjkl</span><br><span class="line">kljkljklj</span><br><span class="line">kljlk</span><br><span class="line">Ctrl-D</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">引用</span><br><span class="line"><span class="comment"># cat iii.txt</span></span><br><span class="line">skldjfklj</span><br><span class="line">sdkfjkl</span><br><span class="line">kljkljklj</span><br><span class="line">kljlk</span><br></pre></td></tr></table></figure>



<h2 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">懒的整理：http://xstarcd.github.io/wiki/shell/exec_redirect.html</span><br><span class="line">简明说说<span class="built_in">exec</span>使用，不深究：</span><br><span class="line">1.作为日志打印重定向使用</span><br><span class="line">SCRTIP_NAME=<span class="string">"cp_image.sh"</span>  <span class="comment">#脚本名</span></span><br><span class="line"><span class="built_in">exec</span> 5&gt;&gt;/tmp/<span class="variable">$&#123;SCRTIP_NAME/.sh/&#125;</span>.<span class="built_in">log</span> <span class="comment">#带&gt;&amp;5都输出到这个日志</span></span><br><span class="line">echolog <span class="string">"Error, Delete the image file failed!"</span> &gt;&amp;5</span><br></pre></td></tr></table></figure>



<h2 id><a href="#" class="headerlink" title="$"></a>$</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$0:</span> 脚本本身文件名称</span><br><span class="line"><span class="variable">$1:</span> 命令行第一个参数，<span class="variable">$2</span>为第二个，以此类推</span><br><span class="line"><span class="variable">$</span>*: 所有参数列表</span><br><span class="line"><span class="variable">$</span><span class="selector-tag">@</span>: 所有参数列表</span><br><span class="line"><span class="variable">$</span><span class="comment">#: 参数个数</span></span><br><span class="line"><span class="variable">$</span><span class="variable">$</span>: 脚本运行时的PID</span><br><span class="line"><span class="variable">$</span>?: 脚本退出码</span><br><span class="line"></span><br><span class="line">*与<span class="selector-tag">@</span>的区别</span><br><span class="line"></span><br><span class="line">当命令行为test.sh <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="string">"<span class="variable">$</span>*“表示"</span><span class="number">1</span> <span class="number">2</span> <span class="number">3</span>”</span><br><span class="line"><span class="string">"<span class="variable">$</span>@“表示"</span><span class="number">1</span>” “<span class="number">2</span>” “<span class="number">3</span>”</span><br><span class="line">二者没有被引号括起来时是一样的都为<span class="string">"1 2 3"</span>，只有当被引号括起来后才表现出差异</span><br></pre></td></tr></table></figure>



<h2 id="printf"><a href="#printf" class="headerlink" title="printf"></a>printf</h2><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">printf</span></span><br><span class="line">https:<span class="regexp">//www</span>.cnblogs.com/simadongyang/p/<span class="number">8228098</span>.html</span><br><span class="line"></span><br><span class="line">上一章节我们学习了Shell的echo命令，本章节我们来学习Shell的另一个输出命令printf.</span><br><span class="line"><span class="keyword">printf</span>命令模仿C程序库(library)里的<span class="keyword">printf</span>()程序。</span><br><span class="line"><span class="keyword">printf</span>由POSIX标准多定义，因此使用<span class="keyword">printf</span> 的脚本比使用echo 移值性好。</span><br><span class="line"><span class="keyword">printf</span> 使用引用文本或空格分隔的参数，外面可以在<span class="keyword">printf</span>中使用格式化字符串，还可以制定字符串的宽度 左右对齐方式等。</span><br><span class="line">默认<span class="keyword">printf</span>不会向echo 自动添加换行符， 我们可以手动添加 \n.</span><br><span class="line"></span><br><span class="line"><span class="keyword">printf</span> 命令的语法：</span><br><span class="line"><span class="keyword">printf</span> <span class="keyword">format</span>-string [arguments ...]</span><br><span class="line">参数说明：</span><br><span class="line"><span class="keyword">format</span>-string:为格式控制字符串</span><br><span class="line">arguments:为参数列表。</span><br><span class="line">实例如下：</span><br><span class="line">$ echo <span class="string">"Hello,Shell"</span></span><br><span class="line">Hello,Shell</span><br><span class="line">$ prinrf <span class="string">"Hello,Shell\n"</span></span><br><span class="line">Hello,Shell</span><br><span class="line">$</span><br><span class="line">接下来，我来用一个脚本来体现<span class="keyword">printf</span>的强大功能：</span><br><span class="line"><span class="comment">#！/binbash</span></span><br><span class="line"><span class="comment"># author:菜鸟教程</span></span><br><span class="line"><span class="comment"># url:www.runoob.com</span></span><br><span class="line"><span class="keyword">printf</span> <span class="string">"%-10s %-8s %-4s\n"</span> 姓名 性别 体重kg</span><br><span class="line"><span class="keyword">printf</span> <span class="string">"%-10s %-8s %-4.2f\n"</span> 郭靖 男 <span class="number">66.1234</span></span><br><span class="line">执行脚本，输出结果如下所示：</span><br><span class="line">姓名 性别 体重kg</span><br><span class="line">郭靖  男  <span class="number">66.12</span></span><br><span class="line"> </span><br><span class="line">%s %c %d %都是格式替代符</span><br><span class="line">%-<span class="number">10</span><span class="keyword">s</span> 指一个宽度为<span class="number">10</span>个字符(-表示左对齐，没有则表示右对齐),任何字符都会被显示在<span class="number">10</span>个字符宽的字符内，如果不足则自动以空格填充，超过也会将内容全部显示出来。</span><br><span class="line">%-<span class="number">4</span> <span class="number">2</span>f 指格式化小数，其中，.<span class="number">2</span>指保留<span class="number">2</span>为小数。</span><br><span class="line">更多实例：</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># author:菜鸟教程</span></span><br><span class="line"><span class="comment"># url:www.runoob.com</span></span><br><span class="line"><span class="comment"># fotmat-sting为双引号</span></span><br><span class="line"><span class="keyword">printf</span> <span class="string">"%d %s\n"</span> <span class="number">1</span>  <span class="string">"abc"</span></span><br><span class="line"><span class="comment"># 单引号与双引号效果一样</span></span><br><span class="line"><span class="keyword">printf</span> <span class="string">'%d %s\n'</span> <span class="number">1</span> <span class="string">"abc"</span></span><br><span class="line"><span class="comment"># 没有引号也可以输出</span></span><br><span class="line"><span class="keyword">printf</span> %s abcdef</span><br><span class="line"><span class="comment"># 格式只指定了一个参数，但多出的参数仍然会按照该格式输出， format-string 被重用</span></span><br><span class="line"><span class="keyword">printf</span> %s abc def</span><br><span class="line"><span class="keyword">printf</span> <span class="string">"%s\n"</span> abc def </span><br><span class="line"><span class="keyword">printf</span> <span class="string">"%s %s %s\n"</span> a b c e f g h </span><br><span class="line"><span class="comment"># 如果没有 arguments,那么 %s 用HULL 代替， %d 用0 代替</span></span><br><span class="line"><span class="keyword">printf</span> <span class="string">"%s and %d \n"</span></span><br><span class="line">执行脚本 ，输出结果如下所示：</span><br><span class="line"><span class="keyword">printf</span>的转义序列</span><br><span class="line">序列  说明</span><br><span class="line">\a  警告字符，通常为ASCII的BEL字符</span><br><span class="line">\b 后退</span><br><span class="line">\c 抑制(不显示)输出结果中任何结尾的换行字符(只在%b格式指示符控制下的参数字符串中有效),而且， 任何留在参数里的字符，</span><br><span class="line">任何接下来的参数以及任何留在格式字符串中的字符，都被忽略</span><br><span class="line">\f 换页(formfeed)</span><br><span class="line">\n 换行</span><br><span class="line">\r 回车(Carriage <span class="keyword">return</span>)</span><br><span class="line">\t  水平制表符</span><br><span class="line">\v 垂直制表符</span><br><span class="line">\\ 一个字面上的反斜杠字符</span><br><span class="line">\ddd 表示<span class="number">1</span>到<span class="number">3</span>位数八进制的字符，仅在格式字符串中有效</span><br><span class="line">\0ddd 表示<span class="number">1</span>到<span class="number">3</span>位的八进制值字符</span><br><span class="line">笔记</span><br><span class="line">%d %s %c %f  格式替代符详解</span><br><span class="line">d:Decimal 十进制整数 对应位置参数必须是十进制整数，否则报错!</span><br><span class="line"><span class="keyword">s</span>:String 字符串 对应位置参数必须是字符串或者字符型 否则报错</span><br><span class="line">c:Char 字符 对应位置参数必须是字符串或者字符型 否则报错</span><br><span class="line">f: Float 浮点 对应位置参数必须是数字型 否则报错</span><br><span class="line">如： 其中最后一个参数是 <span class="string">"def"</span> %c 自动截取字符串的第一个字符作为结果输出。</span><br></pre></td></tr></table></figure>



<h2 id="shift：参数左移"><a href="#shift：参数左移" class="headerlink" title="shift：参数左移"></a>shift：参数左移</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shell脚本shfit</span><br><span class="line"><span class="built_in">shift</span>其实很简单的，就是左移参数列表，<span class="built_in">shift</span>一次就将最左边的参数<span class="variable">$1</span>移出去了，然后 </span><br><span class="line">原来的<span class="variable">$2</span>现在就变成了<span class="variable">$1</span>。</span><br><span class="line"></span><br><span class="line"><span class="built_in">shift</span>后面还可以带上一个数字，指明要移出多少个参数（默认只移出一个），比如说 </span><br><span class="line"><span class="built_in">shift</span> 3 就是移出3个参数，之后原来的<span class="variable">$4</span>就变成了现在的<span class="variable">$1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">shift</span>命令用于对参数的移动(左移)，通常用于在不知道传入参数个数的情况下依次遍历每个参数然后进行相应处理（常见于Linux中各种程序的启动脚本）。</span><br><span class="line"></span><br><span class="line">示例1:依次读取输入的参数并打印参数个数：</span><br><span class="line">run.sh:</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$#</span> != 0 ];<span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"第一个参数为：<span class="variable">$1</span>,参数个数为：<span class="variable">$#</span>"</span></span><br><span class="line"><span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">输入如下命令运行：run.sh a b c d e f</span><br><span class="line">结果显示如下：</span><br><span class="line">第一个参数为：a,参数个数为：6</span><br><span class="line">第一个参数为：b,参数个数为：5</span><br><span class="line">第一个参数为：c,参数个数为：4</span><br><span class="line">第一个参数为：d,参数个数为：3</span><br><span class="line">第一个参数为：e,参数个数为：2</span><br><span class="line">第一个参数为：f,参数个数为：1</span><br><span class="line">从上可知 <span class="built_in">shift</span>(<span class="built_in">shift</span> 1) 命令每执行一次，变量的个数(<span class="variable">$#</span>)减一（之前的<span class="variable">$1</span>变量被销毁,之后的<span class="variable">$2</span>就变成了<span class="variable">$1</span>），而变量值提前一位。</span><br><span class="line"></span><br><span class="line">同理，<span class="built_in">shift</span> n后，前n位参数都会被销毁，比如：</span><br><span class="line">输入5个参数： abcde</span><br><span class="line">那么<span class="variable">$1</span>=a,<span class="variable">$2</span>=b,<span class="variable">$3</span>=c,<span class="variable">$4</span>=d,<span class="variable">$5</span>=e,执行<span class="built_in">shift</span> 3操作后，前3个参数a、b、c被销毁，就剩下了2个参数：d,e（这时d=<span class="variable">$1</span>,e=<span class="variable">$2</span>，其中d由<span class="variable">$4</span>—&gt;<span class="variable">$1</span>,e由<span class="variable">$5</span>—&gt;<span class="variable">$2</span>）,参考示例如下：</span><br><span class="line">示例2：</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"参数个数为：<span class="variable">$#</span>,其中："</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 <span class="variable">$#</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">eval</span> j=\$<span class="variable">$i</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"第<span class="variable">$i</span>个参数($"</span><span class="variable">$i</span><span class="string">")：<span class="variable">$j</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">shift</span> 3</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"执行shift 3操作后："</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"参数个数为：<span class="variable">$#</span>,其中："</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 <span class="variable">$#</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="comment">#通过eval把i变量的值($i)作为变量j的名字</span></span><br><span class="line"><span class="built_in">eval</span> j=\$<span class="variable">$i</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"第<span class="variable">$i</span>个参数($"</span><span class="variable">$i</span><span class="string">")：<span class="variable">$j</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line">输出结果为：</span><br><span class="line">参数个数为：5,其中：</span><br><span class="line">第1个参数(<span class="variable">$1</span>)：a</span><br><span class="line">第2个参数(<span class="variable">$2</span>)：b</span><br><span class="line">第3个参数(<span class="variable">$3</span>)：c</span><br><span class="line">第4个参数(<span class="variable">$4</span>)：d</span><br><span class="line">第5个参数(<span class="variable">$5</span>)：e</span><br><span class="line">执行<span class="built_in">shift</span> 3操作后：</span><br><span class="line">参数个数为：2,其中：</span><br><span class="line">第1个参数(<span class="variable">$1</span>)：d</span><br><span class="line">第2个参数(<span class="variable">$2</span>)：e</span><br></pre></td></tr></table></figure>



<h2 id="readlink"><a href="#readlink" class="headerlink" title="readlink"></a>readlink</h2><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">全路径文件名/<span class="keyword">dirname</span>:文件所在的目录</span><br><span class="line"><span class="keyword">dirname</span>:文件所在的目录</span><br><span class="line"><span class="keyword">dirname</span></span><br><span class="line">直接从<span class="keyword">dirname</span>返回的未必是绝对路径，取决于提供给<span class="keyword">dirname</span>的参数是否是绝对路径。 </span><br><span class="line">例子<span class="number">1</span>：</span><br><span class="line">[root@ceph4 home]# <span class="keyword">dirname</span>  /home/<span class="number">1.</span>sh </span><br><span class="line">/home</span><br><span class="line"></span><br><span class="line">例子<span class="number">2</span>：</span><br><span class="line">SHELL_FOLDER=$(<span class="keyword">dirname</span> <span class="string">"$0"</span>)</span><br><span class="line">echo $SHELL_FOLDER</span><br><span class="line">返回.</span><br><span class="line"></span><br><span class="line">例子<span class="number">3</span>：</span><br><span class="line">SHELL_FOLDER1=$(cd <span class="string">"$(dirname "</span>$0<span class="string">")"</span>;<span class="keyword">pwd</span>)</span><br><span class="line">echo $SHELL_FOLDER1</span><br><span class="line">返回：/home</span><br><span class="line"></span><br><span class="line">SHELL_FOLDER=$(<span class="keyword">dirname</span> <span class="string">"$0"</span>)</span><br><span class="line"></span><br><span class="line">readlink ：全路径文件名</span><br><span class="line">[hadoopet2-centos6 codemgrs]$ readlink --<span class="keyword">help</span></span><br><span class="line">用法: readlink [选项]...文件</span><br><span class="line">输出符号链接值或权威文件名.</span><br><span class="line">-f, --canonicalize 递归跟随给出文件名的所有符号链接以标准化,除最后一个外所有组件必须存在</span><br><span class="line">-e, --canonicalize-existing 递归跟随给出文件名的所有符号链接以标准化,所有组件都必须存在</span><br><span class="line">-m, --canonicalize-missing 递归跟随给出文件名的所有符号链接以标准化,但不对组件存在性作出要求</span><br><span class="line">-n, --no-newline	不输出尾随的新行</span><br><span class="line">-q, --quiet,</span><br><span class="line">-S, --silent	缩减大多数的错误消息</span><br><span class="line">-v, --verbose	报告所有错误消息</span><br><span class="line">	--<span class="keyword">help</span>		显示此帮助信息并退出</span><br><span class="line">	--version	显示版本信息并退出</span><br><span class="line">所以用readlink命令我们可以直接获取$0参数的全路径文件名，然后再用<span class="keyword">dirname</span>获取其所在的绝对路径：</span><br><span class="line">举例<span class="number">1</span>：</span><br><span class="line">readlink -f <span class="string">"$0"</span></span><br><span class="line">/home/<span class="number">6.</span>sh</span><br><span class="line"></span><br><span class="line">举例<span class="number">2</span>：</span><br><span class="line">SHELL_FOLDER=$(<span class="keyword">dirname</span> $(readlink -f <span class="string">"$0"</span>))</span><br><span class="line">echo $SHELL_FOLDER</span><br><span class="line">/home</span><br></pre></td></tr></table></figure>



<h2 id="random：从数组中随机抽取元素"><a href="#random：从数组中随机抽取元素" class="headerlink" title="random：从数组中随机抽取元素"></a>random：从数组中随机抽取元素</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">student=(1 DPL YPD LT ZZM HY CQW LSJ ybr)</span><br><span class="line">a=$[RANDOM%4+3]</span><br><span class="line">c=$[RANDOM%2+1]</span><br><span class="line"><span class="built_in">echo</span> -----------------------------------</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span>号 <span class="variable">$&#123;student[$a]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> $((<span class="variable">$a</span>+<span class="variable">$c</span>))号 <span class="variable">$&#123;student[$(($a+$c))]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> $((<span class="variable">$a</span>-<span class="variable">$c</span>))号 <span class="variable">$&#123;student[$(($a-$c))]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> -----------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment">#done</span></span><br></pre></td></tr></table></figure>



<h2 id="getopt"><a href="#getopt" class="headerlink" title="getopt"></a>getopt</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">getopt（一个外部工具）</span><br><span class="line">https://www.cnblogs.com/lidabo/p/5382617.html</span><br><span class="line">具体用用法可以 man getopt</span><br><span class="line">char*optstring = “ab:c::”;</span><br><span class="line"><span class="comment">#单个字符a         表示选项a没有参数            格式：-a即可，不加参数</span></span><br><span class="line"><span class="comment">#单字符加冒号b:     表示选项b有且必须加参数      格式：-b 100或-b100,但-b=100错</span></span><br><span class="line"><span class="comment">#单字符加2冒号c::   表示选项c可以有，也可以无     格式：-c200，其它格式错误</span></span><br><span class="line"><span class="comment">#getopt处理以'-’开头的命令行参数，如optstring="ab:c::d::",命令行为getopt.exe -a -b host -ckeke -d haha </span></span><br><span class="line"><span class="comment">#在这个命令行参数中，-a是选项元素。host是b的参数，keke是c的参数。但haha并不是d的参数，因为它们中间有空格隔开。</span></span><br><span class="line"><span class="comment">#还要注意的是默认情况下getopt会重新排列命令行参数的顺序，所以到最后所有不包含选项的命令行参数都排到最后。</span></span><br><span class="line"><span class="comment">#-o表示短选项</span></span><br><span class="line"><span class="comment">#--long表示长选项</span></span><br><span class="line"><span class="comment">#"$@"在上面解释过</span></span><br><span class="line"><span class="comment"># -n:出错时的信息</span></span><br><span class="line"><span class="comment"># -- ：举一个例子比较好理解：</span></span><br><span class="line">我们要创建一个名字为 <span class="string">"-f"</span>的目录你会怎么办？</span><br><span class="line">mkdir -f <span class="comment">#不成功，因为-f会被mkdir当作选项来解析，这时就可以使用</span></span><br><span class="line">mkdir -- -f 这样-f就不会被作为选项。</span><br><span class="line"><span class="comment">#下面的例子都是使用的$2</span></span><br><span class="line">举例：</span><br><span class="line">!/bin/bash</span><br><span class="line">TEMP=`getopt -o ab:c:: --long a-long,b-long:,c-long:: \</span><br><span class="line">     -n <span class="string">'example.bash'</span> -- <span class="string">"<span class="variable">$@</span>"</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ $? != 0 ] ; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">"Terminating..."</span> &gt;&amp;2 ; <span class="built_in">exit</span> 1 ; <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#set 会重新排列参数的顺序，也就是改变$1,$2...$n的值，这些值在getopt中重新排列过了</span></span><br><span class="line"><span class="built_in">eval</span> <span class="built_in">set</span> -- <span class="string">"<span class="variable">$TEMP</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#经过getopt的处理，下面处理具体选项。</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> ; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">                -a|--a-long) <span class="built_in">echo</span> <span class="string">"Option a"</span> ; <span class="built_in">shift</span> ;;</span><br><span class="line">                -b|--b-long) <span class="built_in">echo</span> <span class="string">"Option b, argument \`<span class="variable">$2</span>'"</span> ; <span class="built_in">shift</span> 2 ;;</span><br><span class="line">                -c|--c-long)</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">"<span class="variable">$2</span>"</span> <span class="keyword">in</span></span><br><span class="line">                                <span class="string">""</span>) <span class="built_in">echo</span> <span class="string">"Option c, no argument"</span>; <span class="built_in">shift</span> 2 ;;</span><br><span class="line">                                *)  <span class="built_in">echo</span> <span class="string">"Option c, argument \`<span class="variable">$2</span>'"</span> ; <span class="built_in">shift</span> 2 ;;</span><br><span class="line">                        <span class="keyword">esac</span> ;;</span><br><span class="line">                --) <span class="built_in">shift</span> ; <span class="built_in">break</span> ;;</span><br><span class="line">                *) <span class="built_in">echo</span> <span class="string">"Internal error!"</span> ; <span class="built_in">exit</span> 1 ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Remaining arguments:"</span></span><br><span class="line"><span class="keyword">for</span> arg <span class="keyword">do</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">'--&gt; '</span><span class="string">"\`<span class="variable">$arg</span>'"</span> ;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">运行命令：</span><br><span class="line">./getopt.sh -b abc -a -c33 remain</span><br><span class="line">Option b, argument `abc<span class="string">'</span></span><br><span class="line"><span class="string">Option a</span></span><br><span class="line"><span class="string">Option c, argument `33'</span></span><br><span class="line">Remaining arguments:</span><br><span class="line">--&gt; `remain<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">再举一个例子：（安装脚本里面的）</span></span><br><span class="line"><span class="string">function parse()</span></span><br><span class="line"><span class="string">&#123;"</span></span><br><span class="line"><span class="string">    RET=`getopt -o ht:e: \</span></span><br><span class="line"><span class="string">                --long help,type:,env: \</span></span><br><span class="line"><span class="string">                -n "ERROR" -- "$@"`</span></span><br><span class="line"><span class="string">    if [ $? -ne 0 ]</span></span><br><span class="line"><span class="string">    then</span></span><br><span class="line"><span class="string">        usage</span></span><br><span class="line"><span class="string">        exit 0</span></span><br><span class="line"><span class="string">    fi</span></span><br><span class="line"><span class="string">    eval set -- "$RET"</span></span><br><span class="line"><span class="string">    while true</span></span><br><span class="line"><span class="string">    do</span></span><br><span class="line"><span class="string">        case "$1" in</span></span><br><span class="line"><span class="string">            -h|--help)</span></span><br><span class="line"><span class="string">                usage</span></span><br><span class="line"><span class="string">                exit 0</span></span><br><span class="line"><span class="string">                ;;</span></span><br><span class="line"><span class="string">            -t|--type)</span></span><br><span class="line"><span class="string">                TYPE=$2</span></span><br><span class="line"><span class="string">                shift 2</span></span><br><span class="line"><span class="string">                ;;</span></span><br><span class="line"><span class="string">            -e|--env)</span></span><br><span class="line"><span class="string">                ENV=$2</span></span><br><span class="line"><span class="string">                shift 2</span></span><br><span class="line"><span class="string">                ;;</span></span><br><span class="line"><span class="string">            --)</span></span><br><span class="line"><span class="string">                shift</span></span><br><span class="line"><span class="string">                break</span></span><br><span class="line"><span class="string">                ;;</span></span><br><span class="line"><span class="string">            *)</span></span><br><span class="line"><span class="string">                usage</span></span><br><span class="line"><span class="string">                exit 0</span></span><br><span class="line"><span class="string">                ;;</span></span><br><span class="line"><span class="string">        esac</span></span><br><span class="line"><span class="string">    done</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/f-ck-need-u/p/7426371.html</span><br><span class="line">使用示例来说明：</span><br><span class="line">[root@xuexi ~]<span class="comment"># a=24;name='long$a'     # 注意，使用的是单引号，禁止$a被扩展</span></span><br><span class="line">如果直接执行 <span class="built_in">echo</span> <span class="variable">$name</span> ，则结果为<span class="string">"long<span class="variable">$a</span>"</span>，但如果执行 <span class="built_in">eval</span> <span class="built_in">echo</span> <span class="variable">$name</span> ，结果将是<span class="string">"long24"</span>。</span><br><span class="line">[root@xuexi ~]<span class="comment"># eval echo $name</span></span><br><span class="line">long24</span><br></pre></td></tr></table></figure>



<h2 id="exit"><a href="#exit" class="headerlink" title="exit"></a>exit</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">exit</span>（<span class="number">0</span>）：正常运行程序并退出程序；</span><br><span class="line"><span class="keyword">exit</span>（<span class="number">1</span>）：非正常运行导致退出程序；</span><br></pre></td></tr></table></figure>



<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">https://www.runoob.com/linux/linux-shell-basic-operators.html</span><br><span class="line"></span><br><span class="line">%：整除</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">sum=0</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> `seq 1 300`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="keyword">if</span> [ $((<span class="variable">$a</span>%4)) = <span class="string">'0'</span> ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">let</span> sum=<span class="variable">$sum</span>+<span class="variable">$a</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$sum</span></span><br></pre></td></tr></table></figure>



<h2 id="nohup"><a href="#nohup" class="headerlink" title="nohup"></a>nohup</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup ./start.sh &gt;output <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章推荐</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2007\01\01\linux\2007-01-01-linux-string\" rel="bookmark">字符串</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2007\01\02\linux\2007-01-02-linux-ASCII\" rel="bookmark">ASCII</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2007\01\03\linux\2007-01-03-linux-wildcard\" rel="bookmark">通配符-元字符-转义符</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2007\01\04\linux\2007-01-04-linux-cat\" rel="bookmark">cat</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2007\01\05\linux\2007-01-05-linux-cut\" rel="bookmark">cut</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div>赞赏一下吧～</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="tongsiying 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>tongsiying
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/" title="linux-draft">https://tongsiying.github.io/2008/01/02/linux/2008-01-02-linux-draft/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/linux-%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/" rel="tag"># linux-文件管理</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2008/01/01/%E5%89%8D%E7%AB%AF/CSS/" rel="prev" title="CSS">
      <i class="fa fa-chevron-left"></i> CSS
    </a></div>
      <div class="post-nav-item">
    <a href="/2008/01/03/collect/collect_blog/2008-01-03-blog-draft/" rel="next" title="blog-draft">
      blog-draft <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#001-文件管理"><span class="nav-text">001-文件管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#通配符"><span class="nav-text">通配符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字符串"><span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ASCII比较大小"><span class="nav-text">ASCII比较大小</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cat"><span class="nav-text">cat</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#grep"><span class="nav-text">grep</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#find"><span class="nav-text">find</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rm删除文件不释放"><span class="nav-text">rm删除文件不释放</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shuf命令"><span class="nav-text">shuf命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#grep-和-awk的buffer"><span class="nav-text">grep 和 awk的buffer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sed"><span class="nav-text">sed</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#awk"><span class="nav-text">awk</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#split"><span class="nav-text">split</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#qemu-img"><span class="nav-text">qemu-img</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dd"><span class="nav-text">dd</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tr：去除字母"><span class="nav-text">tr：去除字母</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#column-对齐"><span class="nav-text">column :对齐</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#stat：文件的状态信息"><span class="nav-text">stat：文件的状态信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#paste-d"><span class="nav-text">paste -d,</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sort：排序"><span class="nav-text">sort：排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#map：键值"><span class="nav-text">map：键值</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#002-磁盘管理"><span class="nav-text">002-磁盘管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#查看磁盘分区UUID的四种方法"><span class="nav-text">查看磁盘分区UUID的四种方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如何关闭硬盘写缓存（Write-Cache）"><span class="nav-text">如何关闭硬盘写缓存（Write Cache）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Linux创建虚拟块设备并格式化为文件系统"><span class="nav-text">Linux创建虚拟块设备并格式化为文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lvm"><span class="nav-text">lvm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#part"><span class="nav-text">part</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fdisk"><span class="nav-text">fdisk</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MBR和GPT"><span class="nav-text">MBR和GPT</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#惰性初始化"><span class="nav-text">惰性初始化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#raid卡"><span class="nav-text">raid卡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#storcli64"><span class="nav-text">storcli64</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MegaCli"><span class="nav-text">MegaCli</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#去除raid-0"><span class="nav-text">去除raid 0</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看磁盘型号"><span class="nav-text">查看磁盘型号</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#003-网络"><span class="nav-text">003-网络</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#时间同步及设置ip"><span class="nav-text">时间同步及设置ip</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#centos关闭防火墙"><span class="nav-text">centos关闭防火墙</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ping"><span class="nav-text">ping</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#telnet"><span class="nav-text">telnet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ssh"><span class="nav-text">ssh</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sshpass"><span class="nav-text">sshpass</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scp"><span class="nav-text">scp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#双网卡配置"><span class="nav-text">双网卡配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设备重启后网口变了"><span class="nav-text">设备重启后网口变了</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#路由"><span class="nav-text">路由</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#004-调试命令"><span class="nav-text">004-调试命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#watch"><span class="nav-text">watch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#screen"><span class="nav-text">screen</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#curl"><span class="nav-text">curl</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dmesg"><span class="nav-text">dmesg</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tc命令"><span class="nav-text">tc命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#长短链接"><span class="nav-text">长短链接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内存泄露"><span class="nav-text">内存泄露</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#005-字符串"><span class="nav-text">005-字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#字符串大小写转换"><span class="nav-text">字符串大小写转换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shuf命令-1"><span class="nav-text">shuf命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Linux-的字符串截取"><span class="nav-text">Linux 的字符串截取</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#006-数据库"><span class="nav-text">006-数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#mysql"><span class="nav-text">mysql</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#redis"><span class="nav-text">redis</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#007-系统"><span class="nav-text">007-系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#windows"><span class="nav-text">windows</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#last"><span class="nav-text">last</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#时间同步"><span class="nav-text">时间同步</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义linux命令"><span class="nav-text">自定义linux命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关闭swap"><span class="nav-text">关闭swap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#etc-rc-local：开机执行"><span class="nav-text">&#x2F;etc&#x2F;rc.local：开机执行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#系统配置"><span class="nav-text">系统配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#系统参数"><span class="nav-text">系统参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dsa免密"><span class="nav-text">dsa免密</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#免密登录脚本"><span class="nav-text">免密登录脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rsa免密登录"><span class="nav-text">rsa免密登录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看系统版本"><span class="nav-text">查看系统版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#虚机卡执行"><span class="nav-text">虚机卡执行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fuser"><span class="nav-text">fuser</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#isof"><span class="nav-text">isof</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ulimit"><span class="nav-text">ulimit</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#date"><span class="nav-text">date</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ntp"><span class="nav-text">ntp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#logrotate"><span class="nav-text">logrotate</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#清理设备所有缓存"><span class="nav-text">清理设备所有缓存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#yum"><span class="nav-text">yum</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#执行jar包"><span class="nav-text">执行jar包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重启nginx"><span class="nav-text">重启nginx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jdk"><span class="nav-text">jdk</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nmon"><span class="nav-text">nmon</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ftp"><span class="nav-text">ftp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lrzsz"><span class="nav-text">lrzsz</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#清屏"><span class="nav-text">清屏</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#008-性能"><span class="nav-text">008-性能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#top"><span class="nav-text">top</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#iostat"><span class="nav-text">iostat</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看当前占用最多的K个进程"><span class="nav-text">查看当前占用最多的K个进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vmstat-iostat"><span class="nav-text">vmstat+iostat</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#009-异常模拟"><span class="nav-text">009-异常模拟</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#cpu模拟"><span class="nav-text">cpu模拟</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网络异常"><span class="nav-text">网络异常</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#消耗内存"><span class="nav-text">消耗内存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模拟丢包"><span class="nav-text">模拟丢包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ASM磁盘头信息损坏和修复-kfed-dd"><span class="nav-text">ASM磁盘头信息损坏和修复(kfed&#x2F;dd)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#010-其他"><span class="nav-text">010-其他</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#rz命令安装"><span class="nav-text">rz命令安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Wireshark"><span class="nav-text">Wireshark</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#001-庖丁解牛"><span class="nav-text">001-庖丁解牛</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#011-SHELL"><span class="nav-text">011-SHELL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#小数和整数比较"><span class="nav-text">小数和整数比较</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#read"><span class="nav-text">read</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EOT、EOF"><span class="nav-text">EOT、EOF</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exec"><span class="nav-text">exec</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#"><span class="nav-text">$</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#printf"><span class="nav-text">printf</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shift：参数左移"><span class="nav-text">shift：参数左移</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#readlink"><span class="nav-text">readlink</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#random：从数组中随机抽取元素"><span class="nav-text">random：从数组中随机抽取元素</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#getopt"><span class="nav-text">getopt</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#eval"><span class="nav-text">eval</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exit"><span class="nav-text">exit</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#运算符"><span class="nav-text">运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nohup"><span class="nav-text">nohup</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="tongsiying"
      src="/images/gutianle.gif">
  <p class="site-author-name" itemprop="name">tongsiying</p>
  <div class="site-description" itemprop="description">问渠那得清如许？为有源头活水来。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">432</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tongsiying" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tongsiying" rel="noopener external nofollow noreferrer" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wxtlucky1015@163.com" title="E-Mail → mailto:wxtlucky1015@163.com" rel="noopener external nofollow noreferrer" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/2964109344" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;2964109344" rel="noopener external nofollow noreferrer" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/" title="tongsiying → https:&#x2F;&#x2F;tongsiying.github.io"><i class="wrench fa-fw"></i>tongsiying</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/ReadingNotes/" title="ReadingNotes → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;ReadingNotes&#x2F;"><i class="book fa-fw"></i>ReadingNotes</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/blog/" title="blog → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;blog&#x2F;"><i class="book fa-fw"></i>blog</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/blog/tools/" title="tools → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;blog&#x2F;tools&#x2F;"><i class="wrench fa-fw"></i>tools</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/lanlan/" title="lanlan → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;lanlan&#x2F;"><i class="wrench fa-fw"></i>lanlan</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/Music/" title="note → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;Music&#x2F;"><i class="wrench fa-fw"></i>note</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/sound/" title="Music → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;sound&#x2F;"><i class="wrench fa-fw"></i>Music</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/JSONFormat/" title="JSONFormat → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;JSONFormat&#x2F;"><i class="wrench fa-fw"></i>JSONFormat</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/HTML5-Canvas/" title="Canvas → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;HTML5-Canvas&#x2F;"><i class="wrench fa-fw"></i>Canvas</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/games/" title="games → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;games&#x2F;"><i class="wrench fa-fw"></i>games</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/love/" title="love → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;love&#x2F;"><i class="wrench fa-fw"></i>love</a>
      </span>
  </div>



		<div style="">
  <canvas id="canvas" style="width:60%;">��ǰ�������֧��canvas������������������</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //����canvas�Ŀ���
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //�洢ʱ������
    var data = [];
    //�洢�˶���С��
    var balls = [];
    //�������Ӱ뾶
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //�洢ʱ�����֣���ʮλСʱ����λСʱ��ð�š�ʮλ���ӡ���λ���ӡ�ð�š�ʮλ���ӡ���λ������7���������
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*���ɵ�������*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*����ʱ��*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //ʱ�䷢���仯
            if(NewData[i] !== data[i]){
                //���仯������ֵ����data�����е������洢��changeNumArray������
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //����С��
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*����С��״̬*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*����Ҫ�˶���С��*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*��Ⱦ*/
    function render(){
        //���û������ȣ��ﵽ��ջ�����Ч��
        canvas.height = 100;
        //��Ⱦʱ��
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //��ȾС��
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //����ʱ��
        updateDigitTime();
        //����С��״̬
        updateBalls();
        //��Ⱦ
        render();
    },50);
}

})();
</script>
      </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; Weeny – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tongsiying</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">7.6m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">114:48</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
