<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/hedgehog.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/hedgehog.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tongsiying.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","b2t":true,"scrollpercent":true,"padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="爬虫实战：高清图片下载">
<meta property="og:url" content="https://tongsiying.github.io/2021/11/24/python/python_%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98/%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98%EF%BC%9A%E9%AB%98%E6%B8%85%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD/index.html">
<meta property="og:site_name" content="tongsiying">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/spider_object.gif">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210405214028818.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210405221726608.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210405222247528.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210405222351234.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406110309727.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210405222838077.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406111452340.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406115311249.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406170545949.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/spider_netnr.gif">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406173924641.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406174126569.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406174301838.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406175307706.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406175423634.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406175747238.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210407120847338.png">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/spider_netbian.gif">
<meta property="og:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210407120641203.png">
<meta property="article:published_time" content="2021-11-24T11:47:18.169Z">
<meta property="article:modified_time" content="2021-11-24T11:47:18.171Z">
<meta property="article:author" content="tongsiying">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/spider_object.gif">

<link rel="canonical" href="https://tongsiying.github.io/2021/11/24/python/python_%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98/%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98%EF%BC%9A%E9%AB%98%E6%B8%85%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>爬虫实战：高清图片下载 | tongsiying</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
<!-- 加入APlayer音乐播放器 -->
<link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>
  <div class="container use-motion">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">tongsiying</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">阅读|运动|自律</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/catalog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-目录">

    <a href="/catalog/" rel="section"><i class="fa fa fa-th fa-fw"></i>目录</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-读书清单">

    <a href="/read" rel="section"><i class="fa fa-book fa-fw"></i>读书清单</a>

  </li>
        <li class="menu-item menu-item-读书笔记">

    <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="section"><i class="fa fa-book fa-fw"></i>读书笔记</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tongsiying.github.io/2021/11/24/python/python_%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98/%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98%EF%BC%9A%E9%AB%98%E6%B8%85%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/gutianle.gif">
      <meta itemprop="name" content="tongsiying">
      <meta itemprop="description" content="问渠那得清如许？为有源头活水来。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tongsiying">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          爬虫实战：高清图片下载
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-24 19:47:18" itemprop="dateCreated datePublished" datetime="2021-11-24T19:47:18+08:00">2021-11-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>37k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>34 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p class="description"></p>
<a id="more"></a>
## 爬虫实战：高清图片下载

<p>Hello，小伙子们，小姑娘们，我又要出新教程了！本次教程为Python爬虫实战：高清图片下载，主要针对刚学完Python基础的同学，或者想学习爬虫方向的年轻人，很合适作为爬虫入们教程，难度虽然不高，但小项目仍然蕴含有大智慧。</p>
<h2 id="项目演示"><a href="#项目演示" class="headerlink" title="项目演示"></a>项目演示</h2><p>演示视频：<a href="https://www.bilibili.com/video/BV14i4y1N7pP/" target="_blank" rel="noopener external nofollow noreferrer">https://www.bilibili.com/video/BV14i4y1N7pP/</a></p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/spider_object.gif" alt></p>
<p>项目代码：<a href="https://gitee.com/zhangyafeii/python-doc-tutorial/tree/master/code/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98%EF%BC%9A%E9%AB%98%E6%B8%85%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD" target="_blank" rel="noopener external nofollow noreferrer">爬虫实战：高清图片下载</a></p>
<p><strong>本教程将用到的知识点有</strong>：</p>
<ul>
<li><code>requests的使用</code></li>
<li><code>lxml库解析html</code></li>
<li><code>json数据解析</code></li>
<li><code>图片数据存储</code></li>
<li><code>请求过滤</code></li>
<li><code>进度条打印</code></li>
<li><code>多线程提速</code></li>
<li><code>其他</code></li>
</ul>
<h2 id="项目一：NET牛人"><a href="#项目一：NET牛人" class="headerlink" title="项目一：NET牛人"></a>项目一：NET牛人</h2><h3 id="一、目标网站分析"><a href="#一、目标网站分析" class="headerlink" title="一、目标网站分析"></a>一、目标网站分析</h3><p>网址：<a href="https://ss.netnr.com/wallpaper" target="_blank" rel="noopener external nofollow noreferrer">https://ss.netnr.com/wallpaper</a></p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210405214028818.png" alt></p>
<p>该网站提供了各种格式的高清壁纸，用户可以根据自己的需要选择相应格式下载，鼠标向下拉会自动刷新获取更多壁纸，该网站有4K专区、美女模特、风景大片等18种壁纸分类，默认为最新壁纸。</p>
<p>我们的目标就是：使用Python自动化下载该网站的高清壁纸，可以指定类别和下载数量。当然，有兴趣的伙伴也可以指定壁纸分辨率，本教程将按照该网站所提供壁纸的最高分辨率进行下载。</p>
<h3 id="二、网络请求分析"><a href="#二、网络请求分析" class="headerlink" title="二、网络请求分析"></a>二、网络请求分析</h3><p>右键点击 - “检查 - 网络”，刷新页面，观察请求变化，结果在XHR-ajax请求中发现了每次获取新数据都会发送的请求，</p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210405221726608.png" alt></p>
<p>我们再观察一下它的返回信息，果然就是我们需要的图片信息。返回数据为json格式，data中包含了12个元素，每个元素都是一张图片的信息，其中包含可以获取的所有分辨率的图片地址，默认url为最高分辨率，我们观察到，还有两个重要的元素，id和tag, id是唯一标示，tag是图片的描述，这两个值我们在给图片命名的时候会用到。</p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210405222247528.png" alt></p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210405222351234.png" alt></p>
<p>我们再来观察一下请求信息，发现请求url为<code>https://bird.ioliu.cn/v2</code>，GET请求，每会携带一个参数url，<code>http://wallpaper.apc.360.cn/index.php?c=WallPaper&amp;start=13&amp;count=12&amp;from=360chrome&amp;a=getAppsByOrder&amp;order=create_time</code>,其中参数start和count分别是起始位置和数量的意思，另外，如果没有选择分类，默认是按时间排序，如果选择分类，<code>http://wallpaper.apc.360.cn/index.php?c=WallPaper&amp;start=1&amp;count=12&amp;from=360chrome&amp;a=getAppsByCategory&amp;cid=36</code>，将会有一个参数<code>cid</code>，值为分类<code>id</code>。我们在页面右上角可以选择壁纸分类，当我们点击分类的时候，页面url对应的<code>#id</code>都会发生变化。</p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406110309727.png" alt></p>
<p>总结：有三个重要的参数，start：起始位置，count：请求数量，<code>cid</code>：分类ID, 若要获取最新壁纸，order=create_time</p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210405222838077.png" alt></p>
<p>经过上述网络请求分析，可以看出本次任务请求构造和逻辑较简单，那么接下来我们将去实现它。</p>
<h3 id="三、初步实现"><a href="#三、初步实现" class="headerlink" title="三、初步实现"></a>三、初步实现</h3><ul>
<li><p>代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://bird.ioliu.cn/v2'</span></span><br><span class="line"></span><br><span class="line">start = <span class="number">1</span></span><br><span class="line">count = <span class="number">12</span></span><br><span class="line"></span><br><span class="line">params = &#123;<span class="string">'url'</span>: <span class="string">f'http://wallpaper.apc.360.cn/index.php?c=WallPaper&amp;start=<span class="subst">&#123;start&#125;</span>&amp;count=<span class="subst">&#123;count&#125;</span>&amp;from=360chrome&amp;a=getAppsByOrder&amp;order=create_time'</span>&#125;</span><br><span class="line"></span><br><span class="line">response = requests.get(url=url, params=params)</span><br><span class="line">result = response.json()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> image_info <span class="keyword">in</span> result[<span class="string">'data'</span>]:</span><br><span class="line">    uid = image_info[<span class="string">'id'</span>]</span><br><span class="line">    image_url = image_info[<span class="string">'url'</span>]</span><br><span class="line">    tags = image_info[<span class="string">'tag'</span>].replace(<span class="string">'_category_'</span>, <span class="string">''</span>).replace(<span class="string">'_全部_'</span>, <span class="string">''</span>).strip(<span class="string">'_ '</span>).replace(<span class="string">' '</span>, <span class="string">''</span>)</span><br><span class="line">    size = image_info[<span class="string">'resolution'</span>].replace(<span class="string">'x'</span>, <span class="string">'_'</span>)</span><br><span class="line">    print(image_url, tags, size, uid)</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">λ python spider.py</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t01753453b660de14e9.jpg 汽车天下 1920_1080 2008041</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t01bbd94b90e850d1d3.jpg 动感水果_车厘子_小清新 1920_1080 2008033</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t019fd908f724f51900.jpg 海洋天堂_沙滩_风景大片 1920_1080 2008032</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t010448c46c1ecf7cab.jpg 卡通人物_动漫卡通 1920_1200 2007786</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t0183def7a3a7924215.jpg 自然风光_瀑布_风景大片 1920_1080 2007276</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t016ad88ddaf2ae2d92.jpg 雪山_天空__风景大片 2560_1440 2007035</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t0179b947962a684673.jpg 娇艳欲滴_茶花_小清新 1920_1080 2007033</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t01cd97ec806b712059.jpg 未来城市_航天飞机_4K专区 3840_2160 2007028</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t018160b069da5cac0d.jpg 落日余晖_花海_风景大片 1920_1080 2007013</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t013a4ed4683039d101.jpg 自行车_街道_动漫卡通 1920_1080 2007011</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t01a78941bc25ae2cf9.jpg 兔子_萌宠动物 1920_1080 2005698</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t01b85e62ab512342e5.jpg 落日余晖_秧田_风景大片 1920_1080 2005696</span><br></pre></td></tr></table></figure>

<p>按照我们之前的分析进行代码编写，运行之后发现整个流程没有任何问题，我们成功获取到了图片的id、url、tags和size。核心步骤实现了之后，我们就要开始完善细节部分了。</p>
</li>
</ul>
<h3 id="四、自定义参数和图片存储"><a href="#四、自定义参数和图片存储" class="headerlink" title="四、自定义参数和图片存储"></a>四、自定义参数和图片存储</h3><ul>
<li><p>代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">image_type_info = &#123;</span><br><span class="line">        <span class="number">0</span>: <span class="string">'最新壁纸'</span>, <span class="number">6</span>: <span class="string">'美女模特'</span>, <span class="number">30</span>: <span class="string">'爱情美图'</span>, <span class="number">9</span>: <span class="string">'风景大片'</span>,</span><br><span class="line">        <span class="number">36</span>: <span class="string">'4K专区'</span>, <span class="number">15</span>: <span class="string">'小清新'</span>, <span class="number">26</span>: <span class="string">'动漫卡通'</span>, <span class="number">11</span>: <span class="string">'明星风尚'</span>,</span><br><span class="line">        <span class="number">14</span>: <span class="string">'萌宠动物'</span>, <span class="number">5</span>: <span class="string">'游戏壁纸'</span>, <span class="number">12</span>: <span class="string">'汽车天下'</span>, <span class="number">10</span>: <span class="string">'炫酷时尚'</span>,</span><br><span class="line">        <span class="number">29</span>: <span class="string">'月历壁纸'</span>, <span class="number">7</span>: <span class="string">'景视剧照'</span>, <span class="number">35</span>: <span class="string">'文字控'</span>, <span class="number">13</span>: <span class="string">'节日美图'</span>,</span><br><span class="line">        <span class="number">22</span>: <span class="string">'军事天地'</span>, <span class="number">16</span>: <span class="string">'劲爆体育'</span>, <span class="number">18</span>: <span class="string">'BABY秀'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(start: int, count: int, image_type: int)</span>:</span></span><br><span class="line">    url = <span class="string">'https://bird.ioliu.cn/v2'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> image_type == <span class="number">0</span>:</span><br><span class="line">        params = &#123;<span class="string">'url'</span>: <span class="string">f'http://wallpaper.apc.360.cn/index.php?c=WallPaper&amp;start=<span class="subst">&#123;start&#125;</span>&amp;count=<span class="subst">&#123;count&#125;</span>&amp;from=360chrome&amp;a=getAppsByOrder&amp;order=create_time'</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        params = &#123;<span class="string">'url'</span>: <span class="string">f'http://wallpaper.apc.360.cn/index.php?c=WallPaper&amp;start=<span class="subst">&#123;start&#125;</span>&amp;count=<span class="subst">&#123;count&#125;</span>&amp;from=360chrome&amp;a=getAppsByCategory&amp;cid=<span class="subst">&#123;image_type&#125;</span>'</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 图片文件夹分类</span></span><br><span class="line">    image_type_desc = image_type_info[image_type]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">f'images/<span class="subst">&#123;image_type_desc&#125;</span>'</span>):</span><br><span class="line">        os.makedirs(<span class="string">f'images/<span class="subst">&#123;image_type_desc&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送请求</span></span><br><span class="line">    response = requests.get(url=url, params=params)</span><br><span class="line">    result = response.json()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> image_info <span class="keyword">in</span> result[<span class="string">'data'</span>]:</span><br><span class="line">        uid = image_info[<span class="string">'id'</span>]</span><br><span class="line">        image_url = image_info[<span class="string">'url'</span>]</span><br><span class="line">        tags = image_info[<span class="string">'tag'</span>].replace(<span class="string">'_category_'</span>, <span class="string">''</span>).replace(<span class="string">'_全部_'</span>, <span class="string">''</span>).strip(<span class="string">'_ '</span>).replace(<span class="string">' '</span>, <span class="string">''</span>)</span><br><span class="line">        size = image_info[<span class="string">'resolution'</span>].replace(<span class="string">'x'</span>, <span class="string">'_'</span>)</span><br><span class="line">        filepath = <span class="string">f'images/<span class="subst">&#123;image_type_info[image_type]&#125;</span>/<span class="subst">&#123;tags&#125;</span>_<span class="subst">&#123;uid&#125;</span>_<span class="subst">&#123;size&#125;</span>.jpg'</span></span><br><span class="line">        response = requests.get(image_url)</span><br><span class="line">        <span class="keyword">with</span> open(filepath, mode=<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(response.content)</span><br><span class="line">        print(<span class="string">f'<span class="subst">&#123;image_url&#125;</span> <span class="subst">&#123;filepath&#125;</span> 下载成功'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main(start=<span class="number">1</span>, count=<span class="number">12</span>, image_type=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">λ python spider.py</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t01753453b660de14e9.jpg images/最新壁纸/汽车天下_2008041_1920_1080.jpg 下载成功</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t01bbd94b90e850d1d3.jpg images/最新壁纸/动感水果_车厘子_小清新_2008033_1920_1080.jpg 下载成功</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t019fd908f724f51900.jpg images/最新壁纸/海洋天堂_沙滩_风景大片_2008032_1920_1080.jpg 下载成功</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t010448c46c1ecf7cab.jpg images/最新壁纸/卡通人物_动漫卡通_2007786_1920_1200.jpg 下载成功</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t0183def7a3a7924215.jpg images/最新壁纸/自然风光_瀑布_风景大片_2007276_1920_1080.jpg 下载成功</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t016ad88ddaf2ae2d92.jpg images/最新壁纸/雪山_天空__风景大片_2007035_2560_1440.jpg 下载成功</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t0179b947962a684673.jpg images/最新壁纸/娇艳欲滴_茶花_小清新_2007033_1920_1080.jpg 下载成功</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t01cd97ec806b712059.jpg images/最新壁纸/未来城市_航天飞机_4K专区_2007028_3840_2160.jpg 下载成功</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t018160b069da5cac0d.jpg images/最新壁纸/落日余晖_花海_风景大片_2007013_1920_1080.jpg 下载成功</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t013a4ed4683039d101.jpg images/最新壁纸/自行车_街道_动漫卡通_2007011_1920_1080.jpg 下载成功</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t01a78941bc25ae2cf9.jpg images/最新壁纸/兔子_萌宠动物_2005698_1920_1080.jpg 下载成功</span><br><span class="line">http://browser9.qhimg.com/bdr/__85/t01b85e62ab512342e5.jpg images/最新壁纸/落日余晖_秧田_风景大片_2005696_1920_1080.jpg 下载成功</span><br></pre></td></tr></table></figure>

<p>当前目录下会生成images和最新壁纸两个文件夹，里面有刚下载的12张图片。</p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406111452340.png" alt></p>
</li>
</ul>
<p>至此，我们已经实现了项目的核心下载功能，但，还不够完善。</p>
<h3 id="五、功能完善"><a href="#五、功能完善" class="headerlink" title="五、功能完善"></a>五、功能完善</h3><h4 id="1-用户提示信息"><a href="#1-用户提示信息" class="headerlink" title="1. 用户提示信息"></a>1. 用户提示信息</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> prettytable <span class="keyword">import</span> PrettyTable</span><br><span class="line"></span><br><span class="line">image_type_info = &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="string">'最新壁纸'</span>, <span class="number">6</span>: <span class="string">'美女模特'</span>, <span class="number">30</span>: <span class="string">'爱情美图'</span>, <span class="number">9</span>: <span class="string">'风景大片'</span>,</span><br><span class="line">    <span class="number">36</span>: <span class="string">'4K专区'</span>, <span class="number">15</span>: <span class="string">'小清新'</span>, <span class="number">26</span>: <span class="string">'动漫卡通'</span>, <span class="number">11</span>: <span class="string">'明星风尚'</span>,</span><br><span class="line">    <span class="number">14</span>: <span class="string">'萌宠动物'</span>, <span class="number">5</span>: <span class="string">'游戏壁纸'</span>, <span class="number">12</span>: <span class="string">'汽车天下'</span>, <span class="number">10</span>: <span class="string">'炫酷时尚'</span>,</span><br><span class="line">    <span class="number">29</span>: <span class="string">'月历壁纸'</span>, <span class="number">7</span>: <span class="string">'景视剧照'</span>, <span class="number">35</span>: <span class="string">'文字控'</span>, <span class="number">13</span>: <span class="string">'节日美图'</span>,</span><br><span class="line">    <span class="number">22</span>: <span class="string">'军事天地'</span>, <span class="number">16</span>: <span class="string">'劲爆体育'</span>, <span class="number">18</span>: <span class="string">'BABY秀'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_tips_info</span><span class="params">()</span>:</span></span><br><span class="line">    table = PrettyTable([<span class="string">'序号1'</span>, <span class="string">'壁纸分类1'</span>, <span class="string">'序号2'</span>, <span class="string">'壁纸分类2'</span>])</span><br><span class="line">    row = []</span><br><span class="line">    <span class="keyword">for</span> index, key <span class="keyword">in</span> enumerate(image_type_info, start=<span class="number">1</span>):</span><br><span class="line">        row.extend([key, image_type_info[key]])</span><br><span class="line">        <span class="keyword">if</span> len(row) == <span class="number">4</span>:</span><br><span class="line">            table.add_row(row)</span><br><span class="line">            row.clear()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> index == len(self.image_type_info):</span><br><span class="line">            row.extend([<span class="string">'-'</span>, <span class="string">'-'</span>])</span><br><span class="line">            table.add_row(row)</span><br><span class="line">    print(table) </span><br><span class="line">    </span><br><span class="line">init_tips_info()</span><br></pre></td></tr></table></figure>

<h4 id="2-获取用户输入"><a href="#2-获取用户输入" class="headerlink" title="2. 获取用户输入"></a>2. 获取用户输入</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    image_type = input(<span class="string">'请选择下载的壁纸分类(序号,默认回车为0) &gt;&gt;  '</span>)</span><br><span class="line">    <span class="keyword">if</span> image_type:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> image_type.isdecimal() <span class="keyword">or</span> int(image_type) <span class="keyword">not</span> <span class="keyword">in</span> image_type_info:</span><br><span class="line">            print(<span class="string">'您输入的分类序号有误，请重新确认后输入'</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            image_type = int(image_type)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        image_type = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    count = input(<span class="string">'请输入下载数量（整数，默认为20）&gt;&gt; '</span>)</span><br><span class="line">    <span class="keyword">if</span> count:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> count.isdecimal():</span><br><span class="line">            print(<span class="string">'您输入的数量有误，必须为整数，请重新输入'</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            count = int(count)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        count = <span class="number">20</span></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">main(image_type=image_type, count=count)</span><br></pre></td></tr></table></figure>

<h4 id="3-添加下载进度条"><a href="#3-添加下载进度条" class="headerlink" title="3. 添加下载进度条"></a>3. 添加下载进度条</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(image_type: int, start: int = <span class="number">1</span>, count: int = <span class="number">50</span>)</span>:</span></span><br><span class="line">    url = <span class="string">'https://bird.ioliu.cn/v2'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> image_type == <span class="number">0</span>:</span><br><span class="line">        params = &#123;<span class="string">'url'</span>: <span class="string">f'http://wallpaper.apc.360.cn/index.php?c=WallPaper&amp;start=<span class="subst">&#123;start&#125;</span>&amp;count=<span class="subst">&#123;count&#125;</span>&amp;from=360chrome&amp;a=getAppsByOrder&amp;order=create_time'</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        params = &#123;<span class="string">'url'</span>: <span class="string">f'http://wallpaper.apc.360.cn/index.php?c=WallPaper&amp;start=<span class="subst">&#123;start&#125;</span>&amp;count=<span class="subst">&#123;count&#125;</span>&amp;from=360chrome&amp;a=getAppsByCategory&amp;cid=<span class="subst">&#123;image_type&#125;</span>'</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 图片文件夹分类</span></span><br><span class="line">    image_type_desc = image_type_info[image_type]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">f'images/<span class="subst">&#123;image_type_desc&#125;</span>'</span>):</span><br><span class="line">        os.makedirs(<span class="string">f'images/<span class="subst">&#123;image_type_desc&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送请求</span></span><br><span class="line">    response = requests.get(url=url, params=params)</span><br><span class="line">    result = response.json()</span><br><span class="line"></span><br><span class="line">    task_progress = tqdm(result[<span class="string">'data'</span>], ncols=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index, image_info <span class="keyword">in</span> enumerate(task_progress, start=<span class="number">1</span>):</span><br><span class="line">        task_progress.set_description(<span class="string">f"正在下载第 <span class="subst">&#123;index&#125;</span> 张图片"</span>)</span><br><span class="line">        uid = image_info[<span class="string">'id'</span>]</span><br><span class="line">        image_url = image_info[<span class="string">'url'</span>]</span><br><span class="line">        tags = image_info[<span class="string">'tag'</span>].replace(<span class="string">'_category_'</span>, <span class="string">''</span>).replace(<span class="string">'_全部_'</span>, <span class="string">''</span>).strip(<span class="string">'_ '</span>).replace(<span class="string">' '</span>, <span class="string">''</span>)</span><br><span class="line">        size = image_info[<span class="string">'resolution'</span>].replace(<span class="string">'x'</span>, <span class="string">'_'</span>)</span><br><span class="line">        filepath = <span class="string">f'images/<span class="subst">&#123;image_type_info[image_type]&#125;</span>/<span class="subst">&#123;tags&#125;</span>_<span class="subst">&#123;uid&#125;</span>_<span class="subst">&#123;size&#125;</span>.jpg'</span></span><br><span class="line">        response = requests.get(image_url)</span><br><span class="line">        <span class="keyword">with</span> open(filepath, mode=<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(response.content)</span><br><span class="line">        <span class="comment"># print(f'&#123;image_url&#125; &#123;filepath&#125; 下载成功')</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">f'所有图片下载完成!'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="4-代码整合"><a href="#4-代码整合" class="headerlink" title="4. 代码整合"></a>4. 代码整合</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> prettytable <span class="keyword">import</span> PrettyTable</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line">image_type_info = &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="string">'最新壁纸'</span>, <span class="number">6</span>: <span class="string">'美女模特'</span>, <span class="number">30</span>: <span class="string">'爱情美图'</span>, <span class="number">9</span>: <span class="string">'风景大片'</span>,</span><br><span class="line">    <span class="number">36</span>: <span class="string">'4K专区'</span>, <span class="number">15</span>: <span class="string">'小清新'</span>, <span class="number">26</span>: <span class="string">'动漫卡通'</span>, <span class="number">11</span>: <span class="string">'明星风尚'</span>,</span><br><span class="line">    <span class="number">14</span>: <span class="string">'萌宠动物'</span>, <span class="number">5</span>: <span class="string">'游戏壁纸'</span>, <span class="number">12</span>: <span class="string">'汽车天下'</span>, <span class="number">10</span>: <span class="string">'炫酷时尚'</span>,</span><br><span class="line">    <span class="number">29</span>: <span class="string">'月历壁纸'</span>, <span class="number">7</span>: <span class="string">'景视剧照'</span>, <span class="number">35</span>: <span class="string">'文字控'</span>, <span class="number">13</span>: <span class="string">'节日美图'</span>,</span><br><span class="line">    <span class="number">22</span>: <span class="string">'军事天地'</span>, <span class="number">16</span>: <span class="string">'劲爆体育'</span>, <span class="number">18</span>: <span class="string">'BABY秀'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_tips_info</span><span class="params">()</span>:</span></span><br><span class="line">    table = PrettyTable([<span class="string">'序号1'</span>, <span class="string">'壁纸分类1'</span>, <span class="string">'序号2'</span>, <span class="string">'壁纸分类2'</span>])</span><br><span class="line">    row = []</span><br><span class="line">    <span class="keyword">for</span> index, key <span class="keyword">in</span> enumerate(image_type_info, start=<span class="number">1</span>):</span><br><span class="line">        row.extend([key, image_type_info[key]])</span><br><span class="line">        <span class="keyword">if</span> len(row) == <span class="number">4</span>:</span><br><span class="line">            table.add_row(row)</span><br><span class="line">            row.clear()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> index == len(image_type_info):</span><br><span class="line">            row.extend([<span class="string">'-'</span>, <span class="string">'-'</span>])</span><br><span class="line">            table.add_row(row)</span><br><span class="line">    print(table)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(image_type: int, start: int = <span class="number">1</span>, count: int = <span class="number">50</span>)</span>:</span></span><br><span class="line">    url = <span class="string">'https://bird.ioliu.cn/v2'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> image_type == <span class="number">0</span>:</span><br><span class="line">        params = &#123;<span class="string">'url'</span>: <span class="string">f'http://wallpaper.apc.360.cn/index.php?c=WallPaper&amp;start=<span class="subst">&#123;start&#125;</span>&amp;count=<span class="subst">&#123;count&#125;</span>&amp;from=360chrome&amp;a=getAppsByOrder&amp;order=create_time'</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        params = &#123;<span class="string">'url'</span>: <span class="string">f'http://wallpaper.apc.360.cn/index.php?c=WallPaper&amp;start=<span class="subst">&#123;start&#125;</span>&amp;count=<span class="subst">&#123;count&#125;</span>&amp;from=360chrome&amp;a=getAppsByCategory&amp;cid=<span class="subst">&#123;image_type&#125;</span>'</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 图片文件夹分类</span></span><br><span class="line">    image_type_desc = image_type_info[image_type]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">f'images/<span class="subst">&#123;image_type_desc&#125;</span>'</span>):</span><br><span class="line">        os.makedirs(<span class="string">f'images/<span class="subst">&#123;image_type_desc&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送请求</span></span><br><span class="line">    response = requests.get(url=url, params=params)</span><br><span class="line">    result = response.json()</span><br><span class="line"></span><br><span class="line">    task_progress = tqdm(result[<span class="string">'data'</span>], ncols=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index, image_info <span class="keyword">in</span> enumerate(task_progress, start=<span class="number">1</span>):</span><br><span class="line">        task_progress.set_description(<span class="string">f"正在下载第 <span class="subst">&#123;index&#125;</span> 张图片"</span>)</span><br><span class="line">        uid = image_info[<span class="string">'id'</span>]</span><br><span class="line">        image_url = image_info[<span class="string">'url'</span>]</span><br><span class="line">        tags = image_info[<span class="string">'tag'</span>].replace(<span class="string">'_category_'</span>, <span class="string">''</span>).replace(<span class="string">'_全部_'</span>, <span class="string">''</span>).strip(<span class="string">'_ '</span>).replace(<span class="string">' '</span>, <span class="string">''</span>)</span><br><span class="line">        size = image_info[<span class="string">'resolution'</span>].replace(<span class="string">'x'</span>, <span class="string">'_'</span>)</span><br><span class="line">        filepath = <span class="string">f'images/<span class="subst">&#123;image_type_info[image_type]&#125;</span>/<span class="subst">&#123;tags&#125;</span>_<span class="subst">&#123;uid&#125;</span>_<span class="subst">&#123;size&#125;</span>.jpg'</span></span><br><span class="line">        response = requests.get(image_url)</span><br><span class="line">        <span class="keyword">with</span> open(filepath, mode=<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(response.content)</span><br><span class="line">        <span class="comment"># print(f'&#123;image_url&#125; &#123;filepath&#125; 下载成功')</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">f'所有图片下载完成!'</span>)</span><br><span class="line"></span><br><span class="line">init_tips_info()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    image_type = input(<span class="string">'请选择下载的壁纸分类(序号,默认回车为0) &gt;&gt;  '</span>)</span><br><span class="line">    <span class="keyword">if</span> image_type:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> image_type.isdecimal() <span class="keyword">or</span> int(image_type) <span class="keyword">not</span> <span class="keyword">in</span> image_type_info:</span><br><span class="line">            print(<span class="string">'您输入的分类序号有误，请重新确认后输入'</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            image_type = int(image_type)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        image_type = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    count = input(<span class="string">'请输入下载数量（整数，默认为20）&gt;&gt; '</span>)</span><br><span class="line">    <span class="keyword">if</span> count:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> count.isdecimal():</span><br><span class="line">            print(<span class="string">'您输入的数量有误，必须为整数，请重新输入'</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            count = int(count)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        count = <span class="number">20</span></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">main(image_type=image_type, count=count)</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">| 序号<span class="number">1</span> | 壁纸分类<span class="number">1</span> | 序号<span class="number">2</span> | 壁纸分类<span class="number">2</span> |</span><br><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">|   <span class="number">0</span>   |  最新壁纸 |   <span class="number">6</span>   |  美女模特 |</span><br><span class="line">|   <span class="number">30</span>  |  爱情美图 |   <span class="number">9</span>   |  风景大片 |</span><br><span class="line">|   <span class="number">36</span>  |   <span class="number">4</span>K专区  |   <span class="number">15</span>  |   小清新  |</span><br><span class="line">|   <span class="number">26</span>  |  动漫卡通 |   <span class="number">11</span>  |  明星风尚 |</span><br><span class="line">|   <span class="number">14</span>  |  萌宠动物 |   <span class="number">5</span>   |  游戏壁纸 |</span><br><span class="line">|   <span class="number">12</span>  |  汽车天下 |   <span class="number">10</span>  |  炫酷时尚 |</span><br><span class="line">|   <span class="number">29</span>  |  月历壁纸 |   <span class="number">7</span>   |  景视剧照 |</span><br><span class="line">|   <span class="number">35</span>  |   文字控  |   <span class="number">13</span>  |  节日美图 |</span><br><span class="line">|   <span class="number">22</span>  |  军事天地 |   <span class="number">16</span>  |  劲爆体育 |</span><br><span class="line">|   <span class="number">18</span>  |   BABY秀  |   -   |     -     |</span><br><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">请选择下载的壁纸分类(序号,默认回车为<span class="number">0</span>) &gt;&gt;  <span class="number">9</span></span><br><span class="line">请输入下载数量（整数，默认为<span class="number">20</span>）&gt;&gt; <span class="number">30</span></span><br><span class="line">正在下载第 <span class="number">30</span> 张图片: <span class="number">100</span>%|█████████████████████████████████████████| <span class="number">30</span>/<span class="number">30</span> [<span class="number">00</span>:<span class="number">17</span>&lt;<span class="number">00</span>:<span class="number">00</span>,  <span class="number">1.69</span>it/s]</span><br><span class="line">所有图片下载完成!</span><br></pre></td></tr></table></figure>

<h3 id="六、项目优化"><a href="#六、项目优化" class="headerlink" title="六、项目优化"></a>六、项目优化</h3><h4 id="1-实现过滤功能"><a href="#1-实现过滤功能" class="headerlink" title="1. 实现过滤功能"></a>1. 实现过滤功能</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_history_file</span><span class="params">()</span>:</span></span><br><span class="line">    history_file_path = <span class="string">'history.txt'</span></span><br><span class="line">    history_file = open(history_file_path, mode=<span class="string">'a+'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    downloaded_images = set()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(history_file_path):</span><br><span class="line">        history_file.seek(<span class="number">0</span>)</span><br><span class="line">        downloaded_images = &#123;line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> history_file&#125;</span><br><span class="line">    <span class="keyword">return</span> history_file, downloaded_images</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(image_type: int, start: int = <span class="number">1</span>, count: int = <span class="number">50</span>)</span>:</span></span><br><span class="line">    history_file, downloaded_images = init_history_file()</span><br><span class="line">    url = <span class="string">'https://bird.ioliu.cn/v2'</span></span><br><span class="line">    ...</span><br><span class="line">    task_progress = tqdm(result[<span class="string">'data'</span>], ncols=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index, image_info <span class="keyword">in</span> enumerate(task_progress, start=<span class="number">1</span>):</span><br><span class="line">        task_progress.set_description(<span class="string">f"正在下载第 <span class="subst">&#123;index&#125;</span> 张图片"</span>)</span><br><span class="line">        uid = image_info[<span class="string">'id'</span>]</span><br><span class="line">        image_url = image_info[<span class="string">'url'</span>]</span><br><span class="line">        tags = image_info[<span class="string">'tag'</span>].replace(<span class="string">'_category_'</span>, <span class="string">''</span>).replace(<span class="string">'_全部_'</span>, <span class="string">''</span>).strip(<span class="string">'_ '</span>).replace(<span class="string">' '</span>, <span class="string">''</span>)</span><br><span class="line">        size = image_info[<span class="string">'resolution'</span>].replace(<span class="string">'x'</span>, <span class="string">'_'</span>)</span><br><span class="line">        filepath = <span class="string">f'images/<span class="subst">&#123;image_type_info[image_type]&#125;</span>/<span class="subst">&#123;tags&#125;</span>_<span class="subst">&#123;uid&#125;</span>_<span class="subst">&#123;size&#125;</span>.jpg'</span></span><br><span class="line">        <span class="keyword">if</span> filepath <span class="keyword">in</span> downloaded_images:</span><br><span class="line">            print(<span class="string">f'<span class="subst">&#123;filepath&#125;</span> 下载过了'</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        response = requests.get(image_url)</span><br><span class="line">        <span class="keyword">with</span> open(filepath, mode=<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(response.content)</span><br><span class="line">        history_file.write(<span class="string">f'<span class="subst">&#123;filepath&#125;</span>\n'</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f'所有图片下载完成!'</span>)</span><br></pre></td></tr></table></figure>

<p>第一次运行</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">|<span class="string"> 序号1 </span>|<span class="string"> 壁纸分类1 </span>|<span class="string"> 序号2 </span>|<span class="string"> 壁纸分类2 </span>|</span><br><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">|<span class="string">   0   </span>|<span class="string">  最新壁纸 </span>|<span class="string">   6   </span>|<span class="string">  美女模特 </span>|</span><br><span class="line">|<span class="string">   30  </span>|<span class="string">  爱情美图 </span>|<span class="string">   9   </span>|<span class="string">  风景大片 </span>|</span><br><span class="line">|<span class="string">   36  </span>|<span class="string">   4K专区  </span>|<span class="string">   15  </span>|<span class="string">   小清新  </span>|</span><br><span class="line">|<span class="string">   26  </span>|<span class="string">  动漫卡通 </span>|<span class="string">   11  </span>|<span class="string">  明星风尚 </span>|</span><br><span class="line">|<span class="string">   14  </span>|<span class="string">  萌宠动物 </span>|<span class="string">   5   </span>|<span class="string">  游戏壁纸 </span>|</span><br><span class="line">|<span class="string">   12  </span>|<span class="string">  汽车天下 </span>|<span class="string">   10  </span>|<span class="string">  炫酷时尚 </span>|</span><br><span class="line">|<span class="string">   29  </span>|<span class="string">  月历壁纸 </span>|<span class="string">   7   </span>|<span class="string">  景视剧照 </span>|</span><br><span class="line">|<span class="string">   35  </span>|<span class="string">   文字控  </span>|<span class="string">   13  </span>|<span class="string">  节日美图 </span>|</span><br><span class="line">|<span class="string">   22  </span>|<span class="string">  军事天地 </span>|<span class="string">   16  </span>|<span class="string">  劲爆体育 </span>|</span><br><span class="line">|<span class="string">   18  </span>|<span class="string">   BABY秀  </span>|<span class="string">   -   </span>|<span class="string">     -     </span>|</span><br><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">请选择下载的壁纸分类(序号,默认回车为0) &gt;&gt;  9</span><br><span class="line">请输入下载数量（整数，默认为20）&gt;&gt; 30</span><br><span class="line">正在下载第 30 张图片: 100%|<span class="string">█████████████████████████████████████████</span>|<span class="string"> 30/30 [00:13&lt;00:00,  2.30it/s]</span></span><br><span class="line"><span class="string">所有图片下载完成!</span></span><br></pre></td></tr></table></figure>

<p>查看图片文件夹</p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406115311249.png" alt></p>
<p>当前目录下生成了一个history.txt文件，文件内容</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">images/风景大片/海洋天堂<span class="literal">_</span>海岸<span class="literal">_</span>沙滩<span class="literal">_</span>黄昏<span class="literal">_</span>风景大片_2046860_3840_2160.jpg</span><br><span class="line">images/风景大片/乌云<span class="literal">_</span>麦田<span class="literal">_</span>树<span class="literal">_</span>平原<span class="literal">_</span>旷野<span class="literal">_</span>风景大片_2046785_1920_1080.jpg</span><br><span class="line">images/风景大片/秋意正浓<span class="literal">_</span>乡村<span class="literal">_</span>原野<span class="literal">_</span>深秋<span class="literal">_</span>风景大片_2046775_1920_1080.jpg</span><br><span class="line">...</span><br><span class="line">images/风景大片/秋意正浓<span class="literal">_</span>雪山<span class="literal">_</span>高原<span class="literal">_</span>树林<span class="literal">_</span>神秘<span class="literal">_</span>风景大片_2045072_1920_1080.jpg</span><br><span class="line">images/风景大片/海洋天堂<span class="literal">_</span>度假<span class="literal">_</span>浪漫<span class="literal">_</span>海边<span class="literal">_</span>沙滩<span class="literal">_</span>吊床<span class="literal">_</span>风景大片_2045010_3840_2160.jpg</span><br></pre></td></tr></table></figure>

<p>第二次运行</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">|<span class="string"> 序号1 </span>|<span class="string"> 壁纸分类1 </span>|<span class="string"> 序号2 </span>|<span class="string"> 壁纸分类2 </span>|</span><br><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">|<span class="string">   0   </span>|<span class="string">  最新壁纸 </span>|<span class="string">   6   </span>|<span class="string">  美女模特 </span>|</span><br><span class="line">|<span class="string">   30  </span>|<span class="string">  爱情美图 </span>|<span class="string">   9   </span>|<span class="string">  风景大片 </span>|</span><br><span class="line">|<span class="string">   36  </span>|<span class="string">   4K专区  </span>|<span class="string">   15  </span>|<span class="string">   小清新  </span>|</span><br><span class="line">|<span class="string">   26  </span>|<span class="string">  动漫卡通 </span>|<span class="string">   11  </span>|<span class="string">  明星风尚 </span>|</span><br><span class="line">|<span class="string">   14  </span>|<span class="string">  萌宠动物 </span>|<span class="string">   5   </span>|<span class="string">  游戏壁纸 </span>|</span><br><span class="line">|<span class="string">   12  </span>|<span class="string">  汽车天下 </span>|<span class="string">   10  </span>|<span class="string">  炫酷时尚 </span>|</span><br><span class="line">|<span class="string">   29  </span>|<span class="string">  月历壁纸 </span>|<span class="string">   7   </span>|<span class="string">  景视剧照 </span>|</span><br><span class="line">|<span class="string">   35  </span>|<span class="string">   文字控  </span>|<span class="string">   13  </span>|<span class="string">  节日美图 </span>|</span><br><span class="line">|<span class="string">   22  </span>|<span class="string">  军事天地 </span>|<span class="string">   16  </span>|<span class="string">  劲爆体育 </span>|</span><br><span class="line">|<span class="string">   18  </span>|<span class="string">   BABY秀  </span>|<span class="string">   -   </span>|<span class="string">     -     </span>|</span><br><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">请选择下载的壁纸分类(序号,默认回车为0) &gt;&gt;  9</span><br><span class="line">请输入下载数量（整数，默认为20）&gt;&gt; 30</span><br><span class="line">images/风景大片/海洋天堂_海岸_沙滩_黄昏_风景大片_2046860_3840_2160.jpg 下载过了</span><br><span class="line">正在下载第 30 张图片: 100%|<span class="string">███████████████████████████████████████</span>|<span class="string"> 30/30 [00:00&lt;00:00, 3004.95it/s]</span></span><br><span class="line"><span class="string">images/风景大片/乌云_麦田_树_平原_旷野_风景大片_2046785_1920_1080.jpg 下载过了</span></span><br><span class="line"><span class="string">images/风景大片/秋意正浓_乡村_原野_深秋_风景大片_2046775_1920_1080.jpg 下载过了</span></span><br><span class="line"><span class="string">images/风景大片/自然风光_荒漠_石头_傍晚_风景大片_2046626_2560_1440.jpg 下载过了</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">images/风景大片/海洋天堂_度假_浪漫_海边_沙滩_吊床_风景大片_2045010_3840_2160.jpg 下载过了</span></span><br><span class="line"><span class="string">所有图片下载完成!</span></span><br></pre></td></tr></table></figure>

<h4 id="2-多线程下载加速"><a href="#2-多线程下载加速" class="headerlink" title="2. 多线程下载加速"></a>2. 多线程下载加速</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_images</span><span class="params">(image_type: int, start: int = <span class="number">1</span>, count: int = <span class="number">50</span>)</span>:</span></span><br><span class="line">    print(<span class="string">f'正在检索 - <span class="subst">&#123;image_type_info[image_type]&#125;</span>'</span>)</span><br><span class="line">    url = <span class="string">'https://bird.ioliu.cn/v2'</span></span><br><span class="line">    <span class="keyword">if</span> image_type == <span class="number">0</span>:</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">'url'</span>: <span class="string">f'http://wallpaper.apc.360.cn/index.php?c=WallPaper&amp;start=<span class="subst">&#123;start&#125;</span>&amp;count=<span class="subst">&#123;count&#125;</span>&amp;from=360chrome&amp;a=getAppsByOrder&amp;order=create_time'</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">'url'</span>: <span class="string">f'http://wallpaper.apc.360.cn/index.php?c=WallPaper&amp;start=<span class="subst">&#123;start&#125;</span>&amp;count=<span class="subst">&#123;count&#125;</span>&amp;from=360chrome&amp;a=getAppsByCategory&amp;cid=<span class="subst">&#123;image_type&#125;</span>'</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 图片文件夹分类</span></span><br><span class="line">    image_type_desc = image_type_info[image_type]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">f'images/<span class="subst">&#123;image_type_desc&#125;</span>'</span>):</span><br><span class="line">        os.makedirs(<span class="string">f'images/<span class="subst">&#123;image_type_desc&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送请求</span></span><br><span class="line">    response = requests.get(url=url, params=params)</span><br><span class="line">    result = response.json()</span><br><span class="line">    downloaded_count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> image_info <span class="keyword">in</span> result[<span class="string">'data'</span>]:</span><br><span class="line">        uid = image_info[<span class="string">'id'</span>]</span><br><span class="line">        image_url = image_info[<span class="string">'url'</span>]</span><br><span class="line">        tags = image_info[<span class="string">'tag'</span>].replace(<span class="string">'_category_'</span>, <span class="string">''</span>).replace(<span class="string">'_全部_'</span>, <span class="string">''</span>).strip(<span class="string">'_ '</span>).replace(<span class="string">' '</span>, <span class="string">''</span>)</span><br><span class="line">        size = image_info[<span class="string">'resolution'</span>].replace(<span class="string">'x'</span>, <span class="string">'_'</span>)</span><br><span class="line">        filepath = <span class="string">f'images/<span class="subst">&#123;image_type_info[image_type]&#125;</span>/<span class="subst">&#123;tags&#125;</span>_<span class="subst">&#123;uid&#125;</span>_<span class="subst">&#123;size&#125;</span>.jpg'</span></span><br><span class="line">        <span class="keyword">if</span> filepath <span class="keyword">not</span> <span class="keyword">in</span> downloaded_images:</span><br><span class="line">            image_data_list.add((image_url, filepath))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            downloaded_count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> image_data_list, downloaded_count</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_download</span><span class="params">(image_data_list)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(image_data_list) &gt; <span class="number">30</span>:</span><br><span class="line">        choice = input(<span class="string">'是否开启多进程加速下载？(Y/N) &gt;&gt; '</span>)</span><br><span class="line">        <span class="keyword">if</span> choice.upper() == <span class="string">'Y'</span>:</span><br><span class="line">            data_list = [set() <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">4</span>)]</span><br><span class="line">            <span class="keyword">for</span> index, image <span class="keyword">in</span> enumerate(image_data_list):</span><br><span class="line">                remainder = index % <span class="number">4</span></span><br><span class="line">                data_list[remainder].add(image)</span><br><span class="line">            <span class="keyword">with</span> ProcessPoolExecutor(max_workers=<span class="number">4</span>) <span class="keyword">as</span> pool:</span><br><span class="line">                pool.map(download_images, data_list)</span><br><span class="line">            print(<span class="string">f'\n\n所有图片下载完成!'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    download_images()</span><br><span class="line">    print(<span class="string">f'所有图片下载完成!'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_images</span><span class="params">(data_list: set = None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> data_list:</span><br><span class="line">        task_progress = tqdm(data_list, ncols=<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        task_progress = tqdm(image_data_list, ncols=<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">for</span> index, task <span class="keyword">in</span> enumerate(task_progress, start=<span class="number">1</span>):</span><br><span class="line">        url, filepath = task</span><br><span class="line">        task_progress.set_description(<span class="string">f"正在下载第 <span class="subst">&#123;index&#125;</span> 张图片"</span>)</span><br><span class="line">        response = requests.get(url=url)</span><br><span class="line">        <span class="keyword">with</span> open(filepath, mode=<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(response.content)</span><br><span class="line">        history_file.write(<span class="string">f'<span class="subst">&#123;filepath&#125;</span>\n'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    init_tips_info()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        image_type = input(<span class="string">'请选择下载的壁纸分类(序号,默认回车为0) &gt;&gt;  '</span>)</span><br><span class="line">        <span class="keyword">if</span> image_type:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> image_type.isdecimal() <span class="keyword">or</span> int(image_type) <span class="keyword">not</span> <span class="keyword">in</span> image_type_info:</span><br><span class="line">                print(<span class="string">'您输入的分类序号有误，请重新确认后输入'</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                image_type = int(image_type)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            image_type = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        count = input(<span class="string">'请输入下载数量（整数，默认为20）&gt;&gt; '</span>)</span><br><span class="line">        <span class="keyword">if</span> count:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> count.isdecimal():</span><br><span class="line">                print(<span class="string">'您输入的数量有误，必须为整数，请重新输入'</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                count = int(count)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            count = <span class="number">20</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    image_data_list, downloaded_count = search_images(image_type=image_type, count=count)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> downloaded_count == <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">f'共检索到 <span class="subst">&#123;len(image_data_list)&#125;</span> 张图片, 开始下载'</span>)</span><br><span class="line">    <span class="keyword">elif</span> len(image_data_list) == <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">f'共检索到 <span class="subst">&#123;downloaded_count&#125;</span> 张图片, 已全部下载完成！'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(</span><br><span class="line">            <span class="string">f'共检索到 <span class="subst">&#123;len(image_data_list) + downloaded_count&#125;</span> 张图片, 已下载 <span class="subst">&#123;downloaded_count&#125;</span> 张, 还需下载 <span class="subst">&#123;len(image_data_list)&#125;</span> 张, 开始下载'</span>)</span><br><span class="line"></span><br><span class="line">    start_download(image_data_list=image_data_list)</span><br></pre></td></tr></table></figure>

<p>运行代码</p>
<p>第一次运行</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">| 序号<span class="number">1</span> | 壁纸分类<span class="number">1</span> | 序号<span class="number">2</span> | 壁纸分类<span class="number">2</span> |</span><br><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">|   <span class="number">0</span>   |  最新壁纸 |   <span class="number">6</span>   |  美女模特 |</span><br><span class="line">|   <span class="number">30</span>  |  爱情美图 |   <span class="number">9</span>   |  风景大片 |</span><br><span class="line">|   <span class="number">36</span>  |   <span class="number">4</span>K专区  |   <span class="number">15</span>  |   小清新  |</span><br><span class="line">|   <span class="number">26</span>  |  动漫卡通 |   <span class="number">11</span>  |  明星风尚 |</span><br><span class="line">|   <span class="number">14</span>  |  萌宠动物 |   <span class="number">5</span>   |  游戏壁纸 |</span><br><span class="line">|   <span class="number">12</span>  |  汽车天下 |   <span class="number">10</span>  |  炫酷时尚 |</span><br><span class="line">|   <span class="number">29</span>  |  月历壁纸 |   <span class="number">7</span>   |  景视剧照 |</span><br><span class="line">|   <span class="number">35</span>  |   文字控  |   <span class="number">13</span>  |  节日美图 |</span><br><span class="line">|   <span class="number">22</span>  |  军事天地 |   <span class="number">16</span>  |  劲爆体育 |</span><br><span class="line">|   <span class="number">18</span>  |   BABY秀  |   -   |     -     |</span><br><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">请选择下载的壁纸分类(序号,默认回车为<span class="number">0</span>) &gt;&gt;  <span class="number">9</span></span><br><span class="line">请输入下载数量（整数，默认为<span class="number">20</span>）&gt;&gt; <span class="number">50</span></span><br><span class="line">正在检索 - 风景大片</span><br><span class="line">共检索到 <span class="number">50</span> 张图片, 开始下载</span><br><span class="line">是否选择多线程下载？(Y/N) &gt;&gt; y</span><br><span class="line">正在下载第 <span class="number">12</span> 张图片: <span class="number">100</span>%|█████████████████████████████████████████| <span class="number">12</span>/<span class="number">12</span> [<span class="number">00</span>:<span class="number">03</span>&lt;<span class="number">00</span>:<span class="number">00</span>,  <span class="number">3.57</span>it/s]</span><br><span class="line">正在下载第 <span class="number">12</span> 张图片: <span class="number">100</span>%|█████████████████████████████████████████| <span class="number">12</span>/<span class="number">12</span> [<span class="number">00</span>:<span class="number">03</span>&lt;<span class="number">00</span>:<span class="number">00</span>,  <span class="number">3.19</span>it/s]</span><br><span class="line">正在下载第 <span class="number">13</span> 张图片: <span class="number">100</span>%|█████████████████████████████████████████| <span class="number">13</span>/<span class="number">13</span> [<span class="number">00</span>:<span class="number">04</span>&lt;<span class="number">00</span>:<span class="number">00</span>,  <span class="number">3.09</span>it/s]</span><br><span class="line">正在下载第 <span class="number">13</span> 张图片: <span class="number">100</span>%|█████████████████████████████████████████| <span class="number">13</span>/<span class="number">13</span> [<span class="number">00</span>:<span class="number">04</span>&lt;<span class="number">00</span>:<span class="number">00</span>,  <span class="number">3.01</span>it/s]</span><br><span class="line">所有图片下载完成!</span><br></pre></td></tr></table></figure>

<p>第二次</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">|<span class="string"> 序号1 </span>|<span class="string"> 壁纸分类1 </span>|<span class="string"> 序号2 </span>|<span class="string"> 壁纸分类2 </span>|</span><br><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">|<span class="string">   0   </span>|<span class="string">  最新壁纸 </span>|<span class="string">   6   </span>|<span class="string">  美女模特 </span>|</span><br><span class="line">|<span class="string">   30  </span>|<span class="string">  爱情美图 </span>|<span class="string">   9   </span>|<span class="string">  风景大片 </span>|</span><br><span class="line">|<span class="string">   36  </span>|<span class="string">   4K专区  </span>|<span class="string">   15  </span>|<span class="string">   小清新  </span>|</span><br><span class="line">|<span class="string">   26  </span>|<span class="string">  动漫卡通 </span>|<span class="string">   11  </span>|<span class="string">  明星风尚 </span>|</span><br><span class="line">|<span class="string">   14  </span>|<span class="string">  萌宠动物 </span>|<span class="string">   5   </span>|<span class="string">  游戏壁纸 </span>|</span><br><span class="line">|<span class="string">   12  </span>|<span class="string">  汽车天下 </span>|<span class="string">   10  </span>|<span class="string">  炫酷时尚 </span>|</span><br><span class="line">|<span class="string">   29  </span>|<span class="string">  月历壁纸 </span>|<span class="string">   7   </span>|<span class="string">  景视剧照 </span>|</span><br><span class="line">|<span class="string">   35  </span>|<span class="string">   文字控  </span>|<span class="string">   13  </span>|<span class="string">  节日美图 </span>|</span><br><span class="line">|<span class="string">   22  </span>|<span class="string">  军事天地 </span>|<span class="string">   16  </span>|<span class="string">  劲爆体育 </span>|</span><br><span class="line">|<span class="string">   18  </span>|<span class="string">   BABY秀  </span>|<span class="string">   -   </span>|<span class="string">     -     </span>|</span><br><span class="line">+-------+-----------+-------+-----------+</span><br><span class="line">请选择下载的壁纸分类(序号,默认回车为0) &gt;&gt;  9</span><br><span class="line">请输入下载数量（整数，默认为20）&gt;&gt; 50</span><br><span class="line">正在检索 - 风景大片</span><br><span class="line">共检索到 50 张图片, 已全部下载完成！</span><br></pre></td></tr></table></figure>

<h4 id="3-为打印输出添加色彩"><a href="#3-为打印输出添加色彩" class="headerlink" title="3. 为打印输出添加色彩"></a>3. 为打印输出添加色彩</h4><p><code>utils.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foreground</span>:</span></span><br><span class="line">    Black = <span class="number">30</span></span><br><span class="line">    Red = <span class="number">31</span></span><br><span class="line">    Green = <span class="number">32</span></span><br><span class="line">    Yellow = <span class="number">33</span></span><br><span class="line">    Blue = <span class="number">34</span></span><br><span class="line">    Purplish_red = <span class="number">35</span></span><br><span class="line">    Cyan = <span class="number">36</span></span><br><span class="line">    White = <span class="number">37</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Background</span>:</span></span><br><span class="line">    Black = <span class="number">40</span></span><br><span class="line">    Red = <span class="number">41</span></span><br><span class="line">    Green = <span class="number">42</span></span><br><span class="line">    Yellow = <span class="number">43</span></span><br><span class="line">    Blue = <span class="number">44</span></span><br><span class="line">    Purplish_red = <span class="number">45</span></span><br><span class="line">    Cyan = <span class="number">46</span></span><br><span class="line">    White = <span class="number">47</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Display</span>:</span></span><br><span class="line">    Default = <span class="number">0</span></span><br><span class="line">    Highlight = <span class="number">1</span></span><br><span class="line">    Underline = <span class="number">4</span></span><br><span class="line">    Twinkle = <span class="number">5</span></span><br><span class="line">    Reverse = <span class="number">7</span></span><br><span class="line">    Invisible = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print</span><span class="params">(string: str, display_mode: int = Display.Default, foreground: int = Foreground.Green,</span></span></span><br><span class="line"><span class="function"><span class="params">                background: int = Background.Black)</span>:</span></span><br><span class="line">    print(<span class="string">f"\033[<span class="subst">&#123;display_mode&#125;</span>;<span class="subst">&#123;foreground&#125;</span>;<span class="subst">&#123;background&#125;</span>m<span class="subst">&#123;string&#125;</span>\033[0m"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_color</span><span class="params">(string: str, display_mode: int = Display.Default, foreground: int = Foreground.Green,</span></span></span><br><span class="line"><span class="function"><span class="params">              background: int = Background.Black)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f"\033[<span class="subst">&#123;display_mode&#125;</span>;<span class="subst">&#123;foreground&#125;</span>;<span class="subst">&#123;background&#125;</span>m<span class="subst">&#123;string&#125;</span>\033[0m"</span></span><br></pre></td></tr></table></figure>

<p><code>spider.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> prettytable <span class="keyword">import</span> PrettyTable</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> print_color</span><br><span class="line"></span><br><span class="line">image_type_info = &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="string">'最新壁纸'</span>, <span class="number">6</span>: <span class="string">'美女模特'</span>, <span class="number">30</span>: <span class="string">'爱情美图'</span>, <span class="number">9</span>: <span class="string">'风景大片'</span>,</span><br><span class="line">    <span class="number">36</span>: <span class="string">'4K专区'</span>, <span class="number">15</span>: <span class="string">'小清新'</span>, <span class="number">26</span>: <span class="string">'动漫卡通'</span>, <span class="number">11</span>: <span class="string">'明星风尚'</span>,</span><br><span class="line">    <span class="number">14</span>: <span class="string">'萌宠动物'</span>, <span class="number">5</span>: <span class="string">'游戏壁纸'</span>, <span class="number">12</span>: <span class="string">'汽车天下'</span>, <span class="number">10</span>: <span class="string">'炫酷时尚'</span>,</span><br><span class="line">    <span class="number">29</span>: <span class="string">'月历壁纸'</span>, <span class="number">7</span>: <span class="string">'景视剧照'</span>, <span class="number">35</span>: <span class="string">'文字控'</span>, <span class="number">13</span>: <span class="string">'节日美图'</span>,</span><br><span class="line">    <span class="number">22</span>: <span class="string">'军事天地'</span>, <span class="number">16</span>: <span class="string">'劲爆体育'</span>, <span class="number">18</span>: <span class="string">'BABY秀'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">image_data_list = set()</span><br><span class="line">history_file_path = <span class="string">'history.txt'</span></span><br><span class="line">history_file = open(history_file_path, mode=<span class="string">'a+'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">downloaded_images = set()</span><br><span class="line"><span class="keyword">if</span> os.path.exists(history_file_path):</span><br><span class="line">    history_file.seek(<span class="number">0</span>)</span><br><span class="line">    downloaded_images = &#123;line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> history_file&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_tips_info</span><span class="params">()</span>:</span></span><br><span class="line">    table = PrettyTable([<span class="string">'序号1'</span>, <span class="string">'壁纸分类1'</span>, <span class="string">'序号2'</span>, <span class="string">'壁纸分类2'</span>])</span><br><span class="line">    row = []</span><br><span class="line">    <span class="keyword">for</span> index, key <span class="keyword">in</span> enumerate(image_type_info, start=<span class="number">1</span>):</span><br><span class="line">        row.extend([key, image_type_info[key]])</span><br><span class="line">        <span class="keyword">if</span> len(row) == <span class="number">4</span>:</span><br><span class="line">            table.add_row(row)</span><br><span class="line">            row.clear()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> index == len(image_type_info):</span><br><span class="line">            row.extend([<span class="string">'-'</span>, <span class="string">'-'</span>])</span><br><span class="line">            table.add_row(row)</span><br><span class="line">    print(table)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_images</span><span class="params">(image_type: int, start: int = <span class="number">1</span>, count: int = <span class="number">50</span>)</span>:</span></span><br><span class="line">    print_color(<span class="string">f'正在检索 - <span class="subst">&#123;image_type_info[image_type]&#125;</span>'</span>)</span><br><span class="line">    url = <span class="string">'https://bird.ioliu.cn/v2'</span></span><br><span class="line">    <span class="keyword">if</span> image_type == <span class="number">0</span>:</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">'url'</span>: <span class="string">f'http://wallpaper.apc.360.cn/index.php?c=WallPaper&amp;start=<span class="subst">&#123;start&#125;</span>&amp;count=<span class="subst">&#123;count&#125;</span>&amp;from=360chrome&amp;a=getAppsByOrder&amp;order=create_time'</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">'url'</span>: <span class="string">f'http://wallpaper.apc.360.cn/index.php?c=WallPaper&amp;start=<span class="subst">&#123;start&#125;</span>&amp;count=<span class="subst">&#123;count&#125;</span>&amp;from=360chrome&amp;a=getAppsByCategory&amp;cid=<span class="subst">&#123;image_type&#125;</span>'</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 图片文件夹分类</span></span><br><span class="line">    image_type_desc = image_type_info[image_type]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">f'images/<span class="subst">&#123;image_type_desc&#125;</span>'</span>):</span><br><span class="line">        os.makedirs(<span class="string">f'images/<span class="subst">&#123;image_type_desc&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送请求</span></span><br><span class="line">    response = requests.get(url=url, params=params)</span><br><span class="line">    result = response.json()</span><br><span class="line">    downloaded_count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> image_info <span class="keyword">in</span> result[<span class="string">'data'</span>]:</span><br><span class="line">        uid = image_info[<span class="string">'id'</span>]</span><br><span class="line">        image_url = image_info[<span class="string">'url'</span>]</span><br><span class="line">        tags = image_info[<span class="string">'tag'</span>].replace(<span class="string">'_category_'</span>, <span class="string">''</span>).replace(<span class="string">'_全部_'</span>, <span class="string">''</span>).strip(<span class="string">'_ '</span>).replace(<span class="string">' '</span>, <span class="string">''</span>)</span><br><span class="line">        size = image_info[<span class="string">'resolution'</span>].replace(<span class="string">'x'</span>, <span class="string">'_'</span>)</span><br><span class="line">        filepath = <span class="string">f'images/<span class="subst">&#123;image_type_info[image_type]&#125;</span>/<span class="subst">&#123;tags&#125;</span>_<span class="subst">&#123;uid&#125;</span>_<span class="subst">&#123;size&#125;</span>.jpg'</span></span><br><span class="line">        <span class="keyword">if</span> filepath <span class="keyword">not</span> <span class="keyword">in</span> downloaded_images:</span><br><span class="line">            image_data_list.add((image_url, filepath))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            downloaded_count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> image_data_list, downloaded_count</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_download</span><span class="params">(image_data_list)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(image_data_list) &gt; <span class="number">30</span>:</span><br><span class="line">        choice = input(<span class="string">'是否开启多进程加速下载？(Y/N) &gt;&gt; '</span>)</span><br><span class="line">        <span class="keyword">if</span> choice.upper() == <span class="string">'Y'</span>:</span><br><span class="line">            data_list = [set() <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">4</span>)]</span><br><span class="line">            <span class="keyword">for</span> index, image <span class="keyword">in</span> enumerate(image_data_list):</span><br><span class="line">                remainder = index % <span class="number">4</span></span><br><span class="line">                data_list[remainder].add(image)</span><br><span class="line">            <span class="keyword">with</span> ProcessPoolExecutor(max_workers=<span class="number">4</span>) <span class="keyword">as</span> pool:</span><br><span class="line">                pool.map(download_images, data_list)</span><br><span class="line">            print_color(<span class="string">f'\n\n所有图片下载完成!'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    download_images()</span><br><span class="line">    print_color(<span class="string">f'所有图片下载完成!'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_images</span><span class="params">(data_list: set = None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> data_list:</span><br><span class="line">        task_progress = tqdm(data_list, ncols=<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        task_progress = tqdm(image_data_list, ncols=<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">for</span> index, task <span class="keyword">in</span> enumerate(task_progress, start=<span class="number">1</span>):</span><br><span class="line">        url, filepath = task</span><br><span class="line">        task_progress.set_description(<span class="string">f"正在下载第 <span class="subst">&#123;index&#125;</span> 张图片"</span>)</span><br><span class="line">        response = requests.get(url=url)</span><br><span class="line">        <span class="keyword">with</span> open(filepath, mode=<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(response.content)</span><br><span class="line">        history_file.write(<span class="string">f'<span class="subst">&#123;filepath&#125;</span>\n'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    init_tips_info()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        image_type = input(<span class="string">'请选择下载的壁纸分类(序号,默认回车为0) &gt;&gt;  '</span>)</span><br><span class="line">        <span class="keyword">if</span> image_type:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> image_type.isdecimal() <span class="keyword">or</span> int(image_type) <span class="keyword">not</span> <span class="keyword">in</span> image_type_info:</span><br><span class="line">                print(<span class="string">'您输入的分类序号有误，请重新确认后输入'</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                image_type = int(image_type)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            image_type = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        count = input(<span class="string">'请输入下载数量（整数，默认为20）&gt;&gt; '</span>)</span><br><span class="line">        <span class="keyword">if</span> count:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> count.isdecimal():</span><br><span class="line">                print(<span class="string">'您输入的数量有误，必须为整数，请重新输入'</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                count = int(count)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            count = <span class="number">20</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    image_data_list, downloaded_count = search_images(image_type=image_type, count=count)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> downloaded_count == <span class="number">0</span>:</span><br><span class="line">        print_color(<span class="string">f'共检索到 <span class="subst">&#123;len(image_data_list)&#125;</span> 张图片, 开始下载'</span>)</span><br><span class="line">    <span class="keyword">elif</span> len(image_data_list) == <span class="number">0</span>:</span><br><span class="line">        print_color(<span class="string">f'共检索到 <span class="subst">&#123;downloaded_count&#125;</span> 张图片, 已全部下载完成！'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print_color(</span><br><span class="line">            <span class="string">f'共检索到 <span class="subst">&#123;len(image_data_list) + downloaded_count&#125;</span> 张图片, 已下载 <span class="subst">&#123;downloaded_count&#125;</span> 张, 还需下载 <span class="subst">&#123;len(image_data_list)&#125;</span> 张, 开始下载'</span>)</span><br><span class="line"></span><br><span class="line">    start_download(image_data_list=image_data_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406170545949.png" alt></p>
<p>运行代码演示</p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/spider_netnr.gif" alt></p>
<h4 id="4-面向对象"><a href="#4-面向对象" class="headerlink" title="4. 面向对象"></a>4. 面向对象</h4><p>以上代码均是基于函数式编程书写的，虽然目前代码总体只有150行左右，但是能感觉到随着功能的扩展，模块之后的位置和关联还是有些乱的，所以有必要将其改写成面向对象的形式了。代码我已经写好，有兴趣的伙伴可以进行学习：<a href="https://gitee.com/zhangyafeii/python-doc-tutorial/tree/master/code/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98%EF%BC%9A%E9%AB%98%E6%B8%85%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD" target="_blank" rel="noopener external nofollow noreferrer">爬虫实战：高清图片下载</a></p>
<h2 id="项目二：彼岸图网"><a href="#项目二：彼岸图网" class="headerlink" title="项目二：彼岸图网"></a>项目二：彼岸图网</h2><h3 id="一、目标网站分析-1"><a href="#一、目标网站分析-1" class="headerlink" title="一、目标网站分析"></a>一、目标网站分析</h3><p>网址：<a href="https://pic.netbian.com/" target="_blank" rel="noopener external nofollow noreferrer">https://pic.netbian.com/</a></p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406173924641.png" alt></p>
<p>该网站提供了4K风景、4K美女等12种壁纸类别，用户可以选择任一类别的图片进行查看和下载。点击某一分类可以发现，浏览器地址栏的url追加了对应的分类路径，观察分类下的图片，鼠标右键可以直接下载图片，下载之后发现分辨率较低，不太清晰，我们点击进去任意一张图片，查看详细内容页面，发现详细页面的图片相较于检索页分辨率高了不少，另外还可以下载原图，不过原图要登录和收费，所以暂时我们不考虑，详细页面显示图片的分辨率已经相对很好了。</p>
<p>我们的目标就是自动化获取和下载详细页面的图片。</p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406174126569.png" alt></p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406174301838.png" alt></p>
<h3 id="二、网络请求分析-1"><a href="#二、网络请求分析-1" class="headerlink" title="二、网络请求分析"></a>二、网络请求分析</h3><p>鼠标右键点击检查，刷新页面观察浏览器请求变化，发现该页面地址栏请求为GET请求，响应数据为HTML，里面有我们需要的图片详细页面url信息，通过点击该链接，进入详细页面，详细页面可以获取到我们需要的图片url。</p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406175307706.png" alt></p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406175423634.png" alt></p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210406175747238.png" alt></p>
<h3 id="三、初步实现-1"><a href="#三、初步实现-1" class="headerlink" title="三、初步实现"></a>三、初步实现</h3><ul>
<li><p>代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://pic.netbian.com'</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url)</span><br><span class="line">html = etree.HTML(response.content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> html.xpath(<span class="string">'//*[@id="main"]/div[3]/ul/li'</span>):</span><br><span class="line">    href = li.xpath(<span class="string">'a/@href'</span>)[<span class="number">0</span>]</span><br><span class="line">    uid = href.rsplit(<span class="string">'/'</span>, maxsplit=<span class="number">1</span>)[<span class="number">1</span>].replace(<span class="string">'.html'</span>, <span class="string">''</span>)</span><br><span class="line">    title = li.xpath(<span class="string">'a//img/@alt'</span>)[<span class="number">0</span>].replace(<span class="string">' '</span>, <span class="string">'_'</span>)</span><br><span class="line">    response = requests.get(urljoin(url, href))</span><br><span class="line">    html = etree.HTML(response.content)</span><br><span class="line">    img_url = urljoin(url, html.xpath(<span class="string">'//a[@id="img"]/img/@src'</span>)[<span class="number">0</span>])</span><br><span class="line">    print(uid, title, img_url)</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行结果</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">27188 </span>海_少女_大鱼_女孩_唯美动漫<span class="number">4</span>k壁纸<span class="number">3840</span>x2160 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">210405</span>/<span class="number">224731</span>-<span class="number">16176340512348.</span>jpg</span><br><span class="line"><span class="symbol">24695 </span>下午_趴在桌子的女孩<span class="number">4</span>k动漫壁纸<span class="number">3840</span>x2160 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">190824</span>/<span class="number">212516</span>-<span class="number">15666531161</span>ade.jpg</span><br><span class="line"><span class="symbol">27180 </span>学生_女子_丝袜_美腿_二次元动漫美女<span class="number">4</span>k壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">210403</span>/<span class="number">002739</span>-<span class="number">1617380859</span>fd5c.jpg</span><br><span class="line"><span class="symbol">27074 </span>肉骨茶_个性动漫美女_骨汤屋_二次元美女_4k动漫壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">210318</span>/<span class="number">135851</span>-<span class="number">16160471316886.</span>jpg</span><br><span class="line"><span class="symbol">27160 </span>陆萱萱_黑色丝袜美腿美女_白色衬衫_背带裤_4k美女壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">210401</span>/<span class="number">220258</span>-<span class="number">16172857783909.</span>jpg</span><br><span class="line"><span class="symbol">26434 </span>陆萱萱_白色衬衫_黑色吊带短裤_黑丝美腿美女<span class="number">4</span>k壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">201008</span>/<span class="number">203736</span>-<span class="number">1602160656</span>f945.jpg</span><br><span class="line"><span class="symbol">27190 </span>LOL英雄联盟damwon_gaming_冠军皮肤_卡牌_凯南_蕾欧娜_奈德丽_烬<span class="number">4</span>k壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">210405</span>/<span class="number">225104</span>-<span class="number">1617634264</span>a669.jpg</span><br><span class="line"><span class="symbol">25331 </span>女生_女子_起床_晚上_都市_夜景_4k动漫壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">200102</span>/<span class="number">193708</span>-<span class="number">15779650287</span>a6a.jpg</span><br><span class="line"><span class="symbol">21953 </span>阿尔卑斯山风景<span class="number">4</span>k高清壁纸<span class="number">3840</span>x2160 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">180826</span>/<span class="number">113958</span>-<span class="number">153525479855</span>be.jpg</span><br><span class="line"><span class="symbol">26010 </span>长发少女黑色吊带裙_好看的<span class="number">4</span>k动漫美女壁纸<span class="number">3840</span>x2160 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">200618</span>/<span class="number">005100</span>-<span class="number">1592412660d6</span>f4.jpg</span><br><span class="line"><span class="symbol">17781 </span>糖果_美女模特<span class="number">4</span>k壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">180128</span>/<span class="number">112234</span>-<span class="number">1517109754d925.</span>jpg</span><br><span class="line"><span class="symbol">26903 </span>床_女孩_黑色睡衣_小乌龟_唯美插画_4k动漫壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">210216</span>/<span class="number">205419</span>-<span class="number">1613480059</span>a058.jpg</span><br><span class="line"><span class="symbol">27146 </span>古风美女_眼泪_伞_告别_唯美意境_插画_4k动漫壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">210328</span>/<span class="number">001020</span>-<span class="number">1616861420d950.</span>jpg</span><br><span class="line"><span class="symbol">26780 </span>古风_美少女_伞_长发_女孩大长腿<span class="number">4</span>k唯美动漫壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">210122</span>/<span class="number">195550</span>-<span class="number">1611316550d711.</span>jpg</span><br><span class="line"><span class="symbol">26123 </span>漂亮美少女_女孩子_手机_白裤袜_美脚美腿_好看二次元<span class="number">4</span>k动漫壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">200714</span>/<span class="number">224033</span>-<span class="number">159473763328</span>ff.jpg</span><br><span class="line"><span class="symbol">25716 </span>dva_宅女_长筒袜_短发_可爱女孩<span class="number">4</span>k壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">200410</span>/<span class="number">213246</span>-<span class="number">1586525566</span>c099.jpg</span><br><span class="line"><span class="symbol">26309 </span>克拉女神高清女神江琴_唯美写真摄影<span class="number">4</span>k电脑壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">200910</span>/<span class="number">200207</span>-<span class="number">15997393279</span>b23.jpg</span><br><span class="line"><span class="symbol">24031 </span>女孩_微笑_蹲着_水_海岸_海滩_波浪_风_夜晚_4k动漫壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">190415</span>/<span class="number">214606</span>-<span class="number">15553359663</span>cd8.jpg</span><br><span class="line"><span class="symbol">25688 </span>女孩子_旅行_车窗_火车_列车_听音乐_高清<span class="number">4</span>k动漫壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">200405</span>/<span class="number">171302</span>-<span class="number">15860779827765.</span>jpg</span><br><span class="line"><span class="symbol">25037 </span>车子_少女_女生_绑辫子_唯美好看<span class="number">4</span>k动漫壁纸 https://pic.netbian.<span class="keyword">com</span>/uploads/allimg/<span class="number">191026</span>/<span class="number">001458</span>-<span class="number">157202009858e9.</span>jpg</span><br></pre></td></tr></table></figure>

<p>通过以上代码，我们实现了任务的核心功能，同时验证了我们之前分析的合理性。</p>
</li>
</ul>
<h3 id="四、功能完善和优化"><a href="#四、功能完善和优化" class="headerlink" title="四、功能完善和优化"></a>四、功能完善和优化</h3><p>有了上一个案例的基础，我们可以仿照实现相似的功能。</p>
<h4 id="版本1"><a href="#版本1" class="headerlink" title="版本1"></a>版本1</h4><ul>
<li><p>代码</p>
<p>utils.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foreground</span>:</span></span><br><span class="line">    Black = <span class="number">30</span></span><br><span class="line">    Red = <span class="number">31</span></span><br><span class="line">    Green = <span class="number">32</span></span><br><span class="line">    Yellow = <span class="number">33</span></span><br><span class="line">    Blue = <span class="number">34</span></span><br><span class="line">    Purplish_red = <span class="number">35</span></span><br><span class="line">    Cyan = <span class="number">36</span></span><br><span class="line">    White = <span class="number">37</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Background</span>:</span></span><br><span class="line">    Black = <span class="number">40</span></span><br><span class="line">    Red = <span class="number">41</span></span><br><span class="line">    Green = <span class="number">42</span></span><br><span class="line">    Yellow = <span class="number">43</span></span><br><span class="line">    Blue = <span class="number">44</span></span><br><span class="line">    Purplish_red = <span class="number">45</span></span><br><span class="line">    Cyan = <span class="number">46</span></span><br><span class="line">    White = <span class="number">47</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Display</span>:</span></span><br><span class="line">    Default = <span class="number">0</span></span><br><span class="line">    Highlight = <span class="number">1</span></span><br><span class="line">    Underline = <span class="number">4</span></span><br><span class="line">    Twinkle = <span class="number">5</span></span><br><span class="line">    Reverse = <span class="number">7</span></span><br><span class="line">    Invisible = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_color</span><span class="params">(string: str, display_mode: int = Display.Default, foreground: int = Foreground.Green,</span></span></span><br><span class="line"><span class="function"><span class="params">                background: int = Background.Black)</span>:</span></span><br><span class="line">    print(<span class="string">f"\033[<span class="subst">&#123;display_mode&#125;</span>;<span class="subst">&#123;foreground&#125;</span>;<span class="subst">&#123;background&#125;</span>m<span class="subst">&#123;string&#125;</span>\033[0m"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_color</span><span class="params">(string: str, display_mode: int = Display.Default, foreground: int = Foreground.Green,</span></span></span><br><span class="line"><span class="function"><span class="params">              background: int = Background.Black)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f"\033[<span class="subst">&#123;display_mode&#125;</span>;<span class="subst">&#123;foreground&#125;</span>;<span class="subst">&#123;background&#125;</span>m<span class="subst">&#123;string&#125;</span>\033[0m"</span></span><br></pre></td></tr></table></figure>

<p>spider.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> concurrent.futures.thread <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> prettytable <span class="keyword">import</span> PrettyTable</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> zyf.timer <span class="keyword">import</span> timeit</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> print_color</span><br><span class="line"></span><br><span class="line">image_dir = <span class="string">'images'</span></span><br><span class="line"></span><br><span class="line">image_type_info = &#123;</span><br><span class="line">    <span class="number">1</span>: <span class="string">'4kfengjing'</span>, <span class="number">2</span>: <span class="string">'4kmeinv'</span>, <span class="number">3</span>: <span class="string">'4kyouxi'</span>, <span class="number">4</span>: <span class="string">'4kdongman'</span>,</span><br><span class="line">    <span class="number">5</span>: <span class="string">'4kyingshi'</span>, <span class="number">6</span>: <span class="string">'4kmingxing'</span>, <span class="number">7</span>: <span class="string">'4kqiche'</span>, <span class="number">8</span>: <span class="string">'4kdongwu'</span>,</span><br><span class="line">    <span class="number">9</span>: <span class="string">'4krenwu'</span>, <span class="number">10</span>: <span class="string">'4kmeishi'</span>, <span class="number">11</span>: <span class="string">'4kzongjiao'</span>, <span class="number">12</span>: <span class="string">'4kbeijing'</span>,</span><br><span class="line">&#125;</span><br><span class="line">image_tip_info = &#123;</span><br><span class="line">    <span class="number">1</span>: <span class="string">'4K风景'</span>, <span class="number">2</span>: <span class="string">'4K美女'</span>, <span class="number">3</span>: <span class="string">'4K游戏'</span>, <span class="number">4</span>: <span class="string">'4K动漫'</span>,</span><br><span class="line">    <span class="number">5</span>: <span class="string">'4K影视'</span>, <span class="number">6</span>: <span class="string">'4K明星'</span>, <span class="number">7</span>: <span class="string">'4K汽车'</span>, <span class="number">8</span>: <span class="string">'4K动物'</span>,</span><br><span class="line">    <span class="number">9</span>: <span class="string">'4K人物'</span>, <span class="number">10</span>: <span class="string">'4K美食'</span>, <span class="number">11</span>: <span class="string">'4K宗教'</span>, <span class="number">12</span>: <span class="string">'4K背景'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">image_data_list = set()</span><br><span class="line">search_count = <span class="number">0</span></span><br><span class="line">downloaded_count = <span class="number">0</span></span><br><span class="line">success_count = <span class="number">0</span></span><br><span class="line">history_file_path = <span class="string">'history.txt'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(image_dir):</span><br><span class="line">    os.makedirs(image_dir)</span><br><span class="line"></span><br><span class="line">history_file = open(history_file_path, mode=<span class="string">'a+'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">downloaded_images = set()</span><br><span class="line"><span class="keyword">if</span> os.path.exists(history_file_path):</span><br><span class="line">    history_file.seek(<span class="number">0</span>)</span><br><span class="line">    downloaded_images = &#123;line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> history_file&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_tips_info</span><span class="params">()</span>:</span></span><br><span class="line">    table = PrettyTable([<span class="string">'序号1'</span>, <span class="string">'壁纸分类1'</span>, <span class="string">'序号2'</span>, <span class="string">'壁纸分类2'</span>])</span><br><span class="line">    row = []</span><br><span class="line">    <span class="keyword">for</span> index, key <span class="keyword">in</span> enumerate(image_tip_info, start=<span class="number">1</span>):</span><br><span class="line">        row.extend([key, image_tip_info[key]])</span><br><span class="line">        <span class="keyword">if</span> len(row) == <span class="number">4</span>:</span><br><span class="line">            table.add_row(row)</span><br><span class="line">            row.clear()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> index == len(image_type_info):</span><br><span class="line">            row.extend([<span class="string">'-'</span>, <span class="string">'-'</span>])</span><br><span class="line">            table.add_row(row)</span><br><span class="line">    print(table)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_images</span><span class="params">(image_type: int, page_nums: int)</span>:</span></span><br><span class="line">    print(<span class="string">f'正在检索 - <span class="subst">&#123;image_tip_info[image_type]&#125;</span> - 请稍等 - 马上开始下载'</span>)</span><br><span class="line"></span><br><span class="line">    url = <span class="string">'https://pic.netbian.com'</span></span><br><span class="line">    <span class="keyword">if</span> image_type != <span class="number">0</span>:</span><br><span class="line">        url = urljoin(url, image_type_info[image_type])</span><br><span class="line">        image_type_desc = image_tip_info[image_type]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        url = url</span><br><span class="line">        image_type_desc = <span class="string">'最新壁纸'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">f'<span class="subst">&#123;image_dir&#125;</span>/<span class="subst">&#123;image_type_desc&#125;</span>'</span>):</span><br><span class="line">        os.mkdir(<span class="string">f'<span class="subst">&#123;image_dir&#125;</span>/<span class="subst">&#123;image_type_desc&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> page_nums &gt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">with</span> ThreadPoolExecutor(max_workers=page_nums) <span class="keyword">as</span> pool:</span><br><span class="line">            pool.map(get_image_data, [url <span class="keyword">for</span> _ <span class="keyword">in</span> range(page_nums)], [image_type_desc <span class="keyword">for</span> _ <span class="keyword">in</span> range(page_nums)],</span><br><span class="line">                     range(<span class="number">1</span>, page_nums + <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        get_image_data(url=url, image_type_desc=image_type_desc, page_num=page_nums)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_image_data</span><span class="params">(url: str, image_type_desc: str, page_num: int)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> downloaded_count, search_count</span><br><span class="line">    url = url <span class="keyword">if</span> page_num == <span class="number">1</span> <span class="keyword">else</span> <span class="string">f'<span class="subst">&#123;url&#125;</span>/index_<span class="subst">&#123;page_num&#125;</span>.html'</span></span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    html = etree.HTML(response.content)</span><br><span class="line">    <span class="keyword">for</span> li <span class="keyword">in</span> html.xpath(<span class="string">'//*[@id="main"]/div[3]/ul/li'</span>):</span><br><span class="line">        href = li.xpath(<span class="string">'a/@href'</span>)[<span class="number">0</span>]</span><br><span class="line">        uid = href.rsplit(<span class="string">'/'</span>, maxsplit=<span class="number">1</span>)[<span class="number">1</span>].replace(<span class="string">'.html'</span>, <span class="string">''</span>)</span><br><span class="line">        title = li.xpath(<span class="string">'a//img/@alt'</span>)[<span class="number">0</span>].replace(<span class="string">' '</span>, <span class="string">'_'</span>).replace(<span class="string">','</span>, <span class="string">'-'</span>)</span><br><span class="line">        response = requests.get(urljoin(url, href))</span><br><span class="line">        html = etree.HTML(response.content)</span><br><span class="line">        img_url = urljoin(url, html.xpath(<span class="string">'//a[@id="img"]/img/@src'</span>)[<span class="number">0</span>])</span><br><span class="line">        filepath = <span class="string">f'<span class="subst">&#123;image_dir&#125;</span>/<span class="subst">&#123;image_type_desc&#125;</span>/<span class="subst">&#123;title&#125;</span>_<span class="subst">&#123;uid&#125;</span>.jpg'</span></span><br><span class="line">        <span class="keyword">if</span> filepath <span class="keyword">not</span> <span class="keyword">in</span> downloaded_images:</span><br><span class="line">            search_count += <span class="number">1</span></span><br><span class="line">            image_data_list.add((img_url, filepath))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            downloaded_count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@timeit</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(image_type: int, page_nums: int)</span>:</span></span><br><span class="line">    search_images(image_type=image_type, page_nums=page_nums)</span><br><span class="line">    start_download(page_nums)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_download</span><span class="params">(workers: int)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(image_data_list) &gt; <span class="number">20</span>:</span><br><span class="line">        data_list = [set() <span class="keyword">for</span> _ <span class="keyword">in</span> range(workers)]</span><br><span class="line">        <span class="keyword">for</span> index, image <span class="keyword">in</span> enumerate(image_data_list):</span><br><span class="line">            remainder = index % workers</span><br><span class="line">            data_list[remainder].add(image)</span><br><span class="line">        <span class="keyword">with</span> ThreadPoolExecutor(max_workers=workers) <span class="keyword">as</span> pool:</span><br><span class="line">            pool.map(download_images, data_list)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        download_images(image_data_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_images</span><span class="params">(data_list: set = None)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> success_count</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data_list:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    task_progress = tqdm(data_list, ncols=<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">for</span> index, task <span class="keyword">in</span> enumerate(task_progress, start=<span class="number">1</span>):</span><br><span class="line">        url, filepath = task</span><br><span class="line">        task_progress.set_description(<span class="string">f"正在下载第 <span class="subst">&#123;index&#125;</span> 张图片"</span>)</span><br><span class="line">        response = requests.get(url=url)</span><br><span class="line">        <span class="keyword">with</span> open(filepath, mode=<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(response.content)</span><br><span class="line">        history_file.write(<span class="string">f'<span class="subst">&#123;filepath&#125;</span>\n'</span>)</span><br><span class="line">        success_count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    init_tips_info()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        image_type = input(<span class="string">'请选择下载的壁纸分类(序号,默认为最新壁纸) &gt;&gt;  '</span>)</span><br><span class="line">        <span class="keyword">if</span> image_type:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> image_type.isdecimal() <span class="keyword">or</span> int(image_type) <span class="keyword">not</span> <span class="keyword">in</span> image_type_info:</span><br><span class="line">                print(<span class="string">'您输入的分类序号有误，请重新确认后输入'</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                image_type = int(image_type)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            image_type = <span class="number">0</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        page_nums = input(<span class="string">'请输入下载页数（整数，默认为1，每页20）&gt;&gt; '</span>)</span><br><span class="line">        <span class="keyword">if</span> page_nums:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> page_nums.isdecimal():</span><br><span class="line">                print(<span class="string">'您输入的页数有误，必须为整数，请重新输入'</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                page_nums = int(page_nums)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            page_nums = <span class="number">1</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    start(image_type, page_nums)</span><br><span class="line"></span><br><span class="line">    print_color(</span><br><span class="line">        <span class="string">f'\n\n共检索到 <span class="subst">&#123;search_count + downloaded_count&#125;</span> 张图片, 之前已下载 <span class="subst">&#123;downloaded_count&#125;</span> 张, 还需下载 <span class="subst">&#123;search_count&#125;</span> 张, 本次下载成功 <span class="subst">&#123;success_count&#125;</span> 张'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure>


</li>
</ul>
<p>运行结果</p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210407120847338.png" alt></p>
<p>运行演示</p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/spider_netbian.gif" alt></p>
<h4 id="版本2"><a href="#版本2" class="headerlink" title="版本2"></a>版本2</h4><p>spider.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> prettytable <span class="keyword">import</span> PrettyTable</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> zyf.timer <span class="keyword">import</span> timeit</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> print_color</span><br><span class="line"></span><br><span class="line">image_dir = <span class="string">'images'</span></span><br><span class="line"></span><br><span class="line">image_type_info = &#123;</span><br><span class="line">    <span class="number">1</span>: <span class="string">'4kfengjing'</span>, <span class="number">2</span>: <span class="string">'4kmeinv'</span>, <span class="number">3</span>: <span class="string">'4kyouxi'</span>, <span class="number">4</span>: <span class="string">'4kdongman'</span>,</span><br><span class="line">    <span class="number">5</span>: <span class="string">'4kyingshi'</span>, <span class="number">6</span>: <span class="string">'4kmingxing'</span>, <span class="number">7</span>: <span class="string">'4kqiche'</span>, <span class="number">8</span>: <span class="string">'4kdongwu'</span>,</span><br><span class="line">    <span class="number">9</span>: <span class="string">'4krenwu'</span>, <span class="number">10</span>: <span class="string">'4kmeishi'</span>, <span class="number">11</span>: <span class="string">'4kzongjiao'</span>, <span class="number">12</span>: <span class="string">'4kbeijing'</span>,</span><br><span class="line">&#125;</span><br><span class="line">image_tip_info = &#123;</span><br><span class="line">    <span class="number">1</span>: <span class="string">'4K风景'</span>, <span class="number">2</span>: <span class="string">'4K美女'</span>, <span class="number">3</span>: <span class="string">'4K游戏'</span>, <span class="number">4</span>: <span class="string">'4K动漫'</span>,</span><br><span class="line">    <span class="number">5</span>: <span class="string">'4K影视'</span>, <span class="number">6</span>: <span class="string">'4K明星'</span>, <span class="number">7</span>: <span class="string">'4K汽车'</span>, <span class="number">8</span>: <span class="string">'4K动物'</span>,</span><br><span class="line">    <span class="number">9</span>: <span class="string">'4K人物'</span>, <span class="number">10</span>: <span class="string">'4K美食'</span>, <span class="number">11</span>: <span class="string">'4K宗教'</span>, <span class="number">12</span>: <span class="string">'4K背景'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">image_data_list = set()</span><br><span class="line">search_count = <span class="number">0</span></span><br><span class="line">downloaded_count = <span class="number">0</span></span><br><span class="line">success_count = <span class="number">0</span></span><br><span class="line">history_file_path = <span class="string">'history.txt'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(image_dir):</span><br><span class="line">    os.makedirs(image_dir)</span><br><span class="line"></span><br><span class="line">history_file = open(history_file_path, mode=<span class="string">'a+'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">downloaded_images = set()</span><br><span class="line"><span class="keyword">if</span> os.path.exists(history_file_path):</span><br><span class="line">    history_file.seek(<span class="number">0</span>)</span><br><span class="line">    downloaded_images = &#123;line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> history_file&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_tips_info</span><span class="params">()</span>:</span></span><br><span class="line">    table = PrettyTable([<span class="string">'序号1'</span>, <span class="string">'壁纸分类1'</span>, <span class="string">'序号2'</span>, <span class="string">'壁纸分类2'</span>])</span><br><span class="line">    row = []</span><br><span class="line">    <span class="keyword">for</span> index, key <span class="keyword">in</span> enumerate(image_tip_info, start=<span class="number">1</span>):</span><br><span class="line">        row.extend([key, image_tip_info[key]])</span><br><span class="line">        <span class="keyword">if</span> len(row) == <span class="number">4</span>:</span><br><span class="line">            table.add_row(row)</span><br><span class="line">            row.clear()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> index == len(image_type_info):</span><br><span class="line">            row.extend([<span class="string">'-'</span>, <span class="string">'-'</span>])</span><br><span class="line">            table.add_row(row)</span><br><span class="line">    print(table)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@timeit</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_download</span><span class="params">(image_type: int, page_nums: int)</span>:</span></span><br><span class="line">    print(<span class="string">f'正在检索 - <span class="subst">&#123;image_tip_info[image_type]&#125;</span> - 请稍等 - 马上开始下载'</span>)</span><br><span class="line"></span><br><span class="line">    url = <span class="string">'https://pic.netbian.com'</span></span><br><span class="line">    <span class="keyword">if</span> image_type != <span class="number">0</span>:</span><br><span class="line">        url = urljoin(url, image_type_info[image_type])</span><br><span class="line">        image_type_desc = image_tip_info[image_type]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        url = url</span><br><span class="line">        image_type_desc = <span class="string">'最新壁纸'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">f'<span class="subst">&#123;image_dir&#125;</span>/<span class="subst">&#123;image_type_desc&#125;</span>'</span>):</span><br><span class="line">        os.mkdir(<span class="string">f'<span class="subst">&#123;image_dir&#125;</span>/<span class="subst">&#123;image_type_desc&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> page_nums &gt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">with</span> ThreadPoolExecutor(max_workers=page_nums) <span class="keyword">as</span> pool:</span><br><span class="line">            <span class="keyword">for</span> page <span class="keyword">in</span> range(<span class="number">1</span>, page_nums + <span class="number">1</span>):</span><br><span class="line">                pool.submit(get_image_data, url, image_type_desc, page).add_done_callback(download_images_callback)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data_list = get_image_data(url=url, image_type_desc=image_type_desc, page_num=<span class="number">1</span>)</span><br><span class="line">        download_images(data_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_image_data</span><span class="params">(url: str, image_type_desc: str, page_num: int)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> downloaded_count, search_count</span><br><span class="line">    url = url <span class="keyword">if</span> page_num == <span class="number">1</span> <span class="keyword">else</span> <span class="string">f'<span class="subst">&#123;url&#125;</span>/index_<span class="subst">&#123;page_num&#125;</span>.html'</span></span><br><span class="line">    data_list = set()</span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    html = etree.HTML(response.content)</span><br><span class="line">    <span class="keyword">for</span> li <span class="keyword">in</span> html.xpath(<span class="string">'//*[@id="main"]/div[3]/ul/li'</span>):</span><br><span class="line">        href = li.xpath(<span class="string">'a/@href'</span>)[<span class="number">0</span>]</span><br><span class="line">        uid = href.rsplit(<span class="string">'/'</span>, maxsplit=<span class="number">1</span>)[<span class="number">1</span>].replace(<span class="string">'.html'</span>, <span class="string">''</span>)</span><br><span class="line">        title = li.xpath(<span class="string">'a//img/@alt'</span>)[<span class="number">0</span>].replace(<span class="string">' '</span>, <span class="string">'_'</span>)</span><br><span class="line">        response = requests.get(urljoin(url, href))</span><br><span class="line">        html = etree.HTML(response.content)</span><br><span class="line">        img_url = urljoin(url, html.xpath(<span class="string">'//a[@id="img"]/img/@src'</span>)[<span class="number">0</span>])</span><br><span class="line">        filepath = <span class="string">f'<span class="subst">&#123;image_dir&#125;</span>/<span class="subst">&#123;image_type_desc&#125;</span>/<span class="subst">&#123;title&#125;</span>_<span class="subst">&#123;uid&#125;</span>.jpg'</span></span><br><span class="line">        <span class="keyword">if</span> filepath <span class="keyword">not</span> <span class="keyword">in</span> downloaded_images:</span><br><span class="line">            data_list.add((img_url, filepath))</span><br><span class="line">            search_count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            downloaded_count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> data_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_images_callback</span><span class="params">(future)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> success_count</span><br><span class="line">    data_list = future.result()</span><br><span class="line">    <span class="keyword">if</span> len(data_list) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> data_list:</span><br><span class="line">        task_progress = tqdm(data_list, ncols=<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        task_progress = tqdm(image_data_list, ncols=<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">for</span> index, task <span class="keyword">in</span> enumerate(task_progress, start=<span class="number">1</span>):</span><br><span class="line">        url, filepath = task</span><br><span class="line">        task_progress.set_description(<span class="string">f"正在下载第 <span class="subst">&#123;index&#125;</span> 张图片"</span>)</span><br><span class="line">        response = requests.get(url=url)</span><br><span class="line">        <span class="keyword">with</span> open(filepath, mode=<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(response.content)</span><br><span class="line">        history_file.write(<span class="string">f'<span class="subst">&#123;filepath&#125;</span>\n'</span>)</span><br><span class="line">        success_count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_images</span><span class="params">(data_list: set)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> success_count</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data_list:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    task_progress = tqdm(data_list, ncols=<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">for</span> index, task <span class="keyword">in</span> enumerate(task_progress, start=<span class="number">1</span>):</span><br><span class="line">        url, filepath = task</span><br><span class="line">        task_progress.set_description(<span class="string">f"正在下载第 <span class="subst">&#123;index&#125;</span> 张图片"</span>)</span><br><span class="line">        response = requests.get(url=url)</span><br><span class="line">        <span class="keyword">with</span> open(filepath, mode=<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(response.content)</span><br><span class="line">        history_file.write(<span class="string">f'<span class="subst">&#123;filepath&#125;</span>\n'</span>)</span><br><span class="line">        success_count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    init_tips_info()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        image_type = input(<span class="string">'请选择下载的壁纸分类(序号,默认为最新壁纸) &gt;&gt;  '</span>)</span><br><span class="line">        <span class="keyword">if</span> image_type:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> image_type.isdecimal() <span class="keyword">or</span> int(image_type) <span class="keyword">not</span> <span class="keyword">in</span> image_type_info:</span><br><span class="line">                print(<span class="string">'您输入的分类序号有误，请重新确认后输入'</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                image_type = int(image_type)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            image_type = <span class="number">0</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        page_nums = input(<span class="string">'请输入下载页数（整数，默认为1，每页20）&gt;&gt; '</span>)</span><br><span class="line">        <span class="keyword">if</span> page_nums:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> page_nums.isdecimal():</span><br><span class="line">                print(<span class="string">'您输入的页数有误，必须为整数，请重新输入'</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                page_nums = int(page_nums)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            page_nums = <span class="number">1</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    start_download(image_type=image_type, page_nums=page_nums)</span><br><span class="line"></span><br><span class="line">    print_color(</span><br><span class="line">        <span class="string">f'\n\n共检索到 <span class="subst">&#123;search_count + downloaded_count&#125;</span> 张图片, 之前已下载 <span class="subst">&#123;downloaded_count&#125;</span> 张, 还需下载 <span class="subst">&#123;search_count&#125;</span> 张, 本次下载成功 <span class="subst">&#123;success_count&#125;</span> 张'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure>

<p>运行结果‘</p>
<p><img src="https://zhangyafei-1258643511.cos.ap-nanjing.myqcloud.com/image/image-20210407120641203.png" alt></p>
<p>经过测试，版本1和版本2下载同样的100张图片，一个耗时12.686，一个12.961，速度几乎一致。</p>
<p>面向对象代码，有兴趣的伙伴可以进行学习：<a href="https://gitee.com/zhangyafeii/python-doc-tutorial/tree/master/code/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98%EF%BC%9A%E9%AB%98%E6%B8%85%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD" target="_blank" rel="noopener external nofollow noreferrer">爬虫实战：高清图片下载</a></p>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章推荐</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2008\01\05\python\2008-01-04-python-ruan\" rel="bookmark">python-ruan</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2008\01\04\python\2008-01-04-python-draft\" rel="bookmark">python-draft</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\11\25\python\python_基础篇\基础篇-目录\" rel="bookmark">基础篇</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\11\24\python\python_基础篇\第11篇：高级数据类型之集合\" rel="bookmark">第11篇：高级数据类型之集合</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\11\24\python\python_基础篇\第10篇：列表和元组的应用\" rel="bookmark">第10篇：列表和元组的应用</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div>赞赏一下吧～</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="tongsiying 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>tongsiying
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tongsiying.github.io/2021/11/24/python/python_%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98/%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98%EF%BC%9A%E9%AB%98%E6%B8%85%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD/" title="爬虫实战：高清图片下载">https://tongsiying.github.io/2021/11/24/python/python_爬虫实战/爬虫实战：高清图片下载/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/python/" rel="tag"># python</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/11/24/python/python_%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98/%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98%EF%BC%9A%E7%BA%BF%E7%A8%8B%E5%8D%8F%E7%A8%8B%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94/" rel="prev" title="爬虫实战：线程协程性能对比">
      <i class="fa fa-chevron-left"></i> 爬虫实战：线程协程性能对比
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/11/24/python/python_%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/01.%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%92%8C%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7/" rel="next" title="01.网络爬虫和相关工具">
      01.网络爬虫和相关工具 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#项目演示"><span class="nav-text">项目演示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#项目一：NET牛人"><span class="nav-text">项目一：NET牛人</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、目标网站分析"><span class="nav-text">一、目标网站分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、网络请求分析"><span class="nav-text">二、网络请求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、初步实现"><span class="nav-text">三、初步实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、自定义参数和图片存储"><span class="nav-text">四、自定义参数和图片存储</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#五、功能完善"><span class="nav-text">五、功能完善</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-用户提示信息"><span class="nav-text">1. 用户提示信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-获取用户输入"><span class="nav-text">2. 获取用户输入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-添加下载进度条"><span class="nav-text">3. 添加下载进度条</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-代码整合"><span class="nav-text">4. 代码整合</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#六、项目优化"><span class="nav-text">六、项目优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-实现过滤功能"><span class="nav-text">1. 实现过滤功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-多线程下载加速"><span class="nav-text">2. 多线程下载加速</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-为打印输出添加色彩"><span class="nav-text">3. 为打印输出添加色彩</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-面向对象"><span class="nav-text">4. 面向对象</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#项目二：彼岸图网"><span class="nav-text">项目二：彼岸图网</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、目标网站分析-1"><span class="nav-text">一、目标网站分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、网络请求分析-1"><span class="nav-text">二、网络请求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、初步实现-1"><span class="nav-text">三、初步实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、功能完善和优化"><span class="nav-text">四、功能完善和优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#版本1"><span class="nav-text">版本1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#版本2"><span class="nav-text">版本2</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="tongsiying"
      src="/images/gutianle.gif">
  <p class="site-author-name" itemprop="name">tongsiying</p>
  <div class="site-description" itemprop="description">问渠那得清如许？为有源头活水来。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">421</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tongsiying" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tongsiying" rel="noopener external nofollow noreferrer" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wxtlucky1015@163.com" title="E-Mail → mailto:wxtlucky1015@163.com" rel="noopener external nofollow noreferrer" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/2964109344" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;2964109344" rel="noopener external nofollow noreferrer" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/" title="tongsiying → https:&#x2F;&#x2F;tongsiying.github.io"><i class="wrench fa-fw"></i>tongsiying</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/ReadingNotes/" title="ReadingNotes → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;ReadingNotes&#x2F;"><i class="book fa-fw"></i>ReadingNotes</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/blog/" title="blog → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;blog&#x2F;"><i class="book fa-fw"></i>blog</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/blog/tools/" title="tools → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;blog&#x2F;tools&#x2F;"><i class="wrench fa-fw"></i>tools</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/lanlan/" title="lanlan → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;lanlan&#x2F;"><i class="wrench fa-fw"></i>lanlan</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/Music/" title="note → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;Music&#x2F;"><i class="wrench fa-fw"></i>note</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/sound/" title="Music → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;sound&#x2F;"><i class="wrench fa-fw"></i>Music</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/JSONFormat/" title="JSONFormat → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;JSONFormat&#x2F;"><i class="wrench fa-fw"></i>JSONFormat</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/HTML5-Canvas/" title="Canvas → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;HTML5-Canvas&#x2F;"><i class="wrench fa-fw"></i>Canvas</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/games/" title="games → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;games&#x2F;"><i class="wrench fa-fw"></i>games</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/love/" title="love → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;love&#x2F;"><i class="wrench fa-fw"></i>love</a>
      </span>
  </div>



		<div style="">
  <canvas id="canvas" style="width:60%;">��ǰ�������֧��canvas������������������</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //����canvas�Ŀ���
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //�洢ʱ������
    var data = [];
    //�洢�˶���С��
    var balls = [];
    //�������Ӱ뾶
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //�洢ʱ�����֣���ʮλСʱ����λСʱ��ð�š�ʮλ���ӡ���λ���ӡ�ð�š�ʮλ���ӡ���λ������7���������
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*���ɵ�������*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*����ʱ��*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //ʱ�䷢���仯
            if(NewData[i] !== data[i]){
                //���仯������ֵ����data�����е������洢��changeNumArray������
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //����С��
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*����С��״̬*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*����Ҫ�˶���С��*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*��Ⱦ*/
    function render(){
        //���û������ȣ��ﵽ��ջ�����Ч��
        canvas.height = 100;
        //��Ⱦʱ��
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //��ȾС��
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //����ʱ��
        updateDigitTime();
        //����С��״̬
        updateBalls();
        //��Ⱦ
        render();
    },50);
}

})();
</script>
      </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; Weeny – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tongsiying</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">6.1m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">92:38</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
