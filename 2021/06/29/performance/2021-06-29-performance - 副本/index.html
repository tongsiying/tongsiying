<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/hedgehog.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/hedgehog.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tongsiying.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","b2t":true,"scrollpercent":true,"padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="performance">
<meta property="og:url" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/index.html">
<meta property="og:site_name" content="tongsiying">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165331936-258226035.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165427774-1204451515.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165404729-486161047.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301170359419-586503512.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165457773-593293320.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165504168-1545495961.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165517379-2124801784.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165526149-679999705.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165539709-1841664437.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165550212-1790187616.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165557108-1259309741.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165606265-689147647.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165617205-648364546.png">
<meta property="og:image" content="https://hpeng526.github.io/upload/2019/region.png">
<meta property="og:image" content="https://hpeng526.github.io/upload/2019/Y1.png">
<meta property="og:image" content="https://hpeng526.github.io/upload/2019/Y2.png">
<meta property="og:image" content="https://hpeng526.github.io/upload/2019/Y3.png">
<meta property="og:image" content="https://hpeng526.github.io/upload/2019/Y4.png">
<meta property="og:image" content="https://hpeng526.github.io/upload/2019/M1.png">
<meta property="og:image" content="https://hpeng526.github.io/upload/2019/M2.png">
<meta property="og:image" content="https://hpeng526.github.io/upload/2019/M3.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623075924347.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623075933798.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623075945543.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623222820234.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623223017868.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623223153619.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623223329920.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623224110616.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623224157005.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623224942795.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623225202628.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623225227545.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210624072535483.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623230048834.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623230552160.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210624072648902.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210624074021107.png">
<meta property="og:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210624074146183.png">
<meta property="article:published_time" content="2021-06-29T10:37:19.000Z">
<meta property="article:modified_time" content="2022-01-22T12:13:09.817Z">
<meta property="article:author" content="tongsiying">
<meta property="article:tag" content="performance">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165331936-258226035.png">

<link rel="canonical" href="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>performance | tongsiying</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
<!-- 加入APlayer音乐播放器 -->
<link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>
  <div class="container use-motion">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">tongsiying</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">阅读|运动|自律</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/catalog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-目录">

    <a href="/catalog/" rel="section"><i class="fa fa fa-th fa-fw"></i>目录</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-读书清单">

    <a href="/read" rel="section"><i class="fa fa-book fa-fw"></i>读书清单</a>

  </li>
        <li class="menu-item menu-item-读书笔记">

    <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="section"><i class="fa fa-book fa-fw"></i>读书笔记</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/gutianle.gif">
      <meta itemprop="name" content="tongsiying">
      <meta itemprop="description" content="问渠那得清如许？为有源头活水来。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tongsiying">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          performance
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-29 18:37:19" itemprop="dateCreated datePublished" datetime="2021-06-29T18:37:19+08:00">2021-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-22 20:13:09" itemprop="dateModified" datetime="2022-01-22T20:13:09+08:00">2022-01-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/performance/" itemprop="url" rel="index"><span itemprop="name">performance</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>61k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>56 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p class="description"></p>
<a id="more"></a>

<h1 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">测什么：</span><br><span class="line">压力测试、稳定性测试、可靠性测试</span><br></pre></td></tr></table></figure>



<h1 id="java性能工具"><a href="#java性能工具" class="headerlink" title="java性能工具"></a>java性能工具</h1><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">性能工具：</span><br><span class="line">async-profiler   <span class="keyword">java火焰图</span></span><br><span class="line"><span class="keyword">jprofile</span></span><br><span class="line"><span class="keyword">arthas</span></span><br><span class="line"><span class="keyword">j </span>s ta c k</span><br><span class="line"><span class="keyword">jstat</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">jvm内存快照 </span>神风炼</span><br><span class="line"></span><br><span class="line">性能调优：</span><br><span class="line">hpeng526.github</span><br><span class="line"></span><br><span class="line">百度：良好的状态指标</span><br><span class="line"></span><br><span class="line">top -H -p</span><br></pre></td></tr></table></figure>

<h2 id="jvm内存快照dump文件太大，怎么分析"><a href="#jvm内存快照dump文件太大，怎么分析" class="headerlink" title="jvm内存快照dump文件太大，怎么分析"></a><a href="https://www.cnblogs.com/liangzs/p/8489321.html" target="_blank" rel="noopener external nofollow noreferrer">jvm内存快照dump文件太大，怎么分析</a></h2><h3 id="1、场景"><a href="#1、场景" class="headerlink" title="1、场景"></a>1、场景</h3><p>通常，使用eclipse的mat图形化工具打开dump的时候都会内存溢出.</p>
<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165331936-258226035.png" alt="img"></p>
<p>对于比较小的dump，eclipse可以打开，但一旦dump文件太大，eclipse就有点束手无策。</p>
<p>这时候怎么办呢？可以使用linux下的mat，既Memory Analyzer Tools</p>
<h3 id="2、dump生成"><a href="#2、dump生成" class="headerlink" title="2、dump生成"></a>2、dump生成</h3><p>dump可以是内存溢出时让其自动生成，或者手工直接导。配置jvm参数-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/home/biapp/m.hprof</p>
<p>手工直接导，PID为进程号</p>
<p>jmap -dump:live,format=b,file=m.hprof PID</p>
<h3 id="3、准备工作，下载LINUX的MAT"><a href="#3、准备工作，下载LINUX的MAT" class="headerlink" title="3、准备工作，下载LINUX的MAT"></a>3、准备工作，下载LINUX的MAT</h3><p>地址：<a href="http://www.eclipse.org/mat/downloads.php" target="_blank" rel="noopener external nofollow noreferrer">http://www.eclipse.org/mat/downloads.php</a></p>
<p>在linux服务器执行命令 uname –m查看版本</p>
<p> <img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165427774-1204451515.png" alt="img"></p>
<p>下载对应的版本</p>
<p> <img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165404729-486161047.png" alt="img"></p>
<p>下载后将包传到linux服务器上解压。</p>
<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301170359419-586503512.png" alt="img"></p>
<p>MemoryAnalyzer.ini 配置文件可以修改最大的内存，默认1G基本够用了。</p>
<h3 id="4、在linux执行分析命令"><a href="#4、在linux执行分析命令" class="headerlink" title="4、在linux执行分析命令"></a>4、在linux执行分析命令</h3><p>执行命令</p>
<p>./ParseHeapDump.sh m.hprof  org.eclipse.mat.api:suspects org.eclipse.mat.api:overview org.eclipse.mat.api:top_components。</p>
<p>m.hprof就是jvm的dump文件，在mat目录下会生成3份.zip结尾的报告和一些m.相关的文件，将生成的m.hprof相关的文件都下载到windows本地磁盘。</p>
<p>如：</p>
<p> <img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165457773-593293320.png" alt="img"></p>
<h3 id="5、打开分析报告"><a href="#5、打开分析报告" class="headerlink" title="5、打开分析报告"></a>5、打开分析报告</h3><p>1）使用浏览器</p>
<p>解压缩以.zip结尾的文件，解压后</p>
<p> <img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165504168-1545495961.png" alt="img"></p>
<p>使用浏览器打开index.html文件内容，查看分析报告</p>
<p> <img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165517379-2124801784.png" alt="img"></p>
<p>查看Class Histogram一项</p>
<p> <img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165526149-679999705.png" alt="img"></p>
<p>发现其中一个类对象占用了7个G，这里的Heap单位都是Byte，自行换算。</p>
<p>Shallow Heap 既对象本身的大小</p>
<p>Retained Heap 对象自身加起直接或间接引用的大小</p>
<p>​    </p>
<p>2）使用eclipse的mat工具</p>
<p>Eclipse需要按照mat工具，安装步骤可以百度，或者参考</p>
<p><a href="https://jingyan.baidu.com/article/cb5d61053562ed005c2fe022.html" target="_blank" rel="noopener external nofollow noreferrer">https://jingyan.baidu.com/article/cb5d61053562ed005c2fe022.html</a></p>
<p>如果直接打开dump文件还是会内存溢出，所以可以使用eclipse打开分析报告即可。</p>
<p>使用eclipse-File-Open File打开dump文件，如下：</p>
<p> <img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165539709-1841664437.png" alt="img"></p>
<p>会提示错误，点击OK忽略错误，然后选择第三项，重新打开之前的运行报告</p>
<p> <img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165550212-1790187616.png" alt="img"></p>
<p>点击Next,出现如下界面</p>
<p> <img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165557108-1259309741.png" alt="img"></p>
<p>选择其中的一份报告打开，如m_System_Overview.zip</p>
<p> <img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165606265-689147647.png" alt="img"></p>
<p>得到相同的结果</p>
<p> <img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/328846-20180301165617205-648364546.png" alt="img"></p>
<h2 id="G1GC-概念与性能调优-jdk11"><a href="#G1GC-概念与性能调优-jdk11" class="headerlink" title="G1GC 概念与性能调优 (jdk11)"></a>G1GC 概念与性能调优 (jdk11)</h2><blockquote>
<p>本文不讨论 G1 底层数据结构与算法, 从 G1 GC 行为上做简要介绍 G1 的过程</p>
</blockquote>
<p>Garbage-First Garbage Collector 从官网的描述来看 <code>G1 is a generational, incremental, parallel, mostly concurrent, stop-the-world, and evacuating garbage collector which monitors pause-time goals in each of the stop-the-world pauses. Similar to other collectors, G1 splits the heap into (virtual) young and old generations. Space-reclamation efforts concentrate on the young generation where it is most efficient to do so, with occasional space-reclamation in the old generation</code></p>
<p>从介绍可以加粗几个重点</p>
<ul>
<li>分代</li>
<li>并发</li>
<li>STW</li>
<li>在每个STW阶段关注暂停时间目标</li>
<li>回收主要集中在最有效的young generation, old generation则没这么频繁</li>
</ul>
<p>在G1中, 为了提升吞吐量, 有一些操作永远是(STW) stop-the-world 的. 其他的一些要长期的, 如全局标记这种要全堆进行的操作与应用程序并发进行. 为了让空间回收的 STW 尽可能减少, G1并行的分步的递增进行空间回收. G1通过追踪此前应用行为和垃圾回收停顿的信息来构建一个与开销有关的模型(Pause Prediction Model). 它使用这些信息停顿期间可做的工作. 举个例子, G1首先回收最高效的区域(也即垃圾最满的区域, 因此称为垃圾-优先).</p>
<h3 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h3><p>G1把堆分成了n个大小相同的region</p>
<p><img src="https://hpeng526.github.io/upload/2019/region.png" alt="region"></p>
<ul>
<li>E 是 eden region</li>
<li>S 是 survivor region</li>
<li>O 是 old region</li>
<li>H 是 humongous (老年代可以是 humongous, 可以看出, 他可以跨越多个连续regions. 直接分配到老年代, 防止反复拷贝移动)</li>
</ul>
<h3 id="Java-9-以后开启的参数"><a href="#Java-9-以后开启的参数" class="headerlink" title="Java 9 以后开启的参数"></a>Java 9 以后开启的参数</h3><p>自从 Java9 后, 引入的统一的日志, 也就是 Xlog 参数. 下面是建议的 GCLog 参数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xlog:gc*:file=your.log:tags,time,uptime,level:filecount=5,filesize=100m</span><br></pre></td></tr></table></figure>



<h3 id="G1-的-GC-阶段"><a href="#G1-的-GC-阶段" class="headerlink" title="G1 的 GC 阶段"></a>G1 的 GC 阶段</h3><p>我们明白, 调优的基本步骤就是</p>
<ol>
<li>Measure 收集相关诊断信息 (例如, 收集详细的gclog, 默认log level info 可以满足大部分情况)</li>
<li>Understand 理解发生了什么</li>
<li>Tune 调优</li>
</ol>
<p>只有明白了GC内部发生了什么, 才能针对性的对其进行调整</p>
<p>下面通过一些正常的 GC log 来理解 GC 的三种方式 GC 做了什么</p>
<h4 id="Young-Only-Phase"><a href="#Young-Only-Phase" class="headerlink" title="Young Only Phase"></a>Young Only Phase</h4><p>先用张图来简单理解 Young GC 过程</p>
<ul>
<li>垃圾回收的过程就是 Allocated-&gt;eden; eden -&gt; survivor; survivor -&gt; survivor; survivor -&gt; old;</li>
</ul>
<p><img src="https://hpeng526.github.io/upload/2019/Y1.png" alt="y1"></p>
<ul>
<li>可以看到, 这里有 eden, survivor, old 还有个 free region.</li>
</ul>
<p><img src="https://hpeng526.github.io/upload/2019/Y2.png" alt="y2"></p>
<ul>
<li>橙色就是活着的对象</li>
</ul>
<p><img src="https://hpeng526.github.io/upload/2019/Y3.png" alt="y3"></p>
<ul>
<li>G1会把橙色对象拷贝到free region</li>
</ul>
<p><img src="https://hpeng526.github.io/upload/2019/Y4.png" alt="y4"></p>
<ul>
<li>当拷贝完毕, free region 就会晋升为 survivor region, 以前的 eden 就被释放了</li>
<li>如果 Young gc 中, 花费了大量的时间<ul>
<li>正常来说, 大部分在 Young 的对象都不会存活很长时间</li>
</ul>
</li>
<li>如果不符合这个规则 (大部分在 Young 的对象都不会存活很长时间), 你可能需要调整一下 Young 区域占比, 来降低 Young 对象的拷贝时间<ul>
<li><code>-XX:G1NewSizePercent</code> (默认:5) Young region 最小值</li>
<li><code>-XX:G1MaxNewSizePercent</code> (默认: 60) Young region 最大值</li>
</ul>
</li>
</ul>
<h4 id="Mixed-gc-Phase"><a href="#Mixed-gc-Phase" class="headerlink" title="Mixed gc Phase"></a>Mixed gc Phase</h4><ul>
<li>Mixed gc 会选取所有的 Young region + 收益高的若干个 Old region.</li>
</ul>
<p><img src="https://hpeng526.github.io/upload/2019/M1.png" alt="M1"> <img src="https://hpeng526.github.io/upload/2019/M2.png" alt="M2"> <img src="https://hpeng526.github.io/upload/2019/M3.png" alt="M3"></p>
<ul>
<li><p>同样的, 被回收的 region 就变回 free region 了</p>
</li>
<li><p>从上图可以了解到 Mixed gc 只能回收部分的老年代</p>
</li>
<li><p>G1 是如何选择要回收的 regions 的?</p>
<ul>
<li><code>-XX:G1MaxNewSizePercent</code> 与 Young 关联</li>
<li><code>-XX:MixedGCCountTarget</code> 与 old 关联</li>
</ul>
</li>
<li><pre><code>-XX:MixedGCCountTarget
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">  默认是8, 意味着要在8次以内回收完所有的 old region</span><br><span class="line"></span><br><span class="line">  - 换句话说, 如果你有 800 个 old region, 那么一次 mixed gc 最大会回收 100 个 old region</span><br><span class="line"></span><br><span class="line">- G1 也可以被调整成不做这么多工作, 也就是回收少点, 浪费堆内存, 导致更堆使用</span><br><span class="line"></span><br><span class="line">  - `-XX:G1MixedGCLiveThresholdPercent` (默认:85) 可能会提高堆使用率</span><br><span class="line">  - `-XX:G1HeapWastePercent` (默认:5) 如果可回收低于这个值, 那么将不会启动Mixed gc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### Full gc Phase</span><br><span class="line"></span><br><span class="line">- Full gc 是不应该发生的</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 先来看看 GC 周期</span><br><span class="line"></span><br><span class="line">![gcy](https://hpeng526.github.io/upload/2019/gcy.png)</span><br><span class="line"></span><br><span class="line">G1 有两个阶段, 它会在这两个阶段往返, 分别是 Young-only, Space Reclamation.</span><br><span class="line"></span><br><span class="line">- Young-only 包含一系列逐渐填满 old gen 的 gc</span><br><span class="line">- Space Reclamation G1 会递进地回收 old gen 的空间, 同时也处理 Young region</span><br><span class="line"></span><br><span class="line">图是来自 oracle 上对 gc 周期的描述, 实心圆都表示一次 GC 停顿</span><br><span class="line"></span><br><span class="line">- 蓝色 Young-only</span><br><span class="line">- 黄色 标记过程的停顿</span><br><span class="line">- 红色 Mixed gc 停顿</span><br><span class="line"></span><br><span class="line">在几次gc后, old gen 的对象占有比超过了 `InitiatingHeapOccupancyPercent`, gc就会进入并发标记准备(concurrent mark).</span><br><span class="line"></span><br><span class="line">- G1 在每一次 Young 回收中都会查找活对象(有引用的对象)</span><br><span class="line">- G1 在 old region 并发查找活对象</span><br><span class="line">  - 叫 concurrent marking</span><br><span class="line">  - 可能花费很长时间</span><br><span class="line">  - 不会停止 Java 应用</span><br><span class="line">- G1 没有活对象的引用信息是不能进行垃圾回收的</span><br><span class="line">  - Mixed gc 依赖 concurrent mark</span><br><span class="line"></span><br><span class="line">回到 full gc, 从上面简单分析得出, full gc 发生是没有足够的 free region, 如果堆是足够大的, Mixed gc 没有回收足够的 old region, 或者 concurrent mark 没法及时完成, 都可能会导致 full gc.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### gc 日志</span><br><span class="line"></span><br><span class="line">```log</span><br><span class="line">[gc,start     ] GC(78) Pause Young (Normal) (G1 Evacuation Pause)</span><br><span class="line">[gc,task      ] GC(78) Using 10 workers of 10 for evacuation</span><br><span class="line">[gc,phases    ] GC(78)   Pre Evacuate Collection Set: 3.2ms</span><br><span class="line">[gc,phases    ] GC(78)   Evacuate Collection Set: 28.8ms</span><br><span class="line">[gc,phases    ] GC(78)   Post Evacuate Collection Set: 1.8ms</span><br><span class="line">[gc,phases    ] GC(78)   Other: 1.1ms</span><br><span class="line">[gc,heap      ] GC(78) Eden regions: 538-&gt;0(871)</span><br><span class="line">[gc,heap      ] GC(78) Survivor regions: 69-&gt;33(76)</span><br><span class="line">[gc,heap      ] GC(78) Old regions: 1041-&gt;1077</span><br><span class="line">[gc,heap      ] GC(78) Humongous regions: 3-&gt;1</span><br><span class="line">[gc,metaspace ] GC(78) Metaspace: 71777K-&gt;71777K(1114112K)</span><br><span class="line">[gc           ] GC(78) Pause Young (Normal) (G1 Evacuation Pause) 3300M-&gt;2220M(6144M) 34.907ms</span><br><span class="line">[gc,cpu       ] GC(78) User=0.24s Sys=0.05s Real=0.04s</span><br><span class="line">[gc,start     ] GC(79) Pause Young (Concurrent Start) (G1 Humongous Allocation)</span><br><span class="line">[gc,task      ] GC(79) Using 10 workers of 10 for evacuation</span><br><span class="line">[gc,phases    ] GC(79)   Pre Evacuate Collection Set: 0.2ms</span><br><span class="line">[gc,phases    ] GC(79)   Evacuate Collection Set: 22.3ms</span><br><span class="line">[gc,phases    ] GC(79)   Post Evacuate Collection Set: 0.9ms</span><br><span class="line">[gc,phases    ] GC(79)   Other: 1.8ms</span><br><span class="line">[gc,heap      ] GC(79) Eden regions: 569-&gt;0(656)</span><br><span class="line">[gc,heap      ] GC(79) Survivor regions: 33-&gt;55(113)</span><br><span class="line">[gc,heap      ] GC(79) Old regions: 1077-&gt;1077</span><br><span class="line">[gc,heap      ] GC(79) Humongous regions: 1-&gt;1</span><br><span class="line">[gc,metaspace ] GC(79) Metaspace: 71780K-&gt;71780K(1114112K)</span><br><span class="line">[gc           ] GC(79) Pause Young (Concurrent Start) (G1 Humongous Allocation) 3357M-&gt;2264M(6144M) 25.305ms</span><br><span class="line">[gc,cpu       ] GC(79) User=0.21s Sys=0.00s Real=0.03s</span><br><span class="line">[gc           ] GC(80) Concurrent Cycle</span><br><span class="line">[gc,marking   ] GC(80) Concurrent Clear Claimed Marks</span><br><span class="line">[gc,marking   ] GC(80) Concurrent Clear Claimed Marks 0.147ms</span><br><span class="line">[gc,marking   ] GC(80) Concurrent Scan Root Regions</span><br><span class="line">[gc,marking   ] GC(80) Concurrent Scan Root Regions 16.125ms</span><br><span class="line">[gc,marking   ] GC(80) Concurrent Mark (373.358s)</span><br><span class="line">[gc,marking   ] GC(80) Concurrent Mark From Roots</span><br><span class="line">[gc,task      ] GC(80) Using 4 workers of 4 for marking</span><br><span class="line">[gc,marking   ] GC(80) Concurrent Mark From Roots 57.029ms</span><br><span class="line">[gc,marking   ] GC(80) Concurrent Preclean</span><br><span class="line">[gc,marking   ] GC(80) Concurrent Preclean 0.454ms</span><br><span class="line">[gc,marking   ] GC(80) Concurrent Mark (373.358s, 373.415s) 57.548ms</span><br><span class="line">[gc,start     ] GC(80) Pause Remark</span><br><span class="line">[gc,stringtable] GC(80) Cleaned string and symbol table, strings: 36361 processed, 315 removed, symbols: 192117 processed, 500 removed</span><br><span class="line">[gc            ] GC(80) Pause Remark 2326M-&gt;956M(6144M) 14.454ms</span><br><span class="line">[gc,cpu        ] GC(80) User=0.08s Sys=0.03s Real=0.02s</span><br><span class="line">[gc,marking    ] GC(80) Concurrent Rebuild Remembered Sets</span><br><span class="line">[gc,marking    ] GC(80) Concurrent Rebuild Remembered Sets 38.843ms</span><br><span class="line">[gc,start      ] GC(80) Pause Cleanup</span><br><span class="line">[gc            ] GC(80) Pause Cleanup 974M-&gt;974M(6144M) 0.660ms</span><br><span class="line">[gc,cpu        ] GC(80) User=0.00s Sys=0.00s Real=0.00s</span><br><span class="line">[gc,marking    ] GC(80) Concurrent Cleanup for Next Mark</span><br><span class="line">[gc,marking    ] GC(80) Concurrent Cleanup for Next Mark 16.673ms</span><br><span class="line">[gc            ] GC(80) Concurrent Cycle 146.748ms</span><br><span class="line">[gc,start      ] GC(81) Pause Young (Prepare Mixed) (G1 Evacuation Pause)</span><br><span class="line">[gc,task       ] GC(81) Using 10 workers of 10 for evacuation</span><br><span class="line">[gc,mmu        ] GC(81) MMU target violated: 61.0ms (60.0ms/61.0ms)</span><br><span class="line">[gc,phases     ] GC(81)   Pre Evacuate Collection Set: 0.1ms</span><br><span class="line">[gc,phases     ] GC(81)   Evacuate Collection Set: 76.8ms</span><br><span class="line">[gc,phases     ] GC(81)   Post Evacuate Collection Set: 0.9ms</span><br><span class="line">[gc,phases     ] GC(81)   Other: 1.1ms</span><br><span class="line">[gc,heap       ] GC(81) Eden regions: 211-&gt;0(136)</span><br><span class="line">[gc,heap       ] GC(81) Survivor regions: 55-&gt;17(34)</span><br><span class="line">[gc,heap       ] GC(81) Old regions: 392-&gt;443</span><br><span class="line">[gc,heap       ] GC(81) Humongous regions: 3-&gt;1</span><br><span class="line">[gc,metaspace  ] GC(81) Metaspace: 71780K-&gt;71780K(1114112K)</span><br><span class="line">[gc            ] GC(81) Pause Young (Prepare Mixed) (G1 Evacuation Pause) 1320M-&gt;919M(6144M) 78.857ms</span><br><span class="line">[gc,cpu        ] GC(81) User=0.41s Sys=0.37s Real=0.08s</span><br><span class="line">[gc,start      ] GC(82) Pause Young (Mixed) (G1 Evacuation Pause)</span><br><span class="line">[gc,task       ] GC(82) Using 10 workers of 10 for evacuation</span><br><span class="line">[gc,phases     ] GC(82)   Pre Evacuate Collection Set: 0.1ms</span><br><span class="line">[gc,phases     ] GC(82)   Evacuate Collection Set: 22.1ms</span><br><span class="line">[gc,phases     ] GC(82)   Post Evacuate Collection Set: 0.8ms</span><br><span class="line">[gc,phases     ] GC(82)   Other: 0.9ms</span><br><span class="line">[gc,heap       ] GC(82) Eden regions: 136-&gt;0(142)</span><br><span class="line">[gc,heap       ] GC(82) Survivor regions: 17-&gt;11(20)</span><br><span class="line">[gc,heap       ] GC(82) Old regions: 443-&gt;367</span><br><span class="line">[gc,heap       ] GC(82) Humongous regions: 1-&gt;1</span><br><span class="line">[gc,metaspace  ] GC(82) Metaspace: 71780K-&gt;71780K(1114112K)</span><br><span class="line">[gc            ] GC(82) Pause Young (Mixed) (G1 Evacuation Pause) 1191M-&gt;757M(6144M) 23.970ms</span><br><span class="line">[gc,cpu        ] GC(82) User=0.15s Sys=0.08s Real=0.03s</span><br><span class="line">[gc,start      ] GC(83) Pause Young (Mixed) (G1 Evacuation Pause)</span><br><span class="line">[gc,task       ] GC(83) Using 10 workers of 10 for evacuation</span><br><span class="line">[gc,phases     ] GC(83)   Pre Evacuate Collection Set: 0.1ms</span><br><span class="line">[gc,phases     ] GC(83)   Evacuate Collection Set: 5.0ms</span><br><span class="line">[gc,phases     ] GC(83)   Post Evacuate Collection Set: 0.8ms</span><br><span class="line">[gc,phases     ] GC(83)   Other: 1.1ms</span><br><span class="line">[gc,heap       ] GC(83) Eden regions: 142-&gt;0(783)</span><br><span class="line">[gc,heap       ] GC(83) Survivor regions: 11-&gt;10(20)</span><br><span class="line">[gc,heap       ] GC(83) Old regions: 367-&gt;294</span><br><span class="line">[gc,heap       ] GC(83) Humongous regions: 1-&gt;1</span><br><span class="line">[gc,metaspace  ] GC(83) Metaspace: 71780K-&gt;71780K(1114112K)</span><br></pre></td></tr></table></figure>
</code></pre></li>
</ul>
<p>上面是连续几次GC的日志, 可以对照着 gc 周期来看 为了方便排版, 把时间相关的tag给精简掉了</p>
<ul>
<li>GC(78) 是一次普通的young gc, 里面信息有各种 region 的变化<ul>
<li>这里简单说一下 humongous 对象的处理</li>
<li>humongous 对象在G1中是被特殊对待的, G1 只决定它们是否生存, 回收他们占用的空间, 从不会移动它们.</li>
<li>Young-Only 阶段, humongous regions 可能会被回收</li>
<li>Space-Reclamation, humongous regions 可能会被回收</li>
</ul>
</li>
<li>GC(79) 开始进入并发阶段</li>
<li>GC(80) 完成了 Cleanup, 紧接着一个 Prepare Mixed GC(81) 的垃圾收集, 对应周期虚线右边的蓝实心圆</li>
<li>GC(82) 之后就是 Space Reclamation 阶段了. 多个 Mixed GC 会进行</li>
</ul>
<p>根据日志, 可以简单看到每个步骤花费的时间, 以及对应区域垃圾的回收情况, 结合GC参数, 可以定位出什么问题, 针对性的调整参数.</p>
<blockquote>
<p>吞吐量跟低延时是无法兼得的, 低延时意味着GC工作会更加频繁, 相对的, 会占用应用的资源, 吞吐量降低. 需要大吞吐量, 那么GC工作就会减少, 相对的, 每次回收的垃圾就会多, 暂停时间就会增加, 延时就会增加. <code>-XX:MaxGCPauseMillis</code> G1 会尽量满足这个参数设定的目标时间, 通过此参数可以平衡应用需要的吞吐量以及延时.</p>
</blockquote>
<h4 id="g1gc-young-shrinking"><a href="#g1gc-young-shrinking" class="headerlink" title="g1gc young shrinking"></a>g1gc young shrinking</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[gc,start      ] GC(29233) Pause Young (Normal) (G1 Evacuation Pause)</span><br><span class="line">[gc,task       ] GC(29233) Using 8 workers of 8 for evacuation</span><br><span class="line">[gc,phases     ] GC(29233)   Pre Evacuate Collection Set: 0.1ms</span><br><span class="line">[gc,phases     ] GC(29233)   Evacuate Collection Set: 28.7ms</span><br><span class="line">[gc,phases     ] GC(29233)   Post Evacuate Collection Set: 1.2ms</span><br><span class="line">[gc,phases     ] GC(29233)   Other: 1.1ms</span><br><span class="line">[gc,heap       ] GC(29233) Eden regions: 1779-&gt;0(1771)</span><br><span class="line">[gc,heap       ] GC(29233) Survivor regions: 64-&gt;72(231)</span><br><span class="line">[gc,heap       ] GC(29233) Old regions: 327-&gt;327</span><br><span class="line">[gc,heap       ] GC(29233) Humongous regions: 1-&gt;1</span><br><span class="line">[gc,metaspace  ] GC(29233) Metaspace: 75815K-&gt;75815K(1118208K)</span><br><span class="line">[gc            ] GC(29233) Pause Young (Normal) (G1 Evacuation Pause) 4339M-&gt;798M(6144M) 31.124ms</span><br><span class="line">[gc,cpu        ] GC(29233) User&#x3D;0.24s Sys&#x3D;0.00s Real&#x3D;0.04s</span><br><span class="line">[gc,start      ] GC(29234) Pause Young (Normal) (G1 Evacuation Pause)</span><br><span class="line">[gc,task       ] GC(29234) Using 8 workers of 8 for evacuation</span><br><span class="line">[gc,mmu        ] GC(29234) MMU target violated: 61.0ms (60.0ms&#x2F;61.0ms)</span><br><span class="line">[gc,phases     ] GC(29234)   Pre Evacuate Collection Set: 0.1ms</span><br><span class="line">[gc,phases     ] GC(29234)   Evacuate Collection Set: 26.6ms</span><br><span class="line">[gc,phases     ] GC(29234)   Post Evacuate Collection Set: 870.6ms</span><br><span class="line">[gc,phases     ] GC(29234)   Other: 1.2ms</span><br><span class="line">[gc,heap       ] GC(29234) Eden regions: 1771-&gt;0(84)</span><br><span class="line">[gc,heap       ] GC(29234) Survivor regions: 72-&gt;69(231)</span><br><span class="line">[gc,heap       ] GC(29234) Old regions: 327-&gt;327</span><br><span class="line">[gc,heap       ] GC(29234) Humongous regions: 1-&gt;1</span><br><span class="line">[gc,metaspace  ] GC(29234) Metaspace: 75815K-&gt;75815K(1118208K)</span><br><span class="line">[gc            ] GC(29234) Pause Young (Normal) (G1 Evacuation Pause) 4340M-&gt;791M(6144M) 898.525ms</span><br><span class="line">[gc,cpu        ] GC(29234) User&#x3D;0.22s Sys&#x3D;0.00s Real&#x3D;0.90s</span><br></pre></td></tr></table></figure>

<ul>
<li>Eden regions shrinking 1771 -&gt; 84<ul>
<li>If not otherwise constrained, then G1 adaptively sizes the young generation size between the values that -XX:G1NewSizePercent and -XX:G1MaxNewSizePercent determine to meet pause-time. See Garbage-First Garbage Collector Tuning for more information about how to fix long pauses.</li>
</ul>
</li>
<li>User=0.22s Sys=0.00s Real=0.90s, Real &gt; User + Sys<ul>
<li>gc lack of cpu time</li>
</ul>
</li>
</ul>
<h2 id="从-GC-log-了解与分析-gc"><a href="#从-GC-log-了解与分析-gc" class="headerlink" title="从 GC log 了解与分析 gc"></a>从 GC log 了解与分析 gc</h2><p>CMS 介绍</p>
<p>CMS, Concurrent Mark Sweep, 并发的标记清楚算法GC.</p>
<h3 id="CMS-执行"><a href="#CMS-执行" class="headerlink" title="CMS 执行"></a>CMS 执行</h3><ol>
<li>初始化标记</li>
<li>并发标记</li>
<li>并发预清理</li>
<li>重标记</li>
<li>并发清理</li>
<li>重置</li>
</ol>
<p>环境配置是 JDK8, HotSpot VM</p>
<p>应用配置的参数</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-<span class="string">XX:</span>+UseConcMarkSweepGC                             <span class="comment">// 使用 CMS GC</span></span><br><span class="line">-<span class="string">XX:</span>+UseCMSInitiatingOccupancyOnly                  <span class="comment">// 不基于运行时收集的数据来启动 CMS 垃圾收集的周期, 使用CMSInitiatingOccupancyFraction</span></span><br><span class="line">-<span class="string">XX:</span>CMSInitiatingOccupancyFraction=<span class="number">70</span>               <span class="comment">// 使用70%后开始 CMS GC</span></span><br><span class="line">-<span class="string">XX:</span>+ExplicitGCInvokesConcurrentAndUnloadsClasses   <span class="comment">// 显式 GC 执行 CMS GC 非 FGC</span></span><br><span class="line">-<span class="string">XX:</span>+CMSClassUnloadingEnabled                       <span class="comment">// CMS 也收集 PermGen space (https://blogs.oracle.com/poonam/about-g1-garbage-collector,-permanent-generation-and-metaspace)</span></span><br><span class="line">-<span class="string">XX:</span>+ParallelRefProcEnabled                         <span class="comment">// 并行处理 ref</span></span><br><span class="line">-<span class="string">XX:</span>+CMSScavengeBeforeRemark                        <span class="comment">// 在CMS remark前执行一次minor gc清理新生代, 减少stop-the-world时间</span></span><br><span class="line">-<span class="string">XX:</span>+PrintGCDetails                                 <span class="comment">// 打印 GC 详细信息</span></span><br><span class="line">-<span class="string">XX:</span>+PrintGCDateStamps                              <span class="comment">// 输出GC的时间戳</span></span><br></pre></td></tr></table></figure>

<p>CMS GC log 如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; initial mark stop-the-world</span><br><span class="line">2018-08-06T10:55:07.447+0800: 495808.570: [GC (CMS Initial Mark) [1 CMS-initial-mark: 1421882K(1966080K)] 1464386K(3027776K), 0.0610635 secs] [Times: user&#x3D;0.05 sys&#x3D;0.00, real&#x3D;0.06 secs] </span><br><span class="line">&#x2F;&#x2F; concurrent mark</span><br><span class="line">2018-08-06T10:55:07.510+0800: 495808.633: [CMS-concurrent-mark-start]</span><br><span class="line">2018-08-06T10:55:38.879+0800: 495840.002: [CMS-concurrent-mark: 27.341&#x2F;31.368 secs] [Times: user&#x3D;48.82 sys&#x3D;8.29, real&#x3D;31.36 secs] </span><br><span class="line">&#x2F;&#x2F; concurrent preclean</span><br><span class="line">2018-08-06T10:55:38.879+0800: 495840.002: [CMS-concurrent-preclean-start]</span><br><span class="line">2018-08-06T10:55:39.303+0800: 495840.426: [CMS-concurrent-preclean: 0.131&#x2F;0.424 secs] [Times: user&#x3D;0.89 sys&#x3D;0.05, real&#x3D;0.43 secs] </span><br><span class="line">&#x2F;&#x2F; abortable preclean</span><br><span class="line">2018-08-06T10:55:39.303+0800: 495840.427: [CMS-concurrent-abortable-preclean-start]</span><br><span class="line">2018-08-06T10:55:39.303+0800: 495840.427: [CMS-concurrent-abortable-preclean: 0.000&#x2F;0.000 secs] [Times: user&#x3D;0.00 sys&#x3D;0.00, real&#x3D;0.00 secs] </span><br><span class="line">&#x2F;&#x2F; final remark stop-the-world</span><br><span class="line">2018-08-06T10:55:39.320+0800: 495840.444: [GC (CMS Final Remark) [YG occupancy: 237032 K (1061696 K)]2018-08-06T10:55:39.321+0800: 495840.444: [GC (CMS Final Remark) 2018-08-06T10:55:39.321+0800: 495840.444: [ParNew: 237032K-&gt;237032K(1061696K), 0.0000520 secs] 2068900K-&gt;2068900K(3027776K), 0.0004108 secs] [Times: user&#x3D;0.00 sys&#x3D;0.00, real&#x3D;0.00 secs] </span><br><span class="line">&#x2F;&#x2F; rescan</span><br><span class="line">2018-08-06T10:55:39.321+0800: 495840.444: [Rescan (parallel) , 0.1066672 secs]2018-08-06T10:55:39.428+0800: 495840.551: [weak refs processing, 0.0868804 secs]2018-08-06T10:55:39.515+0800: 495840.638: [class unloading, 0.0667963 secs]</span><br><span class="line">&#x2F;&#x2F; scrub symbol table</span><br><span class="line">2018-08-06T10:55:39.582+0800: 495840.705: [scrub symbol table, 0.0554765 secs]2018-08-06T10:55:39.637+0800: 495840.761: [scrub string table, 0.0065050 secs][1 CMS-remark: 1831867K(1966080K)] 2068900K(3027776K), 0.3247966 secs] [Times: user&#x3D;0.48 sys&#x3D;0.01, real&#x3D;0.32 secs] </span><br><span class="line">2018-08-06T10:55:39.646+0800: 495840.770: [CMS-concurrent-sweep-start]</span><br><span class="line">2018-08-06T10:55:48.631+0800: 495849.755: [CMS-concurrent-sweep: 6.052&#x2F;8.985 secs] [Times: user&#x3D;7.66 sys&#x3D;4.13, real&#x3D;8.99 secs] </span><br><span class="line">&#x2F;&#x2F; reset start</span><br><span class="line">2018-08-06T10:55:49.130+0800: 495850.253: [CMS-concurrent-reset-start]</span><br><span class="line">2018-08-06T10:55:49.139+0800: 495850.263: [CMS-concurrent-reset: 0.009&#x2F;0.009 secs] [Times: user&#x3D;0.03 sys&#x3D;0.00, real&#x3D;0.00 secs] </span><br><span class="line">2018-08-06T10:55:53.548+0800: 495854.672: [CMS: 1336369K-&gt;468683K(1966080K), 2.2096604 secs] 2336499K-&gt;468683K(3027776K), [Metaspace: 120912K-&gt;120912K(1165312K)], 2.7556633 secs] [Times: user&#x3D;2.87 sys&#x3D;0.01, real&#x3D;2.75 secs]</span><br></pre></td></tr></table></figure>

<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><h4 id="CMS-阶段"><a href="#CMS-阶段" class="headerlink" title="CMS 阶段"></a>CMS 阶段</h4><table>
<thead>
<tr>
<th>步骤</th>
<th>解释</th>
<th>stop-the-world</th>
</tr>
</thead>
<tbody><tr>
<td>CMS Initial Mark</td>
<td>可达性分析, 标记 GC Roots <code>直接关联</code> 对象</td>
<td>True</td>
</tr>
<tr>
<td>CMS-concurrent-mark</td>
<td>GC Tracing, 从 GC Roots 开始对堆进行<code>可达性分析</code>, 找出存活对象</td>
<td>False</td>
</tr>
<tr>
<td>CMS-concurrent-preclean</td>
<td>负责前一个阶段标记了又发生改变的对象标记</td>
<td>False</td>
</tr>
<tr>
<td>CMS-concurrent-abortable-preclean</td>
<td>尝试着去承担 Final Remark 阶段足够多的工作, 重复的做相同的事情直到 abort 条件</td>
<td>False</td>
</tr>
<tr>
<td>CMS Final Remark</td>
<td>完成标记整个年老代的所有的存活对象</td>
<td>True</td>
</tr>
<tr>
<td>CMS-concurrent-sweep</td>
<td>开始移除对象</td>
<td>False</td>
</tr>
<tr>
<td>CMS-concurrent-reset</td>
<td>重置 CMS 算法内部结构</td>
<td>False</td>
</tr>
</tbody></table>
<h4 id="GC-触发条件"><a href="#GC-触发条件" class="headerlink" title="GC 触发条件"></a>GC 触发条件</h4><table>
<thead>
<tr>
<th>原因</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Allocation Failure</td>
<td>新生代(Young generation)不够空间给创建新对象, 触发 minor gc.</td>
</tr>
<tr>
<td>Promotion Failure</td>
<td>没有 <code>连续</code> 的空间来存放更大的对象. 通常会导致 FGC.</td>
</tr>
<tr>
<td>GCLocker Initiated GC</td>
<td>JNI 临界区被释放就会触发</td>
</tr>
<tr>
<td>Concurrent Mode Failure</td>
<td>CMS 采用多个线程和应用线程并发执行, 减少停顿时间, 通常发生于年老代被用完之前不能完成对无引用对象的回收或者年老代不能满足新的空间分配</td>
</tr>
<tr>
<td>Heap Dump Initiated GC</td>
<td>heap dump 之前进行 FGC , 一般是通过工具 dump 会触发 (jmap)</td>
</tr>
</tbody></table>
<h4 id="GC-异常点"><a href="#GC-异常点" class="headerlink" title="GC 异常点"></a>GC 异常点</h4><p>通过 <a href="https://hpeng526.github.io/posts/18/1808cmsgc/gceasy.io" target="_blank" rel="noopener external nofollow noreferrer">gceasy.io</a> 上传日志, 分析异常点得出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">It looks like your application <span class="keyword">is</span> waiting due to lack of compute resources (either CPU <span class="keyword">or</span> I/O cycles). Serious production applications shouldn<span class="string">'t be stranded because of compute resources. In 47 GC event(s), '</span>real<span class="string">' time took more than '</span>us<span class="string">r' + '</span>sys<span class="string">' time.</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>Timestamp</th>
<th>User Time (secs)</th>
<th>Sys Time (secs)</th>
<th>Real Time (secs)</th>
</tr>
</thead>
<tbody><tr>
<td>2018-08-06T10:21:12</td>
<td>0.26</td>
<td>0.01</td>
<td>0.61</td>
</tr>
<tr>
<td>2018-08-06T10:21:18</td>
<td>0.24</td>
<td>0.04</td>
<td>0.9</td>
</tr>
<tr>
<td>2018-08-06T10:33:25</td>
<td>0.22</td>
<td>0.01</td>
<td>0.58</td>
</tr>
<tr>
<td>2018-08-06T10:34:54</td>
<td>0.3</td>
<td>0.01</td>
<td>0.52</td>
</tr>
<tr>
<td>2018-08-06T10:35:15</td>
<td>0.55</td>
<td>0.02</td>
<td>1.15</td>
</tr>
</tbody></table>
<p>意思就是 ‘real’ time &gt; ‘usr’ + ‘sys’, 造成这种现象的可能性有</p>
<ol>
<li>Heavy I/O 如果有 I/O 密集任务, ‘real time’ 会变长. &gt; 解决方案 1. 优化高 I/O 任务 1. 在服务器上减少导致高 I/O 的任务 1. 迁移应用到低 I/O 的服务器上</li>
<li>Lack of CPU 如果是服务器上有多个进程在跑, 程序得不到足够的 CPU 周期, 就会开始等待. 因此 ‘real time’会变长 &gt; 解决方案: 1. 减少服务器上的进程 1. 增加 CPU 1. 迁移应用到充足 CPU 服务器上</li>
</ol>
<h4 id="现象分析"><a href="#现象分析" class="headerlink" title="现象分析"></a>现象分析</h4><p>当时出现的现象是: 1. CPU 告警 1. 上去服务器看到系统负载已经到70左右 1. top 信息看到应用占用 CPU 高 1. GC 日志显示同一台服务器上的两个服务在10点时间段 CMS 都在工作 1. 业务高峰期 1. 4核服务器</p>
<p>初步分析: 1. 从应用线程dump分析, 应用内线程无明显异常现象. 1. 结合 top -H 初步得到是 GC 线程在运行 1. 从 GC log 入手, 分析得出异常点, 回顾与计算两个服务 CMS 线程占用了一半的 CPU 资源 <code>(4+3)/4*2</code>, 导致 CPU 资源紧缺, 整体服务变慢.</p>
<h3 id="参考4资料"><a href="#参考4资料" class="headerlink" title="参考4资料"></a>参考4资料</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span><span class="comment">//www.cnblogs.com/zhangxiaoguang/p/5792468.html</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//juejin.im/post/5b651200f265da0fa00a38d7?utm_source=gold_browser_extension</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//stackoverflow.com/questions/22149075/why-promotion-failure-and-concurrent-mode-failure</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//blog.gceasy.io/2016/12/08/real-time-greater-than-user-and-sys-time/</span></span><br></pre></td></tr></table></figure>



<h1 id="linux性能监控"><a href="#linux性能监控" class="headerlink" title="linux性能监控"></a>linux性能监控</h1><p> CPU、Memory、IO、Network等指标的讲解</p>
<h2 id="一、CPU"><a href="#一、CPU" class="headerlink" title="一、CPU"></a>一、CPU</h2><p>1、良好状态指标</p>
<ul>
<li>CPU利用率：User Time &lt;= 70%，System Time &lt;= 35%，User Time + System Time &lt;= 70%。</li>
<li>上下文切换：与CPU利用率相关联，如果CPU利用率状态良好，大量的上下文切换也是可以接受的。</li>
<li>可运行队列：每个处理器的可运行队列&lt;=3个线程。</li>
</ul>
<p>2、监控工具</p>
<ul>
<li>vmstat</li>
</ul>
<p>$ vmstat 1</p>
<p>procs ———–memory———- —swap– —–io—- –system– —–cpu——</p>
<p>r b  swpd  free  buff cache  si  so  bi  bo  in  cs us sy id wa st</p>
<p>14 0  140 2904316 341912 3952308 0  0   0  460 1106 9593 36 64 1 0 0</p>
<p>17 0  140 2903492 341912 3951780 0  0   0   0 1037 9614 35 65 1 0 0</p>
<p>20 0  140 2902016 341912 3952000 0  0   0   0 1046 9739 35 64 1 0 0</p>
<p>17 0  140 2903904 341912 3951888 0  0   0  76 1044 9879 37 63 0 0 0</p>
<p>16 0  140 2904580 341912 3952108 0  0   0   0 1055 9808 34 65 1 0 0</p>
<p>重要参数：</p>
<p>r，run queue，可运行队列的线程数，这些线程都是可运行状态，只不过CPU暂时不可用；</p>
<p>b，被blocked的进程数，正在等待IO请求；</p>
<p>in，interrupts，被处理过的中断数</p>
<p>cs，context switch，系统上正在做上下文切换的数目</p>
<p>us，用户占用CPU的百分比</p>
<p>sys，内核和中断占用CPU的百分比</p>
<p>id，CPU完全空闲的百分比</p>
<p>上例可得：</p>
<p>sy高us低，以及高频度的上下文切换（cs），说明应用程序进行了大量的系统调用；</p>
<p>这台4核机器的r应该在12个以内，现在r在14个线程以上，此时CPU负荷很重。</p>
<ul>
<li>查看某个进程占用的CPU资源</li>
</ul>
<p>$ while :; do ps -eo pid,ni,pri,pcpu,psr,comm | grep ‘test_command’; sleep 1; done</p>
<p> PID NI PRI %CPU PSR COMMAND</p>
<p>28577  0 23 0.0  0 test_command</p>
<p>28578  0 23 0.0  3 test_command</p>
<p>28579  0 23 0.0  2 test_command</p>
<p>28581  0 23 0.0  2 test_command</p>
<p>28582  0 23 0.0  3 test_command</p>
<p>28659  0 23 0.0  0 test_command</p>
<p>…… </p>
<h2 id="二、Memory"><a href="#二、Memory" class="headerlink" title="二、Memory"></a>二、Memory</h2><p>1、良好状态指标</p>
<ul>
<li>swap in （si） == 0，swap out （so） == 0</li>
<li>应用程序可用内存/系统物理内存 &lt;= 70%</li>
</ul>
<p>2、监控工具</p>
<ul>
<li>vmstat</li>
</ul>
<p>$ vmstat 1</p>
<p>procs ———–memory———- —swap– —–io—- –system– —–cpu——</p>
<p>r b  swpd  free  buff cache  si  so  bi  bo  in  cs us sy id wa st</p>
<p>0 3 252696  2432  268  7148 3604 2368 3608 2372 288 288 0 0 21 78 1</p>
<p>0 2 253484  2216  228  7104 5368 2976 5372 3036 930 519 0 0 0 100 0</p>
<p>0 1 259252  2616  128  6148 19784 18712 19784 18712 3821 1853 0 1 3 95 1</p>
<p>1 2 260008  2188  144  6824 11824 2584 12664 2584 1347 1174 14 0 0 86 0</p>
<p>2 1 262140  2964  128  5852 24912 17304 24952 17304 4737 2341 86 10 0 0 4</p>
<p>重要参数：</p>
<p>swpd，已使用的 SWAP 空间大小，KB 为单位；</p>
<p>free，可用的物理内存大小，KB 为单位；</p>
<p>buff，物理内存用来缓存读写操作的buffer大小，KB 为单位；</p>
<p>cache，物理内存用来缓存进程地址空间的 cache 大小，KB 为单位；</p>
<p>si，数据从 SWAP 读取到 RAM（swap in）的大小，KB 为单位；</p>
<p>so，数据从 RAM 写到 SWAP（swap out）的大小，KB 为单位。</p>
<p>上例可得：</p>
<p>物理可用内存 free 基本没什么显著变化，swapd逐步增加，说明最小可用的内存始终保持在 256MB(物理内存大小) * 10％ = 2.56MB 左右，当脏页达到10％的时候就开始大量使用swap。</p>
<ul>
<li>free</li>
</ul>
<p>$ free -m</p>
<p>total used free shared buffers cached</p>
<p>Mem: 8111 7185 926 0 243 6299</p>
<p>-/+ buffers/cache: 643 7468</p>
<p>Swap: 8189 0 8189</p>
<h2 id="三、磁盘IO"><a href="#三、磁盘IO" class="headerlink" title="三、磁盘IO"></a>三、磁盘IO</h2><p>1、良好状态指标</p>
<ul>
<li>iowait % &lt; 20%</li>
</ul>
<p>提高命中率的一个简单方式就是增大文件缓存区面积，缓存区越大预存的页面就越多，命中率也越高。</p>
<p>Linux 内核希望能尽可能产生次缺页中断（从文件缓存区读），并且能尽可能避免主缺页中断（从硬盘读），这样随着次缺页中断的增多，文件缓存区也逐步增大，直到系统只有少量可用物理内存的时候 Linux 才开始释放一些不用的页。</p>
<p>2、监控工具</p>
<ul>
<li>查看物理内存和文件缓存情况</li>
</ul>
<p>$ cat /proc/meminfo</p>
<p>MemTotal:   8182776 kB</p>
<p>MemFree:    3053808 kB</p>
<p>Buffers:    342704 kB</p>
<p>Cached:    3972748 kB</p>
<p>这台服务器总共有 8GB 物理内存（MemTotal），3GB 左右可用内存（MemFree），343MB左右用来做磁盘缓存（Buffers），4GB左右用来做文件缓存区（Cached）。</p>
<ul>
<li>sar</li>
</ul>
<p>$ sar -d 2 3</p>
<p>Linux 2.6.9-42.ELsmp (webserver) 11/30/2008 <em>i686</em> (8 CPU)</p>
<p>11:09:33 PM DEV tps rd_sec/s wr_sec/s avgrq-sz avgqu-sz await svctm %util</p>
<p>11:09:35 PM dev8-0 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00</p>
<p>11:09:35 PM DEV tps rd_sec/s wr_sec/s avgrq-sz avgqu-sz await svctm %util</p>
<p>11:09:37 PM dev8-0 1.00 0.00 12.00 12.00 0.00 0.00 0.00 0.00</p>
<p>11:09:37 PM DEV tps rd_sec/s wr_sec/s avgrq-sz avgqu-sz await svctm %util</p>
<p>11:09:39 PM dev8-0 1.99 0.00 47.76 24.00 0.00 0.50 0.25 0.05</p>
<p>Average: DEV tps rd_sec/s wr_sec/s avgrq-sz avgqu-sz await svctm %util</p>
<p>Average: dev8-0 1.00 0.00 19.97 20.00 0.00 0.33 0.17 0.02</p>
<p>重要参数：</p>
<p>await表示平均每次设备I/O操作的等待时间（以毫秒为单位）。</p>
<p>svctm表示平均每次设备I/O操作的服务时间（以毫秒为单位）。</p>
<p>%util表示一秒中有百分之几的时间用于I/O操作。</p>
<p>如果svctm的值与await很接近，表示几乎没有I/O等待，磁盘性能很好，如果await的值远高于svctm的值，则表示I/O队列等待太长，系统上运行的应用程序将变慢。</p>
<p>如果%util接近100%，表示磁盘产生的I/O请求太多，I/O系统已经满负荷的在工作，该磁盘可能存在瓶颈。</p>
<h2 id="四、Network-IO"><a href="#四、Network-IO" class="headerlink" title="四、Network IO"></a>四、Network IO</h2><p>对于UDP</p>
<p>1、良好状态指标</p>
<p>接收、发送缓冲区不长时间有等待处理的网络包</p>
<p>2、监控工具</p>
<ul>
<li>netstat</li>
</ul>
<p>对于UDP服务，查看所有监听的UDP端口的网络情况</p>
<p>$ watch netstat -lunp</p>
<p>Proto Recv-Q Send-Q Local Address      Foreign Address     State    PID/Program name</p>
<p>udp    0   0 0.0.0.0:64000      0.0.0.0:*              -</p>
<p>udp    0   0 0.0.0.0:38400      0.0.0.0:*              -</p>
<p>udp    0   0 0.0.0.0:38272      0.0.0.0:*              -</p>
<p>udp    0   0 0.0.0.0:36992      0.0.0.0:*              -</p>
<p>udp    0   0 0.0.0.0:17921      0.0.0.0:*              -</p>
<p>udp    0   0 0.0.0.0:11777      0.0.0.0:*              -</p>
<p>udp    0   0 0.0.0.0:14721      0.0.0.0:*              -</p>
<p>udp    0   0 0.0.0.0:36225      0.0.0.0:*              -</p>
<p>RecvQ、SendQ为0，或者不长时间有数值是比较正常的。</p>
<p>对于UDP服务，查看丢包情况（网卡收到了，但是应用层没有处理过来造成的丢包）</p>
<p>$ watch netstat -su</p>
<p>Udp:</p>
<p>  278073881 packets received</p>
<p>  4083356897 packets to unknown port received.</p>
<p>  2474435364 packet receive errors</p>
<p>  1079038030 packets sent</p>
<p>packet receive errors 这一项数值增长了，则表明在丢包。</p>
<p><a href="http://www.withdevo.net/?p=18" target="_blank" rel="noopener external nofollow noreferrer">这里</a>有对“packet receive errors”的稍微详细些的解释，它包含了7种错误，and通常表明是checksum错误。不过我们通常通过这个数值的变化来判断UDP服务是否丢包（第2项错误），不知道是否有其他什么方法来判断UDP的丢包？：</p>
<p>“packet receive errors” usually means:</p>
<p>\1) data is truncated, error in checksum while copying</p>
<p>\2) udp queue is full, so it needs to be dropped</p>
<p>\3) unable to receive udp package from encapsulated socket</p>
<p>\4) sock_queue_rcv_skb() failed with -ENOMEM</p>
<p>\5) it is a short packet</p>
<p>\6) no space for header in udp packet when validating packet</p>
<p>\7) xfrm6_policy_check() fails</p>
<p>many times it means the checksum is not right.</p>
<p>对于TCP（来自david的经验，thx~~）</p>
<p>1、良好状态指标</p>
<p>对于TCP而言，不会出现因为缓存不足而存在丢包的事，因为网络等其他原因，导致丢了包，协议层也会通过重传机制来保证丢的包到达对方。</p>
<p>所以，tcp而言更多的专注重传率。</p>
<p>2、监控工具</p>
<p># cat /proc/net/snmp | grep Tcp:</p>
<p>Tcp: RtoAlgorithm RtoMin RtoMax MaxConn ActiveOpens PassiveOpens AttemptFails EstabResets CurrEstab InSegs OutSegs RetransSegs InErrs OutRsts</p>
<p>Tcp: 1 200 120000 -1 78447 413 50234 221 3 5984652 5653408 156800 0 849</p>
<p>重传率 = RetransSegs / OutSegs</p>
<p>至于这个值在多少范围内，算ok的，得看具体的业务了。</p>
<p>业务侧更关注的是响应时间。</p>
<p>每天一点点，感受自己存在的意义。</p>
<h1 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">dstat</span> <span class="string">–c</span> <span class="string">打印cpu</span></span><br><span class="line"><span class="string">top</span></span><br><span class="line"></span><br><span class="line"><span class="string">[root@host-80-80-41-196</span> <span class="string">webcache]#</span> <span class="string">dstat</span> <span class="string">-c</span> <span class="number">2</span></span><br><span class="line"><span class="number">2</span><span class="string">秒打印一次</span></span><br><span class="line"><span class="string">----total-cpu-usage----</span></span><br><span class="line"><span class="string">usr</span>   <span class="string">sys</span> <span class="string">idl</span>  <span class="string">wai</span> <span class="string">hiq</span> <span class="string">siq</span></span><br><span class="line">  <span class="number">5</span>   <span class="number">5</span>   <span class="number">85</span>   <span class="number">2</span>   <span class="number">1</span>   <span class="number">1</span></span><br><span class="line">  <span class="number">3</span>   <span class="number">2</span>   <span class="number">94</span>   <span class="number">0</span>   <span class="number">1</span>   <span class="number">1</span></span><br><span class="line">  <span class="number">4</span>   <span class="number">2</span>   <span class="number">91</span>   <span class="number">1</span>   <span class="number">1</span>   <span class="number">1</span></span><br><span class="line"><span class="string">usr:用户占用</span></span><br><span class="line"><span class="string">sys:系统占中</span></span><br><span class="line"><span class="string">idl:cpu空闲</span></span><br><span class="line"><span class="string">wai:等待</span></span><br><span class="line"><span class="string">hiq:中断</span></span><br><span class="line"><span class="string">siq:软件中断</span></span><br><span class="line"></span><br><span class="line"><span class="string">dstat</span> <span class="string">服务器性能查看命令</span></span><br><span class="line"><span class="comment"># dstat -c</span></span><br><span class="line">   <span class="string">usr:用户占用，sys系统占中，idl</span> <span class="string">cpu空闲，</span> <span class="string">wai等待，hiq中断，siq软件中断</span></span><br><span class="line"><span class="comment"># dstat -C</span></span><br><span class="line">   <span class="string">-C</span> <span class="string">当多个CPU的时候用此参数</span></span><br><span class="line"><span class="comment"># dstat -C 0,1 显示CPU0和1</span></span><br><span class="line"><span class="comment"># dstat -d 显示磁盘读写数据大小</span></span><br><span class="line"><span class="comment"># dstat -n 显示网络状态</span></span><br><span class="line"><span class="comment"># dstat -N eth1 有多块网卡时指定要显示的网卡</span></span><br><span class="line"><span class="comment"># dstat -l 显示系统负载</span></span><br><span class="line"><span class="comment"># dstat -m 显示内存使用情况</span></span><br><span class="line"><span class="comment"># dstat -g 显示页面使用情况</span></span><br><span class="line"><span class="comment"># dstat -p 显示进程状态</span></span><br><span class="line"><span class="comment"># dstat -s 显示swap使用状态</span></span><br><span class="line"><span class="comment"># dstat -r I/O 请求情况</span></span><br><span class="line"><span class="comment"># dstat --socket 用来显示tcp udp端口状态</span></span><br><span class="line"><span class="comment"># dstat -v vmstat</span></span><br><span class="line"><span class="comment"># dstat --output /home/dd.csv可以把状态信息以csv的格式重定向到指定的文件中，以便日后查看</span></span><br><span class="line"></span><br><span class="line"><span class="string">---------------------------------------------------</span></span><br><span class="line"><span class="string">lscpu命令，查看的是cpu的统计信息.</span></span><br><span class="line"><span class="string">blue@blue-pc:~$</span> <span class="string">lscpu</span></span><br><span class="line"><span class="attr">Architecture:</span>          <span class="string">i686</span>            <span class="comment">#cpu架构</span></span><br><span class="line"><span class="string">CPU</span> <span class="string">op-mode(s):</span>        <span class="number">32</span><span class="string">-bit,</span> <span class="number">64</span><span class="string">-bit</span></span><br><span class="line"><span class="attr">Byte Order:</span>            <span class="string">Little</span> <span class="string">Endian</span>   <span class="comment">#小尾序</span></span><br><span class="line"><span class="string">CPU(s):</span>                <span class="number">4</span>               <span class="comment">#总共有4核</span></span><br><span class="line"><span class="string">On-line</span> <span class="string">CPU(s)</span> <span class="attr">list:</span>   <span class="number">0</span><span class="number">-3</span></span><br><span class="line"><span class="string">Thread(s)</span> <span class="attr">per core:</span>    <span class="number">1</span>               <span class="comment">#每个cpu核，只能支持一个线程，即不支持超线程</span></span><br><span class="line"><span class="string">Core(s)</span> <span class="attr">per socket:</span>    <span class="number">4</span>               <span class="comment">#每个cpu，有4个核</span></span><br><span class="line"><span class="string">Socket(s):</span>             <span class="number">1</span>               <span class="comment">#总共有1一个cpu</span></span><br><span class="line"><span class="attr">Vendor ID:</span>             <span class="string">GenuineIntel</span>    <span class="comment">#cpu产商 intel</span></span><br><span class="line"><span class="attr">CPU family:</span>            <span class="number">6</span></span><br><span class="line"><span class="attr">Model:</span>                 <span class="number">42</span></span><br><span class="line"><span class="attr">Stepping:</span>              <span class="number">7</span></span><br><span class="line"><span class="attr">CPU MHz:</span>               <span class="number">1600.000</span></span><br><span class="line"><span class="attr">BogoMIPS:</span>              <span class="number">5986.12</span></span><br><span class="line"><span class="attr">Virtualization:</span>        <span class="string">VT-x</span>            <span class="comment">#支持cpu虚拟化技术</span></span><br><span class="line"><span class="attr">L1d cache:</span>             <span class="string">32K</span></span><br><span class="line"><span class="attr">L1i cache:</span>             <span class="string">32K</span></span><br><span class="line"><span class="attr">L2 cache:</span>              <span class="string">256K</span></span><br><span class="line"><span class="attr">L3 cache:</span>              <span class="string">6144K</span></span><br><span class="line"></span><br><span class="line"><span class="string">查看/proc/cpuinfo,可以知道每个cpu信息，如每个CPU的型号，主频等。</span></span><br><span class="line"><span class="comment">#cat /proc/cpuinfo</span></span><br><span class="line"><span class="attr">processor    :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">vendor_id    :</span> <span class="string">GenuineIntel</span></span><br><span class="line"><span class="attr">cpu family    :</span> <span class="number">6</span></span><br><span class="line"><span class="attr">model        :</span> <span class="number">42</span></span><br><span class="line"><span class="attr">model name    :</span> <span class="string">Intel(R)</span> <span class="string">Core(TM)</span> <span class="string">i5-2320</span> <span class="string">CPU</span> <span class="string">@</span> <span class="number">3.</span><span class="string">00GHz</span></span><br><span class="line"><span class="string">.....</span></span><br><span class="line"></span><br><span class="line"><span class="string">上面输出的是第一个cpu部分信息，还有3个cpu信息省略了。</span></span><br></pre></td></tr></table></figure>



<h1 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">连接CPU和磁盘，放在内存速度快，规格DDR4</span><br><span class="line">free -m</span><br><span class="line"></span><br><span class="line">如下显示free是显示的当前内存的使用</span><br><span class="line">-m的意思是M字节来显示内容</span><br><span class="line">free -m</span><br><span class="line">total used free <span class="keyword">shared</span> buffers cached</span><br><span class="line">Mem: <span class="number">1002</span> <span class="number">769</span> <span class="number">232</span> <span class="number">0</span> <span class="number">62</span> <span class="number">421</span></span><br><span class="line">-/+ buffers/cache: <span class="number">286</span> <span class="number">715</span></span><br><span class="line">Swap: <span class="number">1153</span> <span class="number">0</span> <span class="number">1153</span></span><br><span class="line"></span><br><span class="line">第一部分Mem行:</span><br><span class="line">total 内存总数: <span class="number">1002</span>M</span><br><span class="line">used 已经使用的内存数: <span class="number">769</span>M</span><br><span class="line">free 空闲的内存数: <span class="number">232</span>M</span><br><span class="line"><span class="keyword">shared</span> 当前已经废弃不用,总是<span class="number">0</span></span><br><span class="line">buffers Buffer缓存内存数: <span class="number">62</span>M</span><br><span class="line">cached Page缓存内存数:<span class="number">421</span>M</span><br><span class="line">关系：total(<span class="number">1002</span>M) = used(<span class="number">769</span>M) + free(<span class="number">232</span>M)</span><br><span class="line"></span><br><span class="line">第二部分(-/+ buffers/cache):</span><br><span class="line">(-buffers/cache) used内存数：<span class="number">286</span>M </span><br><span class="line">(指的第一部分Mem行中的used – buffers – cached)</span><br><span class="line"></span><br><span class="line">(+buffers/cache) free内存数: <span class="number">715</span>M </span><br><span class="line">(指的第一部分Mem行中的free + buffers + cached)</span><br><span class="line"></span><br><span class="line">可见-buffers/cache反映的是被程序实实在在吃掉的内存,而+buffers/cache反映的是可以挪用的内存总数.</span><br><span class="line"></span><br><span class="line">第三部分是指交换分区, 我想不讲大家都明白.</span><br><span class="line">	大家看了上面,还是很晕.第一部分(Mem)与第二部分(-/+ buffers/cache)的结果中有关used和free为什么这么奇怪.</span><br><span class="line">其实我们可以从二个方面来解释:</span><br><span class="line">对操作系统来讲是Mem的参数,buffers/cached都是属于被使用,所以它认为free只有<span class="number">232.</span></span><br><span class="line">对应用程序来讲是(-/+ buffers/cach),buffers/cached 是等同可用的,因为buffer/cached是为了提高程序执行的性能,当程序使用内存时,buffer/cached会很快地被使用.</span><br><span class="line">　　所以,以应用来看看,以(-/+ buffers/cache)的free和used为主.所以我们看这个就好了，另外告诉大家一些常识，Linux为了提高磁盘和内存存取效率, Linux做了很多精心的设计, 除了对dentry进行缓存(用于VFS,加速文件路径名到inode的转换), 还采取了两种主要Cache方式：Buffer Cache和Page Cache.前者针对磁盘块的读写,后者针对文件inode的读写，这些Cache能有效缩短了 I/O系统调用(比如read,write,getdents)的时间。</span><br><span class="line">	记住内存是拿来用的,不是拿来看的，不像windows,无论你的真实物理内存有多少,他都要拿硬盘交换文件来读.这也就是windows为什么常常提示虚拟空间不足的原因。你们想想,多无聊,在内存还有大部分的时候,拿出一部分硬盘空间来充当内存，硬盘怎么会快过内存.所以我们看linux,只要不用swap的交换空间,就不用担心自己的内存太少.如果常常swap用很多,可能你就要考虑加物理内存了.这也是linux看内存是否够用的标准哦。</span><br><span class="line"></span><br><span class="line">查看内存条数命令：</span><br><span class="line">dmidecode | grep -A16 <span class="string">"Memory Device$"</span>s</span><br><span class="line"></span><br><span class="line">dstat –m</span><br><span class="line">[<span class="symbol">root@</span>host<span class="number">-80</span><span class="number">-80</span><span class="number">-41</span><span class="number">-196</span> webcache]# dstat -m</span><br><span class="line">------memory-usage-----</span><br><span class="line"> used  buff  cach  free</span><br><span class="line"><span class="number">1627</span>M <span class="number">11.9</span>M <span class="number">2266</span>M <span class="number">45.3</span>M</span><br><span class="line"><span class="number">1631</span>M <span class="number">11.9</span>M <span class="number">2266</span>M <span class="number">41.0</span>M</span><br><span class="line"><span class="number">1633</span>M <span class="number">11.9</span>M <span class="number">2266</span>M <span class="number">39.1</span>M</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">释放内存：</span><br><span class="line"><span class="number">1.</span>清理前内存使用情况 </span><br><span class="line">free -m</span><br><span class="line"><span class="number">2.</span>开始清理: </span><br><span class="line">echo <span class="number">3</span> &gt; /proc/sys/vm/drop_caches</span><br><span class="line">【</span><br><span class="line">To free pagecache, use:</span><br><span class="line">echo <span class="number">1</span> &gt; /proc/sys/vm/drop_caches</span><br><span class="line"> </span><br><span class="line">to free dentries <span class="keyword">and</span> inodes, use:</span><br><span class="line">echo <span class="number">2</span> &gt; /proc/sys/vm/drop_caches</span><br><span class="line"></span><br><span class="line">to free pagecache, dentries <span class="keyword">and</span> inodes, use:</span><br><span class="line">echo <span class="number">3</span> &gt;/proc/sys/vm/drop_caches</span><br><span class="line">】</span><br><span class="line"><span class="number">3.</span>清理后内存使用情况 </span><br><span class="line">free -m</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>完成!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">概要查看内存情况</span><br><span class="line">free -m</span><br><span class="line">             total       used       free     <span class="keyword">shared</span>    buffers     cached</span><br><span class="line">Mem:          <span class="number">3926</span>       <span class="number">3651</span>        <span class="number">274</span>          <span class="number">0</span>         <span class="number">12</span>        <span class="number">404</span></span><br><span class="line">-/+ buffers/cache:       <span class="number">3235</span>        <span class="number">691</span></span><br><span class="line">Swap:         <span class="number">9536</span>         <span class="number">31</span>       <span class="number">9505</span></span><br><span class="line">这里的单位是MB，总共的内存是<span class="number">3926</span>MB。</span><br><span class="line"></span><br><span class="line">查看内存详细使用</span><br><span class="line"># cat /proc/meminfo </span><br><span class="line">MemTotal:        <span class="number">4020868</span> kB</span><br><span class="line">MemFree:          <span class="number">230884</span> kB</span><br><span class="line">Buffers:            <span class="number">7600</span> kB</span><br><span class="line">Cached:           <span class="number">454772</span> kB</span><br><span class="line">SwapCached:          <span class="number">836</span> kB</span><br><span class="line">.....</span><br><span class="line"> </span><br><span class="line">查看内存硬件信息</span><br><span class="line">dmidecode -t memory</span><br><span class="line"># dmidecode <span class="number">2.11</span></span><br><span class="line">SMBIOS <span class="number">2.7</span> present.</span><br><span class="line"></span><br><span class="line">Handle <span class="number">0x0008</span>, DMI type <span class="number">16</span>, <span class="number">23</span> bytes</span><br><span class="line">Physical Memory Array</span><br><span class="line">    Location: System Board Or Motherboard</span><br><span class="line">....</span><br><span class="line">    Maximum Capacity: <span class="number">32</span> GB</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">Handle <span class="number">0x000A</span>, DMI type <span class="number">17</span>, <span class="number">34</span> bytes</span><br><span class="line">....</span><br><span class="line">Memory Device</span><br><span class="line">    Array Handle: <span class="number">0x0008</span></span><br><span class="line">    Error Information Handle: Not Provided</span><br><span class="line">    Total Width: <span class="number">64</span> bits</span><br><span class="line">    Data Width: <span class="number">64</span> bits</span><br><span class="line">    Size: <span class="number">4096</span> MB</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">我的主板有<span class="number">4</span>个槽位，只用了一个槽位，上面插了一条<span class="number">4096</span>MB的内存。</span><br></pre></td></tr></table></figure>



<h1 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">SATA,SAS,SSD(转的越快越好)</span><br><span class="line"></span><br><span class="line">最好的磁盘是SSD</span><br><span class="line">lsscsi(实际磁盘的挂载)</span><br><span class="line">df –h</span><br><span class="line"></span><br><span class="line">查看硬盘和分区分布</span><br><span class="line"># lsblk</span><br><span class="line">NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda      <span class="number">8</span>:<span class="number">0</span>    <span class="number">0</span> <span class="number">465.8</span>G  <span class="number">0</span> disk </span><br><span class="line">├─sda1   <span class="number">8</span>:<span class="number">1</span>    <span class="number">0</span>     <span class="number">1</span>G  <span class="number">0</span> part /boot</span><br><span class="line">├─sda2   <span class="number">8</span>:<span class="number">2</span>    <span class="number">0</span>   <span class="number">9.3</span>G  <span class="number">0</span> part [SWAP]</span><br><span class="line">├─sda3   <span class="number">8</span>:<span class="number">3</span>    <span class="number">0</span>  <span class="number">74.5</span>G  <span class="number">0</span> part /</span><br><span class="line">├─sda4   <span class="number">8</span>:<span class="number">4</span>    <span class="number">0</span>     <span class="number">1</span>K  <span class="number">0</span> part </span><br><span class="line">├─sda5   <span class="number">8</span>:<span class="number">5</span>    <span class="number">0</span> <span class="number">111.8</span>G  <span class="number">0</span> part /home</span><br><span class="line">└─sda6   <span class="number">8</span>:<span class="number">6</span>    <span class="number">0</span> <span class="number">269.2</span>G  <span class="number">0</span> part </span><br><span class="line"></span><br><span class="line">显示很直观</span><br><span class="line"></span><br><span class="line">如果要看硬盘和分区的详细信息</span><br><span class="line"># fdisk -l</span><br><span class="line">Disk /dev/sda: <span class="number">500.1</span> GB, <span class="number">500107862016</span> bytes</span><br><span class="line"><span class="number">255</span> heads, <span class="number">63</span> sectors/track, <span class="number">60801</span> cylinders, total <span class="number">976773168</span> sectors</span><br><span class="line">Units = sectors of <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> bytes</span><br><span class="line">Sector size (logical/physical): <span class="number">512</span> bytes / <span class="number">4096</span> bytes</span><br><span class="line">I/O size (minimum/optimal): <span class="number">4096</span> bytes / <span class="number">4096</span> bytes</span><br><span class="line">Disk identifier: <span class="number">0x00023728</span></span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        <span class="number">2048</span>     <span class="number">2148351</span>     <span class="number">1073152</span>   <span class="number">83</span>  Linux</span><br><span class="line">/dev/sda2         <span class="number">2148352</span>    <span class="number">21680127</span>     <span class="number">9765888</span>   <span class="number">82</span>  Linux swap / Solaris</span><br><span class="line">/dev/sda3        <span class="number">21680128</span>   <span class="number">177930239</span>    <span class="number">78125056</span>   <span class="number">83</span>  Linux</span><br><span class="line">/dev/sda4       <span class="number">177932286</span>   <span class="number">976771071</span>   <span class="number">399419393</span>    <span class="number">5</span>  Extended/dev/sda5       <span class="number">177932288</span>   <span class="number">412305407</span>   <span class="number">117186560</span>   <span class="number">83</span>  Linux</span><br><span class="line">/dev/sda6       <span class="number">412307456</span>   <span class="number">976771071</span>   <span class="number">282231808</span>   <span class="number">83</span>  Linux</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">iostat -xm <span class="number">2</span></span><br><span class="line">[<span class="symbol">root@</span>host<span class="number">-80</span><span class="number">-80</span><span class="number">-41</span><span class="number">-196</span> vm]# iostat -xm <span class="number">2</span></span><br><span class="line">Linux <span class="number">2.6</span><span class="number">.18</span><span class="number">-164.</span>el5 (host<span class="number">-80</span><span class="number">-80</span><span class="number">-41</span><span class="number">-196</span>)    <span class="number">2017</span>年<span class="number">02</span>月<span class="number">04</span>日</span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           <span class="number">5.26</span>    <span class="number">0.00</span>    <span class="number">7.53</span>    <span class="number">1.84</span>    <span class="number">0.00</span>    <span class="number">85.38</span></span><br><span class="line">Device:         rrqm/s   wrqm/s   r/s   w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await  svctm  %util</span><br><span class="line">vda               <span class="number">0.04</span>     <span class="number">2.48</span>  <span class="number">3.21</span> <span class="number">17.36</span>     <span class="number">0.02</span>     <span class="number">0.38</span>    <span class="number">40.03</span>     <span class="number">2.13</span>  <span class="number">103.45</span>   <span class="number">2.92</span>   <span class="number">6.01</span></span><br><span class="line">vda1              <span class="number">0.03</span>     <span class="number">2.48</span>  <span class="number">3.21</span> <span class="number">17.36</span>     <span class="number">0.02</span>     <span class="number">0.38</span>    <span class="number">40.03</span>     <span class="number">2.13</span>  <span class="number">103.45</span>   <span class="number">2.92</span>   <span class="number">6.01</span></span><br><span class="line">vdb               <span class="number">0.00</span>     <span class="number">0.00</span>  <span class="number">0.00</span>  <span class="number">0.00</span>     <span class="number">0.00</span>     <span class="number">0.00</span>    <span class="number">21.07</span>     <span class="number">0.00</span>    <span class="number">4.33</span>   <span class="number">4.33</span>   <span class="number">0.00</span></span><br><span class="line"></span><br><span class="line">第一部分包含了CPU报告</span><br><span class="line">•	%user : 	显示了在执行用户(应用)层时的CPU利用率</span><br><span class="line">•	%nice : 	显示了在以nice优先级运行用户层的CPU利用率</span><br><span class="line">•	%system : 	显示了在执行系统(内核)层时的CPU利用率</span><br><span class="line">•	%iowait : 	显示了CPU在I/O请求挂起时空闲时间的百分比</span><br><span class="line">•	%steal : 	显示了当hypervisor正服务于另外一个虚拟处理器时无意识地等待虚拟CPU所占有的时间百分比。</span><br><span class="line">• %idle : 		显示了CPU在I/O没有挂起请求时空闲时间的百分比</span><br><span class="line"></span><br><span class="line">第二部分包含了设备利用率报告</span><br><span class="line">Device : 		列出的/dev 目录下的设备/分区名称</span><br><span class="line">tps : 			显示每秒传输给设备的数量。更高的tps意味着处理器更忙。</span><br><span class="line">Blk_read/s : 	显示了每秒从设备上读取的块的数量(KB,MB)</span><br><span class="line">Blk_wrtn/s : 	显示了每秒写入设备上块的数量(KB,MB)</span><br><span class="line">Blk_read : 		显示所有已读取的块</span><br><span class="line">Blk_wrtn : 		显示所有已写入的块</span><br><span class="line">注：%idle表示磁盘的忙和闲</span><br><span class="line"></span><br><span class="line">dd  <span class="keyword">if</span>=/dev/zero  of=/home/a.txt  bs=<span class="number">100</span>m  count=<span class="number">10</span></span><br><span class="line">备份/dev/zero磁盘开始<span class="number">100</span>m到指定路径/home/a.txt仅拷贝<span class="number">10</span>个块</span><br></pre></td></tr></table></figure>



<h1 id="带宽"><a href="#带宽" class="headerlink" title="带宽"></a>带宽</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">命令：ethtool eth* </span><br><span class="line">如：ethtool eth1或者ethtool eth0</span><br><span class="line">ethtool eth1</span><br><span class="line">网卡down掉：ifconfig eth1 down / ifconfig eth1 up</span><br><span class="line">电口和光口看Port: Twisted Pair</span><br><span class="line">(Twisted Pair为电口，也叫双绞线; Port：FIBRE为光口)</span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>host<span class="number">-80</span><span class="number">-80</span><span class="number">-41</span><span class="number">-196</span> webcache]# ethtool eth1</span><br><span class="line">Settings <span class="keyword">for</span> eth1:</span><br><span class="line">        Supported ports: [ TP ]</span><br><span class="line">        Supported link modes:   <span class="number">10</span>baseT/Half <span class="number">10</span>baseT/Full </span><br><span class="line">                                <span class="number">100</span>baseT/Half <span class="number">100</span>baseT/Full </span><br><span class="line">                                <span class="number">1000</span>baseT/Full </span><br><span class="line">        Supports <span class="built_in">auto</span>-negotiation: Yes</span><br><span class="line">        Advertised link modes:  <span class="number">10</span>baseT/Half <span class="number">10</span>baseT/Full </span><br><span class="line">                                <span class="number">100</span>baseT/Half <span class="number">100</span>baseT/Full </span><br><span class="line">                                <span class="number">1000</span>baseT/Full </span><br><span class="line">        Advertised <span class="built_in">auto</span>-negotiation: Yes</span><br><span class="line">        Speed: <span class="number">1000</span>Mb/s</span><br><span class="line">        Duplex: Full</span><br><span class="line">        Port: Twisted Pair</span><br><span class="line">        PHYAD: <span class="number">0</span></span><br><span class="line">        Transceiver: <span class="built_in">int</span>ernal</span><br><span class="line">        Auto-negotiation: on</span><br><span class="line">        Supports Wake-on: umbg</span><br><span class="line">        Wake-on: g</span><br><span class="line">        Current message level: <span class="number">0x00000007</span> (<span class="number">7</span>)</span><br><span class="line">        Link detected: yes</span><br><span class="line">        </span><br><span class="line">电口：<span class="number">1</span>G；</span><br><span class="line">光口（光纤）：<span class="number">10</span>G</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dstat –n <span class="number">2</span></span><br><span class="line">dstat –tcmnd 同时查看CPU，内存，IO，带宽</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看网卡硬件信息</span><br><span class="line"># lspci | grep -i <span class="string">'eth'</span></span><br><span class="line"><span class="number">02</span>:<span class="number">00.0</span> Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/<span class="number">8168</span>B PCI Express Gigabit Ethernet controller (rev <span class="number">06</span>)</span><br><span class="line"> </span><br><span class="line">查看系统的所有网络接口</span><br><span class="line"># ifconfig -a</span><br><span class="line">eth0      Link encap:以太网  硬件地址 b8:<span class="number">97</span>:<span class="number">5</span>a:<span class="number">17</span>:b3:<span class="number">8f</span>  </span><br><span class="line">          .....</span><br><span class="line"></span><br><span class="line">lo        Link encap:本地环回  </span><br><span class="line">          .....</span><br><span class="line">或者是</span><br><span class="line">ip link show</span><br><span class="line"><span class="number">1</span>: lo: &lt;LOOPBACK&gt; mtu <span class="number">16436</span> qdisc noqueue state DOWN </span><br><span class="line">link/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">2</span>: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc pfifo_fast state UP qlen <span class="number">1000</span></span><br><span class="line">link/ether b8:<span class="number">97</span>:<span class="number">5</span>a:<span class="number">17</span>:b3:<span class="number">8f</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line"> </span><br><span class="line">如果要查看某个网络接口的详细信息，例如eth0的详细参数和指标</span><br><span class="line"># ethtool eth0</span><br><span class="line">Settings <span class="keyword">for</span> eth0:</span><br><span class="line">    Supported ports: [ TP MII ]</span><br><span class="line">    Supported link modes:   <span class="number">10</span>baseT/Half <span class="number">10</span>baseT/Full </span><br><span class="line">                            <span class="number">100</span>baseT/Half <span class="number">100</span>baseT/Full </span><br><span class="line">                            <span class="number">1000</span>baseT/Half <span class="number">1000</span>baseT/Full #支持千兆半双工，全双工模式</span><br><span class="line">    Supported pause frame use: No </span><br><span class="line">    Supports <span class="built_in">auto</span>-negotiation: Yes #支持自适应模式，一般都支持</span><br><span class="line">    Advertised link modes:  <span class="number">10</span>baseT/Half <span class="number">10</span>baseT/Full </span><br><span class="line">                            <span class="number">100</span>baseT/Half <span class="number">100</span>baseT/Full </span><br><span class="line">                            <span class="number">1000</span>baseT/Half <span class="number">1000</span>baseT/Full</span><br><span class="line">    Advertised pause frame use: Symmetric Receive-only</span><br><span class="line">    Advertised <span class="built_in">auto</span>-negotiation: Yes #默认使用自适应模式</span><br><span class="line">    Link partner advertised link modes:  <span class="number">10</span>baseT/Half <span class="number">10</span>baseT/Full </span><br><span class="line">                                         <span class="number">100</span>baseT/Half <span class="number">100</span>baseT/Full </span><br><span class="line">    .....</span><br><span class="line">    Speed: <span class="number">100</span>Mb/s #现在网卡的速度是<span class="number">100</span>Mb,网卡使用自适应模式，所以推测路由是<span class="number">100</span>Mb，导致网卡从支持千兆，变成要支持百兆</span><br><span class="line">    Duplex: Full   #全双工</span><br><span class="line">    .....</span><br><span class="line">    Link detected: yes    #表示有网线连接，和路由是通的</span><br></pre></td></tr></table></figure>



<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">查看pci信息，即主板所有硬件槽信息。</span><br><span class="line">lspci</span><br><span class="line">00:00.0 Host bridge: Intel Corporation 2nd Generation Core Processor Family DRAM Controller (rev 09) #主板芯片</span><br><span class="line">00:02.0 VGA compatible controller: Intel Corporation 2nd Generation Core Processor Family Integrated Graphics Controller (rev 09) #显卡</span><br><span class="line">00:14.0 USB controller: Intel Corporation Panther Point USB xHCI Host Controller (rev 04) #usb控制器</span><br><span class="line">00:16.0 Communication controller: Intel Corporation Panther Point MEI Controller #1 (rev 04)</span><br><span class="line">00:1a.0 USB controller: Intel Corporation Panther Point USB Enhanced Host Controller #2 (rev 04)</span><br><span class="line">00:1b.0 Audio device: Intel Corporation Panther Point High Definition Audio Controller (rev 04) #声卡</span><br><span class="line">00:1c.0 PCI bridge: Intel Corporation Panther Point PCI Express Root<span class="built_in"> Port </span>1 (rev c4) #pci 插槽</span><br><span class="line">00:1c.2 PCI bridge: Intel Corporation Panther Point PCI Express Root<span class="built_in"> Port </span>3 (rev c4)</span><br><span class="line">00:1c.3 PCI bridge: Intel Corporation Panther Point PCI Express Root<span class="built_in"> Port </span>4 (rev c4)</span><br><span class="line">00:1d.0 USB controller: Intel Corporation Panther Point USB Enhanced Host Controller #1 (rev 04)</span><br><span class="line">00:1f.0 ISA bridge: Intel Corporation Panther Point LPC Controller (rev 04)</span><br><span class="line">00:1f.2 IDE interface: Intel Corporation Panther Point 4<span class="built_in"> port </span>SATA Controller [IDE mode] (rev 04) #硬盘接口</span><br><span class="line">00:1f.3 SMBus: Intel Corporation Panther Point SMBus Controller (rev 04)</span><br><span class="line">00:1f.5 IDE interface: Intel Corporation Panther Point 2<span class="built_in"> port </span>SATA Controller [IDE mode] (rev 04) #硬盘接口</span><br><span class="line">02:00.0<span class="built_in"> Ethernet </span>controller: Realtek Semiconductor Co., Ltd. RTL8111/8168B PCI Express Gigabit<span class="built_in"> Ethernet </span>controller (rev 06) #网卡</span><br><span class="line">03:00.0 PCI bridge: Integrated Technology Express, Inc. Device 8893 (rev 41)</span><br><span class="line">如果要更详细的信息:lspci -v 或者 lspci -vv</span><br><span class="line">如果要看设备树:lscpi -t</span><br><span class="line"></span><br><span class="line"> 查看bios信息</span><br><span class="line"><span class="comment"># dmidecode -t bios</span></span><br><span class="line"><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">BIOS Information</span><br><span class="line">    Vendor: American Megatrends Inc.</span><br><span class="line">    Version: 4.6.5</span><br><span class="line">    Release Date: 04/25/2012</span><br><span class="line">    <span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span>.</span><br><span class="line">    BIOS Revision: 4.6</span><br><span class="line"><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span></span><br></pre></td></tr></table></figure>



<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">手工释放Linux内存——/proc/sys/vm/drop_cache</span><br><span class="line"></span><br><span class="line">linux的内存查看：</span><br><span class="line">[<span class="symbol">root@</span>localhost <span class="number">0.1</span><span class="number">.0</span>]# free -m</span><br><span class="line">             total       used       free     <span class="keyword">shared</span>    buffers     cached</span><br><span class="line">Mem:          <span class="number">4032</span>        <span class="number">694</span>       <span class="number">3337</span>          <span class="number">0</span>          <span class="number">0</span>         <span class="number">25</span></span><br><span class="line">需要说明的是，mem的used=free+buffers+cached，有些情况是cached占用很多资源，算起来数值就是不对，其实不影响实际使用，下面转载部分有说明如何清除cached的占用（实际上可以不清除，不会影响实际使用）</span><br><span class="line">当在Linux下频繁存取文件后，物理内存会很快被用光，当程序结束后，内存不会被正常释放，而是一直作为caching。这个问题，貌似有不少人在问，不过都没有看到有什么很好解决的办法。那么我来谈谈这个问题。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">一、通常情况</span><br><span class="line">先来说说free命令：</span><br><span class="line">引用[<span class="symbol">root@</span>server ~]# free -m</span><br><span class="line">total used free <span class="keyword">shared</span> buffers cached</span><br><span class="line">Mem: <span class="number">249</span> <span class="number">163</span> <span class="number">86</span> <span class="number">0</span> <span class="number">10</span> <span class="number">94</span></span><br><span class="line">-/+ buffers/cache: <span class="number">58</span> <span class="number">191</span></span><br><span class="line">Swap: <span class="number">511</span> <span class="number">0</span> <span class="number">511</span></span><br><span class="line">其中：</span><br><span class="line">引用total 内存总数</span><br><span class="line">used 已经使用的内存数</span><br><span class="line">free 空闲的内存数</span><br><span class="line"><span class="keyword">shared</span> 多个进程共享的内存总额</span><br><span class="line">buffers Buffer Cache和cached Page Cache 磁盘缓存的大小</span><br><span class="line">-buffers/cache 的内存数:used - buffers - cached</span><br><span class="line">+buffers/cache 的内存数:free + buffers + cached</span><br><span class="line">可用的memory=free memory+buffers+cached。</span><br><span class="line">有了这个基础后，可以得知，我现在used为<span class="number">163</span>MB，free为<span class="number">86</span>MB，buffer和cached分别为<span class="number">10</span>MB，<span class="number">94</span>MB。</span><br><span class="line">那么我们来看看,如果我执行复制文件,内存会发生什么变化.</span><br><span class="line">引用[<span class="symbol">root@</span>server ~]# cp -r /etc ~/test/</span><br><span class="line">[<span class="symbol">root@</span>server ~]# free -m</span><br><span class="line">total used free <span class="keyword">shared</span> buffers cached</span><br><span class="line">Mem: <span class="number">249</span> <span class="number">244</span> <span class="number">4</span> <span class="number">0</span> <span class="number">8</span> <span class="number">174</span></span><br><span class="line">-/+ buffers/cache: <span class="number">62</span> <span class="number">187</span></span><br><span class="line">Swap: <span class="number">511</span> <span class="number">0</span> <span class="number">511</span></span><br><span class="line">在我命令执行结束后，used为<span class="number">244</span>MB，free为<span class="number">4</span>MB，buffers为<span class="number">8</span>MB，cached为<span class="number">174</span>MB，天呐，都被cached吃掉了。别紧张，这是为了提高文件读取效率的做法。</span><br><span class="line">为了提高磁盘存取效率，Linux做了一些精心的设计，除了对dentry进行缓存（用于VFS，加速文件路径名到inode的转换），还采取了两种主要Cache方式：Buffer Cache和Page Cache。前者针对磁盘块的读写，后者针对文件inode的读写。这些Cache有效缩短了 I/O系统调用（比如read，write，getdents）的时间。</span><br><span class="line">那么有人说过段时间，linux会自动释放掉所用的内存。等待一段时间后，我们使用free再来试试，看看是否有释放？</span><br><span class="line">[<span class="symbol">root@</span>server test]# free -m</span><br><span class="line">total used free <span class="keyword">shared</span> buffers cached</span><br><span class="line">Mem: <span class="number">249</span> <span class="number">244</span> <span class="number">5</span> <span class="number">0</span> <span class="number">8</span> <span class="number">174</span></span><br><span class="line">-/+ buffers/cache: <span class="number">61</span> <span class="number">188</span></span><br><span class="line">Swap: <span class="number">511</span> <span class="number">0</span> <span class="number">511</span></span><br><span class="line">似乎没有任何变化。（实际情况下，内存的管理还与Swap有关）</span><br><span class="line">那么我能否手动释放掉这些内存呢？回答是可以的！</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">二、手动释放缓存</span><br><span class="line">/proc是一个虚拟文件系统，我们可以通过对它的读写操作做为与kernel实体间进行通信的一种手段。也就是说可以通过修改/proc中的文件，来对当前kernel的行为做出调整。那么我们可以通过调整/proc/sys/vm/drop_caches来释放内存。操作如下：</span><br><span class="line">[<span class="symbol">root@</span>server test]# cat /proc/sys/vm/drop_caches</span><br><span class="line"><span class="number">0</span></span><br><span class="line">首先，/proc/sys/vm/drop_caches的值，默认为<span class="number">0</span>。</span><br><span class="line">[<span class="symbol">root@</span>server test]# sync</span><br><span class="line">手动执行sync命令（描述：sync 命令运行 sync 子例程。如果必须停止系统，则运行sync 命令以确保文件系统的完整性。sync 命令将所有未写的系统缓冲区写到磁盘中，包含已修改的 i-node、已延迟的块 I/O 和读写映射文件）</span><br><span class="line">[<span class="symbol">root@</span>server test]# echo <span class="number">3</span> &gt; /proc/sys/vm/drop_caches</span><br><span class="line">[<span class="symbol">root@</span>server test]# cat /proc/sys/vm/drop_caches</span><br><span class="line"><span class="number">3</span></span><br><span class="line">将/proc/sys/vm/drop_caches值设为<span class="number">3</span></span><br><span class="line">[<span class="symbol">root@</span>server test]# free -m</span><br><span class="line">total used free <span class="keyword">shared</span> buffers cached</span><br><span class="line">Mem: <span class="number">249</span> <span class="number">66</span> <span class="number">182</span> <span class="number">0</span> <span class="number">0</span> <span class="number">11</span></span><br><span class="line">-/+ buffers/cache: <span class="number">55</span> <span class="number">194</span></span><br><span class="line">Swap: <span class="number">511</span> <span class="number">0</span> <span class="number">511</span></span><br><span class="line">再来运行free命令，会发现现在的used为<span class="number">66</span>MB，free为<span class="number">182</span>MB，buffers为<span class="number">0</span>MB，cached为<span class="number">11</span>MB。那么有效的释放了buffer和cache。</span><br><span class="line">有关/proc/sys/vm/drop_caches的用法在下面进行了说明</span><br><span class="line">引用/proc/sys/vm/drop_caches (since Linux <span class="number">2.6</span><span class="number">.16</span>)</span><br><span class="line">Writing to <span class="keyword">this</span> file causes the kernel to drop clean caches,dentries <span class="keyword">and</span> inodes <span class="keyword">from</span> memory, causing that memory to become free.</span><br><span class="line">To free pagecache, use</span><br><span class="line"> echo <span class="number">1</span> &gt; /proc/sys/vm/drop_caches;</span><br><span class="line"> to free dentries <span class="keyword">and</span> inodes, use</span><br><span class="line">echo <span class="number">2</span> &gt; /proc/sys/vm/drop_caches;</span><br><span class="line">to free pagecache, dentries <span class="keyword">and</span> inodes, use</span><br><span class="line"> echo <span class="number">3</span> &gt;/proc/sys/vm/drop_caches.</span><br><span class="line">Because <span class="keyword">this</span> <span class="keyword">is</span> a non-destructive operation <span class="keyword">and</span> dirty objects are <span class="keyword">not</span> freeable, the user should run sync first.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">三、我的意见</span><br><span class="line">上述文章就长期以来很多用户对Linux内存管理方面的疑问，给出了一个比较“直观”的回复，我更觉得有点像是核心开发小组的妥协。</span><br><span class="line">对于是否需要使用这个值，或向用户提及这个值，我是有保留意见的：</span><br><span class="line"><span class="number">1</span>、从man可以看到，这值从<span class="number">2.6</span><span class="number">.16</span>以后的核心版本才提供，也就是老版的操作系统，如红旗DC <span class="number">5.0</span>、RHEL <span class="number">4.</span>x之前的版本都没有；</span><br><span class="line"><span class="number">2</span>、若对于系统内存是否够用的观察，我还是原意去看swap的使用率和si/so两个值的大小；</span><br><span class="line">用户常见的疑问是，为什么free这么小，是否关闭应用后内存没有释放？</span><br><span class="line">但实际上，我们都知道这是因为Linux对内存的管理与Windows不同，free小并不是说内存不够用了，应该看的是free的第二行最后一个值：<span class="string">"-/+ buffers/cache: 58 191"</span> 这才是系统可用的内存大小。</span><br><span class="line">实际项目中告诉我们，如果因为是应用有像内存泄露、溢出的问题，从swap的使用情况是可以比较快速可以判断的，但free上面反而比较难查看。相反，如果在这个时候，我们告诉用户，修改系统的一个值，“可以”释放内存，free就大了。用户会怎么想？不会觉得操作系统“有问题”吗？所以说，我觉得既然核心是可以快速清空buffer或cache，也不难做到（这从上面的操作中可以明显看到），但核心并没有这样做（默认值是<span class="number">0</span>），我们就不应该随便去改变它。一般情况下，应用在系统上稳定运行了，free值也会保持在一个稳定值的，虽然看上去可能比较小。当发生内存不足、应用获取不到可用内存、OOM错误等问题时，还是更应该去分析应用方面的原因，如用户量太大导致内存不足、发生应用内存溢出等情况，否则，清空buffer，强制腾出free的大小，可能只是把问题给暂时屏蔽了。</span><br><span class="line">我觉得，排除内存不足的情况外，除非是在软件开发阶段，需要临时清掉buffer，以判断应用的内存使用情况；或应用已经不再提供支持，即使应用对内存的时候确实有问题，而且无法避免的情况下，才考虑定时清空buffer。（可惜，这样的应用通常都是运行在老的操作系统版本上，上面的操作也解决不了）。</span><br><span class="line">测试</span><br><span class="line">[<span class="symbol">root@</span>testserver ~]# uname -a</span><br><span class="line">Linux testserver <span class="number">2.6</span><span class="number">.18</span><span class="number">-164.</span>el5 #<span class="number">1</span> SMP Thu Sep <span class="number">3</span> <span class="number">03</span>:<span class="number">28</span>:<span class="number">30</span> EDT <span class="number">2009</span> x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line">[<span class="symbol">root@</span>testserver ~]# free -m</span><br><span class="line">             total       used       free     <span class="keyword">shared</span>    buffers     cached</span><br><span class="line">Mem:          <span class="number">2013</span>       <span class="number">1661</span>        <span class="number">352</span>          <span class="number">0</span>        <span class="number">223</span>       <span class="number">1206</span></span><br><span class="line">-/+ buffers/cache:        <span class="number">231</span>       <span class="number">1782</span></span><br><span class="line">Swap:         <span class="number">2047</span>          <span class="number">0</span>       <span class="number">2047</span></span><br><span class="line">[<span class="symbol">root@</span>testserver ~]# sync</span><br><span class="line">[<span class="symbol">root@</span>testserver ~]# sync</span><br><span class="line">[<span class="symbol">root@</span>testserver ~]# cat /proc/sys/vm/drop_caches</span><br><span class="line"><span class="number">0</span></span><br><span class="line">[<span class="symbol">root@</span>testserver ~]# echo <span class="number">3</span> &gt; /proc/sys/vm/drop_caches</span><br><span class="line">[<span class="symbol">root@</span>testserver ~]# cat /proc/sys/vm/drop_caches    </span><br><span class="line"><span class="number">3</span></span><br><span class="line">[<span class="symbol">root@</span>testserver ~]# free -m</span><br><span class="line">             total       used       free     <span class="keyword">shared</span>    buffers     cached</span><br><span class="line">Mem:          <span class="number">2013</span>        <span class="number">100</span>       <span class="number">1913</span>          <span class="number">0</span>          <span class="number">0</span>         <span class="number">14</span></span><br><span class="line">-/+ buffers/cache:         <span class="number">85</span>       <span class="number">1927</span></span><br><span class="line">Swap:         <span class="number">2047</span>          <span class="number">0</span>       <span class="number">2047</span></span><br></pre></td></tr></table></figure>



<p>待整理</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">timeout：</span><br><span class="line">cat <span class="regexp">/proc/</span>sys<span class="regexp">/net/</span>ipv4/tcp_fin_timeout</span><br><span class="line"></span><br><span class="line">curl多少大小：</span><br><span class="line">curl  -o <span class="regexp">/dev/</span><span class="literal">null</span>  -H <span class="string">"Range:bytes=0-1048576"</span></span><br></pre></td></tr></table></figure>



<p>命令ss</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">ss命令高级网络 </span><br><span class="line">ss命令用来显示处于活动状态的套接字信息。ss命令可以用来获取socket统计信息，它可以显示和netstat类似的内容。但ss的优势在于它能够显示更多更详细的有关TCP和连接状态的信息，而且比netstat更快速更高效。 当服务器的socket连接数量变得非常大时，无论是使用netstat命令还是直接cat /proc/net/tcp，执行速度都会很慢。可能你不会有切身的感受，但请相信我，当服务器维持的连接达到上万个的时候，使用netstat等于浪费 生命，而用ss才是节省时间。 天下武功唯快不破。ss快的秘诀在于，它利用到了TCP协议栈中tcp_diag。tcp_diag是一个用于分析统计的模块，可以获得Linux 内核中第一手的信息，这就确保了ss的快捷高效。当然，如果你的系统中没有tcp_diag，ss也可以正常运行，只是效率会变得稍慢。</span><br><span class="line"></span><br><span class="line"> 语法 ss(选项) 选项 </span><br><span class="line"><span class="deletion">-h：显示帮助信息； </span></span><br><span class="line"><span class="deletion">-V：显示指令版本信息； </span></span><br><span class="line"><span class="deletion">-n：不解析服务名称，以数字方式显示； </span></span><br><span class="line"><span class="deletion">-a：显示所有的套接字； </span></span><br><span class="line"><span class="deletion">-l：显示处于监听状态的套接字； </span></span><br><span class="line"><span class="deletion">-o：显示计时器信息； </span></span><br><span class="line"><span class="deletion">-m：显示套接字的内存使用情况； </span></span><br><span class="line"><span class="deletion">-p：显示使用套接字的进程信息； </span></span><br><span class="line"><span class="deletion">-i：显示内部的TCP信息； </span></span><br><span class="line"><span class="deletion">-4：只显示ipv4的套接字； </span></span><br><span class="line"><span class="deletion">-6：只显示ipv6的套接字； </span></span><br><span class="line"><span class="deletion">-t：只显示tcp套接字； </span></span><br><span class="line"><span class="deletion">-u：只显示udp套接字； </span></span><br><span class="line"><span class="deletion">-d：只显示DCCP套接字； </span></span><br><span class="line"><span class="deletion">-w：仅显示RAW套接字； </span></span><br><span class="line"><span class="deletion">-x：仅显示UNIX域套接字</span></span><br><span class="line"></span><br><span class="line">显示ICP连接</span><br><span class="line">ss -t -a</span><br><span class="line"></span><br><span class="line">显示 Sockets 摘要</span><br><span class="line">ss -s</span><br><span class="line">列出当前的established, closed, orphaned and waiting TCP sockets</span><br><span class="line"></span><br><span class="line">列出所有打开的网络连接端口</span><br><span class="line">ss -l</span><br><span class="line"></span><br><span class="line">常用的  ss -antl</span><br></pre></td></tr></table></figure>



<p>wget</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line">wget命令用来从指定的URL下载文件。wget非常稳定，它在带宽很窄的情况下和不稳定网络中有很强的适应性，如果是由于网络的原因下载失败，wget会不断的尝试，直到整个文件下载完毕。如果是服务器打断下载过程，它会再次联到服务器上从停止的地方继续下载。这对从那些限定了链接时间的服务器上下载大文件非常有用。</span><br><span class="line"></span><br><span class="line">语法：</span><br><span class="line">wget(选项)(参数)</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">-a&lt;日志文件&gt;：在指定的日志文件中记录资料的执行过程；</span><br><span class="line"> -A&lt;后缀名&gt;：指定要下载文件的后缀名，多个后缀名之间使用逗号进行分隔；</span><br><span class="line"> -b：进行后台的方式运行wget； -B&lt;连接地址&gt;：设置参考的连接地址的基地地址；</span><br><span class="line"> -c：继续执行上次终端的任务；</span><br><span class="line"> -C&lt;标志&gt;：设置服务器数据块功能标志on为激活，off为关闭，默认值为on；</span><br><span class="line"> -d：调试模式运行指令； -D&lt;域名列表&gt;：设置顺着的域名列表，域名之间用“，”分隔；</span><br><span class="line"> -e&lt;指令&gt;：作为文件“.wgetrc”中的一部分执行指定的指令；</span><br><span class="line"> -h：显示指令帮助信息；</span><br><span class="line"> -i&lt;文件&gt;：从指定文件获取要下载的URL地址；</span><br><span class="line"> -l&lt;目录列表&gt;：设置顺着的目录列表，多个目录用“，”分隔；</span><br><span class="line"> -L：仅顺着关联的连接；</span><br><span class="line"> -r：递归下载方式；</span><br><span class="line"> -nc：文件存在时，下载文件不覆盖原有文件；</span><br><span class="line"> -nv：下载时只显示更新和出错信息，不显示指令的详细执行过程；</span><br><span class="line"> -q：不显示指令执行过程；</span><br><span class="line"> -nh：不查询主机名称；</span><br><span class="line"> -v：显示详细执行过程；</span><br><span class="line"> -V：显示版本信息；</span><br><span class="line"> --passive-ftp：使用被动模式PASV连接FTP服务器；</span><br><span class="line"> --follow-ftp：从HTML文件中下载FTP连接文件。</span><br><span class="line"></span><br><span class="line">参数：</span><br><span class="line">URL：下载指定的URL地址。</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、使用wget下载单个文件 </span><br><span class="line"></span><br><span class="line">以下的例子是从网络下载一个文件并保存在当前目录 </span><br><span class="line"></span><br><span class="line">wget http:<span class="comment">//cn.wordpress.org/wordpress-3.1-zh_CN.zip </span></span><br><span class="line"></span><br><span class="line">在下载的过程中会显示进度条，包含（下载完成百分比，已经下载的字节，当前下载速度，剩余下载时间）。 </span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、使用wget -O下载并以不同的文件名保存 </span><br><span class="line"></span><br><span class="line">wget默认会以最后一个符合”/”的后面的字符来命令，对于动态链接的下载通常文件名会不正确。 </span><br><span class="line">错误：下面的例子会下载一个文件并以名称download.php?id=<span class="number">1080</span>保存 </span><br><span class="line"></span><br><span class="line">wget http:<span class="comment">//www.centos.bz/download?id=1 </span></span><br><span class="line">即使下载的文件是zip格式，它仍然以download.php?id=<span class="number">1080</span>命令。 </span><br><span class="line">正确：为了解决这个问题，我们可以使用参数-O来指定一个文件名： </span><br><span class="line"></span><br><span class="line">wget -O wordpress.zip http:<span class="comment">//www.centos.bz/download.php?id=1080 </span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、使用wget –limit -rate限速下载 </span><br><span class="line">当你执行wget的时候，它默认会占用全部可能的宽带下载。但是当你准备下载一个大文件，而你还需要下载其它文件时就有必要限速了。 </span><br><span class="line"></span><br><span class="line">wget –limit-rate=<span class="number">300</span>k http:<span class="comment">//cn.wordpress.org/wordpress-3.1-zh_CN.zip </span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span>、使用wget -c断点续传 </span><br><span class="line">使用wget -c重新启动下载中断的文件: </span><br><span class="line"></span><br><span class="line">wget -c http:<span class="comment">//cn.wordpress.org/wordpress-3.1-zh_CN.zip </span></span><br><span class="line">对于我们下载大文件时突然由于网络等原因中断非常有帮助，我们可以继续接着下载而不是重新下载一个文件。需要继续中断的下载时可以使用-c参数。 </span><br><span class="line"></span><br><span class="line"><span class="number">5</span>、使用wget -b后台下载 </span><br><span class="line">对于下载非常大的文件的时候，我们可以使用参数-b进行后台下载。 </span><br><span class="line"></span><br><span class="line">wget -b http:<span class="comment">//cn.wordpress.org/wordpress-3.1-zh_CN.zip </span></span><br><span class="line">Continuing <span class="keyword">in</span> background, pid <span class="number">1840.</span> </span><br><span class="line">Output will be written to `wget-log’. </span><br><span class="line">你可以使用以下命令来察看下载进度 </span><br><span class="line"></span><br><span class="line">tail -f wget-log </span><br><span class="line"></span><br><span class="line"><span class="number">6</span>、伪装代理名称下载 </span><br><span class="line">有些网站能通过根据判断代理名称不是浏览器而拒绝你的下载请求。不过你可以通过–user-agent参数伪装。 </span><br><span class="line"></span><br><span class="line">wget –user-agent=”Mozilla/<span class="number">5.0</span> (Windows; U; Windows NT <span class="number">6.1</span>; en-US) AppleWebKit/<span class="number">534.16</span> (KHTML, like Gecko) Chrome/<span class="number">10.0</span><span class="number">.648</span><span class="number">.204</span> Safari/<span class="number">534.16</span>″ 下载链接 </span><br><span class="line"></span><br><span class="line"><span class="number">7</span>、使用wget –spider测试下载链接 </span><br><span class="line">当你打算进行定时下载，你应该在预定时间测试下载链接是否有效。我们可以增加–spider参数进行检查。 </span><br><span class="line"></span><br><span class="line">wget –spider URL </span><br><span class="line">如果下载链接正确，将会显示 </span><br><span class="line"></span><br><span class="line">wget –spider URL </span><br><span class="line">Spider mode enabled. Check <span class="keyword">if</span> remote file exists. </span><br><span class="line">HTTP request sent, awaiting response… <span class="number">200</span> OK </span><br><span class="line">Length: unspecified [text/html] </span><br><span class="line">Remote file exists <span class="keyword">and</span> could contain further links, </span><br><span class="line">but recursion <span class="keyword">is</span> disabled — <span class="keyword">not</span> retrieving. </span><br><span class="line">这保证了下载能在预定的时间进行，但当你给错了一个链接，将会显示如下错误 </span><br><span class="line"></span><br><span class="line">wget –spider url </span><br><span class="line">Spider mode enabled. Check <span class="keyword">if</span> remote file exists. </span><br><span class="line">HTTP request sent, awaiting response… <span class="number">404</span> Not Found </span><br><span class="line">Remote file does <span class="keyword">not</span> exist — broken link!!! </span><br><span class="line">你可以在以下几种情况下使用spider参数： </span><br><span class="line"></span><br><span class="line">定时下载之前进行检查 </span><br><span class="line">间隔检测网站是否可用 </span><br><span class="line">检查网站页面的死链接 </span><br><span class="line"></span><br><span class="line"><span class="number">8</span>、使用wget –tries增加重试次数 </span><br><span class="line">如果网络有问题或下载一个大文件也有可能失败。wget默认重试<span class="number">20</span>次连接下载文件。如果需要，你可以使用–tries增加重试次数。 </span><br><span class="line"></span><br><span class="line">wget –tries=<span class="number">40</span> URL </span><br><span class="line"></span><br><span class="line"><span class="number">9</span>、使用wget -i下载多个文件 </span><br><span class="line">首先，保存一份下载链接文件 </span><br><span class="line"></span><br><span class="line">cat &gt; filelist.txt </span><br><span class="line">url1 </span><br><span class="line">url2 </span><br><span class="line">url3 </span><br><span class="line">url4 </span><br><span class="line">接着使用这个文件和参数-i下载 </span><br><span class="line"></span><br><span class="line">wget -i filelist.txt </span><br><span class="line"></span><br><span class="line"><span class="number">10</span>、使用wget –mirror镜像网站 </span><br><span class="line">下面的例子是下载整个网站到本地。 </span><br><span class="line"></span><br><span class="line">wget –mirror -p –convert-links -P ./LOCAL URL </span><br><span class="line">–miror:开户镜像下载 </span><br><span class="line">-p:下载所有为了html页面显示正常的文件 </span><br><span class="line">–convert-links:下载后，转换成本地的链接 </span><br><span class="line">-P ./LOCAL：保存所有文件和目录到本地指定目录 </span><br><span class="line"></span><br><span class="line"><span class="number">11</span>、使用wget –reject过滤指定格式下载 </span><br><span class="line">你想下载一个网站，但你不希望下载图片，你可以使用以下命令。 </span><br><span class="line"></span><br><span class="line">wget –reject=gif url </span><br><span class="line"></span><br><span class="line"><span class="number">12</span>、使用wget -o把下载信息存入日志文件 </span><br><span class="line">你不希望下载信息直接显示在终端而是在一个日志文件，可以使用以下命令： </span><br><span class="line"></span><br><span class="line">wget -o download.log URL </span><br><span class="line"></span><br><span class="line"><span class="number">13</span>、使用wget -Q限制总下载文件大小 </span><br><span class="line">当你想要下载的文件超过<span class="number">5</span>M而退出下载，你可以使用以下命令: </span><br><span class="line"></span><br><span class="line">wget -Q5m -i filelist.txt </span><br><span class="line">注意：这个参数对单个文件下载不起作用，只能递归下载时才有效。 </span><br><span class="line"></span><br><span class="line"><span class="number">14</span>、使用wget -r -A下载指定格式文件 </span><br><span class="line">可以在以下情况使用该功能 </span><br><span class="line"></span><br><span class="line">下载一个网站的所有图片 </span><br><span class="line">下载一个网站的所有视频 </span><br><span class="line">下载一个网站的所有PDF文件 </span><br><span class="line">wget -r -A.pdf url </span><br><span class="line"></span><br><span class="line"><span class="number">15</span>、使用wget FTP下载 </span><br><span class="line">你可以使用wget来完成ftp链接的下载。 </span><br><span class="line">使用wget匿名ftp下载 </span><br><span class="line"></span><br><span class="line">wget ftp-url </span><br><span class="line"></span><br><span class="line">使用wget用户名和密码认证的ftp下载 </span><br><span class="line"></span><br><span class="line">wget –ftp-user=USERNAME –ftp-password=PASSWORD url</span><br><span class="line"></span><br><span class="line">wget是在Linux下开发的开放源代码的软件，作者是Hrvoje Niksic，后来被移植到包括Windows在内的各个平台上。它有以下功能和特点： </span><br><span class="line"></span><br><span class="line">（<span class="number">1</span>）支持断点下传功能；这一点，也是网络蚂蚁和FlashGet当年最大的卖点，现在，Wget也可以使用此功能，那些网络不是太好的用户可以放心了； </span><br><span class="line">（<span class="number">2</span>）同时支持FTP和HTTP下载方式；尽管现在大部分软件可以使用HTTP方式下载，但是，有些时候，仍然需要使用FTP方式下载软件； </span><br><span class="line">（<span class="number">3</span>）支持代理服务器；对安全强度很高的系统而言，一般不会将自己的系统直接暴露在互联网上，所以，支持代理是下载软件必须有的功能； </span><br><span class="line">（<span class="number">4</span>）设置方便简单；可能，习惯图形界面的用户已经不是太习惯命令行了，但是，命令行在设置上其实有更多的优点，最少，鼠标可以少点很多次，也不要担心是否错点鼠标； </span><br><span class="line">（<span class="number">5</span>）程序小，完全免费；程序小可以考虑不计，因为现在的硬盘实在太大了；完全免费就不得不考虑了，即使网络上有很多所谓的免费软件，但是，这些软件的广告却不是我们喜欢的； </span><br><span class="line"></span><br><span class="line">wget虽然功能强大，但是使用起来还是比较简单的，基本的语法是：wget [参数列表] URL。下面就结合具体的例子来说明一下wget的用法。 </span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、下载整个http或者ftp站点。 </span><br><span class="line">wget http:<span class="comment">//place.your.url/here </span></span><br><span class="line">这个命令可以将http:<span class="comment">//place.your.url/here 首页下载下来。使用-x会强制建立服务器上一模一样的目录，如果使用-nd参数，那么服务器上下载的所有内容都会加到本地当前目录。 </span></span><br><span class="line"></span><br><span class="line">wget -r http:<span class="comment">//place.your.url/here </span></span><br><span class="line">这 个命令会按照递归的方法，下载服务器上所有的目录和文件，实质就是下载整个网站。这个命令一定要小心使用，因为在下载的时候，被下载网站指向的所有地址同 样会被下载，因此，如果这个网站引用了其他网站，那么被引用的网站也会被下载下来！基于这个原因，这个参数不常用。可以用-l number参数来指定下载的层次。例如只下载两层，那么使用-l <span class="number">2</span>。 </span><br><span class="line"></span><br><span class="line">要是您想制作镜像站点，那么可以使用－m参数，例如：wget -m http:<span class="comment">//place.your.url/here </span></span><br><span class="line">这时wget会自动判断合适的参数来制作镜像站点。此时，wget会登录到服务器上，读入robots.txt并按robots.txt的规定来执行。 </span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、断点续传。 </span><br><span class="line">当文件特别大或者网络特别慢的时候，往往一个文件还没有下载完，连接就已经被切断，此时就需要断点续传。wget的断点续传是自动的，只需要使用-c参数，例如： </span><br><span class="line">wget -c http:<span class="comment">//the.url.of/incomplete/file </span></span><br><span class="line">使用断点续传要求服务器支持断点续传。-t参数表示重试次数，例如需要重试<span class="number">100</span>次，那么就写-t <span class="number">100</span>，如果设成-t <span class="number">0</span>，那么表示无穷次重试，直到连接成功。-T参数表示超时等待时间，例如-T <span class="number">120</span>，表示等待<span class="number">120</span>秒连接不上就算超时。 </span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、批量下载。 </span><br><span class="line">如果有多个文件需要下载，那么可以生成一个文件，把每个文件的URL写一行，例如生成文件download.txt，然后用命令：wget -i download.txt </span><br><span class="line">这样就会把download.txt里面列出的每个URL都下载下来。（如果列的是文件就下载文件，如果列的是网站，那么下载首页） </span><br><span class="line"></span><br><span class="line"><span class="number">4</span>、选择性的下载。 </span><br><span class="line">可以指定让wget只下载一类文件，或者不下载什么文件。例如： </span><br><span class="line">wget -m –reject=gif http:<span class="comment">//target.web.site/subdirectory </span></span><br><span class="line">表示下载http:<span class="comment">//target.web.site/subdirectory，但是忽略gif文件。–accept=LIST 可以接受的文件类型，–reject=LIST拒绝接受的文件类型。 </span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span>、密码和认证。 </span><br><span class="line">wget只能处理利用用户名/密码方式限制访问的网站，可以利用两个参数： </span><br><span class="line">–http-user=USER设置HTTP用户 </span><br><span class="line">–http-passwd=PASS设置HTTP密码 </span><br><span class="line">对于需要证书做认证的网站，就只能利用其他下载工具了，例如curl。 </span><br><span class="line"></span><br><span class="line"><span class="number">6</span>、利用代理服务器进行下载。 </span><br><span class="line">如果用户的网络需要经过代理服务器，那么可以让wget通过代理服务器进行文件的下载。此时需要在当前用户的目录下创建一个.wgetrc文件。文件中可以设置代理服务器： </span><br><span class="line">http-proxy = <span class="number">111.111</span><span class="number">.111</span><span class="number">.111</span>:<span class="number">8080</span> </span><br><span class="line">ftp-proxy = <span class="number">111.111</span><span class="number">.111</span><span class="number">.111</span>:<span class="number">8080</span> </span><br><span class="line">分别表示http的代理服务器和ftp的代理服务器。如果代理服务器需要密码则使用： </span><br><span class="line">–proxy-user=USER设置代理用户 </span><br><span class="line">–proxy-passwd=PASS设置代理密码 </span><br><span class="line">这两个参数。 </span><br><span class="line">使用参数–proxy=on/off 使用或者关闭代理。 </span><br><span class="line">wget还有很多有用的功能，需要用户去挖掘。 </span><br><span class="line"></span><br><span class="line">附录： </span><br><span class="line"></span><br><span class="line">命令格式： </span><br><span class="line">wget [参数列表] [目标软件、网页的网址] </span><br><span class="line"></span><br><span class="line">-V,–version 显示软件版本号然后退出； </span><br><span class="line">-h,–help显示软件帮助信息； </span><br><span class="line">-e,–execute=COMMAND 执行一个 “.wgetrc”命令 </span><br><span class="line"></span><br><span class="line">-o,–output-file=FILE 将软件输出信息保存到文件； </span><br><span class="line">-a,–append-output=FILE将软件输出信息追加到文件； </span><br><span class="line">-d,–debug显示输出信息； </span><br><span class="line">-q,–quiet 不显示输出信息； </span><br><span class="line">-i,–input-file=FILE 从文件中取得URL； </span><br><span class="line"></span><br><span class="line">-t,–tries=NUMBER 是否下载次数（<span class="number">0</span>表示无穷次） </span><br><span class="line">-O –output-document=FILE下载文件保存为别的文件名 </span><br><span class="line">-nc, –no-clobber 不要覆盖已经存在的文件 </span><br><span class="line">-N,–timestamping只下载比本地新的文件 </span><br><span class="line">-T,–timeout=SECONDS 设置超时时间 </span><br><span class="line">-Y,–proxy=on/off 关闭代理 </span><br><span class="line"></span><br><span class="line">-nd,–no-directories 不建立目录 </span><br><span class="line">-x,–force-directories 强制建立目录 </span><br><span class="line"></span><br><span class="line">–http-user=USER设置HTTP用户 </span><br><span class="line">–http-passwd=PASS设置HTTP密码 </span><br><span class="line">–proxy-user=USER设置代理用户 </span><br><span class="line">–proxy-passwd=PASS设置代理密码 </span><br><span class="line"></span><br><span class="line">-r,–recursive 下载整个网站、目录（小心使用） </span><br><span class="line">-l,–level=NUMBER 下载层次 </span><br><span class="line"></span><br><span class="line">-A,–accept=LIST 可以接受的文件类型 </span><br><span class="line">-R,–reject=LIST拒绝接受的文件类型 </span><br><span class="line">-D,–domains=LIST可以接受的域名 </span><br><span class="line">–exclude-domains=LIST拒绝的域名 </span><br><span class="line">-L,–relative 下载关联链接 </span><br><span class="line">–follow-ftp 只下载FTP链接 </span><br><span class="line">-H,–span-hosts 可以下载外面的主机 </span><br><span class="line">-I,–include-directories=LIST允许的目录 </span><br><span class="line">-X,–exclude-directories=LIST 拒绝的目录 </span><br><span class="line"></span><br><span class="line">中文文档名在平常的情况下会被编码， 但是在 –cut-dirs 时又是正常的， </span><br><span class="line">wget -r -np -nH –cut-dirs=<span class="number">3</span> ftp:<span class="comment">//host/test/ </span></span><br><span class="line">测试.txt </span><br><span class="line">wget -r -np -nH -nd ftp:<span class="comment">//host/test/ </span></span><br><span class="line">%B4%FA%B8%D5.txt </span><br><span class="line">wget “ftp:<span class="comment">//host/test/*” </span></span><br><span class="line">%B4%FA%B8%D5.txt </span><br><span class="line"></span><br><span class="line">由 於不知名的原因，可能是为了避开特殊档名， wget 会自动将抓取档名的部分用 encode_string 处理过， 所以该 patch 就把被 encode_string 处理成 “%<span class="number">3</span>A” 这种东西， 用 decode_string 还原成 “:”，并套用在目录与档案名称的部分，decode_string 是 wget 内建的函式。 </span><br><span class="line"></span><br><span class="line">wget -t0 -c -nH -x -np -b -m -P /home/sunny/NOD32view/ http:<span class="comment">//downloads1.kaspersky-labs.com/bases/ -o wget.log</span></span><br></pre></td></tr></table></figure>



<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cmd计算器：calc</span><br><span class="line">windows：</span><br><span class="line">tasklist</span><br><span class="line">taskkill /<span class="keyword">pid</span> <span class="number">69595</span> /f</span><br><span class="line">window+R  mstsc</span><br><span class="line">虚机卡执行：echo <span class="number">204800</span> &gt; /<span class="keyword">proc</span>/sys/vm/min_free_kbytes</span><br><span class="line">mysql倒序：select *<span class="title"> from</span> measure_ottcache_error_5minutes_data<span class="title"> order</span> by<span class="title"> stattime</span> desc<span class="title"> limit</span> 10;</span><br><span class="line">grep -nr "checknetiflinkstat" /home/zxcdn/ottcache/nginx/lua</span><br><span class="line">查系统：</span><br><span class="line">uname -a</span><br><span class="line">lsb_release -a</span><br><span class="line">cat /etc/issue</span><br><span class="line">cat /<span class="keyword">proc</span>/version</span><br></pre></td></tr></table></figure>



<h1 id="路由和远程拷贝知识点"><a href="#路由和远程拷贝知识点" class="headerlink" title="路由和远程拷贝知识点"></a>路由和远程拷贝知识点</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">远程拷贝：scp</span> <span class="string">-r</span> <span class="string">-P</span> <span class="string">PORT</span> <span class="string">/home/setup</span> <span class="string">root@80.80.45.37:/home/setup（-P</span> <span class="string">PORT为指定端口）</span></span><br><span class="line"><span class="string">scp</span> <span class="string">-r</span> <span class="string">/home/zxcdn/*.tar.gz</span> <span class="string">root@10.47.235.167:/home/zxcdn/</span></span><br><span class="line">         <span class="string">这边为要拷贝的内容</span>                        <span class="string">这边是目标地址（要拷到哪个目录下）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">有的端口不是默认的</span></span><br><span class="line"><span class="string">windows下添加路由</span></span><br><span class="line">        <span class="string">我的电脑：小网网关：172.18.100.254</span></span><br><span class="line">                   <span class="string">大网网关：10.47.214.1</span></span><br><span class="line">        <span class="string">比如一个服务器的ip：30.30.3.4</span></span><br><span class="line">                <span class="string">route</span>  <span class="string">add</span>  <span class="number">30.30</span><span class="number">.0</span><span class="number">.0</span> <span class="string">mask</span> <span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span> <span class="number">172.18</span><span class="number">.100</span><span class="number">.254</span></span><br><span class="line"><span class="string">linux下添加路由，内容下发，tomcat日志显示ftp不通</span></span><br><span class="line"><span class="number">10.47</span><span class="number">.231</span><span class="number">.43</span><span class="string">（10不与30的通，10的还有一个ip为80的，所以加80的网关）</span></span><br><span class="line"><span class="string">route</span> <span class="string">-n</span></span><br><span class="line"><span class="string">Kernel</span> <span class="string">IP</span> <span class="string">routing</span> <span class="string">table</span></span><br><span class="line"><span class="string">Destination</span>     <span class="string">Gateway</span>         <span class="string">Genmask</span>         <span class="string">Flags</span> <span class="string">Metric</span> <span class="string">Ref</span>    <span class="string">Use</span> <span class="string">Iface</span></span><br><span class="line"><span class="number">10.47</span><span class="number">.231</span><span class="number">.0</span>     <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>   <span class="string">U</span>     <span class="number">0</span>      <span class="number">0</span>        <span class="number">0</span> <span class="string">eth1</span></span><br><span class="line"><span class="number">10.229</span><span class="number">.0</span><span class="number">.0</span>      <span class="number">80.80</span><span class="number">.80</span><span class="number">.254</span>    <span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span>     <span class="string">UG</span>    <span class="number">0</span>      <span class="number">0</span>        <span class="number">0</span> <span class="string">eth0</span></span><br><span class="line"><span class="number">80.80</span><span class="number">.0</span><span class="number">.0</span>       <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span>     <span class="string">U</span>     <span class="number">0</span>      <span class="number">0</span>        <span class="number">0</span> <span class="string">eth0</span></span><br><span class="line"><span class="number">169.254</span><span class="number">.0</span><span class="number">.0</span>     <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span>     <span class="string">U</span>     <span class="number">0</span>      <span class="number">0</span>        <span class="number">0</span> <span class="string">eth1</span></span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="number">10.47</span><span class="number">.231</span><span class="number">.1</span>     <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>         <span class="string">UG</span>    <span class="number">0</span>      <span class="number">0</span>        <span class="number">0</span> <span class="string">eth1</span></span><br><span class="line"><span class="string">route</span> <span class="string">add</span> <span class="string">-net</span> <span class="number">30.1</span><span class="number">.0</span><span class="number">.0</span> <span class="string">netmask</span> <span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span> <span class="string">gw</span> <span class="number">80.80</span><span class="number">.80</span><span class="number">.254</span> <span class="string">dev</span> <span class="string">eth0</span></span><br><span class="line"><span class="string">route</span> <span class="string">add</span> <span class="string">–net</span> <span class="number">30.1</span><span class="number">.170</span><span class="number">.130</span></span><br><span class="line">        <span class="string">linux添加永久路由</span></span><br><span class="line"><span class="string">cd</span> <span class="string">/etc/sysconfig/network-scripts</span></span><br><span class="line"><span class="string">more</span> <span class="string">route-eth0</span></span><br><span class="line"><span class="string">vi</span> <span class="string">route-eth0</span></span><br><span class="line"><span class="number">10.229</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span> <span class="string">via</span> <span class="number">80.80</span><span class="number">.80</span><span class="number">.254</span></span><br><span class="line"><span class="number">70.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/8</span> <span class="string">via</span> <span class="number">80.80</span><span class="number">.80</span><span class="number">.254</span></span><br><span class="line"><span class="number">172.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/8</span> <span class="string">via</span> <span class="number">80.80</span><span class="number">.80</span><span class="number">.254</span></span><br><span class="line"><span class="string">~</span></span><br><span class="line"><span class="string">~</span></span><br><span class="line"><span class="string">~</span></span><br><span class="line"><span class="string">~</span></span><br><span class="line"><span class="string">/etc/init.d/network</span> <span class="string">restart</span></span><br><span class="line"><span class="string">more</span> <span class="string">ifcfg-eth0</span></span><br><span class="line"><span class="string">more</span> <span class="string">ifcfg-eth1</span></span><br><span class="line"><span class="number">172.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/8</span>         <span class="string">via</span>         <span class="number">80.80</span><span class="number">.80</span><span class="number">.254</span></span><br><span class="line"><span class="string">网段/子网掩码</span>  <span class="string">via</span>  <span class="string">网关</span></span><br><span class="line"><span class="string">问题：itool连接失败（rr：80.80.41.196）</span></span><br><span class="line"><span class="string">网段：IPv4</span> <span class="string">地址:</span> <span class="number">172.18</span><span class="number">.100</span><span class="number">.33</span></span><br><span class="line"><span class="string">IPv4</span> <span class="string">子网掩码:</span> <span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="number">8</span><span class="string">：代表子网掩码</span></span><br><span class="line"><span class="string">网关：route命令</span> <span class="string">查看80.80.41.196的网关（Gateway）：80.80.80.254</span></span><br></pre></td></tr></table></figure>



<h1 id="时间同步及设置ip"><a href="#时间同步及设置ip" class="headerlink" title="时间同步及设置ip"></a>时间同步及设置ip</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">服务器时间同步:</span><br><span class="line">ntpdate 对应的ip</span><br><span class="line">添加定时任务：切换到root用户，crontab –e编辑定时任务，添加如下：</span><br><span class="line">*/5 * * * * /usr/sbin/sntp -P <span class="literal">no</span> -r 30.30.100.12;hwclock –w(加黑ip为时间标准服务器)</span><br><span class="line">有的时候平台zxuss会影响时间同步，需要先停掉平台：pkill -9 ZXUSS</span><br><span class="line">有几个服务器设置不成功用的以下方法:</span><br><span class="line">命令:yast:进设置,选择system&gt;DATA <span class="keyword">and</span> Time&gt;选择时区</span><br><span class="line"></span><br><span class="line">ip</span><br><span class="line">[root@halo network-scripts]# more ifcfg-eth0 </span><br><span class="line"><span class="attribute">DEVICE</span>=eth0</span><br><span class="line"><span class="attribute">HWADDR</span>=00:0C:29:B1:17:0F</span><br><span class="line"><span class="attribute">TYPE</span>=Ethernet</span><br><span class="line"><span class="attribute">UUID</span>=f109427a-2184-41f1-88e9-fc8e3143f80b</span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">NM_CONTROLLED</span>=<span class="literal">yes</span></span><br><span class="line">=none</span><br><span class="line"><span class="attribute">BOOTPROTO</span>=static</span><br><span class="line"><span class="attribute">IPADDR</span>=30.30.3.1</span><br><span class="line"><span class="attribute">NETMASK</span>=255.255.0.0</span><br><span class="line">[root@halo network-scripts]# pwd</span><br><span class="line">/etc/sysconfig/network-scripts</span><br><span class="line">2017-02-23 10:07:49*[马正园10125555]说:</span><br><span class="line">[root@halo sysconfig]# more network</span><br><span class="line"><span class="attribute">NETWORKING</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">HOSTNAME</span>=halo</span><br><span class="line"><span class="attribute">GATEWAY</span>=30.30.30.254</span><br><span class="line">[root@halo sysconfig]# pwd</span><br><span class="line">/etc/sysconfig</span><br><span class="line">vi /etc/sysconfig/network/ifcfg-eth0</span><br></pre></td></tr></table></figure>



<h1 id="跳板机"><a href="#跳板机" class="headerlink" title="跳板机"></a>跳板机</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">跳板机     <span class="number">10.47</span><span class="number">.234</span><span class="number">.12</span> root/iptvtest  深圳往南京跳</span><br><span class="line">命令格式：ssh -p <span class="number">22222</span> <span class="symbol">scydweihu@</span><span class="number">223.85</span><span class="number">.247</span><span class="number">.179</span></span><br></pre></td></tr></table></figure>



<h1 id="centos关闭防火墙"><a href="#centos关闭防火墙" class="headerlink" title="centos关闭防火墙"></a>centos关闭防火墙</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CentOS7用firewall命令“替代”了iptables。</span><br><span class="line">        关闭firewall：</span><br><span class="line">        systemctl stop firewalld.service <span class="comment">#停止firewall</span></span><br><span class="line">        systemctl disable firewalld.service <span class="comment">#禁止firewall开机启动</span></span><br><span class="line">        firewall-<span class="keyword">cmd</span><span class="bash"> --state <span class="comment">#查看默认防火墙状态（关闭后显示notrunning，开启后显示running）</span></span></span><br></pre></td></tr></table></figure>



<h1 id="rz命令安装"><a href="#rz命令安装" class="headerlink" title="rz命令安装"></a>rz命令安装</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">rpm</span> <span class="selector-tag">-ivh</span> <span class="selector-tag">rzsz-0</span><span class="selector-class">.12</span><span class="selector-class">.20-934</span><span class="selector-class">.22</span><span class="selector-class">.x86_64</span><span class="selector-class">.rpm</span></span><br></pre></td></tr></table></figure>



<h1 id="000Wireshark网络分析就这么简单"><a href="#000Wireshark网络分析就这么简单" class="headerlink" title="000Wireshark网络分析就这么简单"></a>000Wireshark网络分析就这么简单</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">001</span>庖丁解牛</span><br></pre></td></tr></table></figure>

<p>tcpdump -i any host 80.80.46.76   -w  target.cap<br>tcpdump -i any port 8080   -w  target.cap<br>tcpdump -i eth0 -s 80 -w tcpdump.cap<br>只抓取eth0上每个包的前80字节，把结果存到tcpdum.cap中<br>1.只抓包头:<br>tcpdump -i eth0 -s 80 -w tcpdump.cap<br>Capture—&gt;Options<br>“Limit each packet to”正常设：80bytes；TCP层、网络层和数据链路层的信息可以包含在内。</p>
<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623075924347.png" alt="image-20210623075924347"></p>
<p>2.只抓必要的包<br>tcpdump -i eth0 host 10.32.200.131 -w tcpdump.cap<br>Capture–&gt;Options<br>在Capture Filter输入“host 10.30.200.131”</p>
<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623075933798.png" alt="image-20210623075933798"></p>
<p>3.过滤<br>ip.addr eq 10.32.106.50 &amp;&amp; tcp.port eq 8080<br>        过滤出10.32.106.50，TCP端口为8080的包</p>
<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623075945543.png" alt="image-20210623075945543"></p>
<p>  如果已知某个协议发生为题可以用协议名称过滤一下。<br>        例如已知该域的验证协议Keberos<br>        Filter:Keberos<br>  用协议过滤时务必考虑协议间的依赖性：<br>         Filter:portmap||mount。前提是要懂协议间的依赖<br>IP地址加port号是最常用的过滤方式。<br>        手工输入Filter：ip.addreq&lt;IP 地址&gt;&amp;&amp;tcp.porteq&lt;端口号&gt;<br>        右击感兴趣的包，选择”Follow TCP/UDP Stream(选择TCP还是UDP根据传输协议而定）<br>   Wireshark是按照两端的IP加port过滤出一个TCP/UDP Stream<br>        Statistics–&gt;Conversations再单击TCP或者UDP标签就可以看到所以Stream<br>用鼠标帮助过滤<br>右击感兴趣的包，Prepare a Filter–&gt;Selected自动在Filter中生成过滤表达式。还可以使用And、Or等选项<br>       右击感兴趣的包，Apply as Filter–&gt;Selected表示式生成后还会自动执行<br>4.让Wireshark自动分析<br>单击Wireshark的Analyze–&gt;Expert Info Composite在分析网络性能和连接问题时，借助此功能<br>单击Statistics–&gt;Service Response Time，再选定协议名称，可以得到响应时间的统计表<br>单击Statistics–&gt;TCP Stream Graph生成统计图<br>Statisecs–&gt;Summary,可以看到一些统计信息，比如平均流量等，有助于我们推测负载状况。<br>5.搜索功能<br>Ctrl+F后选中“String”单选按钮搜索关键字，在Filter中输入例如：error</p>
<h1 id="sss"><a href="#sss" class="headerlink" title="sss"></a>sss</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">即将离开公司，开始一段新的也是自找的新的生活了。人言<span class="number">40</span>不惑，其实还是惑的。也许在企业的生涯注定总有离开的一天，但面临自己做抉择的时候还是会有一些犹豫，一些不舍。回首往事，似乎也没有什么遗憾，作为一名<span class="number">70</span>后，外企和国企中的卓越司各干了十年，该读的书读了，该出的国出了，移民也办了（最后没去），能干的国外和国内岗位也都干过了一边，也即将和兄弟们一起为自己做事了，房子，小孩似乎该有的也都有了。经过了这个城市高速发展的时期，迷茫过，彷徨过，忙忙碌碌到了<span class="number">40</span>，忽然回头看来，才明白原来所珍视的，不过是过眼云烟，原来所忽略的，才是最宝贵的人生风景和人生积累。</span><br><span class="line"></span><br><span class="line">人这一辈子，总要给自己留一些值得回忆的风景，<span class="number">40</span>岁前为家人和生存而活，<span class="number">40</span>岁以后为自己而活，刘欢的《从头再来》对一个步入中年的人来说也许是最好的注释。感谢一路走来互相扶助的朋友们，是你们的扶助伴我走过了过去的美好岁月。</span><br><span class="line"></span><br><span class="line">下面是我的微信和个人电话 <span class="number">18620360646</span>，欢迎联系，相聚明天，一起交流出来后生活，学习和创业的经验和感悟。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">最后分享两篇文章，颇能代表心境，不是我们这个年代的人想折腾，而是这个时代必须折腾啊，也期望大家都能找到自己中年的答案。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">最近到处都在说房价，主流声音就是房价太高了买不起怎么办好迷茫好绝望。</span><br><span class="line"></span><br><span class="line">其实中国人有几个是真没房住的？相对于房价来说房租便宜得很，买不起总租得起吧。实在租不起了回老家也总有你能住的房子。</span><br><span class="line"></span><br><span class="line">如果单纯只论“住”或只论“房子”，对于现在的中国人来说真不是个问题。</span><br><span class="line"></span><br><span class="line">真正的问题是：当你不再年轻了，你还能做什么？</span><br><span class="line"></span><br><span class="line">今年传闻某知名互联网公司裁掉了一大批<span class="number">34</span>以上的老员工，引起职场族尤其是一线城市的白领们大恐慌。在F7那种狼窝里能熬到<span class="number">34</span>岁的人尚且如此，我们这些还没修炼成狼就已人到中年的人该怎么办？</span><br><span class="line"></span><br><span class="line">不管是公务员事业单位招考还是私企招聘，多数都会注明“<span class="number">35</span>岁以下”，一些中小企业甚至要求<span class="number">30</span>岁以下。那么<span class="number">35</span>岁以上的体制外人都去哪了？</span><br><span class="line"></span><br><span class="line">我几年前开始就经常思考这个问题，当然也没想出个结果。或许会有不知天高地厚的年轻人说：如果你工作了十几年还没有掌握一些让自己不可替代的能力，被淘汰就是活该。这话听起来正确得像真理一样，我只希望说这话的人自己到了<span class="number">35</span>岁的时候真的能够成为无法被年轻人代替的人。</span><br><span class="line"></span><br><span class="line">这世界上哪有那么多的不可代替？有肯定是有的，但绝大多数人所从事的工作真不需要十年的经验积累。如果你做的事情年轻人能做到<span class="number">80</span>%甚至只是<span class="number">60</span>%，而他要的薪水只有你的一半不到，你觉得老板会怎么选择？</span><br><span class="line"></span><br><span class="line">人到中年，身体机能开始退化了，你怎么跟那些二十来岁的毛头小伙子拼加班拼熬夜？就算你身体是铁打的，你要不要照顾家庭？要不要陪伴孩子？大家同在一个公司，人家加班你不加班，老板看了会怎么想？换了你是老板你会怎么想？你会仅仅因为同情或旧情而允许一个工作量比别人少拿钱还比别人多的人存在吗？</span><br><span class="line"></span><br><span class="line">其实代入NBA的情况就明白了，奥尼尔、邓肯、加内特、司机、科比等超巨能打到<span class="number">40</span>岁左右自己不想打了才退休，而绝大多数普通球员不到<span class="number">35</span>岁就打不上球了。三十二三岁以后即使还能拿到合同的一般都是低薪老将合同，像科比司机那样职业末年还能拿高薪的，那是人家之前为球队贡献了太多，这样的人在整个联盟能有几个？</span><br><span class="line"></span><br><span class="line">我老婆刚毕业的时候，去了一家十几个人的润滑油销售公司做文员。那家公司是一家港资公司的子公司，总经理<span class="number">30</span>多岁，一个月工资加销售提成大概有两万多块，在<span class="number">2006</span>年的广州，在当时的我们看来是非常令人羡慕的高薪。</span><br><span class="line"></span><br><span class="line">他的生活确实也过得不错，有房有车还有闲钱弄点收藏，但我老婆（那时还是女朋友）说他有时会在公司闲聊时感叹没有事业。女友当时毕竟年轻，说X总您明明是事业有成啊怎么会没有事业？</span><br><span class="line"></span><br><span class="line">那总说：男人得自己创业，才算是有自己的事业。当时我们都不理解这话，后来人过三十以后，慢慢地发现，自己所在的公司里真的没有“老”员工了，自己的同学朋友也一个个不再打工了。至于当初女友钦佩的那总，在大约<span class="number">2009</span>年的时候，公司解散，他得到了几十万的赔偿，后来也不知道做什么去了。</span><br><span class="line"></span><br><span class="line">这样的现象绝非个例，且让我一个个数来：</span><br><span class="line"></span><br><span class="line">我二十六七岁的时候，在一家传统行业的上市公司品牌部混着。第一任部门经理是我所亲见过的最多才多艺的人，这位老哥精通摄影、书法、围棋、国际象棋、平面设计、网页制作、咖啡调制、古籍文献，文字功底深厚，文言和古体诗词都写得有模有样（能让我觉得有模有样的，可不是所谓高考文言作文那种水平）。</span><br><span class="line"></span><br><span class="line">此人思维缜密，智商很高，有次一个同事在网上做了套智商测试题，在群里发给我们，几个人里就以他得分最高。某次上面某大领导不知发什么神经一时兴起交代要写个行业分析报告，他不到一个星期就交出一份洋洋洒洒四万多字节的WORD，我不信邪逐段复制去百度谷歌，发现竟然真是原创。</span><br><span class="line"></span><br><span class="line">然后对理论物理也颇有研究（当然是业余意义上的），发现上帝粒子的那次，他半夜全程看直播，还即兴填词一阙。此人的工作态度更是令我汗颜，自称跟老婆孩子约法三章上班时间没有紧急事件不准打他电话，平时随便一个小破活动都如临大敌再三排练，所有文字材料的遣词用句要求简直比人民日报社论还严格，一篇例行公事的豆腐块都要一校二校三校。</span><br><span class="line"></span><br><span class="line">这位老哥走后，空降的部门领导和他同龄，但风格截然不同。新来的老哥对什么经史子集琴棋书画一窍不通，胜在路子野气魄大，能跟各路老板、媒体人、广告人之类谈笑风生，曾操盘过某跟曼联队有关的颇有影响的热门事件，在业内也算有点知名度。</span><br><span class="line"></span><br><span class="line">这两位老哥进公司的时候都是<span class="number">40</span>岁左右，加起来做了两年，先后离开。前一任回老家开了个咖啡馆，后一任确实路子野，玩起了创业，这四年来我所知道的他已经搞了四个项目，前三个都失败了，目前这个也没看出来有啥成功的苗头。要说眼光和嗅觉他确实不错，<span class="number">13</span>年搞手游，<span class="number">14</span>年搞在线教育，都是所谓风口上的行业。但即使再怎么在风口上的行业，照样是一将功成万骨枯。</span><br><span class="line"></span><br><span class="line">后来我在一家互联网公司做小主管，下面有两个员工，其中一个近四十岁，是负责跑市场商务合作的，一看就是那种职场老油条，精明滑头，态度谦和谨慎，我对他也很客气。</span><br><span class="line"></span><br><span class="line">后来得知他在南山区（深圳房价最高的区）有两套房，不由肃然起敬。后来我们先后离开了那家公司，接下来两年里听说他又换了几次工作，终于不再打工，跟我说养老去了。他是早早享受到房价红利完成了资本积累的人，说养老是真有养老的条件。而现在那些连房都买不起的人，以后怎么养老？</span><br><span class="line"></span><br><span class="line">我同学，建筑设计专业的，自称中国每个大城市都有他设计的房子，三年前混到税前街薪的水平，辞职，和老婆开了家卖玉石的店，生意不错，说能跟得上深圳房价的涨幅。</span><br><span class="line"></span><br><span class="line">我同学，市政设计专业的，毕业后一路颇顺，是同学中第一个在一线买房的人。去年底辞职，自己在家乡那个五线小城市开了个小公司，目前尚未打开局面。</span><br><span class="line"></span><br><span class="line">我同学，在地产营销圈内混得风生水起，几年就做到了深圳某知名开发商的总监级职位。后来辞职创业，一直在朋友圈发他的创业内容，最近一条我有印象的是过年前发了一条说今年暂时不发资金，送给团队一副对联鼓励一下，对联的内容无非是鸡汤鸡血一类。</span><br><span class="line"></span><br><span class="line">太多太多这样的例子，总结起来，在我的小学中学大学同学中，如今还在私企打工的，已经是少数派。当年我们大学毕业时，想的都是找个好工作，觉得上班挣钱做白领是理所当然的事。如今只过去十年，已经没几个所谓的白领了。他们都去哪了？</span><br><span class="line"></span><br><span class="line">李中堂提倡的“大众创业”在虎扑似乎一向是被批判被嘲笑的，但事实上在中国，一直都是大众创业，不管你是开个小点还是摆个小摊，不需要谁来提倡，到<span class="number">35</span>岁或者更早一些时候，你就会发现，真的没法再打工了，就算自己还想打工也没人要了。自古写字楼如青楼，不许楼里见白头。</span><br><span class="line"></span><br><span class="line">而那些年轻时打了鸡血以熬夜通宵为荣的白领们，恐怕到不了应当白头的年龄，就已经白发苍苍了吧？</span><br><span class="line"></span><br><span class="line">别再想着房价了，好好想想<span class="number">35</span>岁以后你还能干嘛，还能去哪吧？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">当你谈论中年危机的时候，你该看看这个男人! </span><br><span class="line"></span><br><span class="line">已过<span class="number">45</span>岁的刘备寄居在刘表帐下，有一次上厕所，看见自己大腿上的肉又长了出来，不禁慨然流涕。</span><br><span class="line"></span><br><span class="line">返回座位后，刘表见他脸上带有泪痕，便问其故。</span><br><span class="line"></span><br><span class="line">原来不是他的瘦腿效果又反弹了。</span><br><span class="line"></span><br><span class="line">他说，我以前总骑在马上，大腿上的肉都磨没了，现在骑得少了，就又长了出来。时光飞逝，我快要老去了，而事业却还没有建立，所以很难过【吾常身不离鞍，髀肉皆消。今不复骑，髀里肉生。日月若驰，老将至矣，而功业不建，是以悲耳】。</span><br><span class="line"></span><br><span class="line"><span class="number">45</span>岁，人生早已跨入中年，在圈内素有“枭雄”之称的刘备仍旧一事无成。</span><br><span class="line"></span><br><span class="line">便连罗贯中都在《三国志演义》的小说中借水镜先生之口调侃他道，我早听说刘先生的大名，为什么到现在都还没成功呢【吾久闻明公大名，何故至今犹落魄不偶耶】？</span><br><span class="line"></span><br><span class="line">可以想见的是，刘备在刘表处每天打卡上班，周围也一定还有不少人是抱有这样的想法或是投来如此的目光的。</span><br><span class="line"></span><br><span class="line">之前他也不是没有过机会，但离成功总差一步之遥。</span><br><span class="line"></span><br><span class="line">投靠公孙瓒，公孙瓒被袁绍吞并；</span><br><span class="line"></span><br><span class="line">帮助陶谦，陶谦为曹操击破；</span><br><span class="line"></span><br><span class="line">接纳吕布，反被吕布端掉老巢；</span><br><span class="line"></span><br><span class="line">终于摆脱曹操独立，却又被曹操突袭致败；</span><br><span class="line"></span><br><span class="line">不得已转投袁绍，袁绍又在官渡折戟……</span><br><span class="line"></span><br><span class="line">后来放眼北方之大，竟已无自己的立足之地。</span><br><span class="line"></span><br><span class="line">无奈他只得再南投刘表。</span><br><span class="line"></span><br><span class="line">于是他的处境益发不利：一面是公司日渐壮大、事业蒸蒸日上的宿敌——曹操，一面是表面尊崇却暗中设防的刘表。</span><br><span class="line"></span><br><span class="line">建安<span class="number">13</span>年，刘备<span class="number">47</span>岁，曹操大军南征。</span><br><span class="line"></span><br><span class="line">这时刘表已死，小儿子刘琮继位，荆州“有识之士”无不认为这是一场泰山压卵，结局注定的战争。</span><br><span class="line"></span><br><span class="line"><span class="number">47</span>岁的刘备，人生走到了一个致命的关口，堪称危机中的危机。</span><br><span class="line"></span><br><span class="line">然而他除了平时偶尔“慨然”，“流涕”一下，并不曾向曹操屈服，也不曾向命运低头。</span><br><span class="line"></span><br><span class="line">他虽号称是汉景帝之子中山靖王之后的汉室宗亲，可那会儿是在西汉，眼下都已是东汉末年了，你们知道刘家过了多少代，又生了多少儿孙？</span><br><span class="line"></span><br><span class="line">他的爷爷刘雄不过是个小县令，爸爸刘弘更只是个不入流的公务员，或许连科级都没混上便已死了，撇下孤儿寡母两个人，相依为命，只能摆摆地摊，做个小生意糊口【贩履织席】，连学业都是在亲戚的资助下勉强完成的。</span><br><span class="line"></span><br><span class="line">碰巧赶上创业大潮，好不容易才遇见两个风险投资人看上他的策划书，决定给他来一个“天使轮”。</span><br><span class="line"></span><br><span class="line">以后他走的每一步几乎都是靠自己。</span><br><span class="line"></span><br><span class="line">很多时候，他肯定不止一次地暗自羡慕过曹操，羡慕他有一个好家世，有一个既是首长又是首富的爹，年纪轻轻便是国家重点培养的“西园八校尉”之一，混迹的都是像桥玄、许劭等这样上层名流社会的场子，出入的都是像袁绍、袁术等这样“四世三公”的官N代小伙伴。</span><br><span class="line"></span><br><span class="line">不惧权贵，一言不合就脱出体制外；再不合人爹就给砸个五亿，开始创业；手头资源异常丰富，且不说姓曹、姓夏侯的亲戚一抓一大把，亲朋好友那也是要多少有多少。</span><br><span class="line"></span><br><span class="line">更要命的是曹操还比他能干，“机权干略”什么的全比不上曹操。</span><br><span class="line"></span><br><span class="line">便连曹操的秘书【丞相掾赵戬】都说，刘备不懂业务，每战必败，逃跑都来不及，还想着兼并别人【（刘备）拙于用兵，每战则败，奔亡不暇，何以图人】</span><br><span class="line"></span><br><span class="line">不光是曹操，东吴的孙权也是，年纪轻轻，<span class="number">18</span>岁便继承了父兄基业，坐领江东六郡八十一州，可以说刘备奋斗了一辈子所到的位置，孙权一生下来，其实就坐在那儿了。</span><br><span class="line"></span><br><span class="line">照着这种优劣势，刘备似乎注定是完败的，还奋斗个什么劲儿啊？</span><br><span class="line"></span><br><span class="line">可他偏不，偏不认命。</span><br><span class="line"></span><br><span class="line">家世、老爸、才干、运气这些他都拼不了，他唯一能拼的就是这个“拼”字。</span><br><span class="line"></span><br><span class="line">而且不但要拼，还要折而不挠，致死不休。</span><br><span class="line"></span><br><span class="line">当他三顾茅庐，终于见到孔明之时，他说，我不自量力，想创立一番事业，但才干欠缺，到现在都没有成就，然而志向未泯【孤不度德量力，欲信大义于天下，而智术短浅，讫无所就，然志犹未已】。</span><br><span class="line"></span><br><span class="line">你当这只是他随便说说而已么？</span><br><span class="line"></span><br><span class="line">不是。</span><br><span class="line"></span><br><span class="line">这实实在在是他自己的真情流露。他太想成功了，太想有一个像孔明这样的达人来给他指点迷津，答疑解惑。</span><br><span class="line"></span><br><span class="line">你们说他好哭，那是你们不懂他的泪水，有时候真的是需要一场发泄。</span><br><span class="line"></span><br><span class="line"><span class="number">47</span>岁的刘备面临灭顶之灾的中年危机，虽然这次他仍败得很惨，正像小说中张昭、虞翻所说的“弃新野，走樊城”，“军败于当阳，计穷于夏口”，“望风逃窜”，“几无容身之地”。</span><br><span class="line"></span><br><span class="line">诸葛亮说他“别有良图”，那纯属是胡扯，不过是在为他老板掩饰，但当孙权问道刘备为何不降曹操之时，诸葛亮说刘备不可能连田横都不如，所以宁死不降。</span><br><span class="line"></span><br><span class="line">这却是刘备的实情。</span><br><span class="line"></span><br><span class="line">刘备这种“折而不挠”的精神被《三国志》的作者陈寿给予了高度的评价。</span><br><span class="line"></span><br><span class="line">凡事只要有一线之机，他就绝不轻言放弃，绝不低头，绝不屈服。</span><br><span class="line"></span><br><span class="line">当年曹操远向乌桓拓展业务之时，刘备就曾敏锐地给刘表献计，让他起兵偷袭许都，但刘表的眼中就只有自己的那“一亩三分地”，像刘表这样“外宽内忌”、“好谋无决”的“坐谈客”自然是只能错失良机。</span><br><span class="line"></span><br><span class="line">事后，刘表追悔不已，刘备却这样说，现在天下大乱，机会是不会没有的，只要下次抓住机会，这次也就没什么遗憾的【今天下分裂，日寻干戈，事会之来，岂有终极乎？若能应之于后者，则此未足为恨也。】。</span><br><span class="line"></span><br><span class="line">就像你错过了<span class="number">90</span>年代的PC互联网，错过了QQ、错过了淘宝，错过了人人网；当移动互联网的机会来临时，你又错过了微博，错过了微信，错过了微商；甚至当O2O再降临时，你又错过了外卖、错过了滴滴，错过了支付……</span><br><span class="line"></span><br><span class="line">每当房价横盘已久，准备飞涨之时；每当股票熊市已久，准备牛起之时……</span><br><span class="line"></span><br><span class="line">你都错过了，那么不要紧，“机会是不会没有的”。</span><br><span class="line"></span><br><span class="line">你觉得他是在安慰刘表么？</span><br><span class="line"></span><br><span class="line">刘表也不过是说说而已。</span><br><span class="line"></span><br><span class="line">他更大的程度上是在安慰自己，鼓励自己，也是在提醒自己，一个像自己这样四十多岁的中年人只要肯努力，不停奋斗，折而不挠，就一定还有机会，那所谓的中年危机，其实也没什么好担心的。</span><br><span class="line"></span><br><span class="line">要知东汉社会阶层固化得比今天更严重，而作为贩履织席之徒的刘备都不轻言放弃，百折不挠，终于实现志向，所以当你们今天在谈论中年危机的时候，是否该回头去看看东汉末年的这个男人，和他奋斗的一生？</span><br></pre></td></tr></table></figure>

<h1 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h1><p>课程内容</p>
<blockquote>
<p>Web工作原理介绍<br>Http协议基础<br>Http协议Request讲解<br>Http协议Response讲解<br>Http状态码<br>Http消息报头<br>Cookie<br>Session</p>
</blockquote>
<h2 id="报头"><a href="#报头" class="headerlink" title="报头"></a>报头</h2><p>web工作原理（1）<br><a href="http://127.0.0.1：8081/ecshop/" rel="external nofollow noreferrer">http://127.0.0.1：8081/ecshop/</a><br>user.php<br>http-协议类型<br>127.0.0.1-主机名：域名和IP等价<br>8081-端口号：端口管理由TCP协议完成，而不是HTTP协议<br>ecshop/user-页面文件<br>附件部分：<br>URL地址参数（也是最容易出问题的地方）</p>
<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623222820234.png" alt="image-20210623222820234"></p>
<p>web工作原理（2）</p>
<p>浏览器与服务器之间的交互就是由请求（Request）和响应（Response）组成，使用标准的HTTP协议（Hyper Text Transfer Protocol-<br>超文本传输协议）来进行请求的发送和响应</p>
<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623223017868.png" alt="image-20210623223017868"></p>
<p>http协议</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>HTTP是Hyper Text Transfer Protocol（超文本传输协议）的缩写，基于TCP/IP协议的应用层协议。它不涉及数据包（packet）传输，主要规定了客户端和服务器之间的通信格式，默认使用<span class="number">80</span>端口。</span><br><span class="line"><span class="number">2.</span>HTTP协议永远都是客户端发起请求，服务器回送响应</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623223153619.png" alt="image-20210623223153619"></p>
<p>http在TCP/IP协议栈中的位置</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>HTTP协议通常承载于TCP协议之上，有时也承载于TLS或SSL协议层之上，这个时候，就成了我们常说的HTTPS </span><br><span class="line"><span class="number">2.</span>HTTPS是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623223329920.png" alt="image-20210623223329920"></p>
<p>Http协议主要特点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">支持客户/服务器模式</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">简单快速：客户向服务器请求服务时，只需传递请求方法和路径</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">灵活：HTTP允许传输任意类型的数据对象。传输类型由Content-Type加以标记</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">无连接：无连接的含义是限制每次连接只处理一个请求，服务器处理完客户的请求，并收到客户的应答后，即断开连接</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">无状态：HTTP协议是无状态协议，协议对于事务处理无记忆能力</span></span><br></pre></td></tr></table></figure>

<p>Http之URL详解</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP <span class="built_in">URL</span>（包含了用于查找某个资源的足够的信息）格式子下：</span><br><span class="line"><span class="keyword">http</span>:/host[<span class="string">"："</span>portllabs pathl </span><br><span class="line"><span class="keyword">http</span>：表示要通过HTTP协议来定位网络资源host：表示合法的Internet主机域名或者P地址port：指定一个端口号，为空则使用缺省端口<span class="number">80</span></span><br><span class="line"><span class="built_in">abs</span> path：指定请求资源的URI，必须以/的形式给出</span><br></pre></td></tr></table></figure>

<p>URL举例</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//mp.weixin.qq.com/s?_biz=MjM5MzIzODE5Nw==&amp;mid=401472582&amp;idx=1&amp;sn=56e8f0106e43a85663353cf9a3a96f1d#wechat_redirect</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>协议类型：http</span><br><span class="line"><span class="number">2.</span>Host:mp.weixin.qq.com</span><br><span class="line"><span class="number">3.</span>Port：默认端口是<span class="number">80</span>，这种情况下端口号可以省略</span><br><span class="line"><span class="number">4.</span>path:/s</span><br><span class="line"><span class="number">5.</span>分隔符：？</span><br><span class="line"><span class="number">6.</span>参数：biz=MjM5MzIzODE5Nw==</span><br><span class="line"><span class="number">7.</span>参数分隔符：&amp;</span><br></pre></td></tr></table></figure>

<p>Http协议请求（Request）</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">http</span>请求由三部分组成，分别是请求行、消息报头、请求|</span><br><span class="line">正文</span><br><span class="line">请求行：</span><br><span class="line">	一个方法符合开头，以空格分开，后面跟着请求的URI和协议的版本。</span><br><span class="line">例如：POST/index.php HTTP/<span class="number">1.1</span>（<span class="literal">CRLF</span>）</span><br><span class="line">其中POST表示请求方法；/index.php是请求的<span class="built_in">URL</span>；HTTP/<span class="number">1.1</span>表示请求的HTTP协议版本；<span class="literal">CRLF</span>表示回车或者换行</span><br></pre></td></tr></table></figure>

<p>Http请求方法</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">请求方法（所有方法全文大写），各个解释如下：</span><br><span class="line">&gt;<span class="keyword">GET</span>请求获取<span class="built_in">Request</span>-URI所标识的资源</span><br><span class="line">&gt;POST在<span class="built_in">Request</span>-URI所标识的资源后附加新的数据</span><br><span class="line">&gt;HEAD请求获取由<span class="built_in">Request</span>-URI所标识的资源的响应消息报头</span><br><span class="line">&gt;PUT请求服务器存储一个资源，并用<span class="built_in">Request</span>-URI作为其标识</span><br><span class="line">&gt;DELETE 请求服务器删除<span class="built_in">Request</span>-URI所标识的资源</span><br></pre></td></tr></table></figure>

<p>Get的请求</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">Get</span>是用来从服务器上获得数据，<span class="keyword">Get</span>传输的数据量小，这主要是因为|</span><br><span class="line">受<span class="keyword">URL</span>长度限制。</span><br><span class="line">&gt;<span class="keyword">Get</span>将表单中数据的按照variable=value的形式，添加到action所指向的<span class="keyword">URL</span>后面，并且两者使用“？”连接，而各个变量之间使用“&amp;”连接Post是将表单中的数据放在form的数据体中，按照变量和值相对应的方式，传递到action所指向<span class="keyword">URL</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623224110616.png" alt="image-20210623224110616"></p>
<p>Post请求</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">Post</span>是用来向服务器上传递数据，<span class="keyword">Post</span>可以传输大量的数据，所以在上传文件只能使用<span class="keyword">Post</span>，<span class="keyword">Post</span>的所有操作对用户来说都是不可见的</span><br><span class="line">&gt;<span class="keyword">Post</span>是将表单中的数据放在<span class="keyword">form</span>的数据体中，按照变量和值相对应的方式，传递到action所指向URL</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623224157005.png" alt="image-20210623224157005"></p>
<p>Http消息报头</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP消息由客户端到服务器的请求和服务器到客户端的响应组成。请求消息和响应消息都是由开始行（对于请求消息，开始行就是请求行，对于响应消息，开始行就是状态行），消息报头（可选），空行（只有CRLF的行），消息正文（可选）组成。</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">Http消息报头包括：</span></span><br><span class="line">普通报头、</span><br><span class="line">请求报头、</span><br><span class="line">响应报头、</span><br><span class="line">实体报头。</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">每一个报头域都是由名字<span class="string">":"</span>+空格+值 组成，消息报头域的名字是大小写无关的。</span></span><br></pre></td></tr></table></figure>

<p>Http普通报头</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">有少数报头域用于所有的请求和响应消息，用于传输的消息</span><br><span class="line">&gt;Cache-Control用于指定缓存指令，缓存指令是单向的，且是独立的请求时的缓存指令包括：<span class="keyword">no</span>-cache、<span class="keyword">no</span>-store、<span class="built_in">max</span>-age、<span class="built_in">max</span>-stale、mint fresh、<span class="keyword">only</span>-<span class="keyword">if</span>-cached</span><br><span class="line">&gt;响应时的缓存指令包括：public、private、<span class="keyword">no</span>-cache、<span class="keyword">no</span>-</span><br><span class="line">storetransform、must-revalidate、proxy-revalidate、<span class="built_in">max</span>-age、s-</span><br><span class="line">maxage.</span><br><span class="line">&gt;Date普通报头域表示消息产生的日期和时间</span><br><span class="line">&gt;Connection普通报头域允许发送指定连接的选项。例如指定连接是连续，或者指定“<span class="keyword">close</span>”选项，通知服务器，在响应完成后，关闭连接</span><br></pre></td></tr></table></figure>

<p>http请求报头</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">请求报头允许客户端向服务器端传递请求的附加信息以及容户端自身的信息</span><br><span class="line">&gt;<span class="keyword">Accept</span> 请求报头域用于指定客户端接受哪些类型的信息。</span><br><span class="line">eg:<span class="keyword">Accept</span>:image/gif，表明客户端希望接受GIF图象格式的资源；<span class="keyword">Accept</span>:text/html，表明客户端希望接受html文本</span><br><span class="line">&gt;<span class="keyword">Accept</span>-Charset 请求报头域用于指定客户端接受的字符集。</span><br><span class="line">eg:<span class="keyword">Accept</span>-Charset:iso-<span class="number">8859</span>-<span class="number">1</span>，gb2312.如果在请求消息中没有设置这个域，缺省是任何字符集都可以接受</span><br></pre></td></tr></table></figure>

<p>http请求报头</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">Accept</span>-Encoding 请求报头域类似于<span class="keyword">Accept</span>，但是它是用于指定可接受的内容编码。</span><br><span class="line">eg:<span class="keyword">Accept</span>-Encoding:gzip.deflate.如果请求消息中没有设置这个域服务器假定客户端对各种内容编码都可以接受。</span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">Accept</span>-Language请求报头域类似于<span class="keyword">Accept</span>，但是它是用于指定一种自然语言。</span><br><span class="line">eg:<span class="keyword">Accept</span>-Language:zh-cn.如果请求消息中没有设置这个报头域，服务器假定客户端对各种语言都可以接受</span><br></pre></td></tr></table></figure>

<p>Http请求报头</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;Authorization 请求报头域主要用于证明客户端有权查看某个资源。当浏览器访问一个页面时，如果收到服务器的响应代码为<span class="number">401</span>（未授权），可以发送一个包含Authorization请求报头域的请求，要求服务器对其进行验迹</span><br><span class="line">&gt;Host（发送请求时，该报头域是必需的）<span class="keyword">e</span><span class="variable">g:http</span>://www.guet.edu.<span class="keyword">cn</span>/<span class="built_in">index</span>.html该URL中包含Host 请求报头域，如下：Hos<span class="variable">t:www</span>.guet.edu.<span class="keyword">cn</span>此处使用缺省端口号<span class="number">80</span>，若指定了端口号，则变成：</span><br><span class="line">Hos<span class="variable">t:www</span>.guet.edu.<span class="keyword">cn</span>：指定端口号</span><br></pre></td></tr></table></figure>

<p>http请求报头</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;User-Agent请求报头域允许客户端将它的操作系统、浏览器和其它属|</span><br><span class="line">性告诉服务器。</span><br><span class="line">&gt;Host请求报头域主要用于指定被请求资源的Internet主机和端口号，它|</span><br><span class="line">通常从HTTPURL中提取出来的</span><br><span class="line">&gt;Connection：表示是否需要持久连接。Keep-Alive持久连接</span><br><span class="line">&gt;Cookie：最重要的请求头之一，将cookie的值发送给HTTP服务器。</span><br><span class="line"></span><br><span class="line">Request Headers</span><br><span class="line">CONNECT mm. taobao. com:443 HTTP/1.1</span><br><span class="line">Client </span><br><span class="line">	Uera-Agent: MoZilla/50(Winows NT 6.1;WOW64) Applewebi/57.536(HTIL, like Geko) Chrome/51.7074. </span><br><span class="line">Transport </span><br><span class="line">	Connection: kepaive </span><br><span class="line">	Host: www. tabao. com:443</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623224942795.png" alt="image-20210623224942795"></p>
<h2 id="接口测试"><a href="#接口测试" class="headerlink" title="接口测试"></a>接口测试</h2><p>接口的概述</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">接口泛指实体把自己提供给外界的一种抽象方法（可以为一实体），用以由内部操作分离出外部沟通方法，使其在储改内部时不影响外界其他实体与其交互的方式。</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623225202628.png" alt="image-20210623225202628"></p>
<p>电脑等信息机器软件组件间的接口叫软件接口。</p>
<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623225227545.png" alt="image-20210623225227545"></p>
<p>电脑等信息机器硬件组件间的接口叫硬件接口。</p>
<p>接口的定义</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">接口是指系统模块与模块或系统与系统间进行交互，一般现在我们用的多的是基于HITTP协议为基础的接口（包括WebService协议），除此之外还有RPC的接口，但不管是哪种揍口，其本质就是发送一个<span class="built_in">Request</span>报文给服务器，然后服务器响应返回一个<span class="built_in">Response</span>报文。</span><br><span class="line"></span><br><span class="line">注：这里接口特指软件接口</span><br></pre></td></tr></table></figure>

<p>接口的分类</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; HTTP接口、Web Service接口</span><br><span class="line"><span class="deletion">-基于某种网络服务提供的接口</span></span><br><span class="line"></span><br><span class="line">&gt; API接口</span><br><span class="line"><span class="deletion">-应用程序编程接口</span></span><br><span class="line"><span class="deletion">-不一定通过网络提供编程服务接口</span></span><br></pre></td></tr></table></figure>

<p>容易产生的误区</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">我们通常讨论的接口，一般是指基于TCP/P传输的http协议</span></span><br><span class="line"></span><br><span class="line">误区：</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">接口测试并不仅限于HTTP接口</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">API接口测试不等同于HTTP接口测试</span></span><br></pre></td></tr></table></figure>

<p>接口测试</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">接口测试是集成测试实现的一种方式，其实在集成测试中分为消息接口测试和代码接口测试两类。</span><br><span class="line"></span><br><span class="line">我们对<span class="built_in">Response</span>的报文进行分析，判断是否和我们发给服务器的<span class="built_in">Request</span>对应的返回相同，从而验证业务是否正确实现，这即是接口测试。</span><br></pre></td></tr></table></figure>

<p>接口测试分类</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">同层之间接口的调用，一个接口调用了其他接口比如service层会调用DAO层的接口，而应用层又会调用服务层提供的接口，一般会通过服务之间的调用，比如注册用）时，会先调用用户查询的服务，查看该用户是否已经注册。</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">外部系统与系统间的交互（调用第三方的接口）</span></span><br><span class="line">比如银行会提供接口供电子商务网站调用，支付宝会提供接口给第三方网站调用</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">各个子系统之间的交互</span></span><br><span class="line">比如订单系统需要调用商品系统、财务系统才能完成一次订单的购买</span><br></pre></td></tr></table></figure>

<p>其他测试技术的关联</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">自动化测试可以分为：UI层自动化和接口层自动化</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210624072535483.png" alt="image-20210624072535483"></p>
<p>其他测试技术的关联</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">性能测试可以分为：系统级性能测试和接口层性能测试</span><br><span class="line">安全测试：对于接口层和UI层都需要进行测试</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623230048834.png" alt="image-20210623230048834"></p>
<p>为什么做接口测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">为了保证系统的独立性，也为了使业务更加的独立，系统间的交互越来越多的使用接口（高内聚低耦合）。这时候对于传统测试人员需要等到系统集成后才能进行测试，不但很难确保测试的覆盖率（接口覆盖率），效率也非常低下，为了解决这两个问题，接口测试也应运而生了。</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">UI的错误相对来说是比较容易修正的，但是数据的错误</span></span><br><span class="line">（业务的错误）所带来的危害就大得多了，所以为了持续性的检查接口数据的准确性，通过在早期进行接口自动化测试，可以很好的发现定位问题。</span><br><span class="line">ОEo</span><br></pre></td></tr></table></figure>

<p>接口测试的适用范围及覆盖率</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;接口是系统与系统间或者模块与模块间的交互，任何数据都是有其意义的，如果在传输过程中丢失了或者发送了错误的数据，就会导致意外或者业务逻辑处理机制，进一<span class="number">4</span>发现存在的问题，并且为此付出很大的代价。</span><br><span class="line"></span><br><span class="line">&gt;所以任何接口都是应该经过测试，即有交互的地方，我们就要进行接口测试。首先要达到<span class="number">100</span>%的接口覆盖率，在有条件的情况下做到进一步的<span class="number">100</span>%需求对接口的映射及<span class="number">100</span>%的接口对代码的逻辑覆盖率</span><br></pre></td></tr></table></figure>

<p>接口测试目的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">核心：保证系统接口的功能正常</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">方式：持续集成</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">目的：提高测试效率，保证数据的准确性</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">文档：接口测试对接口定义文档要求很高，所有的接口数据类型及业务分支导致的报文返回结构是需要事先定义好的，所以要形成文档的习惯，以方便查阅，尽量减少团队与团队间的沟通成本</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">接口测试方法</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">可以通过编写脚本代码进行测试</span></span><br><span class="line">自己开发脚本</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">可以通过工具进行测试</span></span><br><span class="line">第三方工具：SoapUI、Jmeter可以</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">手工在浏览器进行测试</span></span><br><span class="line">辅助工具：Fiddler，PostMan，HttpWatch</span><br></pre></td></tr></table></figure>

<p>接口测试流程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">类似于功能测试，</span><br><span class="line">→需求讨论</span><br><span class="line">→评审需求</span><br><span class="line">→确定需求</span><br><span class="line">→产出接口定义</span><br><span class="line">→根据需求文档及接口定义设计测试用例（测试用例主要从业务场景，功能以及异常测试几个方面考虑）</span><br><span class="line">→评审用例</span><br><span class="line">→执行测试</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210623230552160.png" alt="image-20210623230552160"></p>
<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210624072648902.png" alt="image-20210624072648902"></p>
<p>接口文档的分析</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">手机号码归属地</span><br><span class="line">接口地址：http://apis.juhe.cn/mobile/<span class="keyword">get</span></span><br><span class="line">支持格式：<span class="type">json</span>/<span class="type">xml</span></span><br><span class="line">请求方式：<span class="keyword">get</span></span><br><span class="line">请求示例：http://apis.juhe.cn/mobile/<span class="keyword">get</span>?phone=<span class="number">13429667914</span>&amp;key=您申请的KEY</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>请求参数说明：</span><br><span class="line">名称		类型		必填		说明</span><br><span class="line">phone	<span class="type">int</span>			是		需要查询的手机号码或手机号码前<span class="number">7</span>位</span><br><span class="line">key		string		是		应用APPKEY（应用详细页查询）</span><br><span class="line">dtype 	string		否		返回数据的格式，<span class="type">xml</span>或<span class="type">json</span>，默认<span class="type">json</span></span><br></pre></td></tr></table></figure>

<p>接口测试用例设计（1）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">功能测试：接口是否满足了所提供的功能，相当于是正常情况测试，如果一个接口功能复杂时推荐对接口用例进行结构划分，这样子用例真有更好的可读性和维护性。</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">逻辑测试：逻辑测试严格讲应为单元测试，单元测试应保持内部逻辑的正确性，可单元测试和接口测试界限并不是那么清楚，所以我们也可以从给出的设计文档中考虑内部逻辑错误的分支情况和异常</span></span><br></pre></td></tr></table></figure>

<p>接口测试的用例设计（2）</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;输入参数测试：针对输入的参数进行测试接口有翻页时，页码与页数的异常值测试数据库的增删改查，比如一个<span class="built_in">post</span>按口操作完成后，通过列表页接口看下新的数据是否和刚才的<span class="built_in">post</span>一致每个接口入参的默认值、异常类型、非空校验接口返回的图片地址能否打开，图片尺寸是否符合需求</span><br><span class="line">当输出参数有联动性时，需要校验两参数的实际结束是否都符合实际需求</span><br></pre></td></tr></table></figure>

<p>接口测试用例设计（3）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">异常情况测试：接口实现是否对异常情况都进行了处理</span></span><br><span class="line">所有功能都要考虑兼容旧版本入参支持传多个值时，要考虑传的值的个数多的情况下，接口是否报错</span><br><span class="line">输出参数类型</span><br><span class="line">请求参数的边界值</span><br><span class="line">请求参数的必填项和可选项</span><br><span class="line">所有列表页接口必须考虑排序值</span><br></pre></td></tr></table></figure>

<p>接口测试用例编写</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">接口测试用例和单元或者系统的用例其实区别也不大，要说明调用的接口传递的数据以及应该对应返回的内容目可（其他属性根据具体情况添加）</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">通过接口测试文档了解以下信息。</span></span><br><span class="line">请求的URI</span><br><span class="line">请求的方式</span><br><span class="line">返回值内容</span><br><span class="line">状态码，接口测试用例要覆盖到每一种情况</span><br></pre></td></tr></table></figure>

<p>接口测试用例举例</p>
<table>
<thead>
<tr>
<th>测试用例编号</th>
<th>Interface_getSupportCityString_001</th>
</tr>
</thead>
<tbody><tr>
<td>接口方法名</td>
<td>getSupportCityString</td>
</tr>
<tr>
<td>接口地址</td>
<td><a href="http://webservice.webxml.com.cn/webServices/weatherWs.asnx" target="_blank" rel="noopener external nofollow noreferrer">http://webservice.webxml.com.cn/webServices/weatherWs.asnx</a></td>
</tr>
<tr>
<td></td>
<td>theRogionCode=31101</td>
</tr>
<tr>
<td></td>
<td>&lt;soap:Envelope xmlns:seap=”<a href="http://schemas.xmlsoap.org/soap/envelope" target="_blank" rel="noopener external nofollow noreferrer">http://schemas.xmlsoap.org/soap/envelope</a></td>
</tr>
<tr>
<td></td>
<td>xmins:xsi=”<a href="http://wwww.W3.org/2001/XMLSchema-ins" target="_blank" rel="noopener external nofollow noreferrer">http://wwww.W3.org/2001/XMLSchema-ins</a> tance</td>
</tr>
<tr>
<td></td>
<td>xmlns：xsi=”<a href="http://wwww.w3.org/2001/XMLSchema&quot;&gt;" target="_blank" rel="noopener external nofollow noreferrer">http://wwww.w3.org/2001/XMLSchema&quot;&gt;</a></td>
</tr>
<tr>
<td></td>
<td><a href="soap:Body" rel="external nofollow noreferrer">soap:Body</a></td>
</tr>
<tr>
<td></td>
<td><getSupportCityStringResponse xmlns="http://webXn1.com.cn/"></getSupportCityStringResponse></td>
</tr>
<tr>
<td></td>
<td><getSupportCityStringResult></getSupportCityStringResult></td>
</tr>
<tr>
<td>返回</td>
<td><string>北京，792</string></td>
</tr>
<tr>
<td></td>
<td><string>昌平，785</string></td>
</tr>
<tr>
<td></td>
<td><string>大兴，826</string></td>
</tr>
<tr>
<td></td>
<td><string>房山，827</string></td>
</tr>
<tr>
<td></td>
<td><string>怀柔，752</string></td>
</tr>
<tr>
<td></td>
<td><string>通州，3409K/string&gt;</string></td>
</tr>
<tr>
<td></td>
<td><string>朝阳，3408</string></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>响应指标</td>
<td>响应时间小于500ms</td>
</tr>
<tr>
<td>备注</td>
<td>通过SoapUI实现调用，断言返回条数是否为7条，并且第一条为792，返回类型为字符串</td>
</tr>
</tbody></table>
<p>接口测试常用的工具</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">切换host工具：<span class="keyword">SwitchHosts</span></span><br><span class="line"><span class="keyword">抓包工具：Fillder，WireShark，httpWatch等</span></span><br><span class="line"><span class="keyword">调试工具：firebug等</span></span><br><span class="line"><span class="keyword">辅助测试工具：Postman，HttpRequester等</span></span><br><span class="line"><span class="keyword">性能测试工具：Jmeter，Loadrunner，apache </span>ab等</span><br></pre></td></tr></table></figure>

<h2 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h2><p>Http协议响应（Response）</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;HTTP响应由三个部分组成，分别是状态行、消息报头、响应正文</span><br><span class="line">状态行格式如下：</span><br><span class="line">HTTP-Version Status-Code Reason-Phras，其中HTTP-Version表示服务器HTTP协议的版本Status-Code表示服务器发回的响应状态代码；例如：</span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br></pre></td></tr></table></figure>

<p>Http状态码</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">状态码由三位数字组成，第一个数字定义了响应的类别，分为<span class="number">5</span>种类型：</span><br><span class="line"><span class="number">1</span>xx：指示信息--表示请求已接收，继续处理</span><br><span class="line"><span class="number">2</span>xx：成功-表示请求已被成功接收、理解、接受</span><br><span class="line"><span class="number">3</span>xx：重定-要完成请求必须进行更进一步的操作</span><br><span class="line"><span class="number">4</span>xx：客户端错误-请求有语法错误或请求无法实现</span><br><span class="line">Sxx：服务器端错误-服务器未能实现合法的请求</span><br></pre></td></tr></table></figure>

<p>常见的状态码</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; 200 OK请求已成功，请求所希望的响应头或数据体将随此响应返回</span><br><span class="line">400 Bad Request语义有误，当前请求无法被服务器理解。除非进行修改，否则客户端不应该重复提交这个请求；请求参数有误</span><br><span class="line">403 Forbidden服务器已经理解请求，但是拒绝执行它4014 <span class="keyword">Not</span> Found请求失败，请求所希望得到的资源未被在服务器上发现</span><br><span class="line">&gt; 500 Internal<span class="built_in"> Server </span>Error服务器遇到了一个未曾预料的状况，导致了它无法完成对请求的处理。一般来说，这个问题都会在服务器端的源代码出现错误时出现。</span><br><span class="line">&gt;502 Bad Gateway作网关或者代理工作的服务器尝试执行请求时，从上游服务器接收到无效的响应。</span><br><span class="line">&gt;503<span class="built_in"> Service </span>Unavailable由于临时的服务器维护或者过载，服务器当前无法处理请求。</span><br></pre></td></tr></table></figure>

<p>Http响应报头</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">响应报头允许服务器传递不能放在状态行中的附加响应信息以及关于服务器的信息和对Request-URI所标识的资源进行下一步访问的信息。</span><br><span class="line">&gt;<span class="keyword">Location</span>响应报头域用于重定向接受者到一个新的位置。</span><br><span class="line"><span class="keyword">Location</span> 响应报头域常用在更换域名的时候。</span><br><span class="line">&gt;<span class="keyword">server</span>响应报头域包含了服务器用来处理请求的软件信息与<span class="keyword">User</span>-Agent请求报头域是相对应的</span><br><span class="line">eg: <span class="keyword">Server</span>: Apache-Coyote/<span class="number">1.1</span></span><br></pre></td></tr></table></figure>

<p>Http响应报头</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;WWW-Authenticate响应报头域必须被包含在<span class="number">401</span>（未授权的）响应消息中，客户端收到<span class="number">401</span>响应消息时候，并发送Authorization报头域请求服务器对其进行验证时，服务端响应报头就包含该报头域。</span><br><span class="line">eg：WWW-Authenticate:Basic realm=<span class="string">"Basic Auth Test！"</span></span><br><span class="line"><span class="comment">//可以看出服务器对请求资源采用的是基本验证机制。</span></span><br></pre></td></tr></table></figure>

<p>http响应报头</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Content-Type是返回消息中非常重要的内容，它标识出这个返回内容的类型，其值为“主类型/子类型”的格式，例如最常见的就是text/html，它的意思是说返回的内容是文本类型，这个文本又是HIML格式的</span></span><br><span class="line"><span class="string">Content-Type来决定如何显示返回的消息体内容</span></span><br><span class="line"></span><br><span class="line"><span class="string">Response</span> <span class="string">Headers：</span></span><br><span class="line"><span class="string">HTTP/1.</span> <span class="number">1</span> <span class="number">200</span> <span class="string">Connection</span> <span class="string">Established</span> </span><br><span class="line"><span class="string">Miscellaneous</span> </span><br><span class="line">	<span class="attr">ClientToSeryerBytes:</span> <span class="number">1669</span></span><br><span class="line">    <span class="attr">EndTime:</span> <span class="number">146</span><span class="string">:30.504</span></span><br><span class="line">    <span class="attr">FiddlerGateway: Direct ServerToClientBytes:</span> <span class="number">33290</span></span><br><span class="line">    <span class="attr">StartTime:</span> <span class="number">19</span><span class="string">:45:00.110</span></span><br><span class="line"><span class="string">Transport</span> </span><br><span class="line">	<span class="attr">Connection:</span> <span class="string">dose</span></span><br></pre></td></tr></table></figure>

<p>Http实体报头</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">请求和响应消息都可以传送一个实体。一个实体由实体报域和实体正文组成，但并不是说实体报头域和实体正文要一起发送，可以只发送实体报头域。实体报头定义了关于梁体正文（eg：有无实体正文）和请求所标识的资源的元信息</span><br><span class="line">&gt;Content-<span class="keyword">Encoding</span>实体报头域被用作媒体类型的修饰符，它的值指示了已经被应用到实体正文的附加内容的编码，因而要获得Content-<span class="keyword">Type</span>报头域中所引用的媒体类型，必须采用相应的解码机制。</span><br><span class="line"></span><br><span class="line">Content-<span class="keyword">Encoding</span>这样用于记录文档的压缩方法</span><br><span class="line">eg：Content-<span class="keyword">Encoding</span>：gzip</span><br></pre></td></tr></table></figure>

<p>Http实体报头</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;Content-<span class="keyword">Language</span>实体报头域描述了资源所用的自然语言没有设置该域则认为实体内容将提供给所有的语言阅读者eg：</span><br><span class="line">&gt;Content-<span class="keyword">Language</span>:gbk Content-Length实体报头域用于指明实体正文的长度，以字节方式存储的十进制数字来表示</span><br><span class="line">&gt;Content-lype实体报头域用语指明发送给接收者的实体正文的媒体类型。eg：</span><br><span class="line">Content-<span class="keyword">Type</span>:<span class="type">text</span>/html;charset<span class="number">-1</span>SO<span class="number">-8859</span><span class="number">-1</span></span><br><span class="line">Content-<span class="keyword">Type</span>:<span class="type">text</span>/html;charset-GB2312</span><br></pre></td></tr></table></figure>

<p>Cookie</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;Cookies是服务器在本地机器上存储的小段文本并随每一个请求发送至同一个服务器。网络服务器用HTTP头向客户端发送cookies，在客户终端，浏览器解析这些cookies并将它们保存为一个本地文件，它会自动将同一服务器的任何请求缚上这些cookies </span><br><span class="line">&gt;Cookie将状态保存在客户端，通过Cookies，服务器就可以清楚的知道请求<span class="number">2</span>和请求<span class="number">1</span>来自同一个客户端</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210624074021107.png" alt="image-20210624074021107"></p>
<p>JSON格式及在线解析</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="type">JSON</span>：JavaScript <span class="keyword">Object</span> &gt;Notation（JavaSeript对象表示法）</span><br><span class="line">&gt;<span class="type">JSON</span>是存储和交换文本信息的语法。类似<span class="type">XML</span>。</span><br><span class="line">&gt;<span class="type">JSON</span>比<span class="type">XML</span>更小、更快，更易解析。</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	"sites"： [&#123;</span><br><span class="line">			"name"：</span><br><span class="line">			"家之诺"，</span><br><span class="line">			"url"：</span><br><span class="line">			"www.haozhinuo.com</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			""</span><br><span class="line">			name "："</span><br><span class="line">			电话 "，</span><br><span class="line">			"telephone"：</span><br><span class="line">			"（025）83413826"</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			"name"：</span><br><span class="line">			"地址"，</span><br><span class="line">			"address"：</span><br><span class="line">			"南京市秦准区石鼓路98号阳光大厦H层F座"</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Session</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">Session</span>机制是一种服务器端的机制，服务器使用一种类似于散列表的结构来保存信息</span><br><span class="line">&gt;服务器给每个<span class="keyword">Session</span>分配一个唯一的JSESSIONID，并通过Cookie发t给客户端。当客户端发起新的请求的时候，将在Cookie头中携带这个JSESSIOND，这样服务器能够找到这个客户端对应的<span class="keyword">Session</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/2021-06-29-performance%5Cimage-20210624074146183.png" alt="image-20210624074146183"></p>
<p>WebService协议介绍</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> Web Service就是一个网络组件（一个可以通过网络访问的程序）</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">它有一个或多个端口（Port），这些端口用于接收客户端的请求，并返回响应</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">请求和响应的都是一种基于XML的消息。不过这种消息遵循特定的格式（SOAP）</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">每个Web Service都有一个描述文件（WSDL），它描述一个Web ervice的如下方面：</span></span><br><span class="line">（1）服务的端口（接收SOAP消息的端口）</span><br><span class="line">（2）服务提供的操作</span><br><span class="line">（3）操作的输入输出格式的定义（通过XMLSchema定义输入输出格式</span><br></pre></td></tr></table></figure>

<p>XML约束</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">XML指可扩展标记语言（EXtensible Markup Language）</span><br><span class="line">XML一种标记语言，很类似HTML </span><br><span class="line">XMI的设计宗旨是传输数据，而非显示数据</span><br><span class="line">XML标签没有被预定义。您需要自行定义标</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">to</span>&gt;</span>George<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">from</span>&gt;</span>John<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heading</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>Don' t forget the meeting!<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br></pre></td></tr></table></figure>
    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章推荐</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\06\29\performance\2021-06-29-performance\" rel="bookmark">performance</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div>赞赏一下吧～</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="tongsiying 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>tongsiying
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance%20-%20%E5%89%AF%E6%9C%AC/" title="performance">https://tongsiying.github.io/2021/06/29/performance/2021-06-29-performance - 副本/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/performance/" rel="tag"># performance</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/06/29/project/project_BlockStorage/2021-06-29-resume/" rel="prev" title="resume">
      <i class="fa fa-chevron-left"></i> resume
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/06/29/performance/2021-06-29-performance/" rel="next" title="performance">
      performance <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#性能测试"><span class="nav-text">性能测试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#java性能工具"><span class="nav-text">java性能工具</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#jvm内存快照dump文件太大，怎么分析"><span class="nav-text">jvm内存快照dump文件太大，怎么分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、场景"><span class="nav-text">1、场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、dump生成"><span class="nav-text">2、dump生成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、准备工作，下载LINUX的MAT"><span class="nav-text">3、准备工作，下载LINUX的MAT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、在linux执行分析命令"><span class="nav-text">4、在linux执行分析命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、打开分析报告"><span class="nav-text">5、打开分析报告</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#G1GC-概念与性能调优-jdk11"><span class="nav-text">G1GC 概念与性能调优 (jdk11)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#堆"><span class="nav-text">堆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-9-以后开启的参数"><span class="nav-text">Java 9 以后开启的参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#G1-的-GC-阶段"><span class="nav-text">G1 的 GC 阶段</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Young-Only-Phase"><span class="nav-text">Young Only Phase</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Mixed-gc-Phase"><span class="nav-text">Mixed gc Phase</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#g1gc-young-shrinking"><span class="nav-text">g1gc young shrinking</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#从-GC-log-了解与分析-gc"><span class="nav-text">从 GC log 了解与分析 gc</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CMS-执行"><span class="nav-text">CMS 执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#知识点"><span class="nav-text">知识点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CMS-阶段"><span class="nav-text">CMS 阶段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GC-触发条件"><span class="nav-text">GC 触发条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GC-异常点"><span class="nav-text">GC 异常点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#现象分析"><span class="nav-text">现象分析</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考4资料"><span class="nav-text">参考4资料</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#linux性能监控"><span class="nav-text">linux性能监控</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、CPU"><span class="nav-text">一、CPU</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、Memory"><span class="nav-text">二、Memory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、磁盘IO"><span class="nav-text">三、磁盘IO</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、Network-IO"><span class="nav-text">四、Network IO</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CPU"><span class="nav-text">CPU</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#内存"><span class="nav-text">内存</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IO"><span class="nav-text">IO</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#带宽"><span class="nav-text">带宽</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#其他"><span class="nav-text">其他</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#常用命令"><span class="nav-text">常用命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#路由和远程拷贝知识点"><span class="nav-text">路由和远程拷贝知识点</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#时间同步及设置ip"><span class="nav-text">时间同步及设置ip</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#跳板机"><span class="nav-text">跳板机</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#centos关闭防火墙"><span class="nav-text">centos关闭防火墙</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#rz命令安装"><span class="nav-text">rz命令安装</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#000Wireshark网络分析就这么简单"><span class="nav-text">000Wireshark网络分析就这么简单</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sss"><span class="nav-text">sss</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#接口"><span class="nav-text">接口</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#报头"><span class="nav-text">报头</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#接口测试"><span class="nav-text">接口测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#响应"><span class="nav-text">响应</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="tongsiying"
      src="/images/gutianle.gif">
  <p class="site-author-name" itemprop="name">tongsiying</p>
  <div class="site-description" itemprop="description">问渠那得清如许？为有源头活水来。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">427</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tongsiying" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tongsiying" rel="noopener external nofollow noreferrer" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wxtlucky1015@163.com" title="E-Mail → mailto:wxtlucky1015@163.com" rel="noopener external nofollow noreferrer" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/2964109344" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;2964109344" rel="noopener external nofollow noreferrer" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/" title="tongsiying → https:&#x2F;&#x2F;tongsiying.github.io"><i class="wrench fa-fw"></i>tongsiying</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/ReadingNotes/" title="ReadingNotes → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;ReadingNotes&#x2F;"><i class="book fa-fw"></i>ReadingNotes</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/blog/" title="blog → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;blog&#x2F;"><i class="book fa-fw"></i>blog</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/blog/tools/" title="tools → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;blog&#x2F;tools&#x2F;"><i class="wrench fa-fw"></i>tools</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/lanlan/" title="lanlan → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;lanlan&#x2F;"><i class="wrench fa-fw"></i>lanlan</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/Music/" title="note → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;Music&#x2F;"><i class="wrench fa-fw"></i>note</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/sound/" title="Music → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;sound&#x2F;"><i class="wrench fa-fw"></i>Music</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/JSONFormat/" title="JSONFormat → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;JSONFormat&#x2F;"><i class="wrench fa-fw"></i>JSONFormat</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/HTML5-Canvas/" title="Canvas → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;HTML5-Canvas&#x2F;"><i class="wrench fa-fw"></i>Canvas</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/games/" title="games → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;games&#x2F;"><i class="wrench fa-fw"></i>games</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/love/" title="love → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;love&#x2F;"><i class="wrench fa-fw"></i>love</a>
      </span>
  </div>



		<div style="">
  <canvas id="canvas" style="width:60%;">��ǰ�������֧��canvas������������������</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //����canvas�Ŀ���
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //�洢ʱ������
    var data = [];
    //�洢�˶���С��
    var balls = [];
    //�������Ӱ뾶
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //�洢ʱ�����֣���ʮλСʱ����λСʱ��ð�š�ʮλ���ӡ���λ���ӡ�ð�š�ʮλ���ӡ���λ������7���������
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*���ɵ�������*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*����ʱ��*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //ʱ�䷢���仯
            if(NewData[i] !== data[i]){
                //���仯������ֵ����data�����е������洢��changeNumArray������
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //����С��
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*����С��״̬*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*����Ҫ�˶���С��*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*��Ⱦ*/
    function render(){
        //���û������ȣ��ﵽ��ջ�����Ч��
        canvas.height = 100;
        //��Ⱦʱ��
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //��ȾС��
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //����ʱ��
        updateDigitTime();
        //����С��״̬
        updateBalls();
        //��Ⱦ
        render();
    },50);
}

})();
</script>
      </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; Weeny – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tongsiying</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">6.3m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">95:46</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
