<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/hedgehog.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/hedgehog.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tongsiying.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","b2t":true,"scrollpercent":true,"padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="awk">
<meta property="og:url" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/index.html">
<meta property="og:site_name" content="tongsiying">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/awk.png">
<meta property="og:image" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/awk.png">
<meta property="og:image" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112213438351-1369821830.png">
<meta property="og:image" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112222148579-1614259787.png">
<meta property="og:image" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112222235337-151983861.png">
<meta property="og:image" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112200659076-94256139.png">
<meta property="og:image" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112200031464-2042808281.png">
<meta property="og:image" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112203651293-933187876.png">
<meta property="og:image" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112213125719-1201347346.png">
<meta property="og:image" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112213254755-926278251.png">
<meta property="og:image" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112192701118-2049992323.png">
<meta property="og:image" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112191830840-1657613452.png">
<meta property="og:image" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/1576666-20210104235400018-2005811955.png">
<meta property="article:published_time" content="2007-01-11T10:37:19.000Z">
<meta property="article:modified_time" content="2022-01-24T13:40:27.036Z">
<meta property="article:author" content="tongsiying">
<meta property="article:tag" content="linux-文件管理">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/awk.png">

<link rel="canonical" href="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>awk | tongsiying</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
<!-- 加入APlayer音乐播放器 -->
<link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>
  <div class="container use-motion">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">tongsiying</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">阅读|运动|自律</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/catalog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-目录">

    <a href="/catalog/" rel="section"><i class="fa fa fa-th fa-fw"></i>目录</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-读书清单">

    <a href="/read" rel="section"><i class="fa fa-book fa-fw"></i>读书清单</a>

  </li>
        <li class="menu-item menu-item-读书笔记">

    <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="section"><i class="fa fa-book fa-fw"></i>读书笔记</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/gutianle.gif">
      <meta itemprop="name" content="tongsiying">
      <meta itemprop="description" content="问渠那得清如许？为有源头活水来。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tongsiying">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          awk
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2007-01-11 18:37:19" itemprop="dateCreated datePublished" datetime="2007-01-11T18:37:19+08:00">2007-01-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-24 21:40:27" itemprop="dateModified" datetime="2022-01-24T21:40:27+08:00">2022-01-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>27k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>24 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p class="description"></p>
<a id="more"></a>

<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>​     awk是linux下的一个命令，他对其他命令的输出，对文件的处理都十分强大，其实他更像一门编程语言，他可以自定义变量，有条件语句，有循环，有数组，有正则，有函数等。他读取输出，或者文件的方式是一行，一行的读，根据你给出的条件进行查找，并在找出来的行中进行操作，感觉他的设计思想，真的很简单，但是结合实际情况，具体操作起来就没有那么简单了。他有三种形势，awk，gawk，nawk，平时所说的awk其实就是gawk。 </p>
<p>​    awk是一个强大的文本分析工具，相对于grep的查找，sed的编辑，awk在其对数据分析并生成报告时，显得尤为强大。简单来说awk就是把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分再进行各种分析处理。</p>
<p>​    awk语言的最基本功能是在文件或者字符串中基于指定规则浏览和抽取信息，awk抽取信息后，才能进行其他文本操作。完整的awk脚本通常用来格式化文本文件中的信息。通常，awk是以文件的一行为处理单位的。awk每接收文件的一行，然后执行相应的命令，来处理文本。</p>
<p>​    逐行处理的意思就是说，当awk处理一个文本时，会一行一行进行处理，处理完当前行，再处理下一行，awk默认以”换行符”为标记，识别每一行，也就是说，awk跟我们人类一样，每次遇到”回车换行”，就认为是当前行的结束，新的一行的开始，awk会按照用户指定的分割符去分割当前行，如果没有指定分割符，默认使用空格作为分隔符。</p>
<p> <img src="/2007/01/11/linux/2007-01-11-linux-awk/awk.png" alt="11"> </p>
<img src="/2007/01/11/linux/2007-01-11-linux-awk/awk.png" class title="This is an example image">

<p>0表示显示整行，NF表示当前行分割后的最后一列（0和 0和0和NF均为内置变量）注意，NF和NF要表达的意思是不一样的，对于awk来说， $NF 和 NF 要表达的意思是不一样的，对于awk来说，$NF表示最后一个字段，NF表示当前行被分隔符切开以后，一共有几个字段。也就是说，假如一行文本被空格分成了7段，那么NF的值就是7，$NF的值就是$7, 而7表示当前行的第7个字段，也就是最后一列，那么每行的倒数第二列可以写为 7表示当前行的第7个字段，也就是最后一列，那么每行的倒数第二列可以写为7表示当前行的第7个字段，也就是最后一列，那么每行的倒数第二列可以写为(NF-1)。</p>
<h1 id="1-使用方法"><a href="#1-使用方法" class="headerlink" title="1.使用方法"></a>1.使用方法</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;pattern + action&#125;' &#123;filenames&#125;</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">awk 'pattern &#123;action&#125;' &#123;filenames&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">尽管操作可能会很复杂，但语法总是这样;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pattern 表示 AWK 在数据中查找的内容;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">action是在找到匹配内容时所执行的一系列命令;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">花括号（&#123;&#125;）不需要在程序中始终出现，但它们用于根据特定的模式对一系列指令进行分组;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pattern 要表示的正则表达式，用斜杠括起来。</span></span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">awk [-F|-f|-v] ‘BEGIN&#123;&#125; //&#123;command1; command2&#125; END&#123;&#125;’ file</span><br><span class="line">[-F|-f|-v]   大参数，-F指定分隔符，-f调用脚本，-v定义变量,可以进行变量的赋值及调用（调用不需要加$符） var=value</span><br><span class="line">'  '          	引用代码块</span><br><span class="line">BEGIN   		初始化代码块，在对每一行进行处理之前，初始化代码，主要是引用全局变量，设置FS分隔符</span><br><span class="line">//           	匹配代码块，可以是字符串或正则表达式</span><br><span class="line">&#123;&#125;           	命令代码块，包含一条或多条命令</span><br><span class="line">；          		多条命令使用分号分隔</span><br><span class="line">END      		结尾代码块，在对每一行进行处理之后再执行的代码块，主要是进行最终计算或输出结尾摘要信息</span><br></pre></td></tr></table></figure>

<p>注1：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">默认情况下，正则表达式的匹配工作在贪婪模式下，也就是说它会尽可能长地去匹配，比如某一行有字符串 abacb，如果搜索内容为 "a.*b" 那么会直接匹配 abacb这个串，而不会只匹配ab或acb。</span><br></pre></td></tr></table></figure>

<p>注2：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">所有的正则字符，如 [ 、* 、( 等，若要搜索 * ，而不是想把 * 解释为重复先前字符任意次，可以使用 \* 来转义。</span><br></pre></td></tr></table></figure>



<h1 id="2-变量"><a href="#2-变量" class="headerlink" title="2. 变量"></a>2. 变量</h1><table>
<thead>
<tr>
<th>特殊要点:</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>$0</td>
<td>表示整个当前行</td>
</tr>
<tr>
<td>$1</td>
<td>每行第一个字段</td>
</tr>
<tr>
<td>NF</td>
<td>字段数量变量</td>
</tr>
<tr>
<td>NR</td>
<td>每行的记录号，多文件记录递增</td>
</tr>
<tr>
<td>FNR</td>
<td>与NR类似，不过多文件记录不递增，每个文件都从1开始</td>
</tr>
<tr>
<td>\t</td>
<td>制表符</td>
</tr>
<tr>
<td>\n</td>
<td>换行符</td>
</tr>
<tr>
<td>FS</td>
<td>BEGIN时定义分隔符</td>
</tr>
<tr>
<td>RS</td>
<td>输入的记录分隔符， 默认为换行符(即文本是按一行一行输入)</td>
</tr>
<tr>
<td>~</td>
<td>匹配，与==相比不是精确比较</td>
</tr>
<tr>
<td>!~</td>
<td>不匹配，不精确比较</td>
</tr>
<tr>
<td>==</td>
<td>等于，必须全部相等，精确比较</td>
</tr>
<tr>
<td>!=</td>
<td>不等于，精确比较</td>
</tr>
<tr>
<td>&amp;&amp;</td>
<td>逻辑与</td>
</tr>
<tr>
<td>||</td>
<td>逻辑或</td>
</tr>
<tr>
<td>+</td>
<td>匹配时表示1个或1个以上</td>
</tr>
<tr>
<td>/[0-9][0-9]+/</td>
<td>两个或两个以上数字</td>
</tr>
<tr>
<td>/[0-9][0-9]*/</td>
<td>一个或一个以上数字</td>
</tr>
<tr>
<td>FILENAME</td>
<td>文件名</td>
</tr>
<tr>
<td>OFS</td>
<td>输出字段分隔符， 默认也是空格，可以改为制表符等</td>
</tr>
<tr>
<td>ORS</td>
<td>输出的记录分隔符，默认为换行符,即处理结果也是一行一行输出到屏幕</td>
</tr>
<tr>
<td>-F’[:#/]’</td>
<td>定义三个分隔符</td>
</tr>
</tbody></table>
<p>域就是列；</p>
<table>
<thead>
<tr>
<th>变 量</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>$n</td>
<td>当前记录的第n个字段，字段间由 FS分隔。</td>
</tr>
<tr>
<td>$0</td>
<td>完整的输入记录/整条记录</td>
</tr>
<tr>
<td>$1</td>
<td>当前行的第一个域</td>
</tr>
<tr>
<td>$NF</td>
<td>是number finally,表示最后一列的信息，跟变量NF是有区别的，变量NF统计的是每行列的总数</td>
</tr>
<tr>
<td>ARGC</td>
<td>命令行参数的数目。</td>
</tr>
<tr>
<td>ARGIND</td>
<td>命令行中当前文件的位置(从0开始算)。</td>
</tr>
<tr>
<td>ARGV</td>
<td>包 含命令行参数的数组/命令行参数排列</td>
</tr>
<tr>
<td>CONVFMT</td>
<td>数字转换格式(默认值为%.6g)</td>
</tr>
<tr>
<td>ENVIRON</td>
<td>环境变量关联数组/支持队列中系统环境变量的使用</td>
</tr>
<tr>
<td>ERRNO</td>
<td>最后一个系统错误的描述。</td>
</tr>
<tr>
<td>FIELDWIDTHS</td>
<td>字 段宽度列表(用空格键分隔)。</td>
</tr>
<tr>
<td>FILENAME</td>
<td>当前文件名/awk浏览的文件名</td>
</tr>
<tr>
<td>FNR</td>
<td>同 NR，但相对于当前文件/浏览文件的记录数</td>
</tr>
<tr>
<td>FS</td>
<td>字段分隔符(默认是任何空格)。/设置输入域分隔符，等价于命令行 -F选项</td>
</tr>
<tr>
<td>IGNORECASE</td>
<td>如 果为真，则进行忽略大小写的匹配。</td>
</tr>
<tr>
<td>NF</td>
<td>当前记录中的字段数/浏览记录的域的个数</td>
</tr>
<tr>
<td>NR</td>
<td>当前记录数/已读的记录数</td>
</tr>
<tr>
<td>OFMT</td>
<td>数字的输出格式(默认值是%.6g)。</td>
</tr>
<tr>
<td>OFS</td>
<td>输出字段分隔符(默认值是一个空格)/输出域分隔符</td>
</tr>
<tr>
<td>ORS</td>
<td>输出记录分隔符(默认值是一个换行符)/输出记录分隔符</td>
</tr>
<tr>
<td>RLENGTH</td>
<td>由 match函数所匹配的字符串的长度。</td>
</tr>
<tr>
<td>RS</td>
<td>记录分隔符(默认是一个换行符)/控制记录分隔符</td>
</tr>
<tr>
<td>RSTART</td>
<td>由 match函数所匹配的字符串的第一个位置。</td>
</tr>
<tr>
<td>SUBSEP</td>
<td>数组下标分隔符(默认值是\034)。</td>
</tr>
</tbody></table>
<h1 id="3-运算符"><a href="#3-运算符" class="headerlink" title="3. 运算符"></a>3. <strong>运算符</strong></h1><table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>= += -= <em>= /= %= ^= *</em>=</td>
<td>赋值</td>
</tr>
<tr>
<td>?:</td>
<td>C条件表达式</td>
</tr>
<tr>
<td>||</td>
<td>逻 辑或</td>
</tr>
<tr>
<td>&amp;&amp;</td>
<td>逻辑与</td>
</tr>
<tr>
<td>~ ~!</td>
<td>匹 配正则表达式和不匹配正则表达式</td>
</tr>
<tr>
<td>&lt; &lt;= &gt; &gt;= != ==</td>
<td>关 系运算符</td>
</tr>
<tr>
<td>空格</td>
<td>连接</td>
</tr>
<tr>
<td>+ -</td>
<td>加，减</td>
</tr>
<tr>
<td>* / &amp;</td>
<td>乘，除与求余</td>
</tr>
<tr>
<td>+ - !</td>
<td>一元加，减和逻辑非</td>
</tr>
<tr>
<td>^ ***</td>
<td>求幂</td>
</tr>
<tr>
<td>++ –</td>
<td>增加或减少，作为前缀或后缀</td>
</tr>
<tr>
<td>$</td>
<td>字 段引用</td>
</tr>
<tr>
<td>in</td>
<td>数组成员</td>
</tr>
</tbody></table>
<h1 id="4-awk的正则"><a href="#4-awk的正则" class="headerlink" title="4. awk的正则"></a>4. <strong>awk的正则</strong></h1><table>
<thead>
<tr>
<th>匹配符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>\Y</td>
<td>匹配一个单词开头或者末尾的空字符串</td>
</tr>
<tr>
<td>\B</td>
<td>匹配单词内的空字符串</td>
</tr>
<tr>
<td>&lt;</td>
<td>匹配一个单词的开头的空字符串，锚定开始</td>
</tr>
<tr>
<td>&gt;</td>
<td>匹配一个单词的末尾的空字符串，锚定末尾</td>
</tr>
<tr>
<td>\W</td>
<td>匹配一个非字母数字组成的单词</td>
</tr>
<tr>
<td>\w</td>
<td>匹配一个字母数字组成的单词</td>
</tr>
<tr>
<td>&#39;</td>
<td>匹配字符串末尾的一个空字符串</td>
</tr>
<tr>
<td>&#39;</td>
<td>匹配字符串开头的一个空字符串</td>
</tr>
</tbody></table>
<h1 id="5-字符串函数"><a href="#5-字符串函数" class="headerlink" title="5.字符串函数"></a>5.<strong>字符串函数</strong></h1><table>
<thead>
<tr>
<th>函数名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>sub</td>
<td>匹配记录中最大、最靠左边的子字符串的正则表达式，并用替换字符串替换这些字符串。如果没有指定目标字符串就默认使用整个记录。替换只发生在第一次匹配的 时候</td>
</tr>
<tr>
<td>gsub</td>
<td>整个文档中进行匹配</td>
</tr>
<tr>
<td>index</td>
<td>返回子字符串第一次被匹配的位置，偏移量从位置1开始</td>
</tr>
<tr>
<td>substr</td>
<td>返回从位置1开始的子字符串，如果指定长度超过实际长度，就返回整个字符串</td>
</tr>
<tr>
<td>split</td>
<td>可按给定的分隔符把字符串分割为一个数组。如果分隔符没提供，则按当前FS值进行分割</td>
</tr>
<tr>
<td>length</td>
<td>返回记录的字符数</td>
</tr>
<tr>
<td>match</td>
<td>返回在字符串中正则表达式位置的索引，如果找不到指定的正则表达式则返回0。match函数会设置内建变量RSTART为字符串中子字符串的开始位 置，RLENGTH为到子字符串末尾的字符个数。substr可利于这些变量来截取字符串</td>
</tr>
<tr>
<td>toupper和tolower</td>
<td>可用于字符串大小间的转换，该功能只在gawk中有效</td>
</tr>
</tbody></table>
<p>以test.txt作为处理对象，内容如下：</p>
<p><img src="/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112213438351-1369821830.png" alt="img"></p>
<h2 id="1-sub-gsub-替换"><a href="#1-sub-gsub-替换" class="headerlink" title="1. sub/gsub 替换"></a><strong>1. sub/gsub 替换</strong></h2><p>用法：<strong>sub/gsub(/str1/,str2,col)</strong></p>
<p>str1：要替换成的字符串（用两个正斜杠包裹）</p>
<p>str2：被替换的字符串</p>
<p>col：被处理的列（可省略代表处理当前行）</p>
<p>区别：sub之替换第一次出现的，gsub替换所有</p>
<p>例如替换test.txt文本第一行第一次出现/所有的双引号（”）为星号（*）：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 'NR==1&#123;sub(/<span class="string">"/,"</span>*");<span class="keyword">print</span> <span class="variable">$0&#125;</span>' <span class="keyword">test</span>.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112222148579-1614259787.png" alt="img"></p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 'NR==1&#123;gsub(/<span class="string">"/,"</span>*");<span class="keyword">print</span> <span class="variable">$0&#125;</span>' <span class="keyword">test</span>.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112222235337-151983861.png" alt="img"></p>
<h2 id="2-toupper-tolower-大-小写转换"><a href="#2-toupper-tolower-大-小写转换" class="headerlink" title="2. toupper/tolower 大/小写转换"></a><strong>2. toupper/tolower 大/小写转换</strong></h2><p>用法：<strong>toupper/tolower(col)</strong></p>
<p>col：被处理的列（不可省略）</p>
<p>例如把test.txt文本中第二行的”ApplE”按全大写、”baNaNa”按全小写输出：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 'NR==2&#123;<span class="keyword">print</span> toupper(<span class="variable">$1</span>);<span class="keyword">print</span> tolower(<span class="variable">$2</span>)&#125;' <span class="keyword">test</span>.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112200659076-94256139.png" alt="img"></p>
<h2 id="3-length-获取长度"><a href="#3-length-获取长度" class="headerlink" title="3. length 获取长度"></a><strong>3. length 获取长度</strong></h2><p>用法：<strong>length(col)</strong></p>
<p>col：被处理的列（可省略代表处理当前行）</p>
<p>例如获取test.txt文本第三行第一列的字段的长度：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 'NR==3&#123;<span class="keyword">print</span> <span class="built_in">length</span>(<span class="variable">$1</span>)&#125;' <span class="keyword">test</span>.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112200031464-2042808281.png" alt="img"></p>
<h2 id="4-substr-截取子串"><a href="#4-substr-截取子串" class="headerlink" title="4. substr 截取子串"></a><strong>4. substr 截取子串</strong></h2><p>用法：<strong>substr(col,startindex,len)</strong></p>
<p>col：被处理的列（不可省略）</p>
<p>startindex：要截取子串的起始下标（从1开始）</p>
<p>len：要截取子串的长度（值为正整数才有效）</p>
<p>例如截取test.txt文本第三行第二列的字段，从该字段下标为5的位置开始截取4个字符长度</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 'NR==<span class="number">3</span>&#123;print substr($<span class="number">2</span>,<span class="number">5</span>,<span class="number">4</span>)&#125;' test.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112203651293-933187876.png" alt="img"></p>
<h2 id="5-index-match-获取位置-第一次出现"><a href="#5-index-match-获取位置-第一次出现" class="headerlink" title="5. index/match 获取位置(第一次出现)"></a><strong>5. index/match 获取位置(第一次出现)</strong></h2><p>用法：<strong>index/match(col,str)</strong> </p>
<p>col：被处理的列（不可省略）</p>
<p>str：匹配的字符串/正则表达式</p>
<p>区别：index匹配的是字符串，match匹配的是正则表达式，此外针对match方法，awk还有两个内置变量RSTART、RLENGTH</p>
<p>RSTART：同index/match命令的返回值，正则表达式匹配的字符串在原列中第一次出现位置（下标从1开始，无匹配返回0）</p>
<p>RLENGTH：正则表达式匹配的字符串长度（无匹配返回-1）</p>
<p>例如获取test.txt文本中第四行匹配字符串”abc”的下标位置：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 'NR==4&#123;<span class="keyword">print</span> <span class="built_in">index</span>(<span class="variable">$0</span>,<span class="string">"abc"</span>)&#125;' <span class="keyword">test</span>.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112213125719-1201347346.png" alt="img"></p>
<p>获取test.txt文本中第四行匹配正则表达式”ab[cd]”的下标位置以及RSTART和RLENGTH值</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 'NR==4&#123;<span class="keyword">print</span> <span class="built_in">match</span>(<span class="variable">$0</span>,<span class="string">"ab[cd]"</span>)&#125;' <span class="keyword">test</span>.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112213254755-926278251.png" alt="img"></p>
<h2 id="awk常用场景"><a href="#awk常用场景" class="headerlink" title="awk常用场景"></a>awk常用场景</h2><p>（1）判断进程是否存在，若存在则杀死进程</p>
<p>例如查找nginx进程是否存在：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | <span class="keyword">grep</span> <span class="string">"nginx"</span> | <span class="keyword">grep</span> -v <span class="keyword">grep</span> | awk <span class="string">'NR==1&#123;print $2&#125;'</span> | xargs kill -<span class="number">9</span> &gt;<span class="regexp">/dev/</span><span class="keyword">null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>若能搜索到多个进程ID，去掉NR==1：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | <span class="keyword">grep</span> <span class="string">"nginx"</span> | <span class="keyword">grep</span> -v <span class="keyword">grep</span> | awk <span class="string">'&#123;print $2&#125;'</span> | xargs kill -<span class="number">9</span> &gt;<span class="regexp">/dev/</span><span class="keyword">null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>（2）针对输出结果为多行的命令获取指定字段</p>
<p>例如获取当前机器可用内存（M）：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">free</span> -m | awk <span class="string">'NR==2&#123;print <span class="variable">$3</span>&#125;'</span></span><br></pre></td></tr></table></figure>

<p><img src="/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112192701118-2049992323.png" alt="img"></p>
<p>例如获取机器上安装的java版本：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version <span class="number">2</span>&gt;&amp;<span class="number">1</span> | awk 'NR==<span class="number">1</span>&#123;gsub(/<span class="string">"/,"</span><span class="string">"); print $3&#125;'</span></span><br></pre></td></tr></table></figure>

<p><img src="/2007/01/11/linux/2007-01-11-linux-awk/1576666-20200112191830840-1657613452.png" alt="img"> </p>
<p> （3）获取当前目录的父目录名</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pwd</span> | awk -F <span class="string">"/"</span> <span class="string">'&#123;print <span class="variable">$NF</span>&#125;'</span></span><br></pre></td></tr></table></figure>

<p><img src="/2007/01/11/linux/2007-01-11-linux-awk/1576666-20210104235400018-2005811955.png" alt="img"></p>
<h2 id="最后注意点："><a href="#最后注意点：" class="headerlink" title="最后注意点："></a>最后注意点：</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">一、虽然可以通过<span class="meta">$0</span>作用当前行，但awk命令中涉及下标的都是从<span class="number">1</span>开始</span><br><span class="line">二、awk不会对处理文本的内容做修改</span><br><span class="line">三、所有awk内置方法名均为小写</span><br><span class="line">四、length、sub、gsub三个方法都可以省略最后一个参数，作用于当前行，相当于<span class="meta">$0</span>，比如length()的输出等同于length(<span class="meta">$0</span>)</span><br></pre></td></tr></table></figure>







<h1 id="6-数学函数"><a href="#6-数学函数" class="headerlink" title="6.数学函数"></a>6.<strong>数学函数</strong></h1><table>
<thead>
<tr>
<th>函数名</th>
<th>返回值</th>
</tr>
</thead>
<tbody><tr>
<td>atan2(x,y)</td>
<td>y,x 范围内的余切</td>
</tr>
<tr>
<td>cos(x)</td>
<td>余弦函数</td>
</tr>
<tr>
<td>exp(x)</td>
<td>求 幂</td>
</tr>
<tr>
<td>int(x)</td>
<td>取整</td>
</tr>
<tr>
<td>log(x)</td>
<td>自然对 数</td>
</tr>
<tr>
<td>rand()</td>
<td>随机数</td>
</tr>
<tr>
<td>sin(x)</td>
<td>正弦</td>
</tr>
<tr>
<td>sqrt(x)</td>
<td>平 方根</td>
</tr>
<tr>
<td>srand(x)</td>
<td>x是rand()函数的种子</td>
</tr>
<tr>
<td>int(x)</td>
<td>取 整，过程没有舍入</td>
</tr>
<tr>
<td>rand()</td>
<td>产生一个大于等于0而小于1的随机数</td>
</tr>
</tbody></table>
<h1 id="7-format的使用"><a href="#7-format的使用" class="headerlink" title="7. format的使用"></a>7. <strong>format的使用</strong></h1><p> 要点：<br>1、其与print命令的最大不同是，printf需要指定format；<br>2、format用于指定后面的每个item的输出格式；<br>3、printf语句不会自动打印换行符；\n</p>
<p>format格式的指示符都以%开头，后跟一个字符；如下：<br>%c: 显示字符的ASCII码；<br>%d, %i：十进制整数；<br>%e, %E：科学计数法显示数值；<br>%f: 显示浮点数；<br>%g, %G: 以科学计数法的格式或浮点数的格式显示数值；<br>%s: 显示字符串；<br>%u: 无符号整数；<br>%%: 显示%自身；</p>
<p>修饰符：<br>N: 显示宽度；<br>-: 左对齐；<br>+：显示数值符号； </p>
<h1 id="8-print"><a href="#8-print" class="headerlink" title="8.print"></a>8.print</h1><h2 id="print-是awk打印指定内容的主要命令"><a href="#print-是awk打印指定内容的主要命令" class="headerlink" title="print 是awk打印指定内容的主要命令"></a>print 是awk打印指定内容的主要命令</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;<span class="keyword">print</span>&#125;'  /etc/passwd   ==   awk '&#123;<span class="keyword">print</span> <span class="variable">$0&#125;</span>'  /etc/passwd  </span><br><span class="line"></span><br><span class="line">awk '&#123;<span class="keyword">print</span> <span class="string">" "</span>&#125;' /etc/passwd                                          </span><br><span class="line"><span class="comment">//不输出passwd的内容，而是输出相同个数的空行，进一步解释了awk是一行一行处理文本</span></span><br><span class="line"></span><br><span class="line">awk '&#123;<span class="keyword">print</span> <span class="string">"a"</span>&#125;'   /etc/passwd                                       </span><br><span class="line"><span class="comment">//输出相同个数的a行，一行只有一个a字母</span></span><br><span class="line"></span><br><span class="line">awk -F<span class="string">":"</span> '&#123;<span class="keyword">print</span> <span class="variable">$1&#125;</span>'  /etc/passwd </span><br><span class="line"></span><br><span class="line">awk -F: '&#123;<span class="keyword">print</span> <span class="variable">$1</span>; <span class="keyword">print</span> <span class="variable">$2&#125;</span>'   /etc/passwd   </span><br><span class="line"><span class="comment">//将每一行的前二个字段，分行输出，进一步理解一行一行处理文本</span></span><br><span class="line"></span><br><span class="line">awk  -F: '&#123;<span class="keyword">print</span> <span class="variable">$1</span>,<span class="variable">$3</span>,<span class="variable">$6&#125;</span>' OFS=<span class="string">"\t"</span> /etc/passwd       </span><br><span class="line"><span class="comment">//输出字段1,3,6，以制表符作为分隔符</span></span><br></pre></td></tr></table></figure>

<h2 id="输出最后一列"><a href="#输出最后一列" class="headerlink" title="输出最后一列"></a>输出最后一列</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">cat</span> col_print.txt  | awk <span class="string">'&#123;print <span class="variable">$NF</span> &#125;'</span></span><br></pre></td></tr></table></figure>

<h2 id="输出整行"><a href="#输出整行" class="headerlink" title="输出整行"></a>输出整行</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> <span class="string">'&#123;print <span class="variable">$0</span> &#125;'</span> col_print.txt</span><br></pre></td></tr></table></figure>

<h2 id="输出倒数第二列"><a href="#输出倒数第二列" class="headerlink" title="输出倒数第二列"></a>输出倒数第二列</h2><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat col_print.txt  | awk <span class="string">'&#123;print <span class="subst">$(NF-1)&#125;</span>'</span></span><br></pre></td></tr></table></figure>

<h2 id="输出共有多少列"><a href="#输出共有多少列" class="headerlink" title="输出共有多少列"></a>输出共有多少列</h2><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> col_print.txt  | awk <span class="string">'&#123;print  NF&#125;'</span></span><br></pre></td></tr></table></figure>

<h2 id="输出多列"><a href="#输出多列" class="headerlink" title="输出多列"></a>输出多列</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">cat</span>  col_print.txt | awk <span class="string">'&#123;print <span class="variable">$2</span>,<span class="variable">$3</span>&#125;'</span></span><br></pre></td></tr></table></figure>

<h2 id="添加自定义字段"><a href="#添加自定义字段" class="headerlink" title="添加自定义字段"></a>添加自定义字段</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> col_print.txt  |awk '&#123; <span class="keyword">print</span> <span class="string">"第一列:"</span><span class="variable">$1</span>,<span class="string">"第二列:"</span><span class="variable">$2</span> &#125;'</span><br></pre></td></tr></table></figure>

<h2 id="多分隔符的使用："><a href="#多分隔符的使用：" class="headerlink" title="多分隔符的使用："></a>多分隔符的使用：</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk -F <span class="string">"[/]"</span> 'NR == <span class="number">4</span> &#123;print $<span class="number">0</span>,<span class="string">"<span class="subst">\n</span>"</span>,$<span class="number">1</span>&#125;' /etc/passwd</span><br><span class="line">#这里以/为分隔符，多个分隔符利用[]然后在里面写分隔符即可</span><br></pre></td></tr></table></figure>





<h1 id="9-pattern"><a href="#9-pattern" class="headerlink" title="9.pattern"></a>9.pattern</h1><p> 接下来认识下一Pattern，也就是我们所说的模式先介绍AWK 包含两种特殊的模式：BEGIN 和 END。<br>BEGIN 模式指定了处理文本之前需要执行的操作;</p>
<p>END 模式指定了处理完所有行之后所需要执行的操作 ;</p>
<h2 id="begin-简单语法"><a href="#begin-简单语法" class="headerlink" title="begin 简单语法"></a>begin 简单语法</h2><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="symbol">'BEGIN</span>&#123; print <span class="string">"BEGIN"</span> &#125;' begin_test</span><br></pre></td></tr></table></figure>

<p>上述例子，虽然指定了begin_test文件作为输入源，但是在开始处理test文本之前，需要先执行BEGIN模式指定的”打印”操作。</p>
<h2 id="不添加输入文件"><a href="#不添加输入文件" class="headerlink" title="不添加输入文件"></a>不添加输入文件</h2><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="symbol">'BEGIN</span> &#123; print <span class="string">"BEGIN"</span>&#125;'</span><br></pre></td></tr></table></figure>

<p>而上面例子中，我们并没有给定任何输入来源，awk就直接输出信息了，因为，BEGIN模式表示，在处理指定的文本之前，需要先执行BEGIN模式中指定的动作，而上述示例没有给定任何输入源，但是awk还是会先执行BEGIN模式指定的”打印”动作，打印完成后，发现并没有文本可以处理，于是就只完成了”打印 BEGIN”的操作。</p>
<h2 id="begin-pattern-演示"><a href="#begin-pattern-演示" class="headerlink" title="begin +pattern 演示"></a>begin +pattern 演示</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> <span class="string">'BEGIN &#123;print “BEGIN” ,“BEGIN” &#125; &#123; print <span class="variable">$1</span>,<span class="variable">$2</span> &#125;'</span> col_print.txt</span><br></pre></td></tr></table></figure>

<h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2><p>可以看到，先处理完BEGIN 的内容，再打印文本里面的内容.<br>所以END模式也就一目了然了。 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk 'BEGIN &#123;print "BEGIN"&#125; &#123;print $1&#125; END&#123; print "END"&#125;' col_print.txt</span><br><span class="line"></span><br><span class="line">cat /etc/passwd | awk -F: 'BEGIN&#123;print "name, shell"&#125; &#123;print $1,$NF&#125; END&#123;print "hello  world"&#125;'</span><br></pre></td></tr></table></figure>

<p>查看最近登录最多的IP信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">last | awk '&#123;S[$3]++&#125; END&#123;for(a in S ) &#123;print S[a],a&#125;&#125;' |uniq| sort -rh</span><br></pre></td></tr></table></figure>

<p> 利用正则过滤多个空格 </p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ifconfig</span> |grep eth* | awk -F <span class="string">'[ ]+'</span> <span class="string">'&#123;print <span class="variable">$1</span>&#125;'</span></span><br></pre></td></tr></table></figure>

<p>上述示例中返回的结果 就像一张”报表”，有”表头” 、“表内容”、 “表尾”。我们通常将变量初始化语句（如 var=0 ）以及打印文件头部的语句放入BEGIN 语句块中。在 END{} 语句块中，往往会放入打印结果等语句.</p>
<h1 id="10-awk编程–变量和赋值"><a href="#10-awk编程–变量和赋值" class="headerlink" title="10.awk编程–变量和赋值"></a>10.awk编程–变量和赋值</h1><p>除了awk的内置变量，awk还可以自定义变量, awk中的循环语句同样借鉴于C语言，支持while、do/while、for、break、continue，这些关键字的语义和C语言中的语义完全相同。</p>
<p>统计某个文件夹下的大于100k文件的数量和总和</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ls -l|awk '&#123;if($5&gt;100)&#123;count++; sum+=$5&#125;&#125; &#123;print "Count:" count,"Sum: " sum&#125;'  </span><br><span class="line">【因为awk会轮询统计，所以会显示整个过程】</span><br><span class="line">ls -l|awk '&#123;if($5&gt;100)&#123;count++; sum+=$5&#125;&#125; END&#123;print "Count:" count,"Sum: " sum&#125;' </span><br><span class="line">【天界END后只显示最后的结果】</span><br><span class="line"></span><br><span class="line">备注：count是自定义变量。之前的action&#123;&#125;里都是只有一个print,其实print只是一个语句，而action&#123;&#125;可以有多个语句，以;号隔开</span><br></pre></td></tr></table></figure>

<p>统计显示/etc/passwd的账户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">awk -F: '&#123;count++;&#125; END&#123;print count&#125;' /etc/passwd</span><br><span class="line"></span><br><span class="line">cat /etc/passwd|wc -l</span><br><span class="line"></span><br><span class="line">awk -F ':' 'BEGIN &#123;count=0;&#125; &#123;name[count] = $1;count++;&#125;; END&#123;for (i = 0; i &lt; NR; i++) print i, name[i]&#125;' /etc/passwd</span><br></pre></td></tr></table></figure>





<h1 id="11-f指定脚本文件"><a href="#11-f指定脚本文件" class="headerlink" title="11..-f指定脚本文件"></a>11..-f指定脚本文件</h1><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">awk -f script.awk  <span class="keyword">file</span></span><br><span class="line">BEGIN&#123;</span><br><span class="line">FS=<span class="string">":"</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;<span class="keyword">print</span> <span class="variable">$1&#125;</span>               </span><br><span class="line"><span class="comment">//效果与awk -F":" '&#123;print $1&#125;'相同,只是分隔符使用FS在代码自身中指定</span></span><br><span class="line"> </span><br><span class="line">awk 'BEGIN&#123;X=0&#125; /^$/&#123; X+=1 &#125; END&#123;<span class="keyword">print</span> <span class="string">"I find"</span>,X,<span class="string">"blank lines."</span>&#125;' <span class="keyword">test</span> </span><br><span class="line">I find 4 blank lines.</span><br><span class="line"></span><br><span class="line"><span class="keyword">ls</span> -<span class="keyword">l</span>|awk 'BEGIN&#123;<span class="keyword">sum</span>=0&#125; !/^<span class="keyword">d</span>/&#123;<span class="keyword">sum</span>+=<span class="variable">$5&#125;</span> END&#123;<span class="keyword">print</span> <span class="string">"total size is"</span>,<span class="keyword">sum</span>&#125;'                    <span class="comment">//计算文件大小</span></span><br><span class="line"><span class="keyword">total</span> size is 17487</span><br></pre></td></tr></table></figure>

<h1 id="12-F指定分隔符"><a href="#12-F指定分隔符" class="headerlink" title="12.-F指定分隔符"></a>12.-F指定分隔符</h1><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$1</span> 指指定分隔符后，第一个字段，<span class="variable">$3</span>第三个字段， \t是制表符</span><br><span class="line">一个或多个连续的空格或制表符看做一个定界符，即多个空格看做一个空格</span><br><span class="line"></span><br><span class="line">awk -F<span class="string">":"</span> '&#123;<span class="keyword">print</span> <span class="variable">$1&#125;</span>'  /etc/passwd</span><br><span class="line">awk -F<span class="string">":"</span> '&#123;<span class="keyword">print</span> <span class="variable">$1</span> <span class="variable">$3&#125;</span>'  /etc/passwd            <span class="comment">//$1与$3相连输出，不分隔</span></span><br><span class="line">awk -F<span class="string">":"</span> '&#123;<span class="keyword">print</span> <span class="variable">$1</span>,<span class="variable">$3&#125;</span>'  /etc/passwd            <span class="comment">//多了一个逗号，$1与$3使用空格分隔</span></span><br><span class="line">awk -F<span class="string">":"</span> '&#123;<span class="keyword">print</span> <span class="variable">$1</span> <span class="string">" "</span> <span class="variable">$3&#125;</span>'  /etc/passwd          <span class="comment">//$1与$3之间手动添加空格分隔</span></span><br><span class="line">awk -F<span class="string">":"</span> '&#123;<span class="keyword">print</span> <span class="string">"Username:"</span> <span class="variable">$1</span> <span class="string">"\t\t Uid:"</span> <span class="variable">$3</span> &#125;' /etc/passwd    <span class="comment">//自定义输出  </span></span><br><span class="line">awk -F: '&#123;<span class="keyword">print</span> NF&#125;' /etc/passwd                 <span class="comment">//显示每行有多少字段</span></span><br><span class="line">awk -F: '&#123;<span class="keyword">print</span> <span class="variable">$NF&#125;</span>' /etc/passwd                <span class="comment">//将每行第NF个字段的值打印出来</span></span><br><span class="line">awk -F: 'NF==4 &#123;<span class="keyword">print</span> &#125;' /etc/passwd             <span class="comment">//显示只有4个字段的行</span></span><br><span class="line">awk -F: 'NF&gt;2&#123;<span class="keyword">print</span> <span class="variable">$0&#125;</span>' /etc/passwd            <span class="comment">//显示每行字段数量大于2的行</span></span><br><span class="line">awk '&#123;<span class="keyword">print</span> NR,<span class="variable">$0&#125;</span>' /etc/passwd                  <span class="comment">//输出每行的行号</span></span><br><span class="line">awk -F: '&#123;<span class="keyword">print</span> NR,NF,<span class="variable">$NF</span>,<span class="string">"\t"</span>,<span class="variable">$0&#125;</span>' /etc/passwd    <span class="comment">//依次打印行号，字段数，最后字段值，制表符，每行内容</span></span><br><span class="line">awk -F: 'NR==5&#123;<span class="keyword">print</span>&#125;' /etc/passwd              <span class="comment">//显示第5行</span></span><br><span class="line">awk -F: 'NR==5 || NR==6&#123;<span class="keyword">print</span>&#125;'  /etc/passwd    <span class="comment">//显示第5行和第6行</span></span><br><span class="line">route -<span class="keyword">n</span>|awk 'NR!=1&#123;<span class="keyword">print</span>&#125;'                    <span class="comment">//不显示第一行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">但是如果我想根据多个分隔符进行分割呢？一种办法是两次awk，但是我们可以一次告诉awk我们所有的分隔符，如-和|这两个，如</span><br><span class="line">awk -F ‘[-|]’ ‘&#123;<span class="keyword">print</span> <span class="variable">$3</span>;&#125;’ data</span><br><span class="line"></span><br><span class="line">就这么简单，还有一个问题，如果我们想用[]作为分隔符怎么办？有办法，这样就行：</span><br><span class="line">awk -F ‘[][]’ ‘&#123;<span class="keyword">print</span> <span class="variable">$3</span>;&#125;’ data</span><br></pre></td></tr></table></figure>

<h1 id="13-匹配代码块"><a href="#13-匹配代码块" class="headerlink" title="13.//匹配代码块"></a>13.//匹配代码块</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>纯字符匹配   !<span class="regexp">//</span>纯字符不匹配   ~<span class="regexp">//</span>字段值匹配    !~<span class="regexp">//</span>字段值不匹配   ~<span class="regexp">/a1|a2/</span>字段值匹配a1或a2   </span><br><span class="line">awk <span class="string">'/mysql/'</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line">awk <span class="string">'/mysql/&#123;print &#125;'</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line">awk <span class="string">'/mysql/&#123;print $0&#125;'</span> <span class="regexp">/etc/</span>passwd                   <span class="regexp">//</span>三条指令结果一样</span><br><span class="line">awk <span class="string">'!/mysql/&#123;print $0&#125;'</span> <span class="regexp">/etc/</span>passwd                  <span class="regexp">//</span>输出不匹配mysql的行</span><br><span class="line">awk <span class="string">'/mysql|mail/&#123;print&#125;'</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line">awk <span class="string">'!/mysql|mail/&#123;print&#125;'</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line">awk -F: <span class="string">'/mail/,/mysql/&#123;print&#125;'</span> <span class="regexp">/etc/</span>passwd         <span class="regexp">//</span>区间匹配</span><br><span class="line">awk <span class="string">'/[2][7][7]*/&#123;print $0&#125;'</span> <span class="regexp">/etc/</span>passwd               <span class="regexp">//</span>匹配包含<span class="number">27</span>为数字开头的行，如<span class="number">27</span>，<span class="number">277</span>，<span class="number">2777</span>...</span><br><span class="line">awk -F: <span class="string">'$1~/mail/&#123;print $1&#125;'</span> <span class="regexp">/etc/</span>passwd           <span class="regexp">//</span><span class="variable">$1</span>匹配指定内容才显示</span><br><span class="line">awk -F: <span class="string">'&#123;if($1~/mail/) print $1&#125;'</span> <span class="regexp">/etc/</span>passwd     <span class="regexp">//</span>与上面相同</span><br><span class="line">awk -F: <span class="string">'$1!~/mail/&#123;print $1&#125;'</span> <span class="regexp">/etc/</span>passwd          <span class="regexp">//</span>不匹配</span><br><span class="line">awk -F: <span class="string">'$1!~/mail|mysql/&#123;print $1&#125;'</span> <span class="regexp">/etc/</span>passwd</span><br></pre></td></tr></table></figure>



<h1 id="14-IF语句"><a href="#14-IF语句" class="headerlink" title="14.IF语句"></a>14.IF语句</h1><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">必须用在&#123;&#125;中，且比较内容用()扩起来</span><br><span class="line">awk -F: '&#123;<span class="keyword">if</span>(<span class="variable">$1</span>~/mail/) <span class="keyword">print</span> <span class="variable">$1&#125;</span>' /etc/passwd                    <span class="comment">//简写</span></span><br><span class="line">awk -F: '&#123;<span class="keyword">if</span>(<span class="variable">$1</span>~/mail/) &#123;<span class="keyword">print</span> <span class="variable">$1&#125;</span>&#125;'  /etc/passwd                  <span class="comment">//全写</span></span><br><span class="line">awk -F: '&#123;<span class="keyword">if</span>(<span class="variable">$1</span>~/mail/) &#123;<span class="keyword">print</span> <span class="variable">$1&#125;</span> <span class="keyword">else</span> &#123;<span class="keyword">print</span> <span class="variable">$2&#125;</span>&#125;' /etc/passwd       <span class="comment">//if...else...</span></span><br></pre></td></tr></table></figure>



<h1 id="15-条件表达式"><a href="#15-条件表达式" class="headerlink" title="15.条件表达式"></a>15.条件表达式</h1><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">==   !=   &gt;   &gt;=  </span><br><span class="line">awk -F<span class="string">":"</span> '<span class="variable">$1</span>==<span class="string">"mysql"</span>&#123;<span class="keyword">print</span> <span class="variable">$3&#125;</span>' /etc/passwd  </span><br><span class="line">awk -F<span class="string">":"</span> '&#123;<span class="keyword">if</span>(<span class="variable">$1</span>==<span class="string">"mysql"</span>) <span class="keyword">print</span> <span class="variable">$3&#125;</span>' /etc/passwd          <span class="comment">//与上面相同 </span></span><br><span class="line">awk -F<span class="string">":"</span> '<span class="variable">$1</span>!=<span class="string">"mysql"</span>&#123;<span class="keyword">print</span> <span class="variable">$3&#125;</span>' /etc/passwd                 <span class="comment">//不等于</span></span><br><span class="line">awk -F<span class="string">":"</span> '<span class="variable">$3</span>&gt;1000&#123;<span class="keyword">print</span> <span class="variable">$3&#125;</span>' /etc/passwd                      <span class="comment">//大于</span></span><br><span class="line">awk -F<span class="string">":"</span> '<span class="variable">$3</span>&gt;=100&#123;<span class="keyword">print</span> <span class="variable">$3&#125;</span>' /etc/passwd                     <span class="comment">//大于等于</span></span><br><span class="line">awk -F<span class="string">":"</span> '<span class="variable">$3</span>&lt;1&#123;<span class="keyword">print</span> <span class="variable">$3&#125;</span>' /etc/passwd                            <span class="comment">//小于</span></span><br><span class="line">awk -F<span class="string">":"</span> '<span class="variable">$3</span>&lt;=1&#123;<span class="keyword">print</span> <span class="variable">$3&#125;</span>' /etc/passwd                         <span class="comment">//小于等于</span></span><br></pre></td></tr></table></figure>

<h1 id="16-逻辑运算符"><a href="#16-逻辑运算符" class="headerlink" title="16.逻辑运算符"></a>16.逻辑运算符</h1><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&amp;&amp;　|| </span><br><span class="line">awk -F: <span class="string">'<span class="subst">$1</span>~/mail/ &amp;&amp; <span class="subst">$3</span>&gt;8 &#123;print &#125;'</span> /etc/passwd         <span class="comment">//逻辑与，$1匹配mail，并且$3&gt;8</span></span><br><span class="line">awk -F: <span class="string">'&#123;if(<span class="subst">$1</span>~/mail/ &amp;&amp; <span class="subst">$3</span>&gt;8) print &#125;'</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">'<span class="subst">$1</span>~/mail/ || <span class="subst">$3</span>&gt;1000 &#123;print &#125;'</span> /etc/passwd       <span class="comment">//逻辑或</span></span><br><span class="line">awk -F: <span class="string">'&#123;if(<span class="subst">$1</span>~/mail/ || <span class="subst">$3</span>&gt;1000) print &#125;'</span> /etc/passwd</span><br></pre></td></tr></table></figure>

<h1 id="17-数值运算"><a href="#17-数值运算" class="headerlink" title="17.数值运算"></a>17.数值运算</h1><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">awk -<span class="string">F:</span> <span class="string">'$3 &gt; 100'</span> <span class="regexp">/etc/</span>passwd    </span><br><span class="line">awk -<span class="string">F:</span> <span class="string">'$3 &gt; 100 || $3 &lt; 5'</span> <span class="regexp">/etc/</span>passwd  </span><br><span class="line">awk -<span class="string">F:</span> <span class="string">'$3+$4 &gt; 200'</span> <span class="regexp">/etc/</span>passwd</span><br><span class="line">awk -<span class="string">F:</span> <span class="string">'/mysql|mail/&#123;print $3+10&#125;'</span> <span class="regexp">/etc/</span>passwd                    <span class="comment">//第三个字段加10打印 </span></span><br><span class="line">awk -<span class="string">F:</span> <span class="string">'/mysql/&#123;print $3-$4&#125;'</span> <span class="regexp">/etc/</span>passwd                             <span class="comment">//减法</span></span><br><span class="line">awk -<span class="string">F:</span> <span class="string">'/mysql/&#123;print $3*$4&#125;'</span> <span class="regexp">/etc/</span>passwd                             <span class="comment">//求乘积</span></span><br><span class="line">awk <span class="string">'/MemFree/&#123;print $2/1024&#125;'</span> <span class="regexp">/proc/</span>meminfo                  <span class="comment">//除法</span></span><br><span class="line">awk <span class="string">'/MemFree/&#123;print int($2/1024)&#125;'</span> <span class="regexp">/proc/</span>meminfo           <span class="comment">//取整</span></span><br></pre></td></tr></table></figure>



<h1 id="18-指定输入和输出分隔符OFS"><a href="#18-指定输入和输出分隔符OFS" class="headerlink" title="18.指定输入和输出分隔符OFS"></a>18.指定输入和输出分隔符OFS</h1><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">awk '<span class="variable">$6</span> ~ /FIN/ || NR==1 &#123;<span class="keyword">print</span> NR,<span class="variable">$4</span>,<span class="variable">$5</span>,<span class="variable">$6&#125;</span>' OFS=<span class="string">"\t"</span> netstat.txt</span><br><span class="line">awk '<span class="variable">$6</span> ~ /WAIT/ || NR==1 &#123;<span class="keyword">print</span> NR,<span class="variable">$4</span>,<span class="variable">$5</span>,<span class="variable">$6&#125;</span>' OFS=<span class="string">"\t"</span> netstat.txt        </span><br><span class="line"><span class="comment">//输出字段6匹配WAIT的行，其中输出每行行号，字段4，5,6，并使用制表符分割字段</span></span><br><span class="line"> </span><br><span class="line">输出处理结果到文件</span><br><span class="line">①在命令代码块中直接输出    route -<span class="keyword">n</span>|awk 'NR!=1&#123;<span class="keyword">print</span> &gt; <span class="string">"./fs"</span>&#125;'   </span><br><span class="line">②使用重定向进行输出           route -<span class="keyword">n</span>|awk 'NR!=1&#123;<span class="keyword">print</span>&#125;'  &gt; ./fs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">https:<span class="comment">//blog.csdn.net/liangbilin/article/details/108593296</span></span><br><span class="line">---------------</span><br><span class="line">awk默认的分隔符为空格和<span class="keyword">tab</span>。然而，实践中往往需要指定其它符号作为分隔符。</span><br><span class="line"></span><br><span class="line">输入分隔符</span><br><span class="line">假设有一个<span class="keyword">test</span>.txt文本文件，其内容如下所示，共4行，每行由逗号分隔成三个元素。现在，通过后续的几种方式对它进行分列操作。</span><br><span class="line"></span><br><span class="line"><span class="keyword">cat</span> <span class="keyword">test</span>.txt</span><br><span class="line">sample1,male,12</span><br><span class="line">sample2,female,23</span><br><span class="line">sample3,male,15</span><br><span class="line">sample4,female,28</span><br><span class="line"></span><br><span class="line">1. 第一种方式：通过-F参数实现</span><br><span class="line">通过 -F 参数指定分隔符。需要注意的是，分隔符紧跟在-F参数后面（中间没有空格）。</span><br><span class="line">awk -F, '&#123;<span class="keyword">print</span> <span class="variable">$2&#125;</span>' <span class="keyword">test</span>.txt</span><br><span class="line">male</span><br><span class="line">female</span><br><span class="line">male</span><br><span class="line">female</span><br><span class="line"></span><br><span class="line">2. 第二种方式：通过指定内置变量 FS 来实现</span><br><span class="line">通过-v参数，设置内置变量FS的值为,，从而达到将分隔符指定为逗号。</span><br><span class="line"></span><br><span class="line">awk -v FS=<span class="string">","</span> '&#123;<span class="keyword">print</span> <span class="variable">$2&#125;</span>' <span class="keyword">test</span>.txt</span><br><span class="line">male</span><br><span class="line">female</span><br><span class="line">male</span><br><span class="line">female</span><br><span class="line"></span><br><span class="line">输出分隔符</span><br><span class="line">如果拆分的2列或2列以上需要输出，默认也是以空格进行分隔的。例如：</span><br><span class="line">awk -v FS=',' '&#123;<span class="keyword">print</span> <span class="variable">$1</span>,<span class="variable">$3&#125;</span>' <span class="keyword">test</span>.txt</span><br><span class="line">sample1 12</span><br><span class="line">sample2 23</span><br><span class="line">sample3 15</span><br><span class="line">sample4 28</span><br><span class="line"></span><br><span class="line">那么，当需要在输出文件中，需要指定其它分隔符时，可以通过-v 参数指定内置变量OFS实现。例如：</span><br><span class="line">awk -v FS=<span class="string">","</span> -v OFS=<span class="string">"@@"</span> '&#123;<span class="keyword">print</span> <span class="variable">$1</span>,<span class="variable">$3&#125;</span>' <span class="keyword">test</span>.txt</span><br><span class="line">sample1@@12</span><br><span class="line">sample2@@23</span><br><span class="line">sample3@@15</span><br><span class="line">sample4@@28</span><br><span class="line">-F 指定输入文件的的分隔符 -v OFS 指定输出文件的分隔符</span><br></pre></td></tr></table></figure>



<h1 id="19-格式化输出"><a href="#19-格式化输出" class="headerlink" title="19.格式化输出"></a>19.格式化输出</h1><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">netstat -anp|awk '&#123;printf <span class="string">"%-8s %-8s %-10s<span class="subst">\n</span>"</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>&#125;' </span><br><span class="line">printf表示格式输出</span><br><span class="line">%格式化输出分隔符</span><br><span class="line"><span class="number">-8</span>长度为<span class="number">8</span>个字符</span><br><span class="line">s表示字符串类型</span><br><span class="line">打印每行前三个字段，指定第一个字段输出字符串类型(长度为<span class="number">8</span>)，第二个字段输出字符串类型(长度为<span class="number">8</span>),</span><br><span class="line">第三个字段输出字符串类型(长度为<span class="number">10</span>)</span><br><span class="line">netstat -anp|awk '$<span class="number">6</span>==<span class="string">"LISTEN"</span> || NR==<span class="number">1</span> &#123;printf <span class="string">"%-10s %-10s %-10s <span class="subst">\n</span>"</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>&#125;'</span><br><span class="line">netstat -anp|awk '$<span class="number">6</span>==<span class="string">"LISTEN"</span> || NR==<span class="number">1</span> &#123;printf <span class="string">"%-3s %-10s %-10s %-10s <span class="subst">\n</span>"</span>,NR,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>&#125;'</span><br></pre></td></tr></table></figure>

<h1 id="20-IF语句"><a href="#20-IF语句" class="headerlink" title="20.IF语句"></a>20.IF语句</h1><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">awk -F: '&#123;<span class="keyword">if</span>(<span class="variable">$3</span>&gt;100) <span class="keyword">print</span> <span class="string">"large"</span>; <span class="keyword">else</span> <span class="keyword">print</span> <span class="string">"small"</span>&#125;' /etc/passwd</span><br><span class="line">small</span><br><span class="line">small</span><br><span class="line">small</span><br><span class="line">large</span><br><span class="line">small</span><br><span class="line">small</span><br><span class="line">awk -F: 'BEGIN&#123;A=0;B=0&#125; &#123;<span class="keyword">if</span>(<span class="variable">$3</span>&gt;100) &#123;A++; <span class="keyword">print</span> <span class="string">"large"</span>&#125; <span class="keyword">else</span> &#123;B++; <span class="keyword">print</span> <span class="string">"small"</span>&#125;&#125; END&#123;<span class="keyword">print</span> A,<span class="string">"\t"</span>,B&#125;' /etc/passwd </span><br><span class="line">                                                                                                                  <span class="comment">//ID大于100,A加1，否则B加1</span></span><br><span class="line">awk -F: '&#123;<span class="keyword">if</span>(<span class="variable">$3</span>&lt;100) next; <span class="keyword">else</span> <span class="keyword">print</span>&#125;' /etc/passwd                         <span class="comment">//小于100跳过，否则显示</span></span><br><span class="line">awk -F: 'BEGIN&#123;i=1&#125; &#123;<span class="keyword">if</span>(i&lt;NF) <span class="keyword">print</span> NR,NF,i++ &#125;' /etc/passwd   </span><br><span class="line">awk -F: 'BEGIN&#123;i=1&#125; &#123;<span class="keyword">if</span>(i&lt;NF) &#123;<span class="keyword">print</span> NR,NF&#125; i++ &#125;' /etc/passwd</span><br><span class="line">另一种形式</span><br><span class="line">awk -F: '&#123;<span class="keyword">print</span> (<span class="variable">$3</span>&gt;100 ? <span class="string">"yes"</span>:<span class="string">"no"</span>)&#125;'  /etc/passwd </span><br><span class="line">awk -F: '&#123;<span class="keyword">print</span> (<span class="variable">$3</span>&gt;100 ? <span class="variable">$3</span><span class="string">":\tyes"</span>:<span class="variable">$3</span><span class="string">":\tno"</span>)&#125;'  /etc/passwd</span><br></pre></td></tr></table></figure>

<p>while语句</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">awk -F:</span> <span class="string">'BEGIN&#123;i=1&#125; &#123;while(i&lt;NF) print NF,$i,i++&#125;'</span> <span class="string">/etc/passwd</span> </span><br><span class="line"><span class="number">7</span> <span class="string">root</span> <span class="number">1</span></span><br><span class="line"><span class="number">7</span> <span class="string">x</span> <span class="number">2</span></span><br><span class="line"><span class="number">7</span> <span class="number">0</span> <span class="number">3</span></span><br><span class="line"><span class="number">7</span> <span class="number">0</span> <span class="number">4</span></span><br><span class="line"><span class="number">7</span> <span class="string">root</span> <span class="number">5</span></span><br><span class="line"><span class="number">7</span> <span class="string">/root</span> <span class="number">6</span></span><br></pre></td></tr></table></figure>

<h1 id="21-数组"><a href="#21-数组" class="headerlink" title="21.数组"></a>21.数组</h1><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">netstat -anp|awk 'NR!=<span class="number">1</span>&#123;a[$<span class="number">6</span>]++&#125; END&#123;for (i in a) print i,<span class="string">"<span class="subst">\t</span>"</span>,a[i]&#125;'</span><br><span class="line">netstat -anp|awk 'NR!=<span class="number">1</span>&#123;a[$<span class="number">6</span>]++&#125; END&#123;for (i in a) printf <span class="string">"%-20s %-10s %-5s <span class="subst">\n</span>"</span>, i,<span class="string">"<span class="subst">\t</span>"</span>,a[i]&#125;'</span><br><span class="line"><span class="number">9523</span>                               <span class="number">1</span>     </span><br><span class="line"><span class="number">9929</span>                               <span class="number">1</span>     </span><br><span class="line">LISTEN                            <span class="number">6</span>     </span><br><span class="line"><span class="number">7903</span>                               <span class="number">1</span>     </span><br><span class="line"><span class="number">3038</span>/cupsd                   <span class="number">1</span>     </span><br><span class="line"><span class="number">7913</span>                               <span class="number">1</span>     </span><br><span class="line"><span class="number">10837</span>                             <span class="number">1</span>     </span><br><span class="line"><span class="number">9833</span>                               <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h1 id="22-应用"><a href="#22-应用" class="headerlink" title="22.应用"></a>22.应用</h1><h2 id="输出文件每行有多少字段"><a href="#输出文件每行有多少字段" class="headerlink" title="输出文件每行有多少字段"></a>输出文件每行有多少字段</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -<span class="string">F:</span> <span class="string">'&#123;print NF&#125;'</span> helloworld.sh</span><br></pre></td></tr></table></figure>

<h2 id="输出前5个字段"><a href="#输出前5个字段" class="headerlink" title="输出前5个字段"></a>输出前5个字段</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> -F: <span class="string">'&#123;print <span class="variable">$1</span>,<span class="variable">$2</span>,<span class="variable">$3</span>,<span class="variable">$4</span>,<span class="variable">$5</span>&#125;'</span> helloworld.sh</span><br></pre></td></tr></table></figure>

<h2 id="输出前5个字段并使用制表符分隔输出"><a href="#输出前5个字段并使用制表符分隔输出" class="headerlink" title="输出前5个字段并使用制表符分隔输出"></a>输出前5个字段并使用制表符分隔输出</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> -F: <span class="string">'&#123;print <span class="variable">$1</span>,<span class="variable">$2</span>,<span class="variable">$3</span>,<span class="variable">$4</span>,<span class="variable">$5</span>&#125;'</span> OFS=<span class="string">'\t'</span> helloworld.sh</span><br></pre></td></tr></table></figure>

<h2 id="制表符分隔输出前5个字段，并打印行号"><a href="#制表符分隔输出前5个字段，并打印行号" class="headerlink" title="制表符分隔输出前5个字段，并打印行号"></a>制表符分隔输出前5个字段，并打印行号</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> -F: <span class="string">'&#123;print NR,<span class="variable">$1</span>,<span class="variable">$2</span>,<span class="variable">$3</span>,<span class="variable">$4</span>,<span class="variable">$5</span>&#125;'</span> OFS=<span class="string">'\t'</span> helloworld.sh</span><br></pre></td></tr></table></figure>

<h2 id="指定多个分隔符-，输出每行多少字段"><a href="#指定多个分隔符-，输出每行多少字段" class="headerlink" title="指定多个分隔符: #，输出每行多少字段"></a>指定多个分隔符: #，输出每行多少字段</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> -F<span class="string">'[:#]'</span> <span class="string">'&#123;print NF&#125;'</span>  helloworld.sh</span><br></pre></td></tr></table></figure>

<h2 id="制表符分隔输出多字段"><a href="#制表符分隔输出多字段" class="headerlink" title="制表符分隔输出多字段"></a>制表符分隔输出多字段</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> -F<span class="string">'[:#]'</span> <span class="string">'&#123;print <span class="variable">$1</span>,<span class="variable">$2</span>,<span class="variable">$3</span>,<span class="variable">$4</span>,<span class="variable">$5</span>,<span class="variable">$6</span>,<span class="variable">$7</span>&#125;'</span> OFS=<span class="string">'\t'</span> helloworld.sh</span><br></pre></td></tr></table></figure>

<h2 id="指定三个分隔符，并输出每行字段数"><a href="#指定三个分隔符，并输出每行字段数" class="headerlink" title="指定三个分隔符，并输出每行字段数"></a>指定三个分隔符，并输出每行字段数</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> -F<span class="string">'[:#/]'</span> <span class="string">'&#123;print NF&#125;'</span> helloworld.sh</span><br></pre></td></tr></table></figure>

<h2 id="制表符分隔输出多字段-1"><a href="#制表符分隔输出多字段-1" class="headerlink" title="制表符分隔输出多字段"></a>制表符分隔输出多字段</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> -F<span class="string">'[:#/]'</span> <span class="string">'&#123;print <span class="variable">$1</span>,<span class="variable">$2</span>,<span class="variable">$3</span>,<span class="variable">$4</span>,<span class="variable">$5</span>,<span class="variable">$6</span>,<span class="variable">$7</span>,<span class="variable">$8</span>,<span class="variable">$9</span>,<span class="variable">$10</span>,<span class="variable">$11</span>,<span class="variable">$12</span>&#125;'</span> helloworld.sh</span><br></pre></td></tr></table></figure>

<h2 id="计算-home目录下，普通文件的大小，使用KB作为单位"><a href="#计算-home目录下，普通文件的大小，使用KB作为单位" class="headerlink" title="计算/home目录下，普通文件的大小，使用KB作为单位"></a>计算/home目录下，普通文件的大小，使用KB作为单位</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ls</span> -<span class="keyword">l</span>|awk 'BEGIN&#123;<span class="keyword">sum</span>=0&#125; !/^<span class="keyword">d</span>/&#123;<span class="keyword">sum</span>+=<span class="variable">$5&#125;</span> END&#123;<span class="keyword">print</span> <span class="string">"total size is:"</span>,<span class="keyword">sum</span>/1024,<span class="string">"KB"</span>&#125;'</span><br><span class="line"><span class="keyword">ls</span> -<span class="keyword">l</span>|awk 'BEGIN&#123;<span class="keyword">sum</span>=0&#125; !/^<span class="keyword">d</span>/&#123;<span class="keyword">sum</span>+=<span class="variable">$5&#125;</span> END&#123;<span class="keyword">print</span> <span class="string">"total size is:"</span>,int(<span class="keyword">sum</span>/1024),<span class="string">"KB"</span>&#125;'   <span class="comment">//int是取整的意思</span></span><br></pre></td></tr></table></figure>

<h2 id="统计netstat-anp-状态为LISTEN和CONNECT的连接数量分别是多少"><a href="#统计netstat-anp-状态为LISTEN和CONNECT的连接数量分别是多少" class="headerlink" title="统计netstat -anp 状态为LISTEN和CONNECT的连接数量分别是多少"></a>统计netstat -anp 状态为LISTEN和CONNECT的连接数量分别是多少</h2><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -anp|<span class="type">awk</span> '$<span class="number">6</span>~/LISTEN|<span class="type">CONNECTED</span>/&#123;<span class="built_in">sum</span>[$<span class="number">6</span>]++&#125; END&#123;<span class="keyword">for</span> (i <span class="built_in">in</span> <span class="built_in">sum</span>) printf <span class="string">"%-10s %-6s %-3s \n"</span>, i,<span class="string">" "</span>,<span class="built_in">sum</span>[i]&#125;'</span><br></pre></td></tr></table></figure>

<h2 id="统计-home目录下不同用户的普通文件的总数是多少？"><a href="#统计-home目录下不同用户的普通文件的总数是多少？" class="headerlink" title="统计/home目录下不同用户的普通文件的总数是多少？"></a>统计/home目录下不同用户的普通文件的总数是多少？</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -l|awk 'NR!=<span class="number">1</span> &amp;&amp; !/^d/&#123;sum[$<span class="number">3</span>]++&#125; END&#123;for (i in sum) printf <span class="string">"%-6s %-5s %-3s <span class="subst">\n</span>"</span>,i,<span class="string">" "</span>,sum[i]&#125;'   </span><br><span class="line">mysql        <span class="number">199</span> </span><br><span class="line">root         <span class="number">374</span></span><br></pre></td></tr></table></figure>

<h2 id="统计-home目录下不同用户的普通文件的大小总size是多少？"><a href="#统计-home目录下不同用户的普通文件的大小总size是多少？" class="headerlink" title="统计/home目录下不同用户的普通文件的大小总size是多少？"></a>统计/home目录下不同用户的普通文件的大小总size是多少？</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l|awk 'NR!=<span class="number">1</span> &amp;&amp; !/^d/&#123;sum[$<span class="number">3</span>]+=$<span class="number">5</span>&#125; END&#123;for (i in sum) printf <span class="string">"%-6s %-5s %-3s %-2s <span class="subst">\n</span>"</span>,i,<span class="string">" "</span>,sum[i]/<span class="number">1024</span>/<span class="number">1024</span>,<span class="string">"MB"</span>&#125;'</span><br></pre></td></tr></table></figure>

<h2 id="输出成绩表"><a href="#输出成绩表" class="headerlink" title="输出成绩表"></a>输出成绩表</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">awk 'BEGIN&#123;math=<span class="number">0</span>;eng=<span class="number">0</span>;com=<span class="number">0</span>;printf <span class="string">"Lineno.   Name    No.    Math   English   Computer    Total<span class="subst">\n</span>"</span>;printf <span class="string">"------------------------------------------------------------<span class="subst">\n</span>"</span>&#125;&#123;math+=$<span class="number">3</span>; eng+=$<span class="number">4</span>; com+=$<span class="number">5</span>;printf <span class="string">"%-8s %-7s %-7s %-7s %-9s %-10s %-7s <span class="subst">\n</span>"</span>,NR,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>,$<span class="number">4</span>,$<span class="number">5</span>,$<span class="number">3</span>+$<span class="number">4</span>+$<span class="number">5</span>&#125; END&#123;printf <span class="string">"------------------------------------------------------------<span class="subst">\n</span>"</span>;printf <span class="string">"%-24s %-7s %-9s %-20s <span class="subst">\n</span>"</span>,<span class="string">"Total:"</span>,math,eng,com;printf <span class="string">"%-24s %-7s %-9s %-20s <span class="subst">\n</span>"</span>,<span class="string">"Avg:"</span>,math/NR,eng/NR,com/NR&#125;' test0</span><br><span class="line"></span><br><span class="line">[root@localhost home]# cat test0 </span><br><span class="line">Marry   <span class="number">2143</span> <span class="number">78</span> <span class="number">84</span> <span class="number">77</span></span><br><span class="line">Jack    <span class="number">2321</span> <span class="number">66</span> <span class="number">78</span> <span class="number">45</span></span><br><span class="line">Tom     <span class="number">2122</span> <span class="number">48</span> <span class="number">77</span> <span class="number">71</span></span><br><span class="line">Mike    <span class="number">2537</span> <span class="number">87</span> <span class="number">97</span> <span class="number">95</span></span><br><span class="line">Bob     <span class="number">2415</span> <span class="number">40</span> <span class="number">57</span> <span class="number">62</span></span><br></pre></td></tr></table></figure>

<h2 id="例1"><a href="#例1" class="headerlink" title="例1"></a>例1</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">测试文件test</span><br><span class="line"><span class="symbol">root:</span><span class="symbol">x:</span><span class="number">0</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:root</span><span class="symbol">:/root</span><span class="symbol">:/bin/bash</span></span><br><span class="line"><span class="symbol">bin:</span><span class="symbol">x:</span><span class="number">1</span><span class="symbol">:</span><span class="number">1</span><span class="symbol">:bin</span><span class="symbol">:/bin</span><span class="symbol">:/bin/false</span></span><br><span class="line"><span class="symbol">daemon:</span><span class="symbol">x:</span><span class="number">2</span><span class="symbol">:</span><span class="number">2</span><span class="symbol">:daemon</span><span class="symbol">:/sbin</span><span class="symbol">:/bin/false</span></span><br><span class="line"><span class="symbol">mail:</span><span class="symbol">x:</span><span class="number">8</span><span class="symbol">:</span><span class="number">12</span><span class="symbol">:mail</span><span class="symbol">:/var/spool/mail</span><span class="symbol">:/bin/false</span></span><br><span class="line"><span class="symbol">ftp:</span><span class="symbol">x:</span><span class="number">14</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:ftp</span><span class="symbol">:/home/ftp</span><span class="symbol">:/bin/false</span></span><br><span class="line">&amp;<span class="symbol">nobody:</span>$:<span class="number">99</span><span class="symbol">:</span><span class="number">99</span><span class="symbol">:nobody</span><span class="symbol">:/</span><span class="symbol">:/bin/false</span></span><br><span class="line"><span class="symbol">zhangy:</span><span class="symbol">x:</span><span class="number">1000</span><span class="symbol">:</span><span class="number">100</span><span class="symbol">:</span>,,,<span class="symbol">:/home/zhangy</span><span class="symbol">:/bin/bash</span></span><br><span class="line"><span class="symbol">http:</span><span class="symbol">x:</span><span class="number">33</span><span class="symbol">:</span><span class="number">33</span><span class="symbol">:</span><span class="symbol">:/srv/http</span><span class="symbol">:/bin/false</span></span><br><span class="line"><span class="symbol">dbus:</span><span class="symbol">x:</span><span class="number">81</span><span class="symbol">:</span><span class="number">81</span><span class="symbol">:System</span> message <span class="symbol">bus:</span>/<span class="symbol">:/bin/false</span></span><br><span class="line"><span class="symbol">hal:</span><span class="symbol">x:</span><span class="number">82</span><span class="symbol">:</span><span class="number">82</span><span class="symbol">:HAL</span> <span class="symbol">daemon:</span>/<span class="symbol">:/bin/false</span></span><br><span class="line"><span class="symbol">mysql:</span><span class="symbol">x:</span><span class="number">89</span><span class="symbol">:</span><span class="number">89</span><span class="symbol">:</span><span class="symbol">:/var/lib/mysql</span><span class="symbol">:/bin/false</span></span><br><span class="line"><span class="symbol">aaa:</span><span class="symbol">x:</span><span class="number">1001</span><span class="symbol">:</span><span class="number">1001</span><span class="symbol">:</span><span class="symbol">:/home/aaa</span><span class="symbol">:/bin/bash</span></span><br><span class="line"><span class="symbol">ba:</span><span class="symbol">x:</span><span class="number">1002</span><span class="symbol">:</span><span class="number">1002</span><span class="symbol">:</span><span class="symbol">:/home/zhangy</span><span class="symbol">:/bin/bash</span></span><br><span class="line"><span class="symbol">test:</span><span class="symbol">x:</span><span class="number">1003</span><span class="symbol">:</span><span class="number">1003</span><span class="symbol">:</span><span class="symbol">:/home/test</span><span class="symbol">:/bin/bash</span></span><br><span class="line">@zhangying<span class="symbol">:*</span><span class="symbol">:</span><span class="number">1004</span><span class="symbol">:</span><span class="number">1004</span><span class="symbol">:</span><span class="symbol">:/home/test</span><span class="symbol">:/bin/bash</span></span><br><span class="line"><span class="symbol">policykit:</span><span class="symbol">x:</span><span class="number">102</span><span class="symbol">:</span><span class="number">1005</span><span class="symbol">:Po</span></span><br><span class="line"></span><br><span class="line">例a</span><br><span class="line">cat test <span class="params">| awk -F: '&#123;\</span></span><br><span class="line"><span class="params"> <span class="keyword">if</span> ($1 == "root")&#123;\</span></span><br><span class="line"><span class="params"> print $1;\</span></span><br><span class="line"><span class="params"> &#125;<span class="keyword">else</span> <span class="keyword">if</span>($1 == "bin")&#123;\</span></span><br><span class="line"><span class="params"> print $2;\</span></span><br><span class="line"><span class="params"> &#125;<span class="keyword">else</span>&#123;\</span></span><br><span class="line"><span class="params"> print $3;\</span></span><br><span class="line"><span class="params"> &#125; \</span></span><br><span class="line"><span class="params">&#125;'</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">例b</span></span><br><span class="line"><span class="params">awk '&#123;\</span></span><br><span class="line"><span class="params"> <span class="keyword">for</span>(i=0;i&lt;NF;i++)&#123;\</span></span><br><span class="line"><span class="params"> <span class="keyword">if</span> ($i ~/^root/)&#123;\</span></span><br><span class="line"><span class="params"> print $i;\</span></span><br><span class="line"><span class="params"> &#125;<span class="keyword">else</span> <span class="keyword">if</span>($i ~/zhangy/)&#123;\</span></span><br><span class="line"><span class="params"> print $i;continue;\</span></span><br><span class="line"><span class="params"> &#125;<span class="keyword">else</span> <span class="keyword">if</span>($i ~/mysql/)&#123;\</span></span><br><span class="line"><span class="params"> print $i;<span class="keyword">next</span>;\</span></span><br><span class="line"><span class="params"> &#125;<span class="keyword">else</span> <span class="keyword">if</span>($i ~/^test/)&#123;\</span></span><br><span class="line"><span class="params"> print $i;<span class="keyword">break</span>;\</span></span><br><span class="line"><span class="params"> &#125; \</span></span><br><span class="line"><span class="params"> &#125;\</span></span><br><span class="line"><span class="params">&#125;' test</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">例c</span></span><br><span class="line"><span class="params">tail test |</span> awk <span class="string">'BEGIN&#123;while(getline d)&#123; split(d,test);for(i in test)&#123;\</span></span><br><span class="line"><span class="string"> print test[i]\</span></span><br><span class="line"><span class="string">&#125;&#125;&#125;'</span></span><br><span class="line"></span><br><span class="line">例d</span><br><span class="line">ls -al /home/zhangy/mytest <span class="params">| awk '<span class="keyword">BEGIN</span>&#123;<span class="keyword">while</span>(getline d)&#123; split(d,test);\</span></span><br><span class="line"><span class="params"> print test[9] ;&#125;</span></span><br><span class="line"><span class="params">&#125;'</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">例e</span></span><br><span class="line"><span class="params">echo "32:34" |</span>awk -<span class="symbol">F:</span> <span class="string">'&#123;print "max = ",max($1,$2)&#125;\</span></span><br><span class="line"><span class="string">function max(one,two)&#123;</span></span><br><span class="line"><span class="string">if(one &gt; two)&#123;</span></span><br><span class="line"><span class="string"> return one;</span></span><br><span class="line"><span class="string">&#125;else&#123;</span></span><br><span class="line"><span class="string"> return two;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">例f</span><br><span class="line">awk -<span class="symbol">F:</span> <span class="string">'&#123;mat=match($1,/^[a-zA-Z]+$/);print mat,RSTART,RLENGTH&#125;'</span> test</span><br><span class="line"></span><br><span class="line">例g</span><br><span class="line">cat test <span class="params">|awk -F: '\</span></span><br><span class="line"><span class="params"> NF != 7&#123;\</span></span><br><span class="line"><span class="params">printf("line %d,does <span class="keyword">not</span> have 7 fields:%s\n",NR,$0)&#125;\</span></span><br><span class="line"><span class="params">$1 !~ /^[A-Za-z0-9]/&#123;printf("line %d,non alpha <span class="keyword">and</span> numeric user id:%s: %s\n",NR,$1,$0)&#125;\</span></span><br><span class="line"><span class="params">$2 == "*" &#123;printf("lind %d,no password:%s\n",NR,$0)&#125;'</span></span><br></pre></td></tr></table></figure>

<h2 id="例2"><a href="#例2" class="headerlink" title="例2"></a>例2</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">测试文件</span><br><span class="line">[<span class="symbol">root@</span>Blackghost test2]# cat aaa <span class="comment">//测试文件aaa</span></span><br><span class="line"><span class="number">1111</span>:<span class="number">23434</span>:zhang</span><br><span class="line">hoadsf:asdf:ccc</span><br><span class="line">[<span class="symbol">root@</span>Blackghost test2]# cat ccc  <span class="comment">//测试文件ccc</span></span><br><span class="line"><span class="number">1111</span>:<span class="number">23434</span>:zhang</span><br><span class="line">hoadsf:asdf:ccc</span><br><span class="line">tank:zhang:x20342</span><br><span class="line">ying:zhasdf:<span class="number">72342</span></span><br><span class="line">hosa:asdfa:<span class="number">2345</span>sdf</span><br><span class="line"></span><br><span class="line">例a</span><br><span class="line">[<span class="symbol">root@</span>Blackghost test2]# awk <span class="string">'&#123;print NR;print FNR;print $0;&#125;'</span> aaa</span><br><span class="line"><span class="number">1</span>   <span class="comment">//NR</span></span><br><span class="line"><span class="number">1</span>   <span class="comment">//FNR</span></span><br><span class="line"><span class="number">1111</span>:<span class="number">23434</span>:zhang</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">hoadsf:asdf:ccc</span><br><span class="line"></span><br><span class="line">例b</span><br><span class="line">[<span class="symbol">root@</span>Blackghost test2]# awk <span class="string">'&#123;print NR;print FNR;print $0;&#125;'</span> aaa ccc</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1111</span>:<span class="number">23434</span>:zhang</span><br><span class="line"><span class="number">2</span>    <span class="comment">//NR</span></span><br><span class="line"><span class="number">2</span>    <span class="comment">//FNR</span></span><br><span class="line">hoadsf:asdf:ccc</span><br><span class="line"><span class="number">3</span>    <span class="comment">//NR</span></span><br><span class="line"><span class="number">1</span>    <span class="comment">//FNR   下面的数据是来自ccc，所以NFR重置为1</span></span><br><span class="line"><span class="number">1111</span>:<span class="number">23434</span>:zhang</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">hoadsf:asdf:ccc</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">tank:zhang:x20342</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">ying:zhasdf:<span class="number">72342</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line">hosa:asdfa:<span class="number">2345</span>sdf</span><br></pre></td></tr></table></figure>

<h2 id="例3"><a href="#例3" class="headerlink" title="例3"></a>例3</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat aaa</span></span><br><span class="line"><span class="number">59314</span></span><br><span class="line"><span class="number">46791</span></span><br><span class="line"><span class="number">59992</span></span><br><span class="line"><span class="number">60311</span></span><br><span class="line"><span class="number">60134</span></span><br><span class="line"><span class="number">59992</span></span><br><span class="line"><span class="number">60311</span></span><br><span class="line"><span class="number">97343</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cat aaa | awk '!a[$1]++'</span></span><br><span class="line"><span class="number">59314</span></span><br><span class="line"><span class="number">46791</span></span><br><span class="line"><span class="number">59992</span></span><br><span class="line"><span class="number">60311</span></span><br><span class="line"><span class="number">60134</span></span><br><span class="line"><span class="number">97343</span></span><br></pre></td></tr></table></figure>

<h2 id="获取本机上网络接口上可用的公网IP地址"><a href="#获取本机上网络接口上可用的公网IP地址" class="headerlink" title="获取本机上网络接口上可用的公网IP地址"></a>获取本机上网络接口上可用的公网IP地址</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">处理前:</span><br><span class="line">[<span class="symbol">root@</span>practice ~]# ip addr show </span><br><span class="line"><span class="number">1</span>: lo:  mtu <span class="number">16436</span> qdisc noqueue </span><br><span class="line">    link/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">    inet <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/<span class="number">8</span> scope host lo</span><br><span class="line">    inet <span class="number">10.99</span><span class="number">.133</span><span class="number">.33</span>/<span class="number">32</span> scope global lo</span><br><span class="line"><span class="number">2</span>: eth2:  mtu <span class="number">1500</span> qdisc pfifo_fast qlen <span class="number">1000</span></span><br><span class="line">    link/ether <span class="number">0</span>:<span class="number">1</span>b:<span class="number">21</span>:<span class="number">48</span>:<span class="number">3</span>e:b3 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet <span class="number">172.20</span><span class="number">.33</span><span class="number">.44</span>/<span class="number">23</span> brd <span class="number">172.20</span><span class="number">.33</span><span class="number">.255</span> scope global eth2</span><br><span class="line"><span class="number">3</span>: eth3:  mtu <span class="number">1500</span> qdisc pfifo_fast qlen <span class="number">1000</span></span><br><span class="line">    link/ether <span class="number">00</span>:<span class="number">1</span>b:<span class="number">31</span>:<span class="number">39</span>:<span class="number">3</span>e:<span class="number">2</span>c brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="number">4</span>: eth0:  mtu <span class="number">1500</span> qdisc pfifo_fast qlen <span class="number">1000</span></span><br><span class="line">    link/ether <span class="number">00</span>:<span class="number">25</span>:<span class="number">29</span>:<span class="number">09</span>:<span class="number">8</span>e:f2 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet <span class="number">228.215</span><span class="number">.154</span><span class="number">.140</span>/<span class="number">26</span> brd <span class="number">228.215</span><span class="number">.154</span><span class="number">.191</span> scope global eth0</span><br><span class="line"><span class="number">5</span>: eth1:  mtu <span class="number">1500</span> qdisc pfifo_fast qlen <span class="number">1000</span></span><br><span class="line">    link/ether <span class="number">00</span>:<span class="number">25</span>:<span class="number">09</span>:<span class="number">09</span>:<span class="number">8</span>e:f3 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet <span class="number">228.215</span><span class="number">.154</span><span class="number">.150</span>/<span class="number">26</span> brd228<span class="number">.215</span><span class="number">.154</span><span class="number">.191</span> scope global eth1</span><br><span class="line"></span><br><span class="line">处理后</span><br><span class="line">[<span class="symbol">root@</span>practice ~]# ip addr show | awk <span class="string">'BEGIN&#123;FS="[/ ]+";OFS=" -- "&#125;$2~"eth"&#123;$3~"NO-CARRIER"?a=0:a=1&#125;$NF~"eth"&amp;&amp;a&#123;print $NF,$3&#125;'</span> </span><br><span class="line">eth0 -- <span class="number">228.215</span><span class="number">.154</span><span class="number">.140</span></span><br><span class="line">eth1 -- <span class="number">228.215</span><span class="number">.154</span><span class="number">.150</span></span><br><span class="line"></span><br><span class="line">获取本机上网络接口上可用的公网IP地址</span><br><span class="line">BEGIN&#123;FS=<span class="string">"[/ ]+"</span>;OFS=<span class="string">" -- "</span>&#125; 是指把一个或多个空格或者/作为读取文本时的字段分隔符,把<span class="string">" -- "</span>作为执行完后的输出字段分隔符</span><br><span class="line"></span><br><span class="line">$<span class="number">2</span>~<span class="string">"eth"</span>&#123;$<span class="number">3</span>~<span class="string">"NO-CARRIER"</span>?a=<span class="number">0</span>:a=<span class="number">1</span>&#125;找到第二个字段匹配到<span class="string">"eth"</span>的行并判断第三个字段是否匹配到<span class="string">"NO-CARRIER"</span>,匹配到则a=<span class="number">0</span>,否则a=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">$NF~<span class="string">"eth"</span>&amp;&amp;a将最后一个字段和a相与,结果为真则打印最后一个字段和第三个字段,否则不处理</span><br></pre></td></tr></table></figure>

<h2 id="awk取出last命令结果中非空行"><a href="#awk取出last命令结果中非空行" class="headerlink" title="awk取出last命令结果中非空行"></a>awk取出last命令结果中非空行</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@practice ~]# last |awk '$<span class="number">0</span>!=<span class="string">""</span>&amp;&amp;$<span class="number">2</span>!~<span class="string">"boot"</span>&amp;&amp;$<span class="number">3</span>~<span class="string">"[[:digit:]]"</span>&#123;ips[$<span class="number">3</span>]++&#125;END&#123;for(i in ips)printf <span class="string">"%18-s%10-d<span class="subst">\n</span>"</span>,i,ips[i]&#125;' </span><br><span class="line"><span class="number">172.20</span><span class="number">.33</span><span class="number">.1</span>       <span class="number">1</span>         </span><br><span class="line"><span class="number">172.20</span><span class="number">.33</span><span class="number">.95</span>      <span class="number">7</span>         </span><br><span class="line"><span class="number">192.168</span><span class="number">.2</span><span class="number">.100</span>     <span class="number">6</span>         </span><br><span class="line"><span class="number">192.168</span><span class="number">.2</span><span class="number">.101</span>     <span class="number">3</span>         </span><br><span class="line"><span class="number">172.20</span><span class="number">.33</span><span class="number">.26</span>      <span class="number">1</span>         </span><br><span class="line"><span class="number">192.168</span><span class="number">.2</span><span class="number">.102</span>     <span class="number">8</span>         </span><br><span class="line"><span class="number">172.20</span><span class="number">.32</span><span class="number">.123</span>     <span class="number">7</span>         </span><br><span class="line"><span class="number">192.168</span><span class="number">.140</span><span class="number">.1</span>     <span class="number">2</span>         </span><br><span class="line"><span class="number">172.20</span><span class="number">.33</span><span class="number">.93</span>      <span class="number">1</span>       </span><br><span class="line"></span><br><span class="line">&amp;&amp;表示 且,与</span><br><span class="line"></span><br><span class="line">$<span class="number">0</span>!=<span class="string">""</span>表示排除结果中的空行</span><br><span class="line"></span><br><span class="line">$<span class="number">2</span>!~<span class="string">"boot"</span>表示排除重启的记录</span><br><span class="line"></span><br><span class="line">$<span class="number">3</span>~<span class="string">"[[:digit:]]表示第三个字段匹配数字而不是字符</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;ips[$3]++&#125;表示把第三个字段即IP地址作为下标,组成一个数组ips,IP地址每出现一次,其出现次数累加一</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">END&#123;for(i in ips)printf "</span>%<span class="number">18</span>-s%<span class="number">10</span>-d\n<span class="string">",i,ips[i]&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">表示从数组中获取每个IP地址,及其出现的次数,并定义对齐方式和变量类型打印出来</span></span><br></pre></td></tr></table></figure>

<h2 id="将passwd中的第三列放到test中"><a href="#将passwd中的第三列放到test中" class="headerlink" title="将passwd中的第三列放到test中"></a>将passwd中的第三列放到test中</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#将passwd中的第三列放到test中</span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# awk -F: <span class="string">'&#123;if(NR&gt;=10 &amp;&amp; NR&lt;=20) print $3 &#125;'</span> /etc/passwd &gt; test</span><br><span class="line">You have mail <span class="keyword">in</span> /var/spool/mail/root</span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# cat test</span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">13</span></span><br><span class="line"><span class="number">14</span></span><br><span class="line"><span class="number">99</span></span><br><span class="line"><span class="number">81</span></span><br><span class="line"><span class="number">113</span></span><br><span class="line"><span class="number">69</span></span><br><span class="line"><span class="number">32</span></span><br><span class="line"><span class="number">499</span></span><br></pre></td></tr></table></figure>

<h2 id="例4"><a href="#例4" class="headerlink" title="例4"></a>例4</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>xuegod68 mnt]# head <span class="number">-5</span> <span class="number">2.</span>txt </span><br><span class="line"><span class="number">10.0</span><span class="number">.0</span><span class="number">.3</span> --[<span class="number">21</span>/Mar/<span class="number">2015</span><span class="number">-07</span>:<span class="number">50</span>:<span class="number">17</span>+<span class="number">0800</span>]*GET/HTTP/<span class="number">1.1</span>*<span class="number">200</span> <span class="number">19</span> *-*</span><br><span class="line"><span class="number">10.0</span><span class="number">.0</span><span class="number">.3</span> --[<span class="number">21</span>/Mar/<span class="number">2015</span><span class="number">-07</span>:<span class="number">50</span>:<span class="number">17</span>+<span class="number">0800</span>]*GET/HTTP/<span class="number">1.1</span>*<span class="number">200</span> <span class="number">19</span> *-*</span><br><span class="line"><span class="number">10.0</span><span class="number">.0</span><span class="number">.5</span> --[<span class="number">21</span>/Mar/<span class="number">2015</span><span class="number">-07</span>:<span class="number">50</span>:<span class="number">17</span>+<span class="number">0800</span>]*GET/HTTP/<span class="number">1.1</span>*<span class="number">200</span> <span class="number">19</span> *-*</span><br><span class="line"><span class="number">10.0</span><span class="number">.0</span><span class="number">.3</span> --[<span class="number">21</span>/Mar/<span class="number">2015</span><span class="number">-07</span>:<span class="number">50</span>:<span class="number">17</span>+<span class="number">0800</span>]*GET/HTTP/<span class="number">1.1</span>*<span class="number">200</span> <span class="number">19</span> *-*</span><br><span class="line"><span class="number">10.0</span><span class="number">.0</span><span class="number">.6</span> --[<span class="number">21</span>/Mar/<span class="number">2015</span><span class="number">-07</span>:<span class="number">50</span>:<span class="number">17</span>+<span class="number">0800</span>]*GET/HTTP/<span class="number">1.1</span>*<span class="number">200</span> <span class="number">19</span> *-*</span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>xuegod68 mnt]# awk <span class="string">'&#123;array[$1]++&#125; END &#123;for(key in array) printkey,array[key]&#125;'</span> <span class="number">2.</span>txt </span><br><span class="line"><span class="number">10.0</span><span class="number">.0</span><span class="number">.3</span> <span class="number">35</span></span><br><span class="line"><span class="number">10.0</span><span class="number">.0</span><span class="number">.4</span> <span class="number">5</span></span><br><span class="line"><span class="number">10.0</span><span class="number">.0</span><span class="number">.5</span> <span class="number">10</span></span><br><span class="line"><span class="number">10.0</span><span class="number">.0</span><span class="number">.6</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<h2 id="将UID大于等于500的用户及UID打印出来"><a href="#将UID大于等于500的用户及UID打印出来" class="headerlink" title="将UID大于等于500的用户及UID打印出来"></a>将UID大于等于500的用户及UID打印出来</h2><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# awk -F: '$3&gt;=500  &#123;print $1,$3&#125;' /etc/passwd</span><br><span class="line">nfsnobody 65534</span><br><span class="line">admin 502</span><br><span class="line"><span class="keyword">test </span>503</span><br></pre></td></tr></table></figure>

<h2 id="打包当前目录下的所有文件"><a href="#打包当前目录下的所有文件" class="headerlink" title="打包当前目录下的所有文件"></a>打包当前目录下的所有文件</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ls</span> | awk '&#123; <span class="keyword">print</span> <span class="string">"tar zcvf "</span><span class="variable">$0</span><span class="string">".tar.gz "</span> <span class="variable">$0</span>|<span class="string">"/bin/bash"</span> &#125;'</span><br></pre></td></tr></table></figure>

<h2 id="取范围"><a href="#取范围" class="headerlink" title="取范围"></a>取范围</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@VM</span><span class="number">-202</span> zhuo]<span class="meta"># echo <span class="string">"abc#1233+232@jjjj?==="</span> |awk -F <span class="string">'[#@]'</span> <span class="string">'&#123;print $2&#125;'</span></span></span><br><span class="line"><span class="number">1233</span>+<span class="number">232</span> </span><br><span class="line">[root<span class="symbol">@VM</span><span class="number">-202</span> zhuo]<span class="meta"># echo <span class="string">"abc#1233+232@jjjj?==="</span> |awk -F <span class="string">'[@?]'</span> <span class="string">'&#123;print $2&#125;'</span></span></span><br><span class="line">jjjj</span><br></pre></td></tr></table></figure>

<h2 id="匹配非空行"><a href="#匹配非空行" class="headerlink" title="匹配非空行"></a>匹配非空行</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> <span class="string">'/^[^$]/ &#123;print <span class="variable">$0</span>&#125;'</span> test.txt</span><br></pre></td></tr></table></figure>

<h2 id="匹配非包含zhuo的"><a href="#匹配非包含zhuo的" class="headerlink" title="匹配非包含zhuo的"></a>匹配非包含zhuo的</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> <span class="string">'/^[^zhuo]/ &#123;print <span class="variable">$0</span>&#125;'</span> test.txt</span><br></pre></td></tr></table></figure>

<h2 id="替换（将：替换成-）"><a href="#替换（将：替换成-）" class="headerlink" title="替换（将：替换成#）"></a>替换（将：替换成#）</h2><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM<span class="number">-202</span> zhuo]# echo <span class="string">"zhuo:x:503:504::/home/zhuo:/bin/bash"</span> |awk <span class="string">'gsub(/:/,"#") &#123;print $0&#125;'</span></span><br><span class="line">zhuo#x#<span class="number">503</span>#<span class="number">504</span>##/home/zhuo#/bin/bash</span><br></pre></td></tr></table></figure>

<h2 id="列求和、平均值、最大值、最小值"><a href="#列求和、平均值、最大值、最小值" class="headerlink" title="列求和、平均值、最大值、最小值"></a>列求和、平均值、最大值、最小值</h2><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">you.txt文档内容</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"> </span><br><span class="line">列求和： cat you.txt |awk <span class="comment">'&#123;a+=$1&#125;END&#123;print a&#125;'</span></span><br><span class="line">列求平均值：cat you.txt |awk <span class="comment">'&#123;a+=$1&#125;END&#123;print a/NR&#125;'</span></span><br><span class="line">列求最大值：cat you.txt |awk <span class="comment">'BEGIN&#123;a=0&#125;&#123;if ($1&gt;a) a=$1 fi&#125;END&#123;print a&#125;' </span></span><br><span class="line">设定一个变量开始为<span class="number">0</span>，遇到比该数大的值，就赋值给该变量，直到结束。</span><br><span class="line">求最小值：cat you.txt |awk <span class="comment">'BEGIN&#123;a=11111&#125;&#123;if ($1<span class="doctag">&lt;a) a=$1 fi&#125;END&#123;print a&#125;'</span></span></span><br></pre></td></tr></table></figure>

<h2 id="求全文的最值"><a href="#求全文的最值" class="headerlink" title="求全文的最值"></a>求全文的最值</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">求全文的最值</span><br><span class="line">例：求test.txt的最值</span><br><span class="line"><span class="number">12</span> <span class="number">34</span> <span class="number">56</span> <span class="number">78</span></span><br><span class="line"><span class="number">24</span> <span class="number">65</span> <span class="number">87</span> <span class="number">90</span></span><br><span class="line"><span class="number">76</span> <span class="number">11</span> <span class="number">67</span> <span class="number">87</span></span><br><span class="line"><span class="number">100</span> <span class="number">89</span> <span class="number">78</span> <span class="number">99</span></span><br><span class="line">for i in `cat test.txt` ;do echo $i; done |sort |sed -n '<span class="number">1</span>p;<span class="number">2</span>p'</span><br><span class="line"></span><br><span class="line">例<span class="number">2</span>：同样是test.txt</span><br><span class="line">求总和：for i in `cat you.txt`;do echo $i ;done |awk '&#123;a+=$<span class="number">1</span>&#125;END&#123;print a&#125;'</span><br></pre></td></tr></table></figure>

<h2 id="例5"><a href="#例5" class="headerlink" title="例5"></a>例5</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">例<span class="number">3</span>：</span><br><span class="line">A     <span class="number">88</span></span><br><span class="line">B     <span class="number">78</span></span><br><span class="line">B     <span class="number">89</span></span><br><span class="line">C     <span class="number">44</span></span><br><span class="line">A     <span class="number">98</span></span><br><span class="line">C     <span class="number">433</span></span><br><span class="line">要求输出：A：<span class="number">88</span>；<span class="number">98</span></span><br><span class="line">        B：<span class="number">78</span>；<span class="number">89</span></span><br><span class="line">        C：<span class="number">44</span>；<span class="number">433</span></span><br><span class="line"> </span><br><span class="line">awk '&#123;a[$<span class="number">1</span>]=a[$<span class="number">1</span>]<span class="string">" "</span>$<span class="number">2</span>&#125;END&#123;for(i in a)print i,a[i]&#125;' test.txt |awk '&#123;print $<span class="number">1</span><span class="string">":"</span>,$<span class="number">2</span><span class="string">";"</span>,$<span class="number">3</span>&#125;'</span><br></pre></td></tr></table></figure>

<h2 id="使用awk进行数字计算，保留指定位小数"><a href="#使用awk进行数字计算，保留指定位小数" class="headerlink" title="使用awk进行数字计算，保留指定位小数"></a>使用awk进行数字计算，保留指定位小数</h2><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[root@block-storage09 stap]<span class="comment"># echo|awk '&#123;print 17/20&#125;'</span></span><br><span class="line"><span class="number">0</span>.<span class="number">85</span></span><br><span class="line"></span><br><span class="line">[wangdong@centos715-node1 ~]$ echo | awk <span class="string">'&#123;print 1.5*3&#125;'</span></span><br><span class="line"><span class="number">4.5</span></span><br><span class="line"></span><br><span class="line">看上去还可以，那么进一步，我需要带变量：</span><br><span class="line">[wangdong@centos715-node1 ~]$ A=<span class="number">5</span></span><br><span class="line">[wangdong@centos715-node1 ~]$ B=<span class="number">16</span></span><br><span class="line">[wangdong@centos715-node1 ~]$ C=<span class="number">29</span></span><br><span class="line">[wangdong@centos715-node1 ~]$ echo | awk <span class="string">'&#123;print $A/$B&#125;'</span></span><br><span class="line">awk: cmd. line:<span class="number">1</span>: (FILENAME=- FNR=<span class="number">1</span>) fatal: division by zero attempted</span><br><span class="line">[wangdong@centos715-node1 ~]$ echo | awk <span class="string">"&#123;print $A/$B&#125;"</span> </span><br><span class="line"><span class="number">0</span>.<span class="number">3125</span></span><br><span class="line">[wangdong@centos715-node1 ~]$ echo | awk <span class="string">"&#123;print $C*$A&#125;"</span></span><br><span class="line"><span class="number">145</span></span><br><span class="line">[wangdong@centos715-node1 ~]$ echo | awk <span class="string">"&#123;print $C*$A/$B&#125;"</span></span><br><span class="line"><span class="number">9.0625</span></span><br><span class="line">看上去也还可以，只是注意awk后的单引号需要变为双引号。</span><br><span class="line"></span><br><span class="line">再进一步，上面最后一次的计算，小数点后面出现了<span class="number">4</span>位，我希望只保留两位，不然看着太乱。但是没有找到这里可以保留小数位的参数和方法，于是我尝试一下将<span class="keyword">print</span>换为<span class="keyword">printf</span>：</span><br><span class="line">[wangdong@centos715-node1 ~]$ echo | awk <span class="string">'&#123;print 10/3&#125;'</span></span><br><span class="line"><span class="number">3.33333</span></span><br><span class="line">[wangdong@centos715-node1 ~]$ echo | awk <span class="string">'&#123;printf ("%.2f\n",10/3)&#125;'</span> </span><br><span class="line"><span class="number">3.33</span></span><br><span class="line"></span><br><span class="line">将<span class="keyword">print</span>换成<span class="keyword">printf</span>，就可以有方法进行小数位的限制了，看似不错，但是……</span><br><span class="line">[wangdong@centos715-node1 ~]$ A=<span class="number">5</span></span><br><span class="line">[wangdong@centos715-node1 ~]$ B=<span class="number">16</span></span><br><span class="line">[wangdong@centos715-node1 ~]$ C=<span class="number">29</span></span><br><span class="line">[wangdong@centos715-node1 ~]$ echo | awk <span class="string">'&#123;printf ("%.2f\n",$A/$B)&#125;'</span></span><br><span class="line">awk: cmd. line:<span class="number">1</span>: (FILENAME=- FNR=<span class="number">1</span>) fatal: division by zero attempted</span><br><span class="line">[wangdong@centos715-node1 ~]$ echo | awk <span class="string">"&#123;printf ("</span>%.<span class="number">2</span>f\n<span class="string">",$A/$B)&#125;"</span> </span><br><span class="line">awk: cmd. line:<span class="number">1</span>: &#123;<span class="keyword">printf</span> (%.<span class="number">2</span>fn,<span class="number">5</span>/<span class="number">16</span>)&#125;</span><br><span class="line">awk: cmd. line:<span class="number">1</span>:          ^ syntax error</span><br><span class="line">[wangdong@centos715-node1 ~]$ echo | awk <span class="string">"&#123;printf ('%.2f\n',$A/$B)&#125;"</span></span><br><span class="line">awk: cmd. line:<span class="number">1</span>: &#123;<span class="keyword">printf</span> (<span class="string">'%.2f\n'</span>,<span class="number">5</span>/<span class="number">16</span>)&#125;</span><br><span class="line">awk: cmd. line:<span class="number">1</span>:          ^ invalid char <span class="string">''</span><span class="string">' in expression</span></span><br><span class="line"><span class="string">awk: cmd. line:1: &#123;printf ('</span>%.<span class="number">2</span>f\n<span class="string">',5/16)&#125;</span></span><br><span class="line"><span class="string">awk: cmd. line:1:          ^ syntax error</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">使用变量参与计算的话，会发现一直在报错，这种情况，建议先在前面的echo中将需要使用的变量输出出来，再进行调用。</span></span><br><span class="line"><span class="string">[wangdong@centos715-node1 ~]$ A=5</span></span><br><span class="line"><span class="string">[wangdong@centos715-node1 ~]$ B=16</span></span><br><span class="line"><span class="string">[wangdong@centos715-node1 ~]$ C=29</span></span><br><span class="line"><span class="string">[wangdong@centos715-node1 ~]$ D=6</span></span><br><span class="line"><span class="string">[wangdong@centos715-node1 ~]$ echo "$A $B $C $D" | awk '</span>&#123;<span class="keyword">printf</span> (<span class="string">"%.2f\n"</span>,$1*$2/$3-$4)&#125;<span class="string">'</span></span><br><span class="line"><span class="string">-3.24</span></span><br><span class="line"><span class="string">[wangdong@centos715-node1 ~]$ echo "$A $B $C $D" | awk '</span>&#123;<span class="keyword">printf</span> (<span class="string">"%.2f\n"</span>,$1/$4)&#125;<span class="string">'      </span></span><br><span class="line"><span class="string">0.83</span></span><br><span class="line"><span class="string">[wangdong@centos715-node1 ~]$ echo "$A $B $C $D" | awk '</span>&#123;<span class="keyword">printf</span> (<span class="string">"%.3f\n"</span>,$1/$4)&#125;<span class="string">'</span></span><br><span class="line"><span class="string">0.833</span></span><br><span class="line"><span class="string">注意，使用printf的时候，awk后面必须是单引号，双引号会报错。虽然这种方法麻烦一些，但是起码可以实现我的需求，如果有朋友知道bc计算的结果为0-1之间的小数时，怎么让他显示出来前面的0. ，欢迎留言，不喜勿喷。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">补充，有的时候在计算数字后，会发现你的结果已经不是正常的一串数字了，而是在其中穿插了字母e或者E，这是因为数字过大，系统采用了类似于科学计数法的表达方式（正确叫法不确定，勿喷），但是如果直接使用这一串内容再去计算的话，会报错，系统会认为这是字符串而非数字，这种情况也可以使用awk进行转变，其实准确的说是printf的功能。</span></span><br><span class="line"><span class="string">[wangdong@centos715-node1 uncomp]$ echo "6.8923e+08/100" |bc</span></span><br><span class="line"><span class="string">(standard_in) 1: syntax error</span></span><br><span class="line"><span class="string">[wangdong@centos715-node1 uncomp]$ echo "6.8923e+08" | awk '</span>&#123;<span class="keyword">printf</span> (<span class="string">"%.0f\n"</span>,$1)&#125;<span class="string">'</span></span><br><span class="line"><span class="string">689230000</span></span><br></pre></td></tr></table></figure>

<h2 id="其它数字计算方法"><a href="#其它数字计算方法" class="headerlink" title="其它数字计算方法"></a>其它数字计算方法</h2><h3 id="1、bc"><a href="#1、bc" class="headerlink" title="1、bc"></a>1、bc</h3><p>  bc应该是最常用的Linux中计算器了，简单方便，支持浮点。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ echo <span class="number">1</span>+<span class="number">2</span> |bc</span><br><span class="line"><span class="number">3</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ echo <span class="number">5.5</span>*<span class="number">3.3</span> |bc</span><br><span class="line"><span class="number">18.1</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ echo <span class="number">5</span>/<span class="number">3</span> |bc</span><br><span class="line"><span class="number">1</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ echo <span class="string">"scale=2;5/3"</span> |bc</span><br><span class="line"><span class="number">1.66</span></span><br></pre></td></tr></table></figure>

<p>  看似在简单计算时候完美的bc，其实也有一个让我抓狂的地方，当然有可能有办法可以解决，只是我不知道而已，那就是…… 在出现整数部分为0的时候，这个0是不显示出来的，例如0.5只会显示为.5，情何以堪！</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[wangdong<span class="variable">@centos715</span>-node1 ~]<span class="variable">$ </span>echo <span class="string">"scale=2;1/2"</span> |bc</span><br><span class="line">.<span class="number">50</span></span><br><span class="line">[wangdong<span class="variable">@centos715</span>-node1 ~]<span class="variable">$ </span>echo <span class="string">"scale=4;17/20"</span> |bc    </span><br><span class="line">.<span class="number">8500</span></span><br></pre></td></tr></table></figure>

<p>  而且…… 像一些第三方基于Linux底层的产品，为了系统本身的稳定和轻便，默认是不带bc的，例如……F5</p>
<h3 id="2、expr"><a href="#2、expr" class="headerlink" title="2、expr"></a>2、expr</h3><p>  不支持浮点计算，即不支持小数，所以也常被用来判断变量内容或者结果是不是非0整数（expr 0的echo $?不是0）。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ expr <span class="number">3</span> + <span class="number">5</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ expr <span class="number">10</span> / <span class="number">2</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ expr <span class="number">10</span> / <span class="number">3</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ expr <span class="number">7</span> / <span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ expr <span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ echo $?</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">3</span>、$(())</span><br></pre></td></tr></table></figure>

<p>  不支持浮点计算。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ echo $((<span class="number">8</span>+<span class="number">3</span>))</span><br><span class="line"><span class="number">11</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ echo $((<span class="number">10</span>/<span class="number">2</span>))</span><br><span class="line"><span class="number">5</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ echo $((<span class="number">10</span>/<span class="number">3</span>))</span><br><span class="line"><span class="number">3</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ echo $((<span class="number">1.5</span>*<span class="number">3</span>))</span><br><span class="line">-bash: <span class="number">1.5</span>*<span class="number">3</span>: 语法错误: 无效的算术运算符 （错误符号是 <span class="string">".5*3"</span>）</span><br></pre></td></tr></table></figure>

<h3 id="4、let"><a href="#4、let" class="headerlink" title="4、let"></a>4、let</h3><p>  不仅不支持浮点计算，而且还只能赋值，不能直接输出。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ let a=<span class="number">1</span>+<span class="number">2</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ echo $a</span><br><span class="line"><span class="number">3</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ let b=<span class="number">10</span>/<span class="number">5</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ echo $b</span><br><span class="line"><span class="number">2</span></span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ let c=<span class="number">1.5</span>*<span class="number">3</span></span><br><span class="line">-bash: let: c=<span class="number">1.5</span>*<span class="number">3</span>: 语法错误: 无效的算术运算符 （错误符号是 <span class="string">".5*3"</span>）</span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$ echo $c</span><br><span class="line">[<span class="symbol">wangdong@</span>centos715-node1 ~]$</span><br></pre></td></tr></table></figure>

<p>上面的几种方式，是我之前常用的方式，但是现在我在shell脚本中有一个需求，在计算数字时，会出现浮点计算，也会出现0-1之间的小数，前面的几个方式恐怕都无法满足。</p>
<blockquote>
<p>引用：<br><a href="https://www.cnblogs.com/ftl1012/p/9250541.html" target="_blank" rel="noopener external nofollow noreferrer">https://www.cnblogs.com/ftl1012/p/9250541.html</a><br><a href="https://www.cnblogs.com/xudong-bupt/p/3721210.html" target="_blank" rel="noopener external nofollow noreferrer">https://www.cnblogs.com/xudong-bupt/p/3721210.html</a><br><a href="https://www.cnblogs.com/jackhub/p/3549091.html" target="_blank" rel="noopener external nofollow noreferrer">https://www.cnblogs.com/jackhub/p/3549091.html</a><br><a href="http://www.mamicode.com/info-detail-1187091.html" target="_blank" rel="noopener external nofollow noreferrer">http://www.mamicode.com/info-detail-1187091.html</a></p>
</blockquote>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章推荐</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2007\01\01\linux\2007-01-01-linux-string\" rel="bookmark">字符串</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2007\01\03\linux\2007-01-03-linux-wildcard\" rel="bookmark">通配符-元字符-转义符</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2007\01\02\linux\2007-01-02-linux-ASCII\" rel="bookmark">ASCII</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2007\01\04\linux\2007-01-04-linux-cat\" rel="bookmark">cat</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2007\01\05\linux\2007-01-05-linux-cut\" rel="bookmark">cut</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div>赞赏一下吧～</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="tongsiying 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>tongsiying
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/" title="awk">https://tongsiying.github.io/2007/01/11/linux/2007-01-11-linux-awk/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/linux-%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/" rel="tag"># linux-文件管理</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2007/01/10/linux/2007-01-10-linux-sed/" rel="prev" title="sed">
      <i class="fa fa-chevron-left"></i> sed
    </a></div>
      <div class="post-nav-item">
    <a href="/2007/01/12/linux/2007-01-12-linux-split/" rel="next" title="split">
      split <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-使用方法"><span class="nav-text">1.使用方法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-变量"><span class="nav-text">2. 变量</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-运算符"><span class="nav-text">3. 运算符</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-awk的正则"><span class="nav-text">4. awk的正则</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-字符串函数"><span class="nav-text">5.字符串函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-sub-gsub-替换"><span class="nav-text">1. sub&#x2F;gsub 替换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-toupper-tolower-大-小写转换"><span class="nav-text">2. toupper&#x2F;tolower 大&#x2F;小写转换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-length-获取长度"><span class="nav-text">3. length 获取长度</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-substr-截取子串"><span class="nav-text">4. substr 截取子串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-index-match-获取位置-第一次出现"><span class="nav-text">5. index&#x2F;match 获取位置(第一次出现)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#awk常用场景"><span class="nav-text">awk常用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#最后注意点："><span class="nav-text">最后注意点：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-数学函数"><span class="nav-text">6.数学函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-format的使用"><span class="nav-text">7. format的使用</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-print"><span class="nav-text">8.print</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#print-是awk打印指定内容的主要命令"><span class="nav-text">print 是awk打印指定内容的主要命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出最后一列"><span class="nav-text">输出最后一列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出整行"><span class="nav-text">输出整行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出倒数第二列"><span class="nav-text">输出倒数第二列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出共有多少列"><span class="nav-text">输出共有多少列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出多列"><span class="nav-text">输出多列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加自定义字段"><span class="nav-text">添加自定义字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多分隔符的使用："><span class="nav-text">多分隔符的使用：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-pattern"><span class="nav-text">9.pattern</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#begin-简单语法"><span class="nav-text">begin 简单语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不添加输入文件"><span class="nav-text">不添加输入文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#begin-pattern-演示"><span class="nav-text">begin +pattern 演示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#END"><span class="nav-text">END</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-awk编程–变量和赋值"><span class="nav-text">10.awk编程–变量和赋值</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-f指定脚本文件"><span class="nav-text">11..-f指定脚本文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#12-F指定分隔符"><span class="nav-text">12.-F指定分隔符</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#13-匹配代码块"><span class="nav-text">13.&#x2F;&#x2F;匹配代码块</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#14-IF语句"><span class="nav-text">14.IF语句</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#15-条件表达式"><span class="nav-text">15.条件表达式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#16-逻辑运算符"><span class="nav-text">16.逻辑运算符</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#17-数值运算"><span class="nav-text">17.数值运算</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#18-指定输入和输出分隔符OFS"><span class="nav-text">18.指定输入和输出分隔符OFS</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#19-格式化输出"><span class="nav-text">19.格式化输出</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#20-IF语句"><span class="nav-text">20.IF语句</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#21-数组"><span class="nav-text">21.数组</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#22-应用"><span class="nav-text">22.应用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#输出文件每行有多少字段"><span class="nav-text">输出文件每行有多少字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出前5个字段"><span class="nav-text">输出前5个字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出前5个字段并使用制表符分隔输出"><span class="nav-text">输出前5个字段并使用制表符分隔输出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#制表符分隔输出前5个字段，并打印行号"><span class="nav-text">制表符分隔输出前5个字段，并打印行号</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指定多个分隔符-，输出每行多少字段"><span class="nav-text">指定多个分隔符: #，输出每行多少字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#制表符分隔输出多字段"><span class="nav-text">制表符分隔输出多字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指定三个分隔符，并输出每行字段数"><span class="nav-text">指定三个分隔符，并输出每行字段数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#制表符分隔输出多字段-1"><span class="nav-text">制表符分隔输出多字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#计算-home目录下，普通文件的大小，使用KB作为单位"><span class="nav-text">计算&#x2F;home目录下，普通文件的大小，使用KB作为单位</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#统计netstat-anp-状态为LISTEN和CONNECT的连接数量分别是多少"><span class="nav-text">统计netstat -anp 状态为LISTEN和CONNECT的连接数量分别是多少</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#统计-home目录下不同用户的普通文件的总数是多少？"><span class="nav-text">统计&#x2F;home目录下不同用户的普通文件的总数是多少？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#统计-home目录下不同用户的普通文件的大小总size是多少？"><span class="nav-text">统计&#x2F;home目录下不同用户的普通文件的大小总size是多少？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出成绩表"><span class="nav-text">输出成绩表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#例1"><span class="nav-text">例1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#例2"><span class="nav-text">例2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#例3"><span class="nav-text">例3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取本机上网络接口上可用的公网IP地址"><span class="nav-text">获取本机上网络接口上可用的公网IP地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#awk取出last命令结果中非空行"><span class="nav-text">awk取出last命令结果中非空行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#将passwd中的第三列放到test中"><span class="nav-text">将passwd中的第三列放到test中</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#例4"><span class="nav-text">例4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#将UID大于等于500的用户及UID打印出来"><span class="nav-text">将UID大于等于500的用户及UID打印出来</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打包当前目录下的所有文件"><span class="nav-text">打包当前目录下的所有文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#取范围"><span class="nav-text">取范围</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#匹配非空行"><span class="nav-text">匹配非空行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#匹配非包含zhuo的"><span class="nav-text">匹配非包含zhuo的</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#替换（将：替换成-）"><span class="nav-text">替换（将：替换成#）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#列求和、平均值、最大值、最小值"><span class="nav-text">列求和、平均值、最大值、最小值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#求全文的最值"><span class="nav-text">求全文的最值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#例5"><span class="nav-text">例5</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用awk进行数字计算，保留指定位小数"><span class="nav-text">使用awk进行数字计算，保留指定位小数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其它数字计算方法"><span class="nav-text">其它数字计算方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、bc"><span class="nav-text">1、bc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、expr"><span class="nav-text">2、expr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、let"><span class="nav-text">4、let</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="tongsiying"
      src="/images/gutianle.gif">
  <p class="site-author-name" itemprop="name">tongsiying</p>
  <div class="site-description" itemprop="description">问渠那得清如许？为有源头活水来。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">427</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tongsiying" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tongsiying" rel="noopener external nofollow noreferrer" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wxtlucky1015@163.com" title="E-Mail → mailto:wxtlucky1015@163.com" rel="noopener external nofollow noreferrer" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/2964109344" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;2964109344" rel="noopener external nofollow noreferrer" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/" title="tongsiying → https:&#x2F;&#x2F;tongsiying.github.io"><i class="wrench fa-fw"></i>tongsiying</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/ReadingNotes/" title="ReadingNotes → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;ReadingNotes&#x2F;"><i class="book fa-fw"></i>ReadingNotes</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/blog/" title="blog → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;blog&#x2F;"><i class="book fa-fw"></i>blog</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/blog/tools/" title="tools → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;blog&#x2F;tools&#x2F;"><i class="wrench fa-fw"></i>tools</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/lanlan/" title="lanlan → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;lanlan&#x2F;"><i class="wrench fa-fw"></i>lanlan</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/Music/" title="note → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;Music&#x2F;"><i class="wrench fa-fw"></i>note</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/sound/" title="Music → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;sound&#x2F;"><i class="wrench fa-fw"></i>Music</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/JSONFormat/" title="JSONFormat → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;JSONFormat&#x2F;"><i class="wrench fa-fw"></i>JSONFormat</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/HTML5-Canvas/" title="Canvas → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;HTML5-Canvas&#x2F;"><i class="wrench fa-fw"></i>Canvas</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/games/" title="games → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;games&#x2F;"><i class="wrench fa-fw"></i>games</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tongsiying.github.io/love/" title="love → https:&#x2F;&#x2F;tongsiying.github.io&#x2F;love&#x2F;"><i class="wrench fa-fw"></i>love</a>
      </span>
  </div>



		<div style="">
  <canvas id="canvas" style="width:60%;">��ǰ�������֧��canvas������������������</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //����canvas�Ŀ���
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //�洢ʱ������
    var data = [];
    //�洢�˶���С��
    var balls = [];
    //�������Ӱ뾶
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //�洢ʱ�����֣���ʮλСʱ����λСʱ��ð�š�ʮλ���ӡ���λ���ӡ�ð�š�ʮλ���ӡ���λ������7���������
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*���ɵ�������*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*����ʱ��*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //ʱ�䷢���仯
            if(NewData[i] !== data[i]){
                //���仯������ֵ����data�����е������洢��changeNumArray������
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //����С��
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*����С��״̬*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*����Ҫ�˶���С��*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*��Ⱦ*/
    function render(){
        //���û������ȣ��ﵽ��ջ�����Ч��
        canvas.height = 100;
        //��Ⱦʱ��
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //��ȾС��
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //����ʱ��
        updateDigitTime();
        //����С��״̬
        updateBalls();
        //��Ⱦ
        render();
    },50);
}

})();
</script>
      </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; Weeny – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tongsiying</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">6.3m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">95:48</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
